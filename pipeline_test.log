2024-12-22 12:29:41,068 - __main__ - INFO - Starting pipeline test
2024-12-22 12:29:41,068 - __main__ - INFO - Input directory: /Users/rob/repos/kalliste/test_images_input
2024-12-22 12:29:41,068 - __main__ - INFO - Output directory: /Users/rob/repos/kalliste/test_images_output
2024-12-22 12:29:41,068 - __main__ - INFO - Initializing BatchProcessor
2024-12-22 12:29:41,068 - kalliste.image.batch_processor - INFO - Initializing BatchProcessor with input_root=/Users/rob/repos/kalliste/test_images_input, output_root=/Users/rob/repos/kalliste/test_images_output
2024-12-22 12:29:41,068 - kalliste.image.batch_processor - INFO - Initializing model registry
2024-12-22 12:29:41,068 - kalliste.image.batch_processor - ERROR - Failed to initialize model registry: asyncio.run() cannot be called from a running event loop
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/batch_processor.py", line 22, in __init__
    asyncio.run(ModelRegistry.initialize())
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/asyncio/runners.py", line 186, in run
    raise RuntimeError(
RuntimeError: asyncio.run() cannot be called from a running event loop
2024-12-22 12:29:41,068 - __main__ - ERROR - Failed to initialize BatchProcessor: Failed to initialize batch processor models: asyncio.run() cannot be called from a running event loop
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/batch_processor.py", line 22, in __init__
    asyncio.run(ModelRegistry.initialize())
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/asyncio/runners.py", line 186, in run
    raise RuntimeError(
RuntimeError: asyncio.run() cannot be called from a running event loop

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/scripts/test_pipeline.py", line 43, in main
    processor = BatchProcessor(
                ^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/image/batch_processor.py", line 27, in __init__
    raise RuntimeError(f"Failed to initialize batch processor models: {e}") from e
RuntimeError: Failed to initialize batch processor models: asyncio.run() cannot be called from a running event loop
2024-12-22 12:29:41,068 - __main__ - ERROR - Pipeline test failed: Failed to initialize batch processor models: asyncio.run() cannot be called from a running event loop
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/batch_processor.py", line 22, in __init__
    asyncio.run(ModelRegistry.initialize())
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/asyncio/runners.py", line 186, in run
    raise RuntimeError(
RuntimeError: asyncio.run() cannot be called from a running event loop

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/scripts/test_pipeline.py", line 65, in <module>
    asyncio.run(main())
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
           ^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/asyncio/base_events.py", line 654, in run_until_complete
    return future.result()
           ^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/scripts/test_pipeline.py", line 43, in main
    processor = BatchProcessor(
                ^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/image/batch_processor.py", line 27, in __init__
    raise RuntimeError(f"Failed to initialize batch processor models: {e}") from e
RuntimeError: Failed to initialize batch processor models: asyncio.run() cannot be called from a running event loop
2024-12-22 12:33:04,922 - __main__ - INFO - Starting pipeline test
2024-12-22 12:33:04,922 - __main__ - INFO - Input directory: /Users/rob/repos/kalliste/test_images_input
2024-12-22 12:33:04,922 - __main__ - INFO - Output directory: /Users/rob/repos/kalliste/test_images_output
2024-12-22 12:33:04,922 - __main__ - INFO - Initializing BatchProcessor
2024-12-22 12:33:04,922 - kalliste.image.batch_processor - INFO - Initializing BatchProcessor with input_root=/Users/rob/repos/kalliste/test_images_input, output_root=/Users/rob/repos/kalliste/test_images_output
2024-12-22 12:33:04,922 - kalliste.image.batch_processor - INFO - Initializing model registry
2024-12-22 12:33:04,922 - kalliste.image.batch_processor - ERROR - Failed to initialize model registry: asyncio.run() cannot be called from a running event loop
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/batch_processor.py", line 22, in __init__
    asyncio.run(ModelRegistry.initialize())
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/asyncio/runners.py", line 186, in run
    raise RuntimeError(
RuntimeError: asyncio.run() cannot be called from a running event loop
2024-12-22 12:33:04,922 - __main__ - ERROR - Failed to initialize BatchProcessor: Failed to initialize batch processor models: asyncio.run() cannot be called from a running event loop
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/batch_processor.py", line 22, in __init__
    asyncio.run(ModelRegistry.initialize())
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/asyncio/runners.py", line 186, in run
    raise RuntimeError(
RuntimeError: asyncio.run() cannot be called from a running event loop

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/scripts/test_pipeline.py", line 43, in main
    processor = BatchProcessor(
                ^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/image/batch_processor.py", line 27, in __init__
    raise RuntimeError(f"Failed to initialize batch processor models: {e}") from e
RuntimeError: Failed to initialize batch processor models: asyncio.run() cannot be called from a running event loop
2024-12-22 12:33:04,923 - __main__ - ERROR - Pipeline test failed: Failed to initialize batch processor models: asyncio.run() cannot be called from a running event loop
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/batch_processor.py", line 22, in __init__
    asyncio.run(ModelRegistry.initialize())
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/asyncio/runners.py", line 186, in run
    raise RuntimeError(
RuntimeError: asyncio.run() cannot be called from a running event loop

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/scripts/test_pipeline.py", line 69, in <module>
    asyncio.run(main())
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
           ^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/asyncio/base_events.py", line 654, in run_until_complete
    return future.result()
           ^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/scripts/test_pipeline.py", line 43, in main
    processor = BatchProcessor(
                ^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/image/batch_processor.py", line 27, in __init__
    raise RuntimeError(f"Failed to initialize batch processor models: {e}") from e
RuntimeError: Failed to initialize batch processor models: asyncio.run() cannot be called from a running event loop
2024-12-22 12:34:34,408 - __main__ - INFO - Starting pipeline test
2024-12-22 12:34:34,408 - __main__ - INFO - Input directory: /Users/rob/repos/kalliste/test_images_input
2024-12-22 12:34:34,408 - __main__ - INFO - Output directory: /Users/rob/repos/kalliste/test_images_output
2024-12-22 12:34:34,408 - __main__ - INFO - Initializing BatchProcessor
2024-12-22 12:34:34,408 - kalliste.image.batch_processor - INFO - Initializing BatchProcessor with input_root=/Users/rob/repos/kalliste/test_images_input, output_root=/Users/rob/repos/kalliste/test_images_output
2024-12-22 12:34:34,408 - kalliste.image.batch_processor - INFO - Scanning for batches in /Users/rob/repos/kalliste/test_images_input
2024-12-22 12:34:34,408 - kalliste.image.batch - INFO - Initializing Batch with input_path=/Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2, max_concurrent=3
2024-12-22 12:34:34,408 - kalliste.image.batch - INFO - Scanning for images in /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2
2024-12-22 12:34:34,408 - kalliste.image.batch - INFO - Found 9 images to process in batch 20180312_Photoshoot2
2024-12-22 12:34:34,408 - kalliste.image.batch - INFO - Initializing Batch with input_path=/Users/rob/repos/kalliste/test_images_input/20241012_Photoshoot1, max_concurrent=3
2024-12-22 12:34:34,409 - kalliste.image.batch - INFO - Scanning for images in /Users/rob/repos/kalliste/test_images_input/20241012_Photoshoot1
2024-12-22 12:34:34,409 - kalliste.image.batch - INFO - Found 12 images to process in batch 20241012_Photoshoot1
2024-12-22 12:34:34,409 - kalliste.image.batch_processor - INFO - Found 2 batches to process
2024-12-22 12:34:34,409 - __main__ - INFO - BatchProcessor created
2024-12-22 12:34:34,409 - __main__ - INFO - Initializing models
2024-12-22 12:34:34,409 - kalliste.image.batch_processor - INFO - Initializing model registry
2024-12-22 12:34:34,409 - kalliste.image.batch_processor - ERROR - Failed to initialize model registry: asyncio.run() cannot be called from a running event loop
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/batch_processor.py", line 25, in initialize
    asyncio.run(ModelRegistry.initialize())
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/asyncio/runners.py", line 186, in run
    raise RuntimeError(
RuntimeError: asyncio.run() cannot be called from a running event loop
2024-12-22 12:34:34,409 - __main__ - ERROR - Failed to initialize BatchProcessor: Failed to initialize batch processor models: asyncio.run() cannot be called from a running event loop
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/batch_processor.py", line 25, in initialize
    asyncio.run(ModelRegistry.initialize())
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/asyncio/runners.py", line 186, in run
    raise RuntimeError(
RuntimeError: asyncio.run() cannot be called from a running event loop

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/scripts/test_pipeline.py", line 50, in main
    await processor.initialize()
  File "/Users/rob/repos/kalliste/kalliste/image/batch_processor.py", line 30, in initialize
    raise RuntimeError(f"Failed to initialize batch processor models: {e}") from e
RuntimeError: Failed to initialize batch processor models: asyncio.run() cannot be called from a running event loop
2024-12-22 12:34:34,409 - __main__ - ERROR - Pipeline test failed: Failed to initialize batch processor models: asyncio.run() cannot be called from a running event loop
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/batch_processor.py", line 25, in initialize
    asyncio.run(ModelRegistry.initialize())
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/asyncio/runners.py", line 186, in run
    raise RuntimeError(
RuntimeError: asyncio.run() cannot be called from a running event loop

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/scripts/test_pipeline.py", line 69, in <module>
    asyncio.run(main())
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
           ^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/asyncio/base_events.py", line 654, in run_until_complete
    return future.result()
           ^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/scripts/test_pipeline.py", line 50, in main
    await processor.initialize()
  File "/Users/rob/repos/kalliste/kalliste/image/batch_processor.py", line 30, in initialize
    raise RuntimeError(f"Failed to initialize batch processor models: {e}") from e
RuntimeError: Failed to initialize batch processor models: asyncio.run() cannot be called from a running event loop
2024-12-22 12:37:20,689 - __main__ - INFO - Starting pipeline test
2024-12-22 12:37:20,689 - __main__ - INFO - Input directory: /Users/rob/repos/kalliste/test_images_input
2024-12-22 12:37:20,689 - __main__ - INFO - Output directory: /Users/rob/repos/kalliste/test_images_output
2024-12-22 12:37:20,689 - __main__ - INFO - Initializing BatchProcessor
2024-12-22 12:37:20,689 - kalliste.image.batch_processor - INFO - Initializing BatchProcessor with input_root=/Users/rob/repos/kalliste/test_images_input, output_root=/Users/rob/repos/kalliste/test_images_output
2024-12-22 12:37:20,689 - kalliste.image.batch_processor - INFO - Scanning for batches in /Users/rob/repos/kalliste/test_images_input
2024-12-22 12:37:20,689 - kalliste.image.batch - INFO - Initializing Batch with input_path=/Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2, max_concurrent=3
2024-12-22 12:37:20,689 - kalliste.image.batch - INFO - Scanning for images in /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2
2024-12-22 12:37:20,689 - kalliste.image.batch - INFO - Found 9 images to process in batch 20180312_Photoshoot2
2024-12-22 12:37:20,689 - kalliste.image.batch - INFO - Initializing Batch with input_path=/Users/rob/repos/kalliste/test_images_input/20241012_Photoshoot1, max_concurrent=3
2024-12-22 12:37:20,689 - kalliste.image.batch - INFO - Scanning for images in /Users/rob/repos/kalliste/test_images_input/20241012_Photoshoot1
2024-12-22 12:37:20,690 - kalliste.image.batch - INFO - Found 12 images to process in batch 20241012_Photoshoot1
2024-12-22 12:37:20,690 - kalliste.image.batch_processor - INFO - Found 2 batches to process
2024-12-22 12:37:20,690 - __main__ - INFO - BatchProcessor created
2024-12-22 12:37:20,690 - __main__ - INFO - Initializing models
2024-12-22 12:37:20,690 - kalliste.image.batch_processor - INFO - Initializing model registry
2024-12-22 12:39:00,474 - __main__ - INFO - Pipeline test interrupted by user
2024-12-22 12:39:39,159 - __main__ - INFO - Starting pipeline test
2024-12-22 12:39:39,159 - __main__ - INFO - Input directory: /Users/rob/repos/kalliste/test_images_input
2024-12-22 12:39:39,159 - __main__ - INFO - Output directory: /Users/rob/repos/kalliste/test_images_output
2024-12-22 12:39:39,159 - __main__ - INFO - Initializing BatchProcessor
2024-12-22 12:39:39,159 - kalliste.image.batch_processor - INFO - Initializing BatchProcessor with input_root=/Users/rob/repos/kalliste/test_images_input, output_root=/Users/rob/repos/kalliste/test_images_output
2024-12-22 12:39:39,159 - __main__ - INFO - BatchProcessor created
2024-12-22 12:39:39,159 - __main__ - INFO - Initializing models
2024-12-22 12:39:39,159 - kalliste.image.batch_processor - INFO - Initializing model registry
2024-12-22 12:40:22,282 - __main__ - INFO - Pipeline test interrupted by user
2024-12-22 12:41:03,528 - __main__ - INFO - Starting pipeline test
2024-12-22 12:41:03,528 - __main__ - INFO - Input directory: /Users/rob/repos/kalliste/test_images_input
2024-12-22 12:41:03,528 - __main__ - INFO - Output directory: /Users/rob/repos/kalliste/test_images_output
2024-12-22 12:41:03,528 - __main__ - INFO - Initializing BatchProcessor
2024-12-22 12:41:03,528 - kalliste.image.batch_processor - INFO - Initializing BatchProcessor with input_root=/Users/rob/repos/kalliste/test_images_input, output_root=/Users/rob/repos/kalliste/test_images_output
2024-12-22 12:41:03,528 - kalliste.image.batch_processor - INFO - Scanning for batches in /Users/rob/repos/kalliste/test_images_input
2024-12-22 12:41:03,528 - kalliste.image.batch - INFO - Initializing Batch with input_path=/Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2, max_concurrent=3
2024-12-22 12:41:03,528 - kalliste.image.batch - INFO - Scanning for images in /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2
2024-12-22 12:41:03,528 - kalliste.image.batch - INFO - Found 9 images to process in batch 20180312_Photoshoot2
2024-12-22 12:41:03,528 - kalliste.image.batch - INFO - Initializing Batch with input_path=/Users/rob/repos/kalliste/test_images_input/20241012_Photoshoot1, max_concurrent=3
2024-12-22 12:41:03,529 - kalliste.image.batch - INFO - Scanning for images in /Users/rob/repos/kalliste/test_images_input/20241012_Photoshoot1
2024-12-22 12:41:03,529 - kalliste.image.batch - INFO - Found 12 images to process in batch 20241012_Photoshoot1
2024-12-22 12:41:03,529 - kalliste.image.batch_processor - INFO - Found 2 batches to process
2024-12-22 12:41:03,529 - __main__ - INFO - BatchProcessor created
2024-12-22 12:41:03,529 - __main__ - INFO - Initializing models
2024-12-22 12:41:03,529 - kalliste.image.batch_processor - INFO - Initializing model registry
2024-12-22 12:43:14,038 - __main__ - INFO - Pipeline test interrupted by user
2024-12-22 12:43:18,735 - __main__ - INFO - Starting pipeline test
2024-12-22 12:43:18,735 - __main__ - INFO - Input directory: /Users/rob/repos/kalliste/test_images_input
2024-12-22 12:43:18,735 - __main__ - INFO - Output directory: /Users/rob/repos/kalliste/test_images_output
2024-12-22 12:43:18,736 - __main__ - INFO - Initializing BatchProcessor
2024-12-22 12:43:18,736 - kalliste.image.batch_processor - INFO - Initializing BatchProcessor with input_root=/Users/rob/repos/kalliste/test_images_input, output_root=/Users/rob/repos/kalliste/test_images_output
2024-12-22 12:43:18,736 - kalliste.image.batch_processor - INFO - Scanning for batches in /Users/rob/repos/kalliste/test_images_input
2024-12-22 12:43:18,736 - kalliste.image.batch - INFO - Initializing Batch with input_path=/Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2, max_concurrent=3
2024-12-22 12:43:18,736 - kalliste.image.batch - INFO - Scanning for images in /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2
2024-12-22 12:43:18,736 - kalliste.image.batch - INFO - Found 9 images to process in batch 20180312_Photoshoot2
2024-12-22 12:43:18,736 - kalliste.image.batch - INFO - Initializing Batch with input_path=/Users/rob/repos/kalliste/test_images_input/20241012_Photoshoot1, max_concurrent=3
2024-12-22 12:43:18,736 - kalliste.image.batch - INFO - Scanning for images in /Users/rob/repos/kalliste/test_images_input/20241012_Photoshoot1
2024-12-22 12:43:18,737 - kalliste.image.batch - INFO - Found 12 images to process in batch 20241012_Photoshoot1
2024-12-22 12:43:18,737 - kalliste.image.batch_processor - INFO - Found 2 batches to process
2024-12-22 12:43:18,737 - __main__ - INFO - BatchProcessor created
2024-12-22 12:43:18,737 - __main__ - INFO - Initializing models
2024-12-22 12:43:18,737 - kalliste.image.batch_processor - INFO - Initializing model registry
2024-12-22 12:43:18,737 - kalliste.image.model_registry - INFO - Starting model registry initialization
2024-12-22 12:43:18,737 - kalliste.image.model_registry - INFO - Initializing tagger pipeline...
2024-12-22 12:43:18,737 - kalliste.taggers.tagger_pipeline - INFO - Creating TaggerPipeline instance
2024-12-22 12:43:18,843 - kalliste.taggers.base_tagger - INFO - MPS device validated
2024-12-22 12:43:18,843 - kalliste.taggers.tagger_pipeline - INFO - TaggerPipeline created with device: mps
2024-12-22 12:43:18,843 - kalliste.taggers.tagger_pipeline - INFO - Starting TaggerPipeline initialization
2024-12-22 12:43:18,843 - kalliste.taggers.tagger_pipeline - INFO - Initializing orientation tagger
2024-12-22 12:43:18,843 - kalliste.taggers.base_tagger - INFO - Initializing OrientationTagger on device: mps
2024-12-22 12:43:18,843 - kalliste.taggers.orientation_tagger - INFO - Loading orientation model: LucyintheSky/pose-estimation-front-side-back
2024-12-22 12:43:20,292 - kalliste.taggers.orientation_tagger - INFO - Orientation model loaded successfully on cpu
2024-12-22 12:43:20,292 - kalliste.taggers.tagger_pipeline - INFO - Successfully initialized orientation tagger
2024-12-22 12:43:20,292 - kalliste.taggers.tagger_pipeline - INFO - Initializing wd14 tagger
2024-12-22 12:43:20,292 - kalliste.taggers.base_tagger - INFO - Initializing WD14Tagger on device: mps
2024-12-22 12:43:20,292 - kalliste.taggers.wd14_tagger - INFO - Loading WD14 model: hf_hub:SmilingWolf/wd-vit-large-tagger-v3
2024-12-22 12:43:34,675 - timm.models._builder - INFO - Loading pretrained weights from Hugging Face hub (SmilingWolf/wd-vit-large-tagger-v3)
2024-12-22 12:43:34,779 - timm.models._hub - INFO - [SmilingWolf/wd-vit-large-tagger-v3] Safe alternative available for 'pytorch_model.bin' (as 'model.safetensors'). Loading weights using safetensors.
2024-12-22 12:43:36,774 - kalliste.taggers.wd14_tagger - INFO - Loaded 10861 WD14 tags
2024-12-22 12:43:36,774 - kalliste.taggers.tagger_pipeline - INFO - Successfully initialized wd14 tagger
2024-12-22 12:43:36,774 - kalliste.taggers.tagger_pipeline - INFO - Initializing caption tagger
2024-12-22 12:43:36,774 - kalliste.taggers.base_tagger - INFO - Initializing CaptionTagger on device: mps
2024-12-22 12:43:36,774 - kalliste.taggers.caption_tagger - INFO - Loading BLIP2 model: Salesforce/blip2-opt-2.7b
2024-12-22 12:43:38,460 - kalliste.taggers.caption_tagger - INFO - BLIP2 model loaded successfully on cpu
2024-12-22 12:43:38,460 - kalliste.taggers.tagger_pipeline - INFO - Successfully initialized caption tagger
2024-12-22 12:43:38,460 - kalliste.taggers.tagger_pipeline - INFO - TaggerPipeline initialization complete
2024-12-22 12:43:38,460 - kalliste.image.model_registry - INFO - Tagger pipeline initialized successfully
2024-12-22 12:43:38,460 - kalliste.image.model_registry - INFO - Initializing YOLO detector...
2024-12-22 12:43:38,460 - kalliste.image.model_registry - ERROR - Failed to initialize models: DetectionConfig.__init__() got an unexpected keyword argument 'nms_threshold'
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/model_registry.py", line 34, in initialize
    detector_config = DetectionConfig(
                      ^^^^^^^^^^^^^^^^
TypeError: DetectionConfig.__init__() got an unexpected keyword argument 'nms_threshold'
2024-12-22 12:43:38,460 - kalliste.image.model_registry - INFO - Starting model registry cleanup
2024-12-22 12:44:40,288 - __main__ - INFO - Pipeline test interrupted by user
2024-12-22 12:45:06,930 - __main__ - INFO - Starting pipeline test
2024-12-22 12:45:06,931 - __main__ - INFO - Input directory: /Users/rob/repos/kalliste/test_images_input
2024-12-22 12:45:06,931 - __main__ - INFO - Output directory: /Users/rob/repos/kalliste/test_images_output
2024-12-22 12:45:06,931 - __main__ - INFO - Initializing BatchProcessor
2024-12-22 12:45:06,931 - kalliste.image.batch_processor - INFO - Initializing BatchProcessor with input_root=/Users/rob/repos/kalliste/test_images_input, output_root=/Users/rob/repos/kalliste/test_images_output
2024-12-22 12:45:06,931 - kalliste.image.batch_processor - INFO - Scanning for batches in /Users/rob/repos/kalliste/test_images_input
2024-12-22 12:45:06,931 - kalliste.image.batch - INFO - Initializing Batch with input_path=/Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2, max_concurrent=3
2024-12-22 12:45:06,931 - kalliste.image.batch - INFO - Scanning for images in /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2
2024-12-22 12:45:06,932 - kalliste.image.batch - INFO - Found 9 images to process in batch 20180312_Photoshoot2
2024-12-22 12:45:06,932 - kalliste.image.batch - INFO - Initializing Batch with input_path=/Users/rob/repos/kalliste/test_images_input/20241012_Photoshoot1, max_concurrent=3
2024-12-22 12:45:06,932 - kalliste.image.batch - INFO - Scanning for images in /Users/rob/repos/kalliste/test_images_input/20241012_Photoshoot1
2024-12-22 12:45:06,932 - kalliste.image.batch - INFO - Found 12 images to process in batch 20241012_Photoshoot1
2024-12-22 12:45:06,932 - kalliste.image.batch_processor - INFO - Found 2 batches to process
2024-12-22 12:45:06,932 - __main__ - INFO - BatchProcessor created
2024-12-22 12:45:06,932 - __main__ - INFO - Initializing models
2024-12-22 12:45:06,932 - kalliste.image.batch_processor - INFO - Initializing model registry
2024-12-22 12:45:06,932 - kalliste.image.model_registry - INFO - Starting model registry initialization
2024-12-22 12:45:06,932 - kalliste.image.model_registry - INFO - Initializing tagger pipeline...
2024-12-22 12:45:06,932 - kalliste.taggers.tagger_pipeline - INFO - Creating TaggerPipeline instance
2024-12-22 12:45:06,990 - kalliste.taggers.base_tagger - INFO - MPS device validated
2024-12-22 12:45:06,990 - kalliste.taggers.tagger_pipeline - INFO - TaggerPipeline created with device: mps
2024-12-22 12:45:06,990 - kalliste.taggers.tagger_pipeline - INFO - Starting TaggerPipeline initialization
2024-12-22 12:45:06,990 - kalliste.taggers.tagger_pipeline - INFO - Initializing wd14 tagger
2024-12-22 12:45:06,990 - kalliste.taggers.base_tagger - INFO - Initializing WD14Tagger on device: mps
2024-12-22 12:45:06,990 - kalliste.taggers.wd14_tagger - INFO - Loading WD14 model: hf_hub:SmilingWolf/wd-vit-large-tagger-v3
2024-12-22 12:45:21,547 - timm.models._builder - INFO - Loading pretrained weights from Hugging Face hub (SmilingWolf/wd-vit-large-tagger-v3)
2024-12-22 12:45:21,664 - timm.models._hub - INFO - [SmilingWolf/wd-vit-large-tagger-v3] Safe alternative available for 'pytorch_model.bin' (as 'model.safetensors'). Loading weights using safetensors.
2024-12-22 12:45:21,851 - kalliste.taggers.wd14_tagger - INFO - Loaded 10861 WD14 tags
2024-12-22 12:45:21,852 - kalliste.taggers.tagger_pipeline - INFO - Successfully initialized wd14 tagger
2024-12-22 12:45:21,852 - kalliste.taggers.tagger_pipeline - INFO - Initializing caption tagger
2024-12-22 12:45:21,852 - kalliste.taggers.base_tagger - INFO - Initializing CaptionTagger on device: mps
2024-12-22 12:45:21,852 - kalliste.taggers.caption_tagger - INFO - Loading BLIP2 model: Salesforce/blip2-opt-2.7b
2024-12-22 12:45:23,679 - kalliste.taggers.caption_tagger - INFO - BLIP2 model loaded successfully on cpu
2024-12-22 12:45:23,679 - kalliste.taggers.tagger_pipeline - INFO - Successfully initialized caption tagger
2024-12-22 12:45:23,679 - kalliste.taggers.tagger_pipeline - INFO - Initializing orientation tagger
2024-12-22 12:45:23,679 - kalliste.taggers.base_tagger - INFO - Initializing OrientationTagger on device: mps
2024-12-22 12:45:23,679 - kalliste.taggers.orientation_tagger - INFO - Loading orientation model: LucyintheSky/pose-estimation-front-side-back
2024-12-22 12:45:24,932 - kalliste.taggers.orientation_tagger - INFO - Orientation model loaded successfully on cpu
2024-12-22 12:45:24,932 - kalliste.taggers.tagger_pipeline - INFO - Successfully initialized orientation tagger
2024-12-22 12:45:24,932 - kalliste.taggers.tagger_pipeline - INFO - TaggerPipeline initialization complete
2024-12-22 12:45:24,932 - kalliste.image.model_registry - INFO - Tagger pipeline initialized successfully
2024-12-22 12:45:24,932 - kalliste.image.model_registry - INFO - Initializing YOLO detector...
2024-12-22 12:45:24,952 - kalliste.image.model_registry - INFO - YOLO detector initialized successfully
2024-12-22 12:45:24,955 - kalliste.image.model_registry - INFO - Model registry initialization complete
2024-12-22 12:45:24,956 - kalliste.image.batch_processor - INFO - Model registry initialized successfully
2024-12-22 12:45:24,956 - __main__ - INFO - BatchProcessor initialized successfully
2024-12-22 12:45:24,956 - __main__ - INFO - Starting batch processing
2024-12-22 12:45:24,956 - kalliste.image.batch_processor - INFO - Starting batch processing
2024-12-22 12:45:24,956 - kalliste.image.batch_processor - INFO - Starting batch: 20180312_Photoshoot2
2024-12-22 12:45:24,956 - kalliste.image.batch - INFO - Starting batch processing for 20180312_Photoshoot2 with 9 images
2024-12-22 12:45:24,956 - kalliste.image.original_image - INFO - Starting processing for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3136.png
2024-12-22 12:45:24,957 - kalliste.image.original_image - INFO - Starting processing for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3320.png
2024-12-22 12:45:24,960 - kalliste.image.original_image - INFO - Starting processing for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3297.png
2024-12-22 12:45:25,147 - kalliste.image.original_image - ERROR - Detection failed for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3320.png: 'Conv' object has no attribute 'bn'
2024-12-22 12:45:25,147 - kalliste.image.original_image - ERROR - Detection failed for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3320.png: Detection failed: 'Conv' object has no attribute 'bn'
2024-12-22 12:45:25,148 - kalliste.image.original_image - ERROR - Error processing /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3320.png: Detection failed: Detection failed: 'Conv' object has no attribute 'bn'
2024-12-22 12:45:25,148 - kalliste.image.batch - ERROR - Error processing image IMG_3320.png: Detection failed: Detection failed: 'Conv' object has no attribute 'bn'
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 102, in run_detectors
    regions = await loop.run_in_executor(
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/detectors/yolo_detector.py", line 145, in detect
    results = self.model(str(image_path), conf=min_conf)[0]
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/engine/model.py", line 177, in __call__
    return self.predict(source, stream, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/engine/model.py", line 446, in predict
    self.predictor.setup_model(model=self.model, verbose=is_cli)
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/engine/predictor.py", line 303, in setup_model
    self.model = AutoBackend(
                 ^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/torch/utils/_contextlib.py", line 116, in decorate_context
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/nn/autobackend.py", line 144, in __init__
    model = model.fuse(verbose=verbose)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/nn/tasks.py", line 185, in fuse
    delattr(m, "bn")  # remove batchnorm
    ^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/torch/nn/modules/module.py", line 2043, in __delattr__
    super().__delattr__(name)
AttributeError: 'Conv' object has no attribute 'bn'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 46, in process
    detections = await self.run_detectors()
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 116, in run_detectors
    raise RuntimeError(f"Detection failed: {e}") from e
RuntimeError: Detection failed: 'Conv' object has no attribute 'bn'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 50, in process_image
    result = await image.process()
             ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 50, in process
    raise RuntimeError(f"Detection failed: {e}") from e
RuntimeError: Detection failed: Detection failed: 'Conv' object has no attribute 'bn'
2024-12-22 12:45:25,151 - kalliste.image.original_image - INFO - Starting processing for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3152.png
2024-12-22 12:45:25,151 - kalliste.image.original_image - ERROR - Detection failed for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3297.png: 'Conv' object has no attribute 'bn'
2024-12-22 12:45:25,152 - kalliste.image.original_image - ERROR - Detection failed for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3297.png: Detection failed: 'Conv' object has no attribute 'bn'
2024-12-22 12:45:25,152 - kalliste.image.original_image - ERROR - Error processing /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3297.png: Detection failed: Detection failed: 'Conv' object has no attribute 'bn'
2024-12-22 12:45:25,152 - kalliste.image.batch - ERROR - Error processing image IMG_3297.png: Detection failed: Detection failed: 'Conv' object has no attribute 'bn'
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 102, in run_detectors
    regions = await loop.run_in_executor(
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/detectors/yolo_detector.py", line 145, in detect
    results = self.model(str(image_path), conf=min_conf)[0]
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/engine/model.py", line 177, in __call__
    return self.predict(source, stream, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/engine/model.py", line 446, in predict
    self.predictor.setup_model(model=self.model, verbose=is_cli)
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/engine/predictor.py", line 303, in setup_model
    self.model = AutoBackend(
                 ^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/torch/utils/_contextlib.py", line 116, in decorate_context
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/nn/autobackend.py", line 144, in __init__
    model = model.fuse(verbose=verbose)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/nn/tasks.py", line 185, in fuse
    delattr(m, "bn")  # remove batchnorm
    ^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/torch/nn/modules/module.py", line 2043, in __delattr__
    super().__delattr__(name)
AttributeError: 'Conv' object has no attribute 'bn'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 46, in process
    detections = await self.run_detectors()
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 116, in run_detectors
    raise RuntimeError(f"Detection failed: {e}") from e
RuntimeError: Detection failed: 'Conv' object has no attribute 'bn'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 50, in process_image
    result = await image.process()
             ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 50, in process
    raise RuntimeError(f"Detection failed: {e}") from e
RuntimeError: Detection failed: Detection failed: 'Conv' object has no attribute 'bn'
2024-12-22 12:45:25,153 - kalliste.image.batch - ERROR - Error processing batch /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2: Detection failed: Detection failed: 'Conv' object has no attribute 'bn'
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 102, in run_detectors
    regions = await loop.run_in_executor(
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/detectors/yolo_detector.py", line 145, in detect
    results = self.model(str(image_path), conf=min_conf)[0]
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/engine/model.py", line 177, in __call__
    return self.predict(source, stream, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/engine/model.py", line 446, in predict
    self.predictor.setup_model(model=self.model, verbose=is_cli)
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/engine/predictor.py", line 303, in setup_model
    self.model = AutoBackend(
                 ^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/torch/utils/_contextlib.py", line 116, in decorate_context
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/nn/autobackend.py", line 144, in __init__
    model = model.fuse(verbose=verbose)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/nn/tasks.py", line 185, in fuse
    delattr(m, "bn")  # remove batchnorm
    ^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/torch/nn/modules/module.py", line 2043, in __delattr__
    super().__delattr__(name)
AttributeError: 'Conv' object has no attribute 'bn'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 46, in process
    detections = await self.run_detectors()
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 116, in run_detectors
    raise RuntimeError(f"Detection failed: {e}") from e
RuntimeError: Detection failed: 'Conv' object has no attribute 'bn'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 68, in process
    results = await asyncio.gather(*tasks)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 50, in process_image
    result = await image.process()
             ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 50, in process
    raise RuntimeError(f"Detection failed: {e}") from e
RuntimeError: Detection failed: Detection failed: 'Conv' object has no attribute 'bn'
2024-12-22 12:45:25,154 - kalliste.image.batch_processor - ERROR - Error processing batch 20180312_Photoshoot2: Batch processing failed: Detection failed: Detection failed: 'Conv' object has no attribute 'bn'
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 102, in run_detectors
    regions = await loop.run_in_executor(
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/detectors/yolo_detector.py", line 145, in detect
    results = self.model(str(image_path), conf=min_conf)[0]
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/engine/model.py", line 177, in __call__
    return self.predict(source, stream, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/engine/model.py", line 446, in predict
    self.predictor.setup_model(model=self.model, verbose=is_cli)
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/engine/predictor.py", line 303, in setup_model
    self.model = AutoBackend(
                 ^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/torch/utils/_contextlib.py", line 116, in decorate_context
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/nn/autobackend.py", line 144, in __init__
    model = model.fuse(verbose=verbose)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/nn/tasks.py", line 185, in fuse
    delattr(m, "bn")  # remove batchnorm
    ^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/torch/nn/modules/module.py", line 2043, in __delattr__
    super().__delattr__(name)
AttributeError: 'Conv' object has no attribute 'bn'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 46, in process
    detections = await self.run_detectors()
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 116, in run_detectors
    raise RuntimeError(f"Detection failed: {e}") from e
RuntimeError: Detection failed: 'Conv' object has no attribute 'bn'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 68, in process
    results = await asyncio.gather(*tasks)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 50, in process_image
    result = await image.process()
             ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 50, in process
    raise RuntimeError(f"Detection failed: {e}") from e
RuntimeError: Detection failed: Detection failed: 'Conv' object has no attribute 'bn'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/batch_processor.py", line 71, in process_all
    await batch.process()
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 78, in process
    raise RuntimeError(f"Batch processing failed: {e}") from e
RuntimeError: Batch processing failed: Detection failed: Detection failed: 'Conv' object has no attribute 'bn'
2024-12-22 12:45:25,155 - kalliste.image.batch_processor - ERROR - Error processing batches: Batch processing failed: Detection failed: Detection failed: 'Conv' object has no attribute 'bn'
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 102, in run_detectors
    regions = await loop.run_in_executor(
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/detectors/yolo_detector.py", line 145, in detect
    results = self.model(str(image_path), conf=min_conf)[0]
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/engine/model.py", line 177, in __call__
    return self.predict(source, stream, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/engine/model.py", line 446, in predict
    self.predictor.setup_model(model=self.model, verbose=is_cli)
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/engine/predictor.py", line 303, in setup_model
    self.model = AutoBackend(
                 ^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/torch/utils/_contextlib.py", line 116, in decorate_context
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/nn/autobackend.py", line 144, in __init__
    model = model.fuse(verbose=verbose)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/nn/tasks.py", line 185, in fuse
    delattr(m, "bn")  # remove batchnorm
    ^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/torch/nn/modules/module.py", line 2043, in __delattr__
    super().__delattr__(name)
AttributeError: 'Conv' object has no attribute 'bn'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 46, in process
    detections = await self.run_detectors()
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 116, in run_detectors
    raise RuntimeError(f"Detection failed: {e}") from e
RuntimeError: Detection failed: 'Conv' object has no attribute 'bn'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 68, in process
    results = await asyncio.gather(*tasks)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 50, in process_image
    result = await image.process()
             ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 50, in process
    raise RuntimeError(f"Detection failed: {e}") from e
RuntimeError: Detection failed: Detection failed: 'Conv' object has no attribute 'bn'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/batch_processor.py", line 71, in process_all
    await batch.process()
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 78, in process
    raise RuntimeError(f"Batch processing failed: {e}") from e
RuntimeError: Batch processing failed: Detection failed: Detection failed: 'Conv' object has no attribute 'bn'
2024-12-22 12:45:25,156 - kalliste.image.batch_processor - INFO - Cleaning up model registry
2024-12-22 12:45:25,156 - kalliste.image.model_registry - INFO - Starting model registry cleanup
2024-12-22 12:45:25,203 - kalliste.image.model_registry - INFO - Model registry cleanup complete
2024-12-22 12:45:25,203 - kalliste.image.batch_processor - INFO - Model registry cleanup complete
2024-12-22 12:45:25,203 - __main__ - ERROR - Error during batch processing: Batch processing failed: Detection failed: Detection failed: 'Conv' object has no attribute 'bn'
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 102, in run_detectors
    regions = await loop.run_in_executor(
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/detectors/yolo_detector.py", line 145, in detect
    results = self.model(str(image_path), conf=min_conf)[0]
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/engine/model.py", line 177, in __call__
    return self.predict(source, stream, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/engine/model.py", line 446, in predict
    self.predictor.setup_model(model=self.model, verbose=is_cli)
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/engine/predictor.py", line 303, in setup_model
    self.model = AutoBackend(
                 ^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/torch/utils/_contextlib.py", line 116, in decorate_context
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/nn/autobackend.py", line 144, in __init__
    model = model.fuse(verbose=verbose)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/nn/tasks.py", line 185, in fuse
    delattr(m, "bn")  # remove batchnorm
    ^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/torch/nn/modules/module.py", line 2043, in __delattr__
    super().__delattr__(name)
AttributeError: 'Conv' object has no attribute 'bn'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 46, in process
    detections = await self.run_detectors()
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 116, in run_detectors
    raise RuntimeError(f"Detection failed: {e}") from e
RuntimeError: Detection failed: 'Conv' object has no attribute 'bn'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 68, in process
    results = await asyncio.gather(*tasks)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 50, in process_image
    result = await image.process()
             ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 50, in process
    raise RuntimeError(f"Detection failed: {e}") from e
RuntimeError: Detection failed: Detection failed: 'Conv' object has no attribute 'bn'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/scripts/test_pipeline.py", line 59, in main
    await processor.process_all()
  File "/Users/rob/repos/kalliste/kalliste/image/batch_processor.py", line 71, in process_all
    await batch.process()
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 78, in process
    raise RuntimeError(f"Batch processing failed: {e}") from e
RuntimeError: Batch processing failed: Detection failed: Detection failed: 'Conv' object has no attribute 'bn'
2024-12-22 12:45:25,205 - __main__ - INFO - Pipeline test complete
2024-12-22 12:45:25,205 - kalliste.image.original_image - INFO - Starting processing for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A9668.png
2024-12-22 12:45:25,634 - __main__ - ERROR - Pipeline test failed: Batch processing failed: Detection failed: Detection failed: 'Conv' object has no attribute 'bn'
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 102, in run_detectors
    regions = await loop.run_in_executor(
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/detectors/yolo_detector.py", line 145, in detect
    results = self.model(str(image_path), conf=min_conf)[0]
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/engine/model.py", line 177, in __call__
    return self.predict(source, stream, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/engine/model.py", line 446, in predict
    self.predictor.setup_model(model=self.model, verbose=is_cli)
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/engine/predictor.py", line 303, in setup_model
    self.model = AutoBackend(
                 ^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/torch/utils/_contextlib.py", line 116, in decorate_context
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/nn/autobackend.py", line 144, in __init__
    model = model.fuse(verbose=verbose)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/nn/tasks.py", line 185, in fuse
    delattr(m, "bn")  # remove batchnorm
    ^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/torch/nn/modules/module.py", line 2043, in __delattr__
    super().__delattr__(name)
AttributeError: 'Conv' object has no attribute 'bn'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 46, in process
    detections = await self.run_detectors()
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 116, in run_detectors
    raise RuntimeError(f"Detection failed: {e}") from e
RuntimeError: Detection failed: 'Conv' object has no attribute 'bn'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 68, in process
    results = await asyncio.gather(*tasks)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 50, in process_image
    result = await image.process()
             ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 50, in process
    raise RuntimeError(f"Detection failed: {e}") from e
RuntimeError: Detection failed: Detection failed: 'Conv' object has no attribute 'bn'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/scripts/test_pipeline.py", line 69, in <module>
    asyncio.run(main())
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
           ^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/asyncio/base_events.py", line 654, in run_until_complete
    return future.result()
           ^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/scripts/test_pipeline.py", line 59, in main
    await processor.process_all()
  File "/Users/rob/repos/kalliste/kalliste/image/batch_processor.py", line 71, in process_all
    await batch.process()
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 78, in process
    raise RuntimeError(f"Batch processing failed: {e}") from e
RuntimeError: Batch processing failed: Detection failed: Detection failed: 'Conv' object has no attribute 'bn'
2024-12-22 12:47:46,759 - __main__ - INFO - Starting pipeline test
2024-12-22 12:47:46,759 - __main__ - INFO - Input directory: /Users/rob/repos/kalliste/test_images_input
2024-12-22 12:47:46,759 - __main__ - INFO - Output directory: /Users/rob/repos/kalliste/test_images_output
2024-12-22 12:47:46,759 - __main__ - INFO - Initializing BatchProcessor
2024-12-22 12:47:46,759 - kalliste.image.batch_processor - INFO - Initializing BatchProcessor with input_root=/Users/rob/repos/kalliste/test_images_input, output_root=/Users/rob/repos/kalliste/test_images_output
2024-12-22 12:47:46,759 - kalliste.image.batch_processor - INFO - Scanning for batches in /Users/rob/repos/kalliste/test_images_input
2024-12-22 12:47:46,760 - kalliste.image.batch - INFO - Initializing Batch with input_path=/Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2, max_concurrent=3
2024-12-22 12:47:46,760 - kalliste.image.batch - INFO - Scanning for images in /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2
2024-12-22 12:47:46,760 - kalliste.image.batch - INFO - Found 9 images to process in batch 20180312_Photoshoot2
2024-12-22 12:47:46,760 - kalliste.image.batch - INFO - Initializing Batch with input_path=/Users/rob/repos/kalliste/test_images_input/20241012_Photoshoot1, max_concurrent=3
2024-12-22 12:47:46,760 - kalliste.image.batch - INFO - Scanning for images in /Users/rob/repos/kalliste/test_images_input/20241012_Photoshoot1
2024-12-22 12:47:46,760 - kalliste.image.batch - INFO - Found 12 images to process in batch 20241012_Photoshoot1
2024-12-22 12:47:46,760 - kalliste.image.batch_processor - INFO - Found 2 batches to process
2024-12-22 12:47:46,760 - __main__ - INFO - BatchProcessor created
2024-12-22 12:47:46,760 - __main__ - INFO - Initializing models
2024-12-22 12:47:46,760 - kalliste.image.batch_processor - INFO - Initializing model registry
2024-12-22 12:47:46,760 - kalliste.image.model_registry - INFO - Starting model registry initialization
2024-12-22 12:47:46,760 - kalliste.image.model_registry - INFO - Initializing tagger pipeline...
2024-12-22 12:47:46,760 - kalliste.taggers.tagger_pipeline - INFO - Creating TaggerPipeline instance
2024-12-22 12:47:46,817 - kalliste.taggers.base_tagger - INFO - MPS device validated
2024-12-22 12:47:46,817 - kalliste.taggers.tagger_pipeline - INFO - TaggerPipeline created with device: mps
2024-12-22 12:47:46,817 - kalliste.taggers.tagger_pipeline - INFO - Starting TaggerPipeline initialization
2024-12-22 12:47:46,817 - kalliste.taggers.tagger_pipeline - INFO - Initializing orientation tagger
2024-12-22 12:47:46,817 - kalliste.taggers.base_tagger - INFO - Initializing OrientationTagger on device: mps
2024-12-22 12:47:46,817 - kalliste.taggers.orientation_tagger - INFO - Loading orientation model: LucyintheSky/pose-estimation-front-side-back
2024-12-22 12:47:48,420 - kalliste.taggers.orientation_tagger - INFO - Orientation model loaded successfully on cpu
2024-12-22 12:47:48,420 - kalliste.taggers.tagger_pipeline - INFO - Successfully initialized orientation tagger
2024-12-22 12:47:48,420 - kalliste.taggers.tagger_pipeline - INFO - Initializing wd14 tagger
2024-12-22 12:47:48,420 - kalliste.taggers.base_tagger - INFO - Initializing WD14Tagger on device: mps
2024-12-22 12:47:48,420 - kalliste.taggers.wd14_tagger - INFO - Loading WD14 model: hf_hub:SmilingWolf/wd-vit-large-tagger-v3
2024-12-22 12:48:02,623 - timm.models._builder - INFO - Loading pretrained weights from Hugging Face hub (SmilingWolf/wd-vit-large-tagger-v3)
2024-12-22 12:48:02,848 - timm.models._hub - INFO - [SmilingWolf/wd-vit-large-tagger-v3] Safe alternative available for 'pytorch_model.bin' (as 'model.safetensors'). Loading weights using safetensors.
2024-12-22 12:48:03,042 - kalliste.taggers.wd14_tagger - INFO - Loaded 10861 WD14 tags
2024-12-22 12:48:03,043 - kalliste.taggers.tagger_pipeline - INFO - Successfully initialized wd14 tagger
2024-12-22 12:48:03,043 - kalliste.taggers.tagger_pipeline - INFO - Initializing caption tagger
2024-12-22 12:48:03,043 - kalliste.taggers.base_tagger - INFO - Initializing CaptionTagger on device: mps
2024-12-22 12:48:03,043 - kalliste.taggers.caption_tagger - INFO - Loading BLIP2 model: Salesforce/blip2-opt-2.7b
2024-12-22 12:48:04,825 - kalliste.taggers.caption_tagger - INFO - BLIP2 model loaded successfully on cpu
2024-12-22 12:48:04,825 - kalliste.taggers.tagger_pipeline - INFO - Successfully initialized caption tagger
2024-12-22 12:48:04,825 - kalliste.taggers.tagger_pipeline - INFO - TaggerPipeline initialization complete
2024-12-22 12:48:04,825 - kalliste.image.model_registry - INFO - Tagger pipeline initialized successfully
2024-12-22 12:48:04,825 - kalliste.image.model_registry - INFO - Initializing YOLO detector...
2024-12-22 12:48:04,825 - kalliste.detectors.yolo_detector - INFO - Initializing YOLO detector
2024-12-22 12:48:04,825 - kalliste.detectors.yolo_detector - INFO - Loading YOLO model from /Users/rob/repos/kalliste/yolov8n.pt
2024-12-22 12:48:04,844 - kalliste.detectors.yolo_detector - INFO - YOLO model loaded successfully
2024-12-22 12:48:04,844 - kalliste.detectors.yolo_detector - INFO - Loading YOLO face model from /Users/rob/repos/kalliste/yolov8n-face.pt
2024-12-22 12:48:04,844 - kalliste.detectors.yolo_detector - ERROR - Failed to load YOLO face model: could not find MARK
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/detectors/yolo_detector.py", line 49, in __init__
    self.face_model = YOLO(str(self.face_model_path))
                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/models/yolo/model.py", line 23, in __init__
    super().__init__(model=model, task=task, verbose=verbose)
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/engine/model.py", line 152, in __init__
    self._load(model, task=task)
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/engine/model.py", line 241, in _load
    self.model, self.ckpt = attempt_load_one_weight(weights)
                            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/nn/tasks.py", line 806, in attempt_load_one_weight
    ckpt, weight = torch_safe_load(weight)  # load ckpt
                   ^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/nn/tasks.py", line 732, in torch_safe_load
    ckpt = torch.load(file, map_location="cpu")
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/torch/serialization.py", line 1384, in load
    return _legacy_load(
           ^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/torch/serialization.py", line 1628, in _legacy_load
    magic_number = pickle_module.load(f, **pickle_load_args)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
_pickle.UnpicklingError: could not find MARK
2024-12-22 12:48:04,847 - kalliste.detectors.yolo_detector - WARNING - Continuing without face detection
2024-12-22 12:48:04,847 - kalliste.detectors.yolo_detector - INFO - YOLODetector initialized with 1 active classes
2024-12-22 12:48:04,847 - kalliste.image.model_registry - INFO - YOLO detector initialized successfully
2024-12-22 12:48:04,847 - kalliste.image.model_registry - INFO - Model registry initialization complete
2024-12-22 12:48:04,847 - kalliste.image.batch_processor - INFO - Model registry initialized successfully
2024-12-22 12:48:04,847 - __main__ - INFO - BatchProcessor initialized successfully
2024-12-22 12:48:04,847 - __main__ - INFO - Starting batch processing
2024-12-22 12:48:04,847 - kalliste.image.batch_processor - INFO - Starting batch processing
2024-12-22 12:48:04,847 - kalliste.image.batch_processor - INFO - Starting batch: 20180312_Photoshoot2
2024-12-22 12:48:04,847 - kalliste.image.batch - INFO - Starting batch processing for 20180312_Photoshoot2 with 9 images
2024-12-22 12:48:04,847 - kalliste.image.original_image - INFO - Starting processing for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3136.png
2024-12-22 12:48:04,848 - kalliste.image.original_image - INFO - Starting processing for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3320.png
2024-12-22 12:48:04,848 - kalliste.image.original_image - INFO - Starting processing for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3297.png
2024-12-22 12:48:04,852 - kalliste.detectors.yolo_detector - INFO - Running detection on /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3297.png
2024-12-22 12:48:04,854 - kalliste.detectors.yolo_detector - INFO - Running detection on /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3136.png
2024-12-22 12:48:04,856 - kalliste.detectors.yolo_detector - INFO - Running detection on /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3320.png
2024-12-22 12:48:05,039 - kalliste.detectors.yolo_detector - ERROR - Error during detection: 'Conv' object has no attribute 'bn'
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/detectors/yolo_detector.py", line 156, in detect
    results = self.model(str(image_path), conf=min_conf)[0]
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/engine/model.py", line 177, in __call__
    return self.predict(source, stream, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/engine/model.py", line 446, in predict
    self.predictor.setup_model(model=self.model, verbose=is_cli)
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/engine/predictor.py", line 303, in setup_model
    self.model = AutoBackend(
                 ^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/torch/utils/_contextlib.py", line 116, in decorate_context
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/nn/autobackend.py", line 144, in __init__
    model = model.fuse(verbose=verbose)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/nn/tasks.py", line 185, in fuse
    delattr(m, "bn")  # remove batchnorm
    ^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/torch/nn/modules/module.py", line 2043, in __delattr__
    super().__delattr__(name)
AttributeError: 'Conv' object has no attribute 'bn'
2024-12-22 12:48:05,040 - kalliste.detectors.yolo_detector - ERROR - Error during detection: 'Conv' object has no attribute 'bn'
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/detectors/yolo_detector.py", line 156, in detect
    results = self.model(str(image_path), conf=min_conf)[0]
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/engine/model.py", line 177, in __call__
    return self.predict(source, stream, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/engine/model.py", line 446, in predict
    self.predictor.setup_model(model=self.model, verbose=is_cli)
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/engine/predictor.py", line 303, in setup_model
    self.model = AutoBackend(
                 ^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/torch/utils/_contextlib.py", line 116, in decorate_context
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/nn/autobackend.py", line 144, in __init__
    model = model.fuse(verbose=verbose)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/nn/tasks.py", line 185, in fuse
    delattr(m, "bn")  # remove batchnorm
    ^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/torch/nn/modules/module.py", line 2043, in __delattr__
    super().__delattr__(name)
AttributeError: 'Conv' object has no attribute 'bn'
2024-12-22 12:48:05,042 - kalliste.image.original_image - ERROR - Detection failed for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3297.png: Detection failed
2024-12-22 12:48:05,042 - kalliste.image.original_image - ERROR - Detection failed for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3297.png: Detection failed: Detection failed
2024-12-22 12:48:05,042 - kalliste.image.original_image - ERROR - Error processing /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3297.png: Detection failed: Detection failed: Detection failed
2024-12-22 12:48:05,042 - kalliste.image.batch - ERROR - Error processing image IMG_3297.png: Detection failed: Detection failed: Detection failed
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/detectors/yolo_detector.py", line 156, in detect
    results = self.model(str(image_path), conf=min_conf)[0]
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/engine/model.py", line 177, in __call__
    return self.predict(source, stream, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/engine/model.py", line 446, in predict
    self.predictor.setup_model(model=self.model, verbose=is_cli)
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/engine/predictor.py", line 303, in setup_model
    self.model = AutoBackend(
                 ^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/torch/utils/_contextlib.py", line 116, in decorate_context
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/nn/autobackend.py", line 144, in __init__
    model = model.fuse(verbose=verbose)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/nn/tasks.py", line 185, in fuse
    delattr(m, "bn")  # remove batchnorm
    ^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/torch/nn/modules/module.py", line 2043, in __delattr__
    super().__delattr__(name)
AttributeError: 'Conv' object has no attribute 'bn'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 102, in run_detectors
    regions = await loop.run_in_executor(
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/detectors/yolo_detector.py", line 195, in detect
    raise RuntimeError("Detection failed") from e
RuntimeError: Detection failed

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 46, in process
    detections = await self.run_detectors()
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 116, in run_detectors
    raise RuntimeError(f"Detection failed: {e}") from e
RuntimeError: Detection failed: Detection failed

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 50, in process_image
    result = await image.process()
             ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 50, in process
    raise RuntimeError(f"Detection failed: {e}") from e
RuntimeError: Detection failed: Detection failed: Detection failed
2024-12-22 12:48:05,043 - kalliste.image.original_image - INFO - Starting processing for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3152.png
2024-12-22 12:48:05,043 - kalliste.image.original_image - ERROR - Detection failed for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3136.png: Detection failed
2024-12-22 12:48:05,043 - kalliste.image.original_image - ERROR - Detection failed for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3136.png: Detection failed: Detection failed
2024-12-22 12:48:05,043 - kalliste.image.original_image - ERROR - Error processing /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3136.png: Detection failed: Detection failed: Detection failed
2024-12-22 12:48:05,043 - kalliste.image.batch - ERROR - Error processing image IMG_3136.png: Detection failed: Detection failed: Detection failed
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/detectors/yolo_detector.py", line 156, in detect
    results = self.model(str(image_path), conf=min_conf)[0]
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/engine/model.py", line 177, in __call__
    return self.predict(source, stream, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/engine/model.py", line 446, in predict
    self.predictor.setup_model(model=self.model, verbose=is_cli)
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/engine/predictor.py", line 303, in setup_model
    self.model = AutoBackend(
                 ^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/torch/utils/_contextlib.py", line 116, in decorate_context
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/nn/autobackend.py", line 144, in __init__
    model = model.fuse(verbose=verbose)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/nn/tasks.py", line 185, in fuse
    delattr(m, "bn")  # remove batchnorm
    ^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/torch/nn/modules/module.py", line 2043, in __delattr__
    super().__delattr__(name)
AttributeError: 'Conv' object has no attribute 'bn'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 102, in run_detectors
    regions = await loop.run_in_executor(
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/detectors/yolo_detector.py", line 195, in detect
    raise RuntimeError("Detection failed") from e
RuntimeError: Detection failed

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 46, in process
    detections = await self.run_detectors()
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 116, in run_detectors
    raise RuntimeError(f"Detection failed: {e}") from e
RuntimeError: Detection failed: Detection failed

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 50, in process_image
    result = await image.process()
             ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 50, in process
    raise RuntimeError(f"Detection failed: {e}") from e
RuntimeError: Detection failed: Detection failed: Detection failed
2024-12-22 12:48:05,044 - kalliste.image.batch - ERROR - Error processing batch /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2: Detection failed: Detection failed: Detection failed
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/detectors/yolo_detector.py", line 156, in detect
    results = self.model(str(image_path), conf=min_conf)[0]
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/engine/model.py", line 177, in __call__
    return self.predict(source, stream, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/engine/model.py", line 446, in predict
    self.predictor.setup_model(model=self.model, verbose=is_cli)
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/engine/predictor.py", line 303, in setup_model
    self.model = AutoBackend(
                 ^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/torch/utils/_contextlib.py", line 116, in decorate_context
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/nn/autobackend.py", line 144, in __init__
    model = model.fuse(verbose=verbose)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/nn/tasks.py", line 185, in fuse
    delattr(m, "bn")  # remove batchnorm
    ^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/torch/nn/modules/module.py", line 2043, in __delattr__
    super().__delattr__(name)
AttributeError: 'Conv' object has no attribute 'bn'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 102, in run_detectors
    regions = await loop.run_in_executor(
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/detectors/yolo_detector.py", line 195, in detect
    raise RuntimeError("Detection failed") from e
RuntimeError: Detection failed

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 46, in process
    detections = await self.run_detectors()
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 116, in run_detectors
    raise RuntimeError(f"Detection failed: {e}") from e
RuntimeError: Detection failed: Detection failed

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 68, in process
    results = await asyncio.gather(*tasks)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 50, in process_image
    result = await image.process()
             ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 50, in process
    raise RuntimeError(f"Detection failed: {e}") from e
RuntimeError: Detection failed: Detection failed: Detection failed
2024-12-22 12:48:05,045 - kalliste.image.batch_processor - ERROR - Error processing batch 20180312_Photoshoot2: Batch processing failed: Detection failed: Detection failed: Detection failed
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/detectors/yolo_detector.py", line 156, in detect
    results = self.model(str(image_path), conf=min_conf)[0]
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/engine/model.py", line 177, in __call__
    return self.predict(source, stream, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/engine/model.py", line 446, in predict
    self.predictor.setup_model(model=self.model, verbose=is_cli)
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/engine/predictor.py", line 303, in setup_model
    self.model = AutoBackend(
                 ^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/torch/utils/_contextlib.py", line 116, in decorate_context
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/nn/autobackend.py", line 144, in __init__
    model = model.fuse(verbose=verbose)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/nn/tasks.py", line 185, in fuse
    delattr(m, "bn")  # remove batchnorm
    ^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/torch/nn/modules/module.py", line 2043, in __delattr__
    super().__delattr__(name)
AttributeError: 'Conv' object has no attribute 'bn'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 102, in run_detectors
    regions = await loop.run_in_executor(
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/detectors/yolo_detector.py", line 195, in detect
    raise RuntimeError("Detection failed") from e
RuntimeError: Detection failed

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 46, in process
    detections = await self.run_detectors()
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 116, in run_detectors
    raise RuntimeError(f"Detection failed: {e}") from e
RuntimeError: Detection failed: Detection failed

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 68, in process
    results = await asyncio.gather(*tasks)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 50, in process_image
    result = await image.process()
             ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 50, in process
    raise RuntimeError(f"Detection failed: {e}") from e
RuntimeError: Detection failed: Detection failed: Detection failed

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/batch_processor.py", line 71, in process_all
    await batch.process()
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 78, in process
    raise RuntimeError(f"Batch processing failed: {e}") from e
RuntimeError: Batch processing failed: Detection failed: Detection failed: Detection failed
2024-12-22 12:48:05,046 - kalliste.image.batch_processor - ERROR - Error processing batches: Batch processing failed: Detection failed: Detection failed: Detection failed
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/detectors/yolo_detector.py", line 156, in detect
    results = self.model(str(image_path), conf=min_conf)[0]
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/engine/model.py", line 177, in __call__
    return self.predict(source, stream, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/engine/model.py", line 446, in predict
    self.predictor.setup_model(model=self.model, verbose=is_cli)
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/engine/predictor.py", line 303, in setup_model
    self.model = AutoBackend(
                 ^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/torch/utils/_contextlib.py", line 116, in decorate_context
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/nn/autobackend.py", line 144, in __init__
    model = model.fuse(verbose=verbose)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/nn/tasks.py", line 185, in fuse
    delattr(m, "bn")  # remove batchnorm
    ^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/torch/nn/modules/module.py", line 2043, in __delattr__
    super().__delattr__(name)
AttributeError: 'Conv' object has no attribute 'bn'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 102, in run_detectors
    regions = await loop.run_in_executor(
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/detectors/yolo_detector.py", line 195, in detect
    raise RuntimeError("Detection failed") from e
RuntimeError: Detection failed

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 46, in process
    detections = await self.run_detectors()
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 116, in run_detectors
    raise RuntimeError(f"Detection failed: {e}") from e
RuntimeError: Detection failed: Detection failed

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 68, in process
    results = await asyncio.gather(*tasks)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 50, in process_image
    result = await image.process()
             ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 50, in process
    raise RuntimeError(f"Detection failed: {e}") from e
RuntimeError: Detection failed: Detection failed: Detection failed

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/batch_processor.py", line 71, in process_all
    await batch.process()
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 78, in process
    raise RuntimeError(f"Batch processing failed: {e}") from e
RuntimeError: Batch processing failed: Detection failed: Detection failed: Detection failed
2024-12-22 12:48:05,048 - kalliste.image.batch_processor - INFO - Cleaning up model registry
2024-12-22 12:48:05,048 - kalliste.image.model_registry - INFO - Starting model registry cleanup
2024-12-22 12:48:05,093 - kalliste.image.model_registry - INFO - Model registry cleanup complete
2024-12-22 12:48:05,093 - kalliste.image.batch_processor - INFO - Model registry cleanup complete
2024-12-22 12:48:05,093 - __main__ - ERROR - Error during batch processing: Batch processing failed: Detection failed: Detection failed: Detection failed
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/detectors/yolo_detector.py", line 156, in detect
    results = self.model(str(image_path), conf=min_conf)[0]
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/engine/model.py", line 177, in __call__
    return self.predict(source, stream, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/engine/model.py", line 446, in predict
    self.predictor.setup_model(model=self.model, verbose=is_cli)
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/engine/predictor.py", line 303, in setup_model
    self.model = AutoBackend(
                 ^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/torch/utils/_contextlib.py", line 116, in decorate_context
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/nn/autobackend.py", line 144, in __init__
    model = model.fuse(verbose=verbose)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/nn/tasks.py", line 185, in fuse
    delattr(m, "bn")  # remove batchnorm
    ^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/torch/nn/modules/module.py", line 2043, in __delattr__
    super().__delattr__(name)
AttributeError: 'Conv' object has no attribute 'bn'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 102, in run_detectors
    regions = await loop.run_in_executor(
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/detectors/yolo_detector.py", line 195, in detect
    raise RuntimeError("Detection failed") from e
RuntimeError: Detection failed

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 46, in process
    detections = await self.run_detectors()
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 116, in run_detectors
    raise RuntimeError(f"Detection failed: {e}") from e
RuntimeError: Detection failed: Detection failed

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 68, in process
    results = await asyncio.gather(*tasks)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 50, in process_image
    result = await image.process()
             ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 50, in process
    raise RuntimeError(f"Detection failed: {e}") from e
RuntimeError: Detection failed: Detection failed: Detection failed

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/scripts/test_pipeline.py", line 59, in main
    await processor.process_all()
  File "/Users/rob/repos/kalliste/kalliste/image/batch_processor.py", line 71, in process_all
    await batch.process()
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 78, in process
    raise RuntimeError(f"Batch processing failed: {e}") from e
RuntimeError: Batch processing failed: Detection failed: Detection failed: Detection failed
2024-12-22 12:48:05,094 - __main__ - INFO - Pipeline test complete
2024-12-22 12:48:05,094 - kalliste.image.original_image - INFO - Starting processing for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A9668.png
2024-12-22 12:48:05,484 - kalliste.detectors.yolo_detector - INFO - Detection complete. Found 1 total regions
2024-12-22 12:48:05,484 - __main__ - ERROR - Pipeline test failed: Batch processing failed: Detection failed: Detection failed: Detection failed
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/detectors/yolo_detector.py", line 156, in detect
    results = self.model(str(image_path), conf=min_conf)[0]
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/engine/model.py", line 177, in __call__
    return self.predict(source, stream, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/engine/model.py", line 446, in predict
    self.predictor.setup_model(model=self.model, verbose=is_cli)
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/engine/predictor.py", line 303, in setup_model
    self.model = AutoBackend(
                 ^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/torch/utils/_contextlib.py", line 116, in decorate_context
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/nn/autobackend.py", line 144, in __init__
    model = model.fuse(verbose=verbose)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/nn/tasks.py", line 185, in fuse
    delattr(m, "bn")  # remove batchnorm
    ^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/torch/nn/modules/module.py", line 2043, in __delattr__
    super().__delattr__(name)
AttributeError: 'Conv' object has no attribute 'bn'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 102, in run_detectors
    regions = await loop.run_in_executor(
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/detectors/yolo_detector.py", line 195, in detect
    raise RuntimeError("Detection failed") from e
RuntimeError: Detection failed

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 46, in process
    detections = await self.run_detectors()
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 116, in run_detectors
    raise RuntimeError(f"Detection failed: {e}") from e
RuntimeError: Detection failed: Detection failed

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 68, in process
    results = await asyncio.gather(*tasks)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 50, in process_image
    result = await image.process()
             ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 50, in process
    raise RuntimeError(f"Detection failed: {e}") from e
RuntimeError: Detection failed: Detection failed: Detection failed

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/scripts/test_pipeline.py", line 69, in <module>
    asyncio.run(main())
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
           ^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/asyncio/base_events.py", line 654, in run_until_complete
    return future.result()
           ^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/scripts/test_pipeline.py", line 59, in main
    await processor.process_all()
  File "/Users/rob/repos/kalliste/kalliste/image/batch_processor.py", line 71, in process_all
    await batch.process()
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 78, in process
    raise RuntimeError(f"Batch processing failed: {e}") from e
RuntimeError: Batch processing failed: Detection failed: Detection failed: Detection failed
2024-12-22 13:05:39,987 - __main__ - INFO - Starting pipeline test
2024-12-22 13:05:39,987 - __main__ - INFO - Input directory: /Users/rob/repos/kalliste/test_images_input
2024-12-22 13:05:39,987 - __main__ - INFO - Output directory: /Users/rob/repos/kalliste/test_images_output
2024-12-22 13:05:39,987 - __main__ - INFO - Initializing BatchProcessor
2024-12-22 13:05:39,987 - kalliste.image.batch_processor - INFO - Initializing BatchProcessor with input_root=/Users/rob/repos/kalliste/test_images_input, output_root=/Users/rob/repos/kalliste/test_images_output
2024-12-22 13:05:39,987 - kalliste.image.batch_processor - INFO - Scanning for batches in /Users/rob/repos/kalliste/test_images_input
2024-12-22 13:05:39,987 - kalliste.image.batch - INFO - Initializing Batch with input_path=/Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2, max_concurrent=3
2024-12-22 13:05:39,987 - kalliste.image.batch - INFO - Scanning for images in /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2
2024-12-22 13:05:39,988 - kalliste.image.batch - INFO - Found 9 images to process in batch 20180312_Photoshoot2
2024-12-22 13:05:39,988 - kalliste.image.batch - INFO - Initializing Batch with input_path=/Users/rob/repos/kalliste/test_images_input/20241012_Photoshoot1, max_concurrent=3
2024-12-22 13:05:39,988 - kalliste.image.batch - INFO - Scanning for images in /Users/rob/repos/kalliste/test_images_input/20241012_Photoshoot1
2024-12-22 13:05:39,988 - kalliste.image.batch - INFO - Found 12 images to process in batch 20241012_Photoshoot1
2024-12-22 13:05:39,988 - kalliste.image.batch_processor - INFO - Found 2 batches to process
2024-12-22 13:05:39,988 - __main__ - INFO - BatchProcessor created
2024-12-22 13:05:39,988 - __main__ - INFO - Initializing models
2024-12-22 13:05:39,988 - kalliste.image.batch_processor - INFO - Initializing model registry
2024-12-22 13:05:39,988 - kalliste.image.model_registry - INFO - Starting model registry initialization
2024-12-22 13:05:39,988 - kalliste.image.model_registry - INFO - Initializing tagger pipeline...
2024-12-22 13:05:39,988 - kalliste.taggers.tagger_pipeline - INFO - Creating TaggerPipeline instance
2024-12-22 13:05:40,046 - kalliste.taggers.base_tagger - INFO - MPS device validated
2024-12-22 13:05:40,046 - kalliste.taggers.tagger_pipeline - INFO - TaggerPipeline created with device: mps
2024-12-22 13:05:40,046 - kalliste.taggers.tagger_pipeline - INFO - Starting TaggerPipeline initialization
2024-12-22 13:05:40,046 - kalliste.taggers.tagger_pipeline - INFO - Initializing wd14 tagger
2024-12-22 13:05:40,046 - kalliste.taggers.base_tagger - INFO - Initializing WD14Tagger on device: mps
2024-12-22 13:05:40,046 - kalliste.taggers.wd14_tagger - INFO - Loading WD14 model: hf_hub:SmilingWolf/wd-vit-large-tagger-v3
2024-12-22 13:05:53,846 - timm.models._builder - INFO - Loading pretrained weights from Hugging Face hub (SmilingWolf/wd-vit-large-tagger-v3)
2024-12-22 13:05:53,958 - timm.models._hub - INFO - [SmilingWolf/wd-vit-large-tagger-v3] Safe alternative available for 'pytorch_model.bin' (as 'model.safetensors'). Loading weights using safetensors.
2024-12-22 13:05:54,139 - kalliste.taggers.wd14_tagger - INFO - Loaded 10861 WD14 tags
2024-12-22 13:05:54,139 - kalliste.taggers.tagger_pipeline - INFO - Successfully initialized wd14 tagger
2024-12-22 13:05:54,139 - kalliste.taggers.tagger_pipeline - INFO - Initializing caption tagger
2024-12-22 13:05:54,139 - kalliste.taggers.base_tagger - INFO - Initializing CaptionTagger on device: mps
2024-12-22 13:05:54,139 - kalliste.taggers.caption_tagger - INFO - Loading BLIP2 model: Salesforce/blip2-opt-2.7b
2024-12-22 13:05:55,857 - kalliste.taggers.caption_tagger - INFO - BLIP2 model loaded successfully on cpu
2024-12-22 13:05:55,857 - kalliste.taggers.tagger_pipeline - INFO - Successfully initialized caption tagger
2024-12-22 13:05:55,857 - kalliste.taggers.tagger_pipeline - INFO - Initializing orientation tagger
2024-12-22 13:05:55,857 - kalliste.taggers.base_tagger - INFO - Initializing OrientationTagger on device: mps
2024-12-22 13:05:55,857 - kalliste.taggers.orientation_tagger - INFO - Loading orientation model: LucyintheSky/pose-estimation-front-side-back
2024-12-22 13:05:57,132 - kalliste.taggers.orientation_tagger - INFO - Orientation model loaded successfully on cpu
2024-12-22 13:05:57,133 - kalliste.taggers.tagger_pipeline - INFO - Successfully initialized orientation tagger
2024-12-22 13:05:57,133 - kalliste.taggers.tagger_pipeline - INFO - TaggerPipeline initialization complete
2024-12-22 13:05:57,133 - kalliste.image.model_registry - INFO - Tagger pipeline initialized successfully
2024-12-22 13:05:57,133 - kalliste.image.model_registry - INFO - Initializing YOLO detector...
2024-12-22 13:05:57,133 - kalliste.detectors.yolo_detector - INFO - Initializing YOLO detector
2024-12-22 13:05:57,133 - kalliste.detectors.yolo_detector - INFO - Loading YOLO model from /Users/rob/.cache/ultralytics/yolov8n.pt
2024-12-22 13:05:57,154 - kalliste.detectors.yolo_detector - INFO - YOLO model loaded successfully
2024-12-22 13:05:57,155 - kalliste.detectors.yolo_detector - INFO - Loading YOLO face model from /Users/rob/.cache/ultralytics/yolov8n-face.pt
2024-12-22 13:05:57,215 - kalliste.detectors.yolo_detector - INFO - YOLO face model loaded successfully
2024-12-22 13:05:57,215 - kalliste.detectors.yolo_detector - INFO - YOLODetector initialized with 1 active classes
2024-12-22 13:05:57,215 - kalliste.image.model_registry - INFO - YOLO detector initialized successfully
2024-12-22 13:05:57,215 - kalliste.image.model_registry - INFO - Model registry initialization complete
2024-12-22 13:05:57,215 - kalliste.image.batch_processor - INFO - Model registry initialized successfully
2024-12-22 13:05:57,215 - __main__ - INFO - BatchProcessor initialized successfully
2024-12-22 13:05:57,215 - __main__ - INFO - Starting batch processing
2024-12-22 13:05:57,215 - kalliste.image.batch_processor - INFO - Starting batch processing
2024-12-22 13:05:57,215 - kalliste.image.batch_processor - INFO - Starting batch: 20180312_Photoshoot2
2024-12-22 13:05:57,215 - kalliste.image.batch - INFO - Starting batch processing for 20180312_Photoshoot2 with 9 images
2024-12-22 13:05:57,215 - kalliste.image.original_image - INFO - Starting processing for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3136.png
2024-12-22 13:05:57,216 - kalliste.image.original_image - INFO - Starting processing for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3320.png
2024-12-22 13:05:57,216 - kalliste.image.original_image - INFO - Starting processing for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3297.png
2024-12-22 13:05:57,220 - kalliste.detectors.yolo_detector - INFO - Running detection on /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3297.png
2024-12-22 13:05:57,223 - kalliste.detectors.yolo_detector - INFO - Running detection on /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3136.png
2024-12-22 13:05:57,224 - kalliste.detectors.yolo_detector - INFO - Running detection on /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3320.png
2024-12-22 13:05:57,364 - kalliste.detectors.yolo_detector - ERROR - Error during face detection: 'Conv' object has no attribute 'bn'
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/detectors/yolo_detector.py", line 100, in detect_faces
    results = self.face_model(str(image_path), conf=face_config.confidence_threshold)[0]
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/engine/model.py", line 177, in __call__
    return self.predict(source, stream, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/engine/model.py", line 446, in predict
    self.predictor.setup_model(model=self.model, verbose=is_cli)
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/engine/predictor.py", line 303, in setup_model
    self.model = AutoBackend(
                 ^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/torch/utils/_contextlib.py", line 116, in decorate_context
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/nn/autobackend.py", line 144, in __init__
    model = model.fuse(verbose=verbose)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/nn/tasks.py", line 185, in fuse
    delattr(m, "bn")  # remove batchnorm
    ^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/torch/nn/modules/module.py", line 2043, in __delattr__
    super().__delattr__(name)
AttributeError: 'Conv' object has no attribute 'bn'
2024-12-22 13:05:57,364 - kalliste.detectors.yolo_detector - ERROR - Error during face detection: 'Conv' object has no attribute 'bn'
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/detectors/yolo_detector.py", line 100, in detect_faces
    results = self.face_model(str(image_path), conf=face_config.confidence_threshold)[0]
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/engine/model.py", line 177, in __call__
    return self.predict(source, stream, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/engine/model.py", line 446, in predict
    self.predictor.setup_model(model=self.model, verbose=is_cli)
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/engine/predictor.py", line 303, in setup_model
    self.model = AutoBackend(
                 ^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/torch/utils/_contextlib.py", line 116, in decorate_context
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/nn/autobackend.py", line 144, in __init__
    model = model.fuse(verbose=verbose)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/nn/tasks.py", line 185, in fuse
    delattr(m, "bn")  # remove batchnorm
    ^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/torch/nn/modules/module.py", line 2043, in __delattr__
    super().__delattr__(name)
AttributeError: 'Conv' object has no attribute 'bn'
2024-12-22 13:05:57,366 - kalliste.detectors.yolo_detector - ERROR - Error during detection: Face detection failed
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/detectors/yolo_detector.py", line 100, in detect_faces
    results = self.face_model(str(image_path), conf=face_config.confidence_threshold)[0]
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/engine/model.py", line 177, in __call__
    return self.predict(source, stream, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/engine/model.py", line 446, in predict
    self.predictor.setup_model(model=self.model, verbose=is_cli)
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/engine/predictor.py", line 303, in setup_model
    self.model = AutoBackend(
                 ^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/torch/utils/_contextlib.py", line 116, in decorate_context
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/nn/autobackend.py", line 144, in __init__
    model = model.fuse(verbose=verbose)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/nn/tasks.py", line 185, in fuse
    delattr(m, "bn")  # remove batchnorm
    ^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/torch/nn/modules/module.py", line 2043, in __delattr__
    super().__delattr__(name)
AttributeError: 'Conv' object has no attribute 'bn'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/detectors/yolo_detector.py", line 144, in detect
    regions.extend(self.detect_faces(image_path))
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/detectors/yolo_detector.py", line 123, in detect_faces
    raise RuntimeError("Face detection failed") from e
RuntimeError: Face detection failed
2024-12-22 13:05:57,366 - kalliste.detectors.yolo_detector - ERROR - Error during detection: Face detection failed
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/detectors/yolo_detector.py", line 100, in detect_faces
    results = self.face_model(str(image_path), conf=face_config.confidence_threshold)[0]
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/engine/model.py", line 177, in __call__
    return self.predict(source, stream, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/engine/model.py", line 446, in predict
    self.predictor.setup_model(model=self.model, verbose=is_cli)
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/engine/predictor.py", line 303, in setup_model
    self.model = AutoBackend(
                 ^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/torch/utils/_contextlib.py", line 116, in decorate_context
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/nn/autobackend.py", line 144, in __init__
    model = model.fuse(verbose=verbose)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/nn/tasks.py", line 185, in fuse
    delattr(m, "bn")  # remove batchnorm
    ^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/torch/nn/modules/module.py", line 2043, in __delattr__
    super().__delattr__(name)
AttributeError: 'Conv' object has no attribute 'bn'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/detectors/yolo_detector.py", line 144, in detect
    regions.extend(self.detect_faces(image_path))
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/detectors/yolo_detector.py", line 123, in detect_faces
    raise RuntimeError("Face detection failed") from e
RuntimeError: Face detection failed
2024-12-22 13:05:57,367 - kalliste.image.original_image - ERROR - Detection failed for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3297.png: Detection failed
2024-12-22 13:05:57,368 - kalliste.image.original_image - ERROR - Detection failed for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3297.png: Detection failed: Detection failed
2024-12-22 13:05:57,368 - kalliste.image.original_image - ERROR - Error processing /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3297.png: Detection failed: Detection failed: Detection failed
2024-12-22 13:05:57,368 - kalliste.image.batch - ERROR - Error processing image IMG_3297.png: Detection failed: Detection failed: Detection failed
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/detectors/yolo_detector.py", line 100, in detect_faces
    results = self.face_model(str(image_path), conf=face_config.confidence_threshold)[0]
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/engine/model.py", line 177, in __call__
    return self.predict(source, stream, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/engine/model.py", line 446, in predict
    self.predictor.setup_model(model=self.model, verbose=is_cli)
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/engine/predictor.py", line 303, in setup_model
    self.model = AutoBackend(
                 ^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/torch/utils/_contextlib.py", line 116, in decorate_context
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/nn/autobackend.py", line 144, in __init__
    model = model.fuse(verbose=verbose)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/nn/tasks.py", line 185, in fuse
    delattr(m, "bn")  # remove batchnorm
    ^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/torch/nn/modules/module.py", line 2043, in __delattr__
    super().__delattr__(name)
AttributeError: 'Conv' object has no attribute 'bn'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/detectors/yolo_detector.py", line 144, in detect
    regions.extend(self.detect_faces(image_path))
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/detectors/yolo_detector.py", line 123, in detect_faces
    raise RuntimeError("Face detection failed") from e
RuntimeError: Face detection failed

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 102, in run_detectors
    regions = await loop.run_in_executor(
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/detectors/yolo_detector.py", line 196, in detect
    raise RuntimeError("Detection failed") from e
RuntimeError: Detection failed

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 46, in process
    detections = await self.run_detectors()
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 116, in run_detectors
    raise RuntimeError(f"Detection failed: {e}") from e
RuntimeError: Detection failed: Detection failed

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 50, in process_image
    result = await image.process()
             ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 50, in process
    raise RuntimeError(f"Detection failed: {e}") from e
RuntimeError: Detection failed: Detection failed: Detection failed
2024-12-22 13:05:57,369 - kalliste.image.original_image - INFO - Starting processing for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3152.png
2024-12-22 13:05:57,369 - kalliste.image.original_image - ERROR - Detection failed for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3320.png: Detection failed
2024-12-22 13:05:57,369 - kalliste.image.original_image - ERROR - Detection failed for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3320.png: Detection failed: Detection failed
2024-12-22 13:05:57,369 - kalliste.image.original_image - ERROR - Error processing /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3320.png: Detection failed: Detection failed: Detection failed
2024-12-22 13:05:57,369 - kalliste.image.batch - ERROR - Error processing image IMG_3320.png: Detection failed: Detection failed: Detection failed
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/detectors/yolo_detector.py", line 100, in detect_faces
    results = self.face_model(str(image_path), conf=face_config.confidence_threshold)[0]
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/engine/model.py", line 177, in __call__
    return self.predict(source, stream, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/engine/model.py", line 446, in predict
    self.predictor.setup_model(model=self.model, verbose=is_cli)
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/engine/predictor.py", line 303, in setup_model
    self.model = AutoBackend(
                 ^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/torch/utils/_contextlib.py", line 116, in decorate_context
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/nn/autobackend.py", line 144, in __init__
    model = model.fuse(verbose=verbose)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/nn/tasks.py", line 185, in fuse
    delattr(m, "bn")  # remove batchnorm
    ^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/torch/nn/modules/module.py", line 2043, in __delattr__
    super().__delattr__(name)
AttributeError: 'Conv' object has no attribute 'bn'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/detectors/yolo_detector.py", line 144, in detect
    regions.extend(self.detect_faces(image_path))
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/detectors/yolo_detector.py", line 123, in detect_faces
    raise RuntimeError("Face detection failed") from e
RuntimeError: Face detection failed

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 102, in run_detectors
    regions = await loop.run_in_executor(
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/detectors/yolo_detector.py", line 196, in detect
    raise RuntimeError("Detection failed") from e
RuntimeError: Detection failed

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 46, in process
    detections = await self.run_detectors()
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 116, in run_detectors
    raise RuntimeError(f"Detection failed: {e}") from e
RuntimeError: Detection failed: Detection failed

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 50, in process_image
    result = await image.process()
             ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 50, in process
    raise RuntimeError(f"Detection failed: {e}") from e
RuntimeError: Detection failed: Detection failed: Detection failed
2024-12-22 13:05:57,370 - kalliste.image.batch - ERROR - Error processing batch /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2: Detection failed: Detection failed: Detection failed
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/detectors/yolo_detector.py", line 100, in detect_faces
    results = self.face_model(str(image_path), conf=face_config.confidence_threshold)[0]
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/engine/model.py", line 177, in __call__
    return self.predict(source, stream, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/engine/model.py", line 446, in predict
    self.predictor.setup_model(model=self.model, verbose=is_cli)
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/engine/predictor.py", line 303, in setup_model
    self.model = AutoBackend(
                 ^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/torch/utils/_contextlib.py", line 116, in decorate_context
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/nn/autobackend.py", line 144, in __init__
    model = model.fuse(verbose=verbose)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/nn/tasks.py", line 185, in fuse
    delattr(m, "bn")  # remove batchnorm
    ^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/torch/nn/modules/module.py", line 2043, in __delattr__
    super().__delattr__(name)
AttributeError: 'Conv' object has no attribute 'bn'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/detectors/yolo_detector.py", line 144, in detect
    regions.extend(self.detect_faces(image_path))
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/detectors/yolo_detector.py", line 123, in detect_faces
    raise RuntimeError("Face detection failed") from e
RuntimeError: Face detection failed

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 102, in run_detectors
    regions = await loop.run_in_executor(
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/detectors/yolo_detector.py", line 196, in detect
    raise RuntimeError("Detection failed") from e
RuntimeError: Detection failed

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 46, in process
    detections = await self.run_detectors()
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 116, in run_detectors
    raise RuntimeError(f"Detection failed: {e}") from e
RuntimeError: Detection failed: Detection failed

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 68, in process
    results = await asyncio.gather(*tasks)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 50, in process_image
    result = await image.process()
             ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 50, in process
    raise RuntimeError(f"Detection failed: {e}") from e
RuntimeError: Detection failed: Detection failed: Detection failed
2024-12-22 13:05:57,372 - kalliste.image.batch_processor - ERROR - Error processing batch 20180312_Photoshoot2: Batch processing failed: Detection failed: Detection failed: Detection failed
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/detectors/yolo_detector.py", line 100, in detect_faces
    results = self.face_model(str(image_path), conf=face_config.confidence_threshold)[0]
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/engine/model.py", line 177, in __call__
    return self.predict(source, stream, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/engine/model.py", line 446, in predict
    self.predictor.setup_model(model=self.model, verbose=is_cli)
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/engine/predictor.py", line 303, in setup_model
    self.model = AutoBackend(
                 ^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/torch/utils/_contextlib.py", line 116, in decorate_context
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/nn/autobackend.py", line 144, in __init__
    model = model.fuse(verbose=verbose)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/nn/tasks.py", line 185, in fuse
    delattr(m, "bn")  # remove batchnorm
    ^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/torch/nn/modules/module.py", line 2043, in __delattr__
    super().__delattr__(name)
AttributeError: 'Conv' object has no attribute 'bn'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/detectors/yolo_detector.py", line 144, in detect
    regions.extend(self.detect_faces(image_path))
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/detectors/yolo_detector.py", line 123, in detect_faces
    raise RuntimeError("Face detection failed") from e
RuntimeError: Face detection failed

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 102, in run_detectors
    regions = await loop.run_in_executor(
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/detectors/yolo_detector.py", line 196, in detect
    raise RuntimeError("Detection failed") from e
RuntimeError: Detection failed

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 46, in process
    detections = await self.run_detectors()
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 116, in run_detectors
    raise RuntimeError(f"Detection failed: {e}") from e
RuntimeError: Detection failed: Detection failed

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 68, in process
    results = await asyncio.gather(*tasks)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 50, in process_image
    result = await image.process()
             ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 50, in process
    raise RuntimeError(f"Detection failed: {e}") from e
RuntimeError: Detection failed: Detection failed: Detection failed

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/batch_processor.py", line 71, in process_all
    await batch.process()
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 78, in process
    raise RuntimeError(f"Batch processing failed: {e}") from e
RuntimeError: Batch processing failed: Detection failed: Detection failed: Detection failed
2024-12-22 13:05:57,373 - kalliste.image.batch_processor - ERROR - Error processing batches: Batch processing failed: Detection failed: Detection failed: Detection failed
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/detectors/yolo_detector.py", line 100, in detect_faces
    results = self.face_model(str(image_path), conf=face_config.confidence_threshold)[0]
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/engine/model.py", line 177, in __call__
    return self.predict(source, stream, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/engine/model.py", line 446, in predict
    self.predictor.setup_model(model=self.model, verbose=is_cli)
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/engine/predictor.py", line 303, in setup_model
    self.model = AutoBackend(
                 ^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/torch/utils/_contextlib.py", line 116, in decorate_context
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/nn/autobackend.py", line 144, in __init__
    model = model.fuse(verbose=verbose)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/nn/tasks.py", line 185, in fuse
    delattr(m, "bn")  # remove batchnorm
    ^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/torch/nn/modules/module.py", line 2043, in __delattr__
    super().__delattr__(name)
AttributeError: 'Conv' object has no attribute 'bn'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/detectors/yolo_detector.py", line 144, in detect
    regions.extend(self.detect_faces(image_path))
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/detectors/yolo_detector.py", line 123, in detect_faces
    raise RuntimeError("Face detection failed") from e
RuntimeError: Face detection failed

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 102, in run_detectors
    regions = await loop.run_in_executor(
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/detectors/yolo_detector.py", line 196, in detect
    raise RuntimeError("Detection failed") from e
RuntimeError: Detection failed

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 46, in process
    detections = await self.run_detectors()
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 116, in run_detectors
    raise RuntimeError(f"Detection failed: {e}") from e
RuntimeError: Detection failed: Detection failed

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 68, in process
    results = await asyncio.gather(*tasks)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 50, in process_image
    result = await image.process()
             ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 50, in process
    raise RuntimeError(f"Detection failed: {e}") from e
RuntimeError: Detection failed: Detection failed: Detection failed

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/batch_processor.py", line 71, in process_all
    await batch.process()
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 78, in process
    raise RuntimeError(f"Batch processing failed: {e}") from e
RuntimeError: Batch processing failed: Detection failed: Detection failed: Detection failed
2024-12-22 13:05:57,374 - kalliste.image.batch_processor - INFO - Cleaning up model registry
2024-12-22 13:05:57,374 - kalliste.image.model_registry - INFO - Starting model registry cleanup
2024-12-22 13:05:57,417 - kalliste.image.model_registry - INFO - Model registry cleanup complete
2024-12-22 13:05:57,417 - kalliste.image.batch_processor - INFO - Model registry cleanup complete
2024-12-22 13:05:57,417 - __main__ - ERROR - Error during batch processing: Batch processing failed: Detection failed: Detection failed: Detection failed
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/detectors/yolo_detector.py", line 100, in detect_faces
    results = self.face_model(str(image_path), conf=face_config.confidence_threshold)[0]
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/engine/model.py", line 177, in __call__
    return self.predict(source, stream, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/engine/model.py", line 446, in predict
    self.predictor.setup_model(model=self.model, verbose=is_cli)
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/engine/predictor.py", line 303, in setup_model
    self.model = AutoBackend(
                 ^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/torch/utils/_contextlib.py", line 116, in decorate_context
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/nn/autobackend.py", line 144, in __init__
    model = model.fuse(verbose=verbose)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/nn/tasks.py", line 185, in fuse
    delattr(m, "bn")  # remove batchnorm
    ^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/torch/nn/modules/module.py", line 2043, in __delattr__
    super().__delattr__(name)
AttributeError: 'Conv' object has no attribute 'bn'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/detectors/yolo_detector.py", line 144, in detect
    regions.extend(self.detect_faces(image_path))
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/detectors/yolo_detector.py", line 123, in detect_faces
    raise RuntimeError("Face detection failed") from e
RuntimeError: Face detection failed

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 102, in run_detectors
    regions = await loop.run_in_executor(
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/detectors/yolo_detector.py", line 196, in detect
    raise RuntimeError("Detection failed") from e
RuntimeError: Detection failed

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 46, in process
    detections = await self.run_detectors()
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 116, in run_detectors
    raise RuntimeError(f"Detection failed: {e}") from e
RuntimeError: Detection failed: Detection failed

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 68, in process
    results = await asyncio.gather(*tasks)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 50, in process_image
    result = await image.process()
             ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 50, in process
    raise RuntimeError(f"Detection failed: {e}") from e
RuntimeError: Detection failed: Detection failed: Detection failed

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/scripts/test_pipeline.py", line 59, in main
    await processor.process_all()
  File "/Users/rob/repos/kalliste/kalliste/image/batch_processor.py", line 71, in process_all
    await batch.process()
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 78, in process
    raise RuntimeError(f"Batch processing failed: {e}") from e
RuntimeError: Batch processing failed: Detection failed: Detection failed: Detection failed
2024-12-22 13:05:57,419 - __main__ - INFO - Pipeline test complete
2024-12-22 13:05:57,419 - kalliste.image.original_image - INFO - Starting processing for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A9668.png
2024-12-22 13:05:58,219 - kalliste.detectors.yolo_detector - INFO - Detection complete. Found 2 total regions
2024-12-22 13:05:58,220 - __main__ - ERROR - Pipeline test failed: Batch processing failed: Detection failed: Detection failed: Detection failed
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/detectors/yolo_detector.py", line 100, in detect_faces
    results = self.face_model(str(image_path), conf=face_config.confidence_threshold)[0]
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/engine/model.py", line 177, in __call__
    return self.predict(source, stream, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/engine/model.py", line 446, in predict
    self.predictor.setup_model(model=self.model, verbose=is_cli)
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/engine/predictor.py", line 303, in setup_model
    self.model = AutoBackend(
                 ^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/torch/utils/_contextlib.py", line 116, in decorate_context
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/nn/autobackend.py", line 144, in __init__
    model = model.fuse(verbose=verbose)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/nn/tasks.py", line 185, in fuse
    delattr(m, "bn")  # remove batchnorm
    ^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/torch/nn/modules/module.py", line 2043, in __delattr__
    super().__delattr__(name)
AttributeError: 'Conv' object has no attribute 'bn'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/detectors/yolo_detector.py", line 144, in detect
    regions.extend(self.detect_faces(image_path))
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/detectors/yolo_detector.py", line 123, in detect_faces
    raise RuntimeError("Face detection failed") from e
RuntimeError: Face detection failed

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 102, in run_detectors
    regions = await loop.run_in_executor(
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/detectors/yolo_detector.py", line 196, in detect
    raise RuntimeError("Detection failed") from e
RuntimeError: Detection failed

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 46, in process
    detections = await self.run_detectors()
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 116, in run_detectors
    raise RuntimeError(f"Detection failed: {e}") from e
RuntimeError: Detection failed: Detection failed

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 68, in process
    results = await asyncio.gather(*tasks)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 50, in process_image
    result = await image.process()
             ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 50, in process
    raise RuntimeError(f"Detection failed: {e}") from e
RuntimeError: Detection failed: Detection failed: Detection failed

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/scripts/test_pipeline.py", line 69, in <module>
    asyncio.run(main())
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
           ^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/asyncio/base_events.py", line 654, in run_until_complete
    return future.result()
           ^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/scripts/test_pipeline.py", line 59, in main
    await processor.process_all()
  File "/Users/rob/repos/kalliste/kalliste/image/batch_processor.py", line 71, in process_all
    await batch.process()
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 78, in process
    raise RuntimeError(f"Batch processing failed: {e}") from e
RuntimeError: Batch processing failed: Detection failed: Detection failed: Detection failed
2024-12-22 13:09:47,513 - __main__ - INFO - Starting pipeline test
2024-12-22 13:09:47,513 - __main__ - INFO - Input directory: /Users/rob/repos/kalliste/test_images_input
2024-12-22 13:09:47,513 - __main__ - INFO - Output directory: /Users/rob/repos/kalliste/test_images_output
2024-12-22 13:09:47,513 - __main__ - INFO - Initializing BatchProcessor
2024-12-22 13:09:47,513 - kalliste.image.batch_processor - INFO - Initializing BatchProcessor with input_root=/Users/rob/repos/kalliste/test_images_input, output_root=/Users/rob/repos/kalliste/test_images_output
2024-12-22 13:09:47,513 - kalliste.image.batch_processor - INFO - Scanning for batches in /Users/rob/repos/kalliste/test_images_input
2024-12-22 13:09:47,513 - kalliste.image.batch - INFO - Initializing Batch with input_path=/Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2, max_concurrent=3
2024-12-22 13:09:47,513 - kalliste.image.batch - INFO - Scanning for images in /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2
2024-12-22 13:09:47,514 - kalliste.image.batch - INFO - Found 9 images to process in batch 20180312_Photoshoot2
2024-12-22 13:09:47,514 - kalliste.image.batch - INFO - Initializing Batch with input_path=/Users/rob/repos/kalliste/test_images_input/20241012_Photoshoot1, max_concurrent=3
2024-12-22 13:09:47,514 - kalliste.image.batch - INFO - Scanning for images in /Users/rob/repos/kalliste/test_images_input/20241012_Photoshoot1
2024-12-22 13:09:47,514 - kalliste.image.batch - INFO - Found 12 images to process in batch 20241012_Photoshoot1
2024-12-22 13:09:47,514 - kalliste.image.batch_processor - INFO - Found 2 batches to process
2024-12-22 13:09:47,514 - __main__ - INFO - BatchProcessor created
2024-12-22 13:09:47,514 - __main__ - INFO - Initializing models
2024-12-22 13:09:47,514 - kalliste.image.batch_processor - INFO - Initializing model registry
2024-12-22 13:09:47,514 - kalliste.image.model_registry - INFO - Starting model registry initialization
2024-12-22 13:09:47,514 - kalliste.image.model_registry - INFO - Initializing tagger pipeline...
2024-12-22 13:09:47,514 - kalliste.taggers.tagger_pipeline - INFO - Creating TaggerPipeline instance
2024-12-22 13:09:47,578 - kalliste.taggers.base_tagger - INFO - MPS device validated
2024-12-22 13:09:47,578 - kalliste.taggers.tagger_pipeline - INFO - TaggerPipeline created with device: mps
2024-12-22 13:09:47,578 - kalliste.taggers.tagger_pipeline - INFO - Starting TaggerPipeline initialization
2024-12-22 13:09:47,578 - kalliste.taggers.tagger_pipeline - INFO - Initializing wd14 tagger
2024-12-22 13:09:47,578 - kalliste.taggers.base_tagger - INFO - Initializing WD14Tagger on device: mps
2024-12-22 13:09:47,578 - kalliste.taggers.wd14_tagger - INFO - Loading WD14 model: hf_hub:SmilingWolf/wd-vit-large-tagger-v3
2024-12-22 13:10:01,300 - timm.models._builder - INFO - Loading pretrained weights from Hugging Face hub (SmilingWolf/wd-vit-large-tagger-v3)
2024-12-22 13:10:01,407 - timm.models._hub - INFO - [SmilingWolf/wd-vit-large-tagger-v3] Safe alternative available for 'pytorch_model.bin' (as 'model.safetensors'). Loading weights using safetensors.
2024-12-22 13:10:01,607 - kalliste.taggers.wd14_tagger - INFO - Loaded 10861 WD14 tags
2024-12-22 13:10:01,607 - kalliste.taggers.tagger_pipeline - INFO - Successfully initialized wd14 tagger
2024-12-22 13:10:01,607 - kalliste.taggers.tagger_pipeline - INFO - Initializing orientation tagger
2024-12-22 13:10:01,607 - kalliste.taggers.base_tagger - INFO - Initializing OrientationTagger on device: mps
2024-12-22 13:10:01,607 - kalliste.taggers.orientation_tagger - INFO - Loading orientation model: LucyintheSky/pose-estimation-front-side-back
2024-12-22 13:10:03,190 - kalliste.taggers.orientation_tagger - INFO - Orientation model loaded successfully on cpu
2024-12-22 13:10:03,190 - kalliste.taggers.tagger_pipeline - INFO - Successfully initialized orientation tagger
2024-12-22 13:10:03,190 - kalliste.taggers.tagger_pipeline - INFO - Initializing caption tagger
2024-12-22 13:10:03,190 - kalliste.taggers.base_tagger - INFO - Initializing CaptionTagger on device: mps
2024-12-22 13:10:03,190 - kalliste.taggers.caption_tagger - INFO - Loading BLIP2 model: Salesforce/blip2-opt-2.7b
2024-12-22 13:10:05,076 - kalliste.taggers.caption_tagger - INFO - BLIP2 model loaded successfully on cpu
2024-12-22 13:10:05,076 - kalliste.taggers.tagger_pipeline - INFO - Successfully initialized caption tagger
2024-12-22 13:10:05,076 - kalliste.taggers.tagger_pipeline - INFO - TaggerPipeline initialization complete
2024-12-22 13:10:05,076 - kalliste.image.model_registry - INFO - Tagger pipeline initialized successfully
2024-12-22 13:10:05,076 - kalliste.image.model_registry - INFO - Initializing YOLO detector...
2024-12-22 13:10:05,076 - kalliste.detectors.yolo_detector - INFO - Initializing YOLO detector
2024-12-22 13:10:05,076 - kalliste.detectors.yolo_detector - INFO - Loading YOLO model from /Users/rob/.cache/ultralytics/yolov8n.pt
2024-12-22 13:10:05,098 - kalliste.detectors.yolo_detector - INFO - YOLO model loaded successfully
2024-12-22 13:10:05,098 - kalliste.detectors.yolo_detector - INFO - Loading YOLO face model from /Users/rob/.cache/ultralytics/yolov8n-face.pt
2024-12-22 13:10:05,140 - kalliste.detectors.yolo_detector - INFO - YOLO face model loaded successfully
2024-12-22 13:10:05,140 - kalliste.detectors.yolo_detector - INFO - YOLODetector initialized with 1 active classes
2024-12-22 13:10:05,140 - kalliste.image.model_registry - INFO - YOLO detector initialized successfully
2024-12-22 13:10:05,140 - kalliste.image.model_registry - INFO - Model registry initialization complete
2024-12-22 13:10:05,140 - kalliste.image.batch_processor - INFO - Model registry initialized successfully
2024-12-22 13:10:05,140 - __main__ - INFO - BatchProcessor initialized successfully
2024-12-22 13:10:05,140 - __main__ - INFO - Starting batch processing
2024-12-22 13:10:05,140 - kalliste.image.batch_processor - INFO - Starting batch processing
2024-12-22 13:10:05,140 - kalliste.image.batch_processor - INFO - Starting batch: 20180312_Photoshoot2
2024-12-22 13:10:05,140 - kalliste.image.batch - INFO - Starting batch processing for 20180312_Photoshoot2 with 9 images
2024-12-22 13:10:05,140 - kalliste.image.original_image - INFO - Starting processing for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3136.png
2024-12-22 13:10:05,140 - kalliste.image.original_image - INFO - Starting processing for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3320.png
2024-12-22 13:10:05,141 - kalliste.image.original_image - INFO - Starting processing for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3297.png
2024-12-22 13:10:05,146 - kalliste.detectors.yolo_detector - INFO - Running detection on /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3297.png
2024-12-22 13:10:05,148 - kalliste.detectors.yolo_detector - INFO - Running detection on /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3136.png
2024-12-22 13:10:05,149 - kalliste.detectors.yolo_detector - INFO - Running detection on /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3320.png
2024-12-22 13:10:05,159 - kalliste.detectors.yolo_detector - INFO - Fusing face model...
2024-12-22 13:10:05,159 - kalliste.detectors.yolo_detector - INFO - Fusing face model...
2024-12-22 13:10:05,159 - kalliste.detectors.yolo_detector - INFO - Fusing face model...
2024-12-22 13:10:05,161 - kalliste.detectors.yolo_detector - WARNING - Model fusion failed for face model: 'Conv' object has no attribute 'bn'
2024-12-22 13:10:05,161 - kalliste.detectors.yolo_detector - WARNING - Continuing with unfused model
2024-12-22 13:10:05,161 - kalliste.detectors.yolo_detector - WARNING - Model fusion failed for face model: 'Conv' object has no attribute 'bn'
2024-12-22 13:10:05,161 - kalliste.detectors.yolo_detector - WARNING - Continuing with unfused model
2024-12-22 13:10:05,227 - kalliste.detectors.yolo_detector - INFO - Face Model fused successfully
2024-12-22 13:10:05,502 - kalliste.detectors.yolo_detector - INFO - Fusing main model...
2024-12-22 13:10:05,539 - kalliste.detectors.yolo_detector - INFO - Main Model fused successfully
2024-12-22 13:10:05,867 - kalliste.detectors.yolo_detector - INFO - Detection complete. Found 2 total regions
2024-12-22 13:10:05,868 - kalliste.image.original_image - INFO - Found 2 detections in /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3297.png
2024-12-22 13:10:05,868 - kalliste.image.cropped_image - INFO - Starting crop processing for face from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3297.png
2024-12-22 13:10:05,868 - kalliste.image.cropped_image - INFO - Starting crop processing for person from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3297.png
2024-12-22 13:10:06,097 - kalliste.image.cropped_image - ERROR - Error in synchronous crop operation: Invalid format specifier '.3f if self.confidence is not None else None' for object of type 'float'
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 106, in _crop_image_sync
    KallisteTag(
  File "<string>", line 6, in __init__
  File "/Users/rob/repos/kalliste/kalliste/image/types.py", line 96, in __post_init__
    f"Created KallisteTag: tag='{self.tag}', source='{self.source}', "
ValueError: Invalid format specifier '.3f if self.confidence is not None else None' for object of type 'float'
2024-12-22 13:10:06,098 - kalliste.image.cropped_image - ERROR - Error during image cropping: Synchronous crop operation failed: Invalid format specifier '.3f if self.confidence is not None else None' for object of type 'float'
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 106, in _crop_image_sync
    KallisteTag(
  File "<string>", line 6, in __init__
  File "/Users/rob/repos/kalliste/kalliste/image/types.py", line 96, in __post_init__
    f"Created KallisteTag: tag='{self.tag}', source='{self.source}', "
ValueError: Invalid format specifier '.3f if self.confidence is not None else None' for object of type 'float'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 85, in crop_image
    self.cropped_image = await loop.run_in_executor(
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 120, in _crop_image_sync
    raise RuntimeError(f"Synchronous crop operation failed: {e}") from e
RuntimeError: Synchronous crop operation failed: Invalid format specifier '.3f if self.confidence is not None else None' for object of type 'float'
2024-12-22 13:10:06,099 - kalliste.image.cropped_image - ERROR - Error processing crop from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3297.png: Image cropping failed: Synchronous crop operation failed: Invalid format specifier '.3f if self.confidence is not None else None' for object of type 'float'
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 106, in _crop_image_sync
    KallisteTag(
  File "<string>", line 6, in __init__
  File "/Users/rob/repos/kalliste/kalliste/image/types.py", line 96, in __post_init__
    f"Created KallisteTag: tag='{self.tag}', source='{self.source}', "
ValueError: Invalid format specifier '.3f if self.confidence is not None else None' for object of type 'float'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 85, in crop_image
    self.cropped_image = await loop.run_in_executor(
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 120, in _crop_image_sync
    raise RuntimeError(f"Synchronous crop operation failed: {e}") from e
RuntimeError: Synchronous crop operation failed: Invalid format specifier '.3f if self.confidence is not None else None' for object of type 'float'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 37, in process
    await self.crop_image()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 92, in crop_image
    raise RuntimeError(f"Image cropping failed: {e}") from e
RuntimeError: Image cropping failed: Synchronous crop operation failed: Invalid format specifier '.3f if self.confidence is not None else None' for object of type 'float'
2024-12-22 13:10:06,099 - kalliste.image.original_image - ERROR - Error processing crops for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3297.png: Crop processing failed: Image cropping failed: Synchronous crop operation failed: Invalid format specifier '.3f if self.confidence is not None else None' for object of type 'float'
2024-12-22 13:10:06,099 - kalliste.image.original_image - ERROR - Error processing /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3297.png: Crop processing failed: Crop processing failed: Image cropping failed: Synchronous crop operation failed: Invalid format specifier '.3f if self.confidence is not None else None' for object of type 'float'
2024-12-22 13:10:06,099 - kalliste.image.batch - ERROR - Error processing image IMG_3297.png: Crop processing failed: Crop processing failed: Image cropping failed: Synchronous crop operation failed: Invalid format specifier '.3f if self.confidence is not None else None' for object of type 'float'
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 106, in _crop_image_sync
    KallisteTag(
  File "<string>", line 6, in __init__
  File "/Users/rob/repos/kalliste/kalliste/image/types.py", line 96, in __post_init__
    f"Created KallisteTag: tag='{self.tag}', source='{self.source}', "
ValueError: Invalid format specifier '.3f if self.confidence is not None else None' for object of type 'float'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 85, in crop_image
    self.cropped_image = await loop.run_in_executor(
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 120, in _crop_image_sync
    raise RuntimeError(f"Synchronous crop operation failed: {e}") from e
RuntimeError: Synchronous crop operation failed: Invalid format specifier '.3f if self.confidence is not None else None' for object of type 'float'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 37, in process
    await self.crop_image()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 92, in crop_image
    raise RuntimeError(f"Image cropping failed: {e}") from e
RuntimeError: Image cropping failed: Synchronous crop operation failed: Invalid format specifier '.3f if self.confidence is not None else None' for object of type 'float'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 66, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 50, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: Image cropping failed: Synchronous crop operation failed: Invalid format specifier '.3f if self.confidence is not None else None' for object of type 'float'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 50, in process_image
    result = await image.process()
             ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 69, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: Crop processing failed: Image cropping failed: Synchronous crop operation failed: Invalid format specifier '.3f if self.confidence is not None else None' for object of type 'float'
2024-12-22 13:10:06,100 - kalliste.image.original_image - INFO - Starting processing for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3152.png
2024-12-22 13:10:06,100 - kalliste.image.batch - ERROR - Error processing batch /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2: Crop processing failed: Crop processing failed: Image cropping failed: Synchronous crop operation failed: Invalid format specifier '.3f if self.confidence is not None else None' for object of type 'float'
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 106, in _crop_image_sync
    KallisteTag(
  File "<string>", line 6, in __init__
  File "/Users/rob/repos/kalliste/kalliste/image/types.py", line 96, in __post_init__
    f"Created KallisteTag: tag='{self.tag}', source='{self.source}', "
ValueError: Invalid format specifier '.3f if self.confidence is not None else None' for object of type 'float'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 85, in crop_image
    self.cropped_image = await loop.run_in_executor(
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 120, in _crop_image_sync
    raise RuntimeError(f"Synchronous crop operation failed: {e}") from e
RuntimeError: Synchronous crop operation failed: Invalid format specifier '.3f if self.confidence is not None else None' for object of type 'float'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 37, in process
    await self.crop_image()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 92, in crop_image
    raise RuntimeError(f"Image cropping failed: {e}") from e
RuntimeError: Image cropping failed: Synchronous crop operation failed: Invalid format specifier '.3f if self.confidence is not None else None' for object of type 'float'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 66, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 50, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: Image cropping failed: Synchronous crop operation failed: Invalid format specifier '.3f if self.confidence is not None else None' for object of type 'float'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 68, in process
    results = await asyncio.gather(*tasks)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 50, in process_image
    result = await image.process()
             ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 69, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: Crop processing failed: Image cropping failed: Synchronous crop operation failed: Invalid format specifier '.3f if self.confidence is not None else None' for object of type 'float'
2024-12-22 13:10:06,101 - kalliste.image.batch_processor - ERROR - Error processing batch 20180312_Photoshoot2: Batch processing failed: Crop processing failed: Crop processing failed: Image cropping failed: Synchronous crop operation failed: Invalid format specifier '.3f if self.confidence is not None else None' for object of type 'float'
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 106, in _crop_image_sync
    KallisteTag(
  File "<string>", line 6, in __init__
  File "/Users/rob/repos/kalliste/kalliste/image/types.py", line 96, in __post_init__
    f"Created KallisteTag: tag='{self.tag}', source='{self.source}', "
ValueError: Invalid format specifier '.3f if self.confidence is not None else None' for object of type 'float'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 85, in crop_image
    self.cropped_image = await loop.run_in_executor(
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 120, in _crop_image_sync
    raise RuntimeError(f"Synchronous crop operation failed: {e}") from e
RuntimeError: Synchronous crop operation failed: Invalid format specifier '.3f if self.confidence is not None else None' for object of type 'float'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 37, in process
    await self.crop_image()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 92, in crop_image
    raise RuntimeError(f"Image cropping failed: {e}") from e
RuntimeError: Image cropping failed: Synchronous crop operation failed: Invalid format specifier '.3f if self.confidence is not None else None' for object of type 'float'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 66, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 50, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: Image cropping failed: Synchronous crop operation failed: Invalid format specifier '.3f if self.confidence is not None else None' for object of type 'float'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 68, in process
    results = await asyncio.gather(*tasks)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 50, in process_image
    result = await image.process()
             ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 69, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: Crop processing failed: Image cropping failed: Synchronous crop operation failed: Invalid format specifier '.3f if self.confidence is not None else None' for object of type 'float'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/batch_processor.py", line 71, in process_all
    await batch.process()
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 78, in process
    raise RuntimeError(f"Batch processing failed: {e}") from e
RuntimeError: Batch processing failed: Crop processing failed: Crop processing failed: Image cropping failed: Synchronous crop operation failed: Invalid format specifier '.3f if self.confidence is not None else None' for object of type 'float'
2024-12-22 13:10:06,102 - kalliste.image.batch_processor - ERROR - Error processing batches: Batch processing failed: Crop processing failed: Crop processing failed: Image cropping failed: Synchronous crop operation failed: Invalid format specifier '.3f if self.confidence is not None else None' for object of type 'float'
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 106, in _crop_image_sync
    KallisteTag(
  File "<string>", line 6, in __init__
  File "/Users/rob/repos/kalliste/kalliste/image/types.py", line 96, in __post_init__
    f"Created KallisteTag: tag='{self.tag}', source='{self.source}', "
ValueError: Invalid format specifier '.3f if self.confidence is not None else None' for object of type 'float'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 85, in crop_image
    self.cropped_image = await loop.run_in_executor(
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 120, in _crop_image_sync
    raise RuntimeError(f"Synchronous crop operation failed: {e}") from e
RuntimeError: Synchronous crop operation failed: Invalid format specifier '.3f if self.confidence is not None else None' for object of type 'float'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 37, in process
    await self.crop_image()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 92, in crop_image
    raise RuntimeError(f"Image cropping failed: {e}") from e
RuntimeError: Image cropping failed: Synchronous crop operation failed: Invalid format specifier '.3f if self.confidence is not None else None' for object of type 'float'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 66, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 50, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: Image cropping failed: Synchronous crop operation failed: Invalid format specifier '.3f if self.confidence is not None else None' for object of type 'float'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 68, in process
    results = await asyncio.gather(*tasks)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 50, in process_image
    result = await image.process()
             ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 69, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: Crop processing failed: Image cropping failed: Synchronous crop operation failed: Invalid format specifier '.3f if self.confidence is not None else None' for object of type 'float'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/batch_processor.py", line 71, in process_all
    await batch.process()
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 78, in process
    raise RuntimeError(f"Batch processing failed: {e}") from e
RuntimeError: Batch processing failed: Crop processing failed: Crop processing failed: Image cropping failed: Synchronous crop operation failed: Invalid format specifier '.3f if self.confidence is not None else None' for object of type 'float'
2024-12-22 13:10:06,102 - kalliste.image.batch_processor - INFO - Cleaning up model registry
2024-12-22 13:10:06,102 - kalliste.image.model_registry - INFO - Starting model registry cleanup
2024-12-22 13:10:06,103 - kalliste.image.cropped_image - ERROR - Error in synchronous crop operation: Invalid format specifier '.3f if self.confidence is not None else None' for object of type 'float'
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 106, in _crop_image_sync
    KallisteTag(
  File "<string>", line 6, in __init__
  File "/Users/rob/repos/kalliste/kalliste/image/types.py", line 96, in __post_init__
    f"Created KallisteTag: tag='{self.tag}', source='{self.source}', "
ValueError: Invalid format specifier '.3f if self.confidence is not None else None' for object of type 'float'
2024-12-22 13:10:06,145 - kalliste.image.model_registry - INFO - Model registry cleanup complete
2024-12-22 13:10:06,145 - kalliste.image.batch_processor - INFO - Model registry cleanup complete
2024-12-22 13:10:06,145 - __main__ - ERROR - Error during batch processing: Batch processing failed: Crop processing failed: Crop processing failed: Image cropping failed: Synchronous crop operation failed: Invalid format specifier '.3f if self.confidence is not None else None' for object of type 'float'
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 106, in _crop_image_sync
    KallisteTag(
  File "<string>", line 6, in __init__
  File "/Users/rob/repos/kalliste/kalliste/image/types.py", line 96, in __post_init__
    f"Created KallisteTag: tag='{self.tag}', source='{self.source}', "
ValueError: Invalid format specifier '.3f if self.confidence is not None else None' for object of type 'float'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 85, in crop_image
    self.cropped_image = await loop.run_in_executor(
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 120, in _crop_image_sync
    raise RuntimeError(f"Synchronous crop operation failed: {e}") from e
RuntimeError: Synchronous crop operation failed: Invalid format specifier '.3f if self.confidence is not None else None' for object of type 'float'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 37, in process
    await self.crop_image()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 92, in crop_image
    raise RuntimeError(f"Image cropping failed: {e}") from e
RuntimeError: Image cropping failed: Synchronous crop operation failed: Invalid format specifier '.3f if self.confidence is not None else None' for object of type 'float'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 66, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 50, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: Image cropping failed: Synchronous crop operation failed: Invalid format specifier '.3f if self.confidence is not None else None' for object of type 'float'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 68, in process
    results = await asyncio.gather(*tasks)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 50, in process_image
    result = await image.process()
             ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 69, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: Crop processing failed: Image cropping failed: Synchronous crop operation failed: Invalid format specifier '.3f if self.confidence is not None else None' for object of type 'float'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/scripts/test_pipeline.py", line 59, in main
    await processor.process_all()
  File "/Users/rob/repos/kalliste/kalliste/image/batch_processor.py", line 71, in process_all
    await batch.process()
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 78, in process
    raise RuntimeError(f"Batch processing failed: {e}") from e
RuntimeError: Batch processing failed: Crop processing failed: Crop processing failed: Image cropping failed: Synchronous crop operation failed: Invalid format specifier '.3f if self.confidence is not None else None' for object of type 'float'
2024-12-22 13:10:06,146 - __main__ - INFO - Pipeline test complete
2024-12-22 13:10:06,176 - kalliste.detectors.yolo_detector - INFO - Detection complete. Found 2 total regions
2024-12-22 13:10:06,452 - kalliste.detectors.yolo_detector - INFO - Detection complete. Found 2 total regions
2024-12-22 13:10:06,454 - __main__ - ERROR - Pipeline test failed: Batch processing failed: Crop processing failed: Crop processing failed: Image cropping failed: Synchronous crop operation failed: Invalid format specifier '.3f if self.confidence is not None else None' for object of type 'float'
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 106, in _crop_image_sync
    KallisteTag(
  File "<string>", line 6, in __init__
  File "/Users/rob/repos/kalliste/kalliste/image/types.py", line 96, in __post_init__
    f"Created KallisteTag: tag='{self.tag}', source='{self.source}', "
ValueError: Invalid format specifier '.3f if self.confidence is not None else None' for object of type 'float'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 85, in crop_image
    self.cropped_image = await loop.run_in_executor(
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 120, in _crop_image_sync
    raise RuntimeError(f"Synchronous crop operation failed: {e}") from e
RuntimeError: Synchronous crop operation failed: Invalid format specifier '.3f if self.confidence is not None else None' for object of type 'float'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 37, in process
    await self.crop_image()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 92, in crop_image
    raise RuntimeError(f"Image cropping failed: {e}") from e
RuntimeError: Image cropping failed: Synchronous crop operation failed: Invalid format specifier '.3f if self.confidence is not None else None' for object of type 'float'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 66, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 50, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: Image cropping failed: Synchronous crop operation failed: Invalid format specifier '.3f if self.confidence is not None else None' for object of type 'float'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 68, in process
    results = await asyncio.gather(*tasks)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 50, in process_image
    result = await image.process()
             ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 69, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: Crop processing failed: Image cropping failed: Synchronous crop operation failed: Invalid format specifier '.3f if self.confidence is not None else None' for object of type 'float'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/scripts/test_pipeline.py", line 69, in <module>
    asyncio.run(main())
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
           ^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/asyncio/base_events.py", line 654, in run_until_complete
    return future.result()
           ^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/scripts/test_pipeline.py", line 59, in main
    await processor.process_all()
  File "/Users/rob/repos/kalliste/kalliste/image/batch_processor.py", line 71, in process_all
    await batch.process()
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 78, in process
    raise RuntimeError(f"Batch processing failed: {e}") from e
RuntimeError: Batch processing failed: Crop processing failed: Crop processing failed: Image cropping failed: Synchronous crop operation failed: Invalid format specifier '.3f if self.confidence is not None else None' for object of type 'float'
2024-12-22 13:13:54,359 - __main__ - INFO - Starting pipeline test
2024-12-22 13:13:54,359 - __main__ - INFO - Input directory: /Users/rob/repos/kalliste/test_images_input
2024-12-22 13:13:54,359 - __main__ - INFO - Output directory: /Users/rob/repos/kalliste/test_images_output
2024-12-22 13:13:54,359 - __main__ - INFO - Initializing BatchProcessor
2024-12-22 13:13:54,359 - kalliste.image.batch_processor - INFO - Initializing BatchProcessor with input_root=/Users/rob/repos/kalliste/test_images_input, output_root=/Users/rob/repos/kalliste/test_images_output
2024-12-22 13:13:54,359 - kalliste.image.batch_processor - INFO - Scanning for batches in /Users/rob/repos/kalliste/test_images_input
2024-12-22 13:13:54,360 - kalliste.image.batch - INFO - Initializing Batch with input_path=/Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2, max_concurrent=3
2024-12-22 13:13:54,360 - kalliste.image.batch - INFO - Scanning for images in /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2
2024-12-22 13:13:54,360 - kalliste.image.batch - INFO - Found 9 images to process in batch 20180312_Photoshoot2
2024-12-22 13:13:54,360 - kalliste.image.batch - INFO - Initializing Batch with input_path=/Users/rob/repos/kalliste/test_images_input/20241012_Photoshoot1, max_concurrent=3
2024-12-22 13:13:54,360 - kalliste.image.batch - INFO - Scanning for images in /Users/rob/repos/kalliste/test_images_input/20241012_Photoshoot1
2024-12-22 13:13:54,360 - kalliste.image.batch - INFO - Found 12 images to process in batch 20241012_Photoshoot1
2024-12-22 13:13:54,360 - kalliste.image.batch_processor - INFO - Found 2 batches to process
2024-12-22 13:13:54,360 - __main__ - INFO - BatchProcessor created
2024-12-22 13:13:54,360 - __main__ - INFO - Initializing models
2024-12-22 13:13:54,360 - kalliste.image.batch_processor - INFO - Initializing model registry
2024-12-22 13:13:54,360 - kalliste.image.model_registry - INFO - Starting model registry initialization
2024-12-22 13:13:54,360 - kalliste.image.model_registry - INFO - Initializing tagger pipeline...
2024-12-22 13:13:54,360 - kalliste.taggers.tagger_pipeline - INFO - Creating TaggerPipeline instance
2024-12-22 13:13:54,419 - kalliste.taggers.base_tagger - INFO - MPS device validated
2024-12-22 13:13:54,419 - kalliste.taggers.tagger_pipeline - INFO - TaggerPipeline created with device: mps
2024-12-22 13:13:54,419 - kalliste.taggers.tagger_pipeline - INFO - Starting TaggerPipeline initialization
2024-12-22 13:13:54,419 - kalliste.taggers.tagger_pipeline - INFO - Initializing wd14 tagger
2024-12-22 13:13:54,419 - kalliste.taggers.base_tagger - INFO - Initializing WD14Tagger on device: mps
2024-12-22 13:13:54,420 - kalliste.taggers.wd14_tagger - INFO - Loading WD14 model: hf_hub:SmilingWolf/wd-vit-large-tagger-v3
2024-12-22 13:14:08,167 - timm.models._builder - INFO - Loading pretrained weights from Hugging Face hub (SmilingWolf/wd-vit-large-tagger-v3)
2024-12-22 13:14:08,272 - timm.models._hub - INFO - [SmilingWolf/wd-vit-large-tagger-v3] Safe alternative available for 'pytorch_model.bin' (as 'model.safetensors'). Loading weights using safetensors.
2024-12-22 13:14:08,454 - kalliste.taggers.wd14_tagger - INFO - Loaded 10861 WD14 tags
2024-12-22 13:14:08,455 - kalliste.taggers.tagger_pipeline - INFO - Successfully initialized wd14 tagger
2024-12-22 13:14:08,455 - kalliste.taggers.tagger_pipeline - INFO - Initializing orientation tagger
2024-12-22 13:14:08,455 - kalliste.taggers.base_tagger - INFO - Initializing OrientationTagger on device: mps
2024-12-22 13:14:08,455 - kalliste.taggers.orientation_tagger - INFO - Loading orientation model: LucyintheSky/pose-estimation-front-side-back
2024-12-22 13:14:09,790 - kalliste.taggers.orientation_tagger - INFO - Orientation model loaded successfully on cpu
2024-12-22 13:14:09,790 - kalliste.taggers.tagger_pipeline - INFO - Successfully initialized orientation tagger
2024-12-22 13:14:09,790 - kalliste.taggers.tagger_pipeline - INFO - Initializing caption tagger
2024-12-22 13:14:09,790 - kalliste.taggers.base_tagger - INFO - Initializing CaptionTagger on device: mps
2024-12-22 13:14:09,790 - kalliste.taggers.caption_tagger - INFO - Loading BLIP2 model: Salesforce/blip2-opt-2.7b
2024-12-22 13:14:11,309 - kalliste.taggers.caption_tagger - INFO - BLIP2 model loaded successfully on cpu
2024-12-22 13:14:11,309 - kalliste.taggers.tagger_pipeline - INFO - Successfully initialized caption tagger
2024-12-22 13:14:11,309 - kalliste.taggers.tagger_pipeline - INFO - TaggerPipeline initialization complete
2024-12-22 13:14:11,309 - kalliste.image.model_registry - INFO - Tagger pipeline initialized successfully
2024-12-22 13:14:11,309 - kalliste.image.model_registry - INFO - Initializing YOLO detector...
2024-12-22 13:14:11,309 - kalliste.detectors.yolo_detector - INFO - Initializing YOLO detector
2024-12-22 13:14:11,309 - kalliste.detectors.yolo_detector - INFO - Loading YOLO model from /Users/rob/.cache/ultralytics/yolov8n.pt
2024-12-22 13:14:11,327 - kalliste.detectors.yolo_detector - INFO - YOLO model loaded successfully
2024-12-22 13:14:11,327 - kalliste.detectors.yolo_detector - INFO - Loading YOLO face model from /Users/rob/.cache/ultralytics/yolov8n-face.pt
2024-12-22 13:14:11,368 - kalliste.detectors.yolo_detector - INFO - YOLO face model loaded successfully
2024-12-22 13:14:11,368 - kalliste.detectors.yolo_detector - INFO - YOLODetector initialized with 1 active classes
2024-12-22 13:14:11,368 - kalliste.image.model_registry - INFO - YOLO detector initialized successfully
2024-12-22 13:14:11,368 - kalliste.image.model_registry - INFO - Model registry initialization complete
2024-12-22 13:14:11,368 - kalliste.image.batch_processor - INFO - Model registry initialized successfully
2024-12-22 13:14:11,368 - __main__ - INFO - BatchProcessor initialized successfully
2024-12-22 13:14:11,368 - __main__ - INFO - Starting batch processing
2024-12-22 13:14:11,368 - kalliste.image.batch_processor - INFO - Starting batch processing
2024-12-22 13:14:11,368 - kalliste.image.batch_processor - INFO - Starting batch: 20180312_Photoshoot2
2024-12-22 13:14:11,368 - kalliste.image.batch - INFO - Starting batch processing for 20180312_Photoshoot2 with 9 images
2024-12-22 13:14:11,368 - kalliste.image.original_image - INFO - Starting processing for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3136.png
2024-12-22 13:14:11,368 - kalliste.image.original_image - INFO - Starting processing for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3320.png
2024-12-22 13:14:11,368 - kalliste.image.original_image - INFO - Starting processing for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3297.png
2024-12-22 13:14:11,373 - kalliste.detectors.yolo_detector - INFO - Running detection on /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3297.png
2024-12-22 13:14:11,375 - kalliste.detectors.yolo_detector - INFO - Running detection on /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3320.png
2024-12-22 13:14:11,376 - kalliste.detectors.yolo_detector - INFO - Running detection on /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3136.png
2024-12-22 13:14:11,387 - kalliste.detectors.yolo_detector - INFO - Fusing face model...
2024-12-22 13:14:11,388 - kalliste.detectors.yolo_detector - INFO - Fusing face model...
2024-12-22 13:14:11,389 - kalliste.detectors.yolo_detector - INFO - Fusing face model...
2024-12-22 13:14:11,390 - kalliste.detectors.yolo_detector - WARNING - Model fusion failed for face model: 'Conv' object has no attribute 'bn'
2024-12-22 13:14:11,390 - kalliste.detectors.yolo_detector - WARNING - Continuing with unfused model
2024-12-22 13:14:11,390 - kalliste.detectors.yolo_detector - WARNING - Model fusion failed for face model: 'Conv' object has no attribute 'bn'
2024-12-22 13:14:11,390 - kalliste.detectors.yolo_detector - WARNING - Continuing with unfused model
2024-12-22 13:14:11,454 - kalliste.detectors.yolo_detector - INFO - Face Model fused successfully
2024-12-22 13:14:11,750 - kalliste.detectors.yolo_detector - INFO - Fusing main model...
2024-12-22 13:14:11,787 - kalliste.detectors.yolo_detector - INFO - Main Model fused successfully
2024-12-22 13:14:12,106 - kalliste.detectors.yolo_detector - INFO - Detection complete. Found 2 total regions
2024-12-22 13:14:12,107 - kalliste.image.original_image - INFO - Found 2 detections in /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3297.png
2024-12-22 13:14:12,107 - kalliste.image.cropped_image - INFO - Starting crop processing for face from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3297.png
2024-12-22 13:14:12,107 - kalliste.image.cropped_image - INFO - Starting crop processing for person from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3297.png
2024-12-22 13:14:12,338 - kalliste.image.cropped_image - INFO - Running taggers for face crop
2024-12-22 13:14:12,378 - kalliste.taggers.tagger_pipeline - INFO - Running orientation tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_3297_face_crop.png
2024-12-22 13:14:12,403 - kalliste.detectors.yolo_detector - INFO - Detection complete. Found 2 total regions
2024-12-22 13:14:12,720 - kalliste.detectors.yolo_detector - INFO - Detection complete. Found 2 total regions
2024-12-22 13:14:13,402 - kalliste.image.cropped_image - INFO - Running taggers for person crop
2024-12-22 13:14:15,727 - kalliste.taggers.tagger_pipeline - INFO - Running wd14 tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_3297_person_crop.png
2024-12-22 13:14:17,987 - kalliste.taggers.wd14_tagger - ERROR - WD14 tagging failed: argument of type 'NoneType' is not iterable
2024-12-22 13:14:17,988 - kalliste.taggers.tagger_pipeline - INFO - Running orientation tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_3297_person_crop.png
2024-12-22 13:14:18,224 - kalliste.taggers.tagger_pipeline - INFO - Running caption tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_3297_person_crop.png
2024-12-22 13:14:58,960 - kalliste.image.original_image - INFO - Found 2 detections in /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3136.png
2024-12-22 13:14:58,971 - kalliste.image.original_image - INFO - Found 2 detections in /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3320.png
2024-12-22 13:14:58,972 - kalliste.image.cropped_image - ERROR - Error during tagging: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined
2024-12-22 13:14:58,975 - kalliste.image.cropped_image - ERROR - Error processing crop from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3297.png: Image tagging failed: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 38, in process
    await self.run_taggers()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 159, in run_taggers
    raise RuntimeError(f"Image tagging failed: {e}") from e
RuntimeError: Image tagging failed: name 'tag_category' is not defined
2024-12-22 13:14:58,977 - kalliste.image.cropped_image - INFO - Starting crop processing for face from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3136.png
2024-12-22 13:14:58,978 - kalliste.image.cropped_image - INFO - Starting crop processing for person from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3136.png
2024-12-22 13:14:58,980 - kalliste.image.cropped_image - INFO - Starting crop processing for face from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3320.png
2024-12-22 13:14:58,981 - kalliste.image.cropped_image - INFO - Starting crop processing for person from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3320.png
2024-12-22 13:14:58,983 - kalliste.image.cropped_image - ERROR - Error during tagging: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined
2024-12-22 13:14:58,984 - kalliste.image.cropped_image - ERROR - Error processing crop from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3297.png: Image tagging failed: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 38, in process
    await self.run_taggers()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 159, in run_taggers
    raise RuntimeError(f"Image tagging failed: {e}") from e
RuntimeError: Image tagging failed: name 'tag_category' is not defined
2024-12-22 13:14:59,010 - kalliste.image.original_image - ERROR - Error processing crops for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3297.png: Crop processing failed: Image tagging failed: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 38, in process
    await self.run_taggers()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 159, in run_taggers
    raise RuntimeError(f"Image tagging failed: {e}") from e
RuntimeError: Image tagging failed: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 66, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 50, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: Image tagging failed: name 'tag_category' is not defined
2024-12-22 13:14:59,018 - kalliste.image.original_image - ERROR - Error processing /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3297.png: Crop processing failed: Image tagging failed: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 38, in process
    await self.run_taggers()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 159, in run_taggers
    raise RuntimeError(f"Image tagging failed: {e}") from e
RuntimeError: Image tagging failed: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 66, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 50, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: Image tagging failed: name 'tag_category' is not defined
2024-12-22 13:14:59,020 - kalliste.image.batch - ERROR - Failed to process IMG_3297.png
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 38, in process
    await self.run_taggers()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 159, in run_taggers
    raise RuntimeError(f"Image tagging failed: {e}") from e
RuntimeError: Image tagging failed: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 44, in process_image
    return await image.process()
           ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 66, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 50, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: Image tagging failed: name 'tag_category' is not defined
2024-12-22 13:14:59,022 - kalliste.image.original_image - INFO - Starting processing for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3152.png
2024-12-22 13:14:59,228 - kalliste.detectors.yolo_detector - INFO - Running detection on /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3152.png
2024-12-22 13:14:59,346 - kalliste.image.cropped_image - INFO - Running taggers for face crop
2024-12-22 13:14:59,393 - kalliste.taggers.tagger_pipeline - INFO - Running orientation tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_3320_face_crop.png
2024-12-22 13:14:59,648 - kalliste.detectors.yolo_detector - INFO - Detection complete. Found 2 total regions
2024-12-22 13:15:00,310 - kalliste.image.cropped_image - INFO - Running taggers for person crop
2024-12-22 13:15:02,790 - kalliste.image.cropped_image - INFO - Running taggers for face crop
2024-12-22 13:15:02,873 - kalliste.image.cropped_image - INFO - Running taggers for person crop
2024-12-22 13:15:06,576 - kalliste.taggers.tagger_pipeline - INFO - Running wd14 tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_3320_person_crop.png
2024-12-22 13:15:09,323 - kalliste.taggers.wd14_tagger - ERROR - WD14 tagging failed: argument of type 'NoneType' is not iterable
2024-12-22 13:15:09,324 - kalliste.taggers.tagger_pipeline - INFO - Running orientation tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_3320_person_crop.png
2024-12-22 13:15:09,593 - kalliste.taggers.tagger_pipeline - INFO - Running caption tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_3320_person_crop.png
2024-12-22 13:15:35,751 - kalliste.taggers.tagger_pipeline - INFO - Running orientation tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_3136_face_crop.png
2024-12-22 13:15:35,879 - kalliste.taggers.tagger_pipeline - INFO - Running wd14 tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_3136_person_crop.png
2024-12-22 13:15:38,288 - kalliste.taggers.wd14_tagger - ERROR - WD14 tagging failed: argument of type 'NoneType' is not iterable
2024-12-22 13:15:38,291 - kalliste.taggers.tagger_pipeline - INFO - Running orientation tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_3136_person_crop.png
2024-12-22 13:15:38,702 - kalliste.taggers.tagger_pipeline - INFO - Running caption tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_3136_person_crop.png
2024-12-22 13:15:44,487 - kalliste.image.original_image - INFO - Found 2 detections in /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3152.png
2024-12-22 13:15:44,487 - kalliste.image.cropped_image - ERROR - Error during tagging: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined
2024-12-22 13:15:44,487 - kalliste.image.cropped_image - ERROR - Error processing crop from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3320.png: Image tagging failed: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 38, in process
    await self.run_taggers()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 159, in run_taggers
    raise RuntimeError(f"Image tagging failed: {e}") from e
RuntimeError: Image tagging failed: name 'tag_category' is not defined
2024-12-22 13:15:44,488 - kalliste.image.cropped_image - INFO - Starting crop processing for face from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3152.png
2024-12-22 13:15:44,488 - kalliste.image.cropped_image - INFO - Starting crop processing for person from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3152.png
2024-12-22 13:15:44,488 - kalliste.image.cropped_image - ERROR - Error during tagging: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined
2024-12-22 13:15:44,488 - kalliste.image.cropped_image - ERROR - Error processing crop from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3320.png: Image tagging failed: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 38, in process
    await self.run_taggers()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 159, in run_taggers
    raise RuntimeError(f"Image tagging failed: {e}") from e
RuntimeError: Image tagging failed: name 'tag_category' is not defined
2024-12-22 13:15:44,491 - kalliste.image.cropped_image - ERROR - Error during tagging: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined
2024-12-22 13:15:44,492 - kalliste.image.cropped_image - ERROR - Error processing crop from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3136.png: Image tagging failed: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 38, in process
    await self.run_taggers()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 159, in run_taggers
    raise RuntimeError(f"Image tagging failed: {e}") from e
RuntimeError: Image tagging failed: name 'tag_category' is not defined
2024-12-22 13:15:44,496 - kalliste.image.cropped_image - ERROR - Error during tagging: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined
2024-12-22 13:15:44,496 - kalliste.image.cropped_image - ERROR - Error processing crop from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3136.png: Image tagging failed: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 38, in process
    await self.run_taggers()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 159, in run_taggers
    raise RuntimeError(f"Image tagging failed: {e}") from e
RuntimeError: Image tagging failed: name 'tag_category' is not defined
2024-12-22 13:15:44,496 - kalliste.image.original_image - ERROR - Error processing crops for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3320.png: Crop processing failed: Image tagging failed: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 38, in process
    await self.run_taggers()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 159, in run_taggers
    raise RuntimeError(f"Image tagging failed: {e}") from e
RuntimeError: Image tagging failed: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 66, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 50, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: Image tagging failed: name 'tag_category' is not defined
2024-12-22 13:15:44,497 - kalliste.image.original_image - ERROR - Error processing /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3320.png: Crop processing failed: Image tagging failed: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 38, in process
    await self.run_taggers()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 159, in run_taggers
    raise RuntimeError(f"Image tagging failed: {e}") from e
RuntimeError: Image tagging failed: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 66, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 50, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: Image tagging failed: name 'tag_category' is not defined
2024-12-22 13:15:44,497 - kalliste.image.batch - ERROR - Failed to process IMG_3320.png
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 38, in process
    await self.run_taggers()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 159, in run_taggers
    raise RuntimeError(f"Image tagging failed: {e}") from e
RuntimeError: Image tagging failed: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 44, in process_image
    return await image.process()
           ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 66, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 50, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: Image tagging failed: name 'tag_category' is not defined
2024-12-22 13:15:44,498 - kalliste.image.original_image - INFO - Starting processing for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A9668.png
2024-12-22 13:15:44,498 - kalliste.image.original_image - ERROR - Error processing crops for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3136.png: Crop processing failed: Image tagging failed: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 38, in process
    await self.run_taggers()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 159, in run_taggers
    raise RuntimeError(f"Image tagging failed: {e}") from e
RuntimeError: Image tagging failed: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 66, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 50, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: Image tagging failed: name 'tag_category' is not defined
2024-12-22 13:15:44,498 - kalliste.image.original_image - ERROR - Error processing /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3136.png: Crop processing failed: Image tagging failed: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 38, in process
    await self.run_taggers()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 159, in run_taggers
    raise RuntimeError(f"Image tagging failed: {e}") from e
RuntimeError: Image tagging failed: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 66, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 50, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: Image tagging failed: name 'tag_category' is not defined
2024-12-22 13:15:44,499 - kalliste.image.batch - ERROR - Failed to process IMG_3136.png
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 38, in process
    await self.run_taggers()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 159, in run_taggers
    raise RuntimeError(f"Image tagging failed: {e}") from e
RuntimeError: Image tagging failed: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 44, in process_image
    return await image.process()
           ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 66, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 50, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: Image tagging failed: name 'tag_category' is not defined
2024-12-22 13:15:44,499 - kalliste.image.original_image - INFO - Starting processing for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_0241-2.png
2024-12-22 13:15:44,521 - kalliste.detectors.yolo_detector - INFO - Running detection on /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A9668.png
2024-12-22 13:15:44,524 - kalliste.detectors.yolo_detector - INFO - Running detection on /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_0241-2.png
2024-12-22 13:15:44,629 - kalliste.image.cropped_image - INFO - Running taggers for face crop
2024-12-22 13:15:44,669 - kalliste.image.cropped_image - INFO - Running taggers for person crop
2024-12-22 13:15:45,788 - kalliste.detectors.yolo_detector - INFO - Detection complete. Found 2 total regions
2024-12-22 13:15:46,094 - kalliste.detectors.yolo_detector - INFO - Detection complete. Found 2 total regions
2024-12-22 13:15:46,602 - kalliste.taggers.tagger_pipeline - INFO - Running orientation tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_3152_face_crop.png
2024-12-22 13:15:46,724 - kalliste.taggers.tagger_pipeline - INFO - Running wd14 tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_3152_person_crop.png
2024-12-22 13:15:49,175 - kalliste.taggers.wd14_tagger - ERROR - WD14 tagging failed: argument of type 'NoneType' is not iterable
2024-12-22 13:15:49,177 - kalliste.taggers.tagger_pipeline - INFO - Running orientation tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_3152_person_crop.png
2024-12-22 13:15:49,458 - kalliste.taggers.tagger_pipeline - INFO - Running caption tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_3152_person_crop.png
2024-12-22 13:15:56,286 - kalliste.image.original_image - INFO - Found 2 detections in /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A9668.png
2024-12-22 13:15:56,287 - kalliste.image.original_image - INFO - Found 2 detections in /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_0241-2.png
2024-12-22 13:15:56,287 - kalliste.image.cropped_image - ERROR - Error during tagging: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined
2024-12-22 13:15:56,287 - kalliste.image.cropped_image - ERROR - Error processing crop from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3152.png: Image tagging failed: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 38, in process
    await self.run_taggers()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 159, in run_taggers
    raise RuntimeError(f"Image tagging failed: {e}") from e
RuntimeError: Image tagging failed: name 'tag_category' is not defined
2024-12-22 13:15:56,287 - kalliste.image.cropped_image - INFO - Starting crop processing for face from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A9668.png
2024-12-22 13:15:56,287 - kalliste.image.cropped_image - INFO - Starting crop processing for person from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A9668.png
2024-12-22 13:15:56,288 - kalliste.image.cropped_image - INFO - Starting crop processing for face from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_0241-2.png
2024-12-22 13:15:56,288 - kalliste.image.cropped_image - INFO - Starting crop processing for person from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_0241-2.png
2024-12-22 13:15:56,288 - kalliste.image.cropped_image - ERROR - Error during tagging: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined
2024-12-22 13:15:56,288 - kalliste.image.cropped_image - ERROR - Error processing crop from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3152.png: Image tagging failed: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 38, in process
    await self.run_taggers()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 159, in run_taggers
    raise RuntimeError(f"Image tagging failed: {e}") from e
RuntimeError: Image tagging failed: name 'tag_category' is not defined
2024-12-22 13:15:56,288 - kalliste.image.original_image - ERROR - Error processing crops for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3152.png: Crop processing failed: Image tagging failed: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 38, in process
    await self.run_taggers()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 159, in run_taggers
    raise RuntimeError(f"Image tagging failed: {e}") from e
RuntimeError: Image tagging failed: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 66, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 50, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: Image tagging failed: name 'tag_category' is not defined
2024-12-22 13:15:56,310 - kalliste.image.original_image - ERROR - Error processing /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3152.png: Crop processing failed: Image tagging failed: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 38, in process
    await self.run_taggers()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 159, in run_taggers
    raise RuntimeError(f"Image tagging failed: {e}") from e
RuntimeError: Image tagging failed: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 66, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 50, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: Image tagging failed: name 'tag_category' is not defined
2024-12-22 13:15:56,355 - kalliste.image.batch - ERROR - Failed to process IMG_3152.png
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 38, in process
    await self.run_taggers()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 159, in run_taggers
    raise RuntimeError(f"Image tagging failed: {e}") from e
RuntimeError: Image tagging failed: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 44, in process_image
    return await image.process()
           ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 66, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 50, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: Image tagging failed: name 'tag_category' is not defined
2024-12-22 13:15:56,356 - kalliste.image.original_image - INFO - Starting processing for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_2455.png
2024-12-22 13:15:56,369 - kalliste.detectors.yolo_detector - INFO - Running detection on /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_2455.png
2024-12-22 13:15:56,633 - kalliste.image.cropped_image - INFO - Running taggers for face crop
2024-12-22 13:15:57,254 - kalliste.image.cropped_image - INFO - Running taggers for person crop
2024-12-22 13:15:57,304 - kalliste.detectors.yolo_detector - INFO - Detection complete. Found 2 total regions
2024-12-22 13:15:59,168 - kalliste.taggers.tagger_pipeline - INFO - Running orientation tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_0241-2_face_crop.png
2024-12-22 13:15:59,359 - kalliste.taggers.tagger_pipeline - INFO - Running wd14 tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_0241-2_person_crop.png
2024-12-22 13:16:01,694 - kalliste.taggers.wd14_tagger - ERROR - WD14 tagging failed: argument of type 'NoneType' is not iterable
2024-12-22 13:16:01,695 - kalliste.taggers.tagger_pipeline - INFO - Running orientation tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_0241-2_person_crop.png
2024-12-22 13:16:01,978 - kalliste.taggers.tagger_pipeline - INFO - Running caption tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_0241-2_person_crop.png
2024-12-22 13:16:09,069 - kalliste.image.cropped_image - INFO - Running taggers for face crop
2024-12-22 13:16:12,989 - kalliste.image.cropped_image - INFO - Running taggers for person crop
2024-12-22 13:16:27,498 - kalliste.image.original_image - INFO - Found 2 detections in /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_2455.png
2024-12-22 13:16:27,502 - kalliste.taggers.tagger_pipeline - INFO - Running orientation tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A9668_face_crop.png
2024-12-22 13:16:27,919 - kalliste.taggers.tagger_pipeline - INFO - Running wd14 tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A9668_person_crop.png
2024-12-22 13:16:31,113 - kalliste.taggers.wd14_tagger - ERROR - WD14 tagging failed: argument of type 'NoneType' is not iterable
2024-12-22 13:16:31,119 - kalliste.taggers.tagger_pipeline - INFO - Running orientation tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A9668_person_crop.png
2024-12-22 13:16:32,319 - kalliste.taggers.tagger_pipeline - INFO - Running caption tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A9668_person_crop.png
2024-12-22 13:16:39,344 - kalliste.image.cropped_image - ERROR - Error during tagging: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined
2024-12-22 13:16:39,344 - kalliste.image.cropped_image - ERROR - Error processing crop from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_0241-2.png: Image tagging failed: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 38, in process
    await self.run_taggers()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 159, in run_taggers
    raise RuntimeError(f"Image tagging failed: {e}") from e
RuntimeError: Image tagging failed: name 'tag_category' is not defined
2024-12-22 13:16:39,345 - kalliste.image.cropped_image - INFO - Starting crop processing for face from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_2455.png
2024-12-22 13:16:39,345 - kalliste.image.cropped_image - INFO - Starting crop processing for person from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_2455.png
2024-12-22 13:16:39,345 - kalliste.image.cropped_image - ERROR - Error during tagging: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined
2024-12-22 13:16:39,345 - kalliste.image.cropped_image - ERROR - Error processing crop from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_0241-2.png: Image tagging failed: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 38, in process
    await self.run_taggers()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 159, in run_taggers
    raise RuntimeError(f"Image tagging failed: {e}") from e
RuntimeError: Image tagging failed: name 'tag_category' is not defined
2024-12-22 13:16:39,346 - kalliste.image.cropped_image - ERROR - Error during tagging: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined
2024-12-22 13:16:39,346 - kalliste.image.cropped_image - ERROR - Error processing crop from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A9668.png: Image tagging failed: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 38, in process
    await self.run_taggers()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 159, in run_taggers
    raise RuntimeError(f"Image tagging failed: {e}") from e
RuntimeError: Image tagging failed: name 'tag_category' is not defined
2024-12-22 13:16:39,347 - kalliste.image.cropped_image - ERROR - Error during tagging: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined
2024-12-22 13:16:39,362 - kalliste.image.cropped_image - ERROR - Error processing crop from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A9668.png: Image tagging failed: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 38, in process
    await self.run_taggers()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 159, in run_taggers
    raise RuntimeError(f"Image tagging failed: {e}") from e
RuntimeError: Image tagging failed: name 'tag_category' is not defined
2024-12-22 13:16:39,362 - kalliste.image.original_image - ERROR - Error processing crops for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_0241-2.png: Crop processing failed: Image tagging failed: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 38, in process
    await self.run_taggers()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 159, in run_taggers
    raise RuntimeError(f"Image tagging failed: {e}") from e
RuntimeError: Image tagging failed: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 66, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 50, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: Image tagging failed: name 'tag_category' is not defined
2024-12-22 13:16:39,363 - kalliste.image.original_image - ERROR - Error processing /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_0241-2.png: Crop processing failed: Image tagging failed: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 38, in process
    await self.run_taggers()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 159, in run_taggers
    raise RuntimeError(f"Image tagging failed: {e}") from e
RuntimeError: Image tagging failed: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 66, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 50, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: Image tagging failed: name 'tag_category' is not defined
2024-12-22 13:16:39,363 - kalliste.image.batch - ERROR - Failed to process IMG_0241-2.png
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 38, in process
    await self.run_taggers()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 159, in run_taggers
    raise RuntimeError(f"Image tagging failed: {e}") from e
RuntimeError: Image tagging failed: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 44, in process_image
    return await image.process()
           ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 66, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 50, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: Image tagging failed: name 'tag_category' is not defined
2024-12-22 13:16:39,364 - kalliste.image.original_image - INFO - Starting processing for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png
2024-12-22 13:16:39,364 - kalliste.image.original_image - ERROR - Error processing crops for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A9668.png: Crop processing failed: Image tagging failed: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 38, in process
    await self.run_taggers()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 159, in run_taggers
    raise RuntimeError(f"Image tagging failed: {e}") from e
RuntimeError: Image tagging failed: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 66, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 50, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: Image tagging failed: name 'tag_category' is not defined
2024-12-22 13:16:39,364 - kalliste.image.original_image - ERROR - Error processing /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A9668.png: Crop processing failed: Image tagging failed: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 38, in process
    await self.run_taggers()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 159, in run_taggers
    raise RuntimeError(f"Image tagging failed: {e}") from e
RuntimeError: Image tagging failed: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 66, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 50, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: Image tagging failed: name 'tag_category' is not defined
2024-12-22 13:16:39,364 - kalliste.image.batch - ERROR - Failed to process 3M2A9668.png
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 38, in process
    await self.run_taggers()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 159, in run_taggers
    raise RuntimeError(f"Image tagging failed: {e}") from e
RuntimeError: Image tagging failed: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 44, in process_image
    return await image.process()
           ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 66, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 50, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: Image tagging failed: name 'tag_category' is not defined
2024-12-22 13:16:39,365 - kalliste.image.original_image - INFO - Starting processing for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_2418.png
2024-12-22 13:16:39,392 - kalliste.detectors.yolo_detector - INFO - Running detection on /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_2418.png
2024-12-22 13:16:39,399 - kalliste.detectors.yolo_detector - INFO - Running detection on /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png
2024-12-22 13:16:39,809 - kalliste.image.cropped_image - INFO - Running taggers for face crop
2024-12-22 13:16:40,363 - kalliste.detectors.yolo_detector - INFO - Detection complete. Found 2 total regions
2024-12-22 13:16:41,046 - kalliste.taggers.tagger_pipeline - INFO - Running orientation tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_2455_face_crop.png
2024-12-22 13:16:41,291 - kalliste.image.cropped_image - INFO - Running taggers for person crop
2024-12-22 13:16:41,450 - kalliste.detectors.yolo_detector - INFO - Detection complete. Found 6 total regions
2024-12-22 13:16:45,981 - kalliste.image.original_image - INFO - Found 2 detections in /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_2418.png
2024-12-22 13:16:45,981 - kalliste.taggers.tagger_pipeline - INFO - Running wd14 tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_2455_person_crop.png
2024-12-22 13:16:48,564 - kalliste.taggers.wd14_tagger - ERROR - WD14 tagging failed: argument of type 'NoneType' is not iterable
2024-12-22 13:16:48,568 - kalliste.taggers.tagger_pipeline - INFO - Running orientation tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_2455_person_crop.png
2024-12-22 13:16:49,167 - kalliste.taggers.tagger_pipeline - INFO - Running caption tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_2455_person_crop.png
2024-12-22 13:16:55,428 - kalliste.image.cropped_image - INFO - Starting crop processing for face from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_2418.png
2024-12-22 13:16:55,429 - kalliste.image.cropped_image - INFO - Starting crop processing for person from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_2418.png
2024-12-22 13:16:55,429 - kalliste.image.cropped_image - ERROR - Error during tagging: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined
2024-12-22 13:16:55,429 - kalliste.image.cropped_image - ERROR - Error processing crop from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_2455.png: Image tagging failed: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 38, in process
    await self.run_taggers()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 159, in run_taggers
    raise RuntimeError(f"Image tagging failed: {e}") from e
RuntimeError: Image tagging failed: name 'tag_category' is not defined
2024-12-22 13:16:55,430 - kalliste.image.original_image - INFO - Found 6 detections in /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png
2024-12-22 13:16:55,438 - kalliste.image.cropped_image - INFO - Starting crop processing for face from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png
2024-12-22 13:16:55,453 - kalliste.image.cropped_image - INFO - Starting crop processing for face from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png
2024-12-22 13:16:55,453 - kalliste.image.cropped_image - INFO - Starting crop processing for face from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png
2024-12-22 13:16:55,453 - kalliste.image.cropped_image - INFO - Starting crop processing for person from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png
2024-12-22 13:16:55,453 - kalliste.image.cropped_image - INFO - Starting crop processing for person from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png
2024-12-22 13:16:55,484 - kalliste.image.cropped_image - INFO - Starting crop processing for person from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png
2024-12-22 13:16:55,485 - kalliste.image.cropped_image - ERROR - Error during tagging: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined
2024-12-22 13:16:55,515 - kalliste.image.cropped_image - ERROR - Error processing crop from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_2455.png: Image tagging failed: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 38, in process
    await self.run_taggers()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 159, in run_taggers
    raise RuntimeError(f"Image tagging failed: {e}") from e
RuntimeError: Image tagging failed: name 'tag_category' is not defined
2024-12-22 13:16:55,533 - kalliste.image.original_image - ERROR - Error processing crops for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_2455.png: Crop processing failed: Image tagging failed: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 38, in process
    await self.run_taggers()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 159, in run_taggers
    raise RuntimeError(f"Image tagging failed: {e}") from e
RuntimeError: Image tagging failed: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 66, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 50, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: Image tagging failed: name 'tag_category' is not defined
2024-12-22 13:16:55,534 - kalliste.image.original_image - ERROR - Error processing /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_2455.png: Crop processing failed: Image tagging failed: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 38, in process
    await self.run_taggers()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 159, in run_taggers
    raise RuntimeError(f"Image tagging failed: {e}") from e
RuntimeError: Image tagging failed: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 66, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 50, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: Image tagging failed: name 'tag_category' is not defined
2024-12-22 13:16:55,534 - kalliste.image.batch - ERROR - Failed to process IMG_2455.png
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 38, in process
    await self.run_taggers()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 159, in run_taggers
    raise RuntimeError(f"Image tagging failed: {e}") from e
RuntimeError: Image tagging failed: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 44, in process_image
    return await image.process()
           ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 66, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 50, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: Image tagging failed: name 'tag_category' is not defined
2024-12-22 13:16:55,997 - kalliste.image.cropped_image - INFO - Running taggers for face crop
2024-12-22 13:16:57,025 - kalliste.taggers.tagger_pipeline - INFO - Running orientation tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_2418_face_crop.png
2024-12-22 13:16:57,231 - kalliste.image.cropped_image - INFO - Running taggers for person crop
2024-12-22 13:17:02,029 - kalliste.image.cropped_image - INFO - Running taggers for face crop
2024-12-22 13:17:02,066 - kalliste.image.cropped_image - INFO - Running taggers for face crop
2024-12-22 13:17:02,096 - kalliste.image.cropped_image - INFO - Running taggers for person crop
2024-12-22 13:17:03,797 - kalliste.image.cropped_image - INFO - Running taggers for person crop
2024-12-22 13:17:05,592 - kalliste.image.cropped_image - INFO - Running taggers for person crop
2024-12-22 13:17:07,234 - kalliste.image.cropped_image - INFO - Running taggers for face crop
2024-12-22 13:17:07,267 - kalliste.taggers.tagger_pipeline - INFO - Running wd14 tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_2418_person_crop.png
2024-12-22 13:17:10,026 - kalliste.taggers.wd14_tagger - ERROR - WD14 tagging failed: argument of type 'NoneType' is not iterable
2024-12-22 13:17:10,028 - kalliste.taggers.tagger_pipeline - INFO - Running orientation tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_2418_person_crop.png
2024-12-22 13:17:10,664 - kalliste.taggers.tagger_pipeline - INFO - Running caption tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_2418_person_crop.png
2024-12-22 13:17:25,389 - kalliste.taggers.tagger_pipeline - INFO - Running orientation tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_face_crop.png
2024-12-22 13:17:25,518 - kalliste.taggers.tagger_pipeline - INFO - Running orientation tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_face_crop.png
2024-12-22 13:17:25,667 - kalliste.taggers.tagger_pipeline - INFO - Running wd14 tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_person_crop.png
2024-12-22 13:17:28,271 - kalliste.taggers.wd14_tagger - ERROR - WD14 tagging failed: argument of type 'NoneType' is not iterable
2024-12-22 13:17:28,271 - kalliste.taggers.tagger_pipeline - INFO - Running orientation tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_person_crop.png
2024-12-22 13:17:28,619 - kalliste.taggers.tagger_pipeline - INFO - Running caption tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_person_crop.png
2024-12-22 13:17:36,126 - kalliste.taggers.tagger_pipeline - INFO - Running wd14 tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_person_crop.png
2024-12-22 13:17:38,762 - kalliste.taggers.wd14_tagger - ERROR - WD14 tagging failed: argument of type 'NoneType' is not iterable
2024-12-22 13:17:38,768 - kalliste.taggers.tagger_pipeline - INFO - Running orientation tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_person_crop.png
2024-12-22 13:17:39,118 - kalliste.taggers.tagger_pipeline - INFO - Running caption tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_person_crop.png
2024-12-22 13:17:45,231 - kalliste.taggers.tagger_pipeline - INFO - Running wd14 tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_person_crop.png
2024-12-22 13:17:47,546 - kalliste.taggers.wd14_tagger - ERROR - WD14 tagging failed: argument of type 'NoneType' is not iterable
2024-12-22 13:17:47,549 - kalliste.taggers.tagger_pipeline - INFO - Running orientation tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_person_crop.png
2024-12-22 13:17:47,857 - kalliste.taggers.tagger_pipeline - INFO - Running caption tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_person_crop.png
2024-12-22 13:17:54,787 - kalliste.taggers.tagger_pipeline - INFO - Running orientation tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_face_crop.png
2024-12-22 13:17:54,924 - kalliste.image.cropped_image - ERROR - Error during tagging: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined
2024-12-22 13:17:54,924 - kalliste.image.cropped_image - ERROR - Error processing crop from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_2418.png: Image tagging failed: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 38, in process
    await self.run_taggers()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 159, in run_taggers
    raise RuntimeError(f"Image tagging failed: {e}") from e
RuntimeError: Image tagging failed: name 'tag_category' is not defined
2024-12-22 13:17:54,925 - kalliste.image.cropped_image - ERROR - Error during tagging: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined
2024-12-22 13:17:54,925 - kalliste.image.cropped_image - ERROR - Error processing crop from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_2418.png: Image tagging failed: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 38, in process
    await self.run_taggers()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 159, in run_taggers
    raise RuntimeError(f"Image tagging failed: {e}") from e
RuntimeError: Image tagging failed: name 'tag_category' is not defined
2024-12-22 13:17:54,925 - kalliste.image.cropped_image - ERROR - Error during tagging: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined
2024-12-22 13:17:54,925 - kalliste.image.cropped_image - ERROR - Error processing crop from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png: Image tagging failed: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 38, in process
    await self.run_taggers()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 159, in run_taggers
    raise RuntimeError(f"Image tagging failed: {e}") from e
RuntimeError: Image tagging failed: name 'tag_category' is not defined
2024-12-22 13:17:54,925 - kalliste.image.cropped_image - ERROR - Error during tagging: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined
2024-12-22 13:17:54,925 - kalliste.image.cropped_image - ERROR - Error processing crop from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png: Image tagging failed: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 38, in process
    await self.run_taggers()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 159, in run_taggers
    raise RuntimeError(f"Image tagging failed: {e}") from e
RuntimeError: Image tagging failed: name 'tag_category' is not defined
2024-12-22 13:17:54,926 - kalliste.image.cropped_image - ERROR - Error during tagging: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined
2024-12-22 13:17:54,926 - kalliste.image.cropped_image - ERROR - Error processing crop from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png: Image tagging failed: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 38, in process
    await self.run_taggers()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 159, in run_taggers
    raise RuntimeError(f"Image tagging failed: {e}") from e
RuntimeError: Image tagging failed: name 'tag_category' is not defined
2024-12-22 13:17:54,926 - kalliste.image.cropped_image - ERROR - Error during tagging: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined
2024-12-22 13:17:54,926 - kalliste.image.cropped_image - ERROR - Error processing crop from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png: Image tagging failed: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 38, in process
    await self.run_taggers()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 159, in run_taggers
    raise RuntimeError(f"Image tagging failed: {e}") from e
RuntimeError: Image tagging failed: name 'tag_category' is not defined
2024-12-22 13:17:54,926 - kalliste.image.cropped_image - ERROR - Error during tagging: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined
2024-12-22 13:17:54,926 - kalliste.image.cropped_image - ERROR - Error processing crop from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png: Image tagging failed: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 38, in process
    await self.run_taggers()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 159, in run_taggers
    raise RuntimeError(f"Image tagging failed: {e}") from e
RuntimeError: Image tagging failed: name 'tag_category' is not defined
2024-12-22 13:17:54,927 - kalliste.image.cropped_image - ERROR - Error during tagging: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined
2024-12-22 13:17:54,927 - kalliste.image.cropped_image - ERROR - Error processing crop from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png: Image tagging failed: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 38, in process
    await self.run_taggers()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 159, in run_taggers
    raise RuntimeError(f"Image tagging failed: {e}") from e
RuntimeError: Image tagging failed: name 'tag_category' is not defined
2024-12-22 13:17:54,927 - kalliste.image.original_image - ERROR - Error processing crops for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_2418.png: Crop processing failed: Image tagging failed: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 38, in process
    await self.run_taggers()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 159, in run_taggers
    raise RuntimeError(f"Image tagging failed: {e}") from e
RuntimeError: Image tagging failed: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 66, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 50, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: Image tagging failed: name 'tag_category' is not defined
2024-12-22 13:17:54,927 - kalliste.image.original_image - ERROR - Error processing /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_2418.png: Crop processing failed: Image tagging failed: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 38, in process
    await self.run_taggers()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 159, in run_taggers
    raise RuntimeError(f"Image tagging failed: {e}") from e
RuntimeError: Image tagging failed: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 66, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 50, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: Image tagging failed: name 'tag_category' is not defined
2024-12-22 13:17:54,927 - kalliste.image.batch - ERROR - Failed to process IMG_2418.png
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 38, in process
    await self.run_taggers()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 159, in run_taggers
    raise RuntimeError(f"Image tagging failed: {e}") from e
RuntimeError: Image tagging failed: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 44, in process_image
    return await image.process()
           ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 66, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 50, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: Image tagging failed: name 'tag_category' is not defined
2024-12-22 13:17:54,928 - kalliste.image.original_image - ERROR - Error processing crops for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png: Crop processing failed: Image tagging failed: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 38, in process
    await self.run_taggers()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 159, in run_taggers
    raise RuntimeError(f"Image tagging failed: {e}") from e
RuntimeError: Image tagging failed: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 66, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 50, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: Image tagging failed: name 'tag_category' is not defined
2024-12-22 13:17:54,928 - kalliste.image.original_image - ERROR - Error processing /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png: Crop processing failed: Image tagging failed: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 38, in process
    await self.run_taggers()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 159, in run_taggers
    raise RuntimeError(f"Image tagging failed: {e}") from e
RuntimeError: Image tagging failed: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 66, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 50, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: Image tagging failed: name 'tag_category' is not defined
2024-12-22 13:17:54,928 - kalliste.image.batch - ERROR - Failed to process 3M2A2876.png
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 38, in process
    await self.run_taggers()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 159, in run_taggers
    raise RuntimeError(f"Image tagging failed: {e}") from e
RuntimeError: Image tagging failed: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 44, in process_image
    return await image.process()
           ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 66, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 50, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: Image tagging failed: name 'tag_category' is not defined
2024-12-22 13:17:54,929 - kalliste.image.batch - ERROR - Batch processing completed with 9 errors
2024-12-22 13:17:54,929 - kalliste.image.batch - ERROR - Batch processing failed
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 38, in process
    await self.run_taggers()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 159, in run_taggers
    raise RuntimeError(f"Image tagging failed: {e}") from e
RuntimeError: Image tagging failed: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 75, in process
    raise errors[0]
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 44, in process_image
    return await image.process()
           ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 66, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 50, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: Image tagging failed: name 'tag_category' is not defined
2024-12-22 13:17:54,929 - kalliste.image.batch_processor - ERROR - Error processing batch 20180312_Photoshoot2: Crop processing failed: Image tagging failed: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 38, in process
    await self.run_taggers()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 159, in run_taggers
    raise RuntimeError(f"Image tagging failed: {e}") from e
RuntimeError: Image tagging failed: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/batch_processor.py", line 71, in process_all
    await batch.process()
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 75, in process
    raise errors[0]
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 44, in process_image
    return await image.process()
           ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 66, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 50, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: Image tagging failed: name 'tag_category' is not defined
2024-12-22 13:17:54,930 - kalliste.image.batch_processor - ERROR - Error processing batches: Crop processing failed: Image tagging failed: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 38, in process
    await self.run_taggers()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 159, in run_taggers
    raise RuntimeError(f"Image tagging failed: {e}") from e
RuntimeError: Image tagging failed: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/batch_processor.py", line 71, in process_all
    await batch.process()
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 75, in process
    raise errors[0]
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 44, in process_image
    return await image.process()
           ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 66, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 50, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: Image tagging failed: name 'tag_category' is not defined
2024-12-22 13:17:54,931 - kalliste.image.batch_processor - INFO - Cleaning up model registry
2024-12-22 13:17:54,931 - kalliste.image.model_registry - INFO - Starting model registry cleanup
2024-12-22 13:17:54,931 - kalliste.image.model_registry - INFO - Model registry cleanup complete
2024-12-22 13:17:54,950 - kalliste.image.batch_processor - INFO - Model registry cleanup complete
2024-12-22 13:17:54,950 - __main__ - ERROR - Error during batch processing: Crop processing failed: Image tagging failed: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 38, in process
    await self.run_taggers()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 159, in run_taggers
    raise RuntimeError(f"Image tagging failed: {e}") from e
RuntimeError: Image tagging failed: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/scripts/test_pipeline.py", line 59, in main
    await processor.process_all()
  File "/Users/rob/repos/kalliste/kalliste/image/batch_processor.py", line 71, in process_all
    await batch.process()
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 75, in process
    raise errors[0]
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 44, in process_image
    return await image.process()
           ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 66, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 50, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: Image tagging failed: name 'tag_category' is not defined
2024-12-22 13:17:54,951 - __main__ - INFO - Pipeline test complete
2024-12-22 13:17:54,952 - __main__ - ERROR - Pipeline test failed: Crop processing failed: Image tagging failed: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 38, in process
    await self.run_taggers()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 159, in run_taggers
    raise RuntimeError(f"Image tagging failed: {e}") from e
RuntimeError: Image tagging failed: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/scripts/test_pipeline.py", line 69, in <module>
    asyncio.run(main())
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
           ^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/asyncio/base_events.py", line 654, in run_until_complete
    return future.result()
           ^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/scripts/test_pipeline.py", line 59, in main
    await processor.process_all()
  File "/Users/rob/repos/kalliste/kalliste/image/batch_processor.py", line 71, in process_all
    await batch.process()
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 75, in process
    raise errors[0]
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 44, in process_image
    return await image.process()
           ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 66, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 50, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: Image tagging failed: name 'tag_category' is not defined
2024-12-22 15:30:37,212 - __main__ - INFO - Starting pipeline test
2024-12-22 15:30:37,212 - __main__ - INFO - Input directory: /Users/rob/repos/kalliste/test_images_input
2024-12-22 15:30:37,212 - __main__ - INFO - Output directory: /Users/rob/repos/kalliste/test_images_output
2024-12-22 15:30:37,212 - __main__ - INFO - Initializing BatchProcessor
2024-12-22 15:30:37,212 - kalliste.image.batch_processor - INFO - Initializing BatchProcessor with input_root=/Users/rob/repos/kalliste/test_images_input, output_root=/Users/rob/repos/kalliste/test_images_output
2024-12-22 15:30:37,212 - kalliste.image.batch_processor - INFO - Scanning for batches in /Users/rob/repos/kalliste/test_images_input
2024-12-22 15:30:37,212 - kalliste.image.batch - INFO - Initializing Batch with input_path=/Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2, max_concurrent=3
2024-12-22 15:30:37,212 - kalliste.image.batch - INFO - Scanning for images in /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2
2024-12-22 15:30:37,212 - kalliste.image.batch - INFO - Found 9 images to process in batch 20180312_Photoshoot2
2024-12-22 15:30:37,212 - kalliste.image.batch - INFO - Initializing Batch with input_path=/Users/rob/repos/kalliste/test_images_input/20241012_Photoshoot1, max_concurrent=3
2024-12-22 15:30:37,212 - kalliste.image.batch - INFO - Scanning for images in /Users/rob/repos/kalliste/test_images_input/20241012_Photoshoot1
2024-12-22 15:30:37,212 - kalliste.image.batch - INFO - Found 12 images to process in batch 20241012_Photoshoot1
2024-12-22 15:30:37,213 - kalliste.image.batch_processor - INFO - Found 2 batches to process
2024-12-22 15:30:37,213 - __main__ - INFO - BatchProcessor created
2024-12-22 15:30:37,213 - __main__ - INFO - Initializing models
2024-12-22 15:30:37,213 - kalliste.image.batch_processor - INFO - Initializing model registry
2024-12-22 15:30:37,213 - kalliste.image.model_registry - INFO - Starting model registry initialization
2024-12-22 15:30:37,213 - kalliste.image.model_registry - INFO - Initializing tagger pipeline...
2024-12-22 15:30:37,213 - kalliste.taggers.tagger_pipeline - INFO - Creating TaggerPipeline instance
2024-12-22 15:30:37,272 - kalliste.taggers.base_tagger - INFO - MPS device validated
2024-12-22 15:30:37,272 - kalliste.taggers.tagger_pipeline - INFO - TaggerPipeline created with device: mps
2024-12-22 15:30:37,272 - kalliste.taggers.tagger_pipeline - INFO - Starting TaggerPipeline initialization
2024-12-22 15:30:37,272 - kalliste.taggers.tagger_pipeline - INFO - Initializing caption tagger
2024-12-22 15:30:37,272 - kalliste.taggers.base_tagger - INFO - Initializing CaptionTagger on device: mps
2024-12-22 15:30:37,272 - kalliste.taggers.caption_tagger - INFO - Loading BLIP2 model: Salesforce/blip2-opt-2.7b
2024-12-22 15:30:39,541 - kalliste.taggers.caption_tagger - INFO - BLIP2 model loaded successfully on cpu
2024-12-22 15:30:39,541 - kalliste.taggers.tagger_pipeline - INFO - Successfully initialized caption tagger
2024-12-22 15:30:39,541 - kalliste.taggers.tagger_pipeline - INFO - Initializing wd14 tagger
2024-12-22 15:30:39,541 - kalliste.taggers.base_tagger - INFO - Initializing WD14Tagger on device: mps
2024-12-22 15:30:39,541 - kalliste.taggers.wd14_tagger - INFO - Loading WD14 model: hf_hub:SmilingWolf/wd-vit-large-tagger-v3
2024-12-22 15:30:53,486 - timm.models._builder - INFO - Loading pretrained weights from Hugging Face hub (SmilingWolf/wd-vit-large-tagger-v3)
2024-12-22 15:30:53,610 - timm.models._hub - INFO - [SmilingWolf/wd-vit-large-tagger-v3] Safe alternative available for 'pytorch_model.bin' (as 'model.safetensors'). Loading weights using safetensors.
2024-12-22 15:30:55,640 - kalliste.taggers.wd14_tagger - INFO - Loaded 10861 WD14 tags
2024-12-22 15:30:55,640 - kalliste.taggers.tagger_pipeline - INFO - Successfully initialized wd14 tagger
2024-12-22 15:30:55,640 - kalliste.taggers.tagger_pipeline - INFO - Initializing orientation tagger
2024-12-22 15:30:55,640 - kalliste.taggers.base_tagger - INFO - Initializing OrientationTagger on device: mps
2024-12-22 15:30:55,640 - kalliste.taggers.orientation_tagger - INFO - Loading orientation model: LucyintheSky/pose-estimation-front-side-back
2024-12-22 15:30:56,976 - kalliste.taggers.orientation_tagger - INFO - Orientation model loaded successfully on cpu
2024-12-22 15:30:56,976 - kalliste.taggers.tagger_pipeline - INFO - Successfully initialized orientation tagger
2024-12-22 15:30:56,976 - kalliste.taggers.tagger_pipeline - INFO - TaggerPipeline initialization complete
2024-12-22 15:30:56,976 - kalliste.image.model_registry - INFO - Tagger pipeline initialized successfully
2024-12-22 15:30:56,976 - kalliste.image.model_registry - INFO - Initializing YOLO detector...
2024-12-22 15:30:56,976 - kalliste.detectors.yolo_detector - INFO - Initializing YOLO detector
2024-12-22 15:30:56,977 - kalliste.detectors.yolo_detector - INFO - Loading YOLO model from /Users/rob/.cache/ultralytics/yolov8n.pt
2024-12-22 15:30:56,997 - kalliste.detectors.yolo_detector - INFO - YOLO model loaded successfully
2024-12-22 15:30:56,997 - kalliste.detectors.yolo_detector - INFO - Loading YOLO face model from /Users/rob/.cache/ultralytics/yolov8n-face.pt
2024-12-22 15:30:57,053 - kalliste.detectors.yolo_detector - INFO - YOLO face model loaded successfully
2024-12-22 15:30:57,053 - kalliste.detectors.yolo_detector - INFO - YOLODetector initialized with 1 active classes
2024-12-22 15:30:57,053 - kalliste.image.model_registry - INFO - YOLO detector initialized successfully
2024-12-22 15:30:57,053 - kalliste.image.model_registry - INFO - Model registry initialization complete
2024-12-22 15:30:57,053 - kalliste.image.batch_processor - INFO - Model registry initialized successfully
2024-12-22 15:30:57,053 - __main__ - INFO - BatchProcessor initialized successfully
2024-12-22 15:30:57,054 - __main__ - INFO - Starting batch processing
2024-12-22 15:30:57,054 - kalliste.image.batch_processor - INFO - Starting batch processing
2024-12-22 15:30:57,054 - kalliste.image.batch_processor - INFO - Starting batch: 20180312_Photoshoot2
2024-12-22 15:30:57,054 - kalliste.image.batch - INFO - Starting batch processing for 20180312_Photoshoot2 with 9 images
2024-12-22 15:30:57,054 - kalliste.image.original_image - INFO - Starting processing for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3136.png
2024-12-22 15:30:57,054 - kalliste.image.original_image - INFO - Starting processing for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3320.png
2024-12-22 15:30:57,054 - kalliste.image.original_image - INFO - Starting processing for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3297.png
2024-12-22 15:30:57,060 - kalliste.detectors.yolo_detector - INFO - Running detection on /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3297.png
2024-12-22 15:30:57,062 - kalliste.detectors.yolo_detector - INFO - Running detection on /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3320.png
2024-12-22 15:30:57,063 - kalliste.detectors.yolo_detector - INFO - Running detection on /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3136.png
2024-12-22 15:30:57,091 - kalliste.detectors.yolo_detector - INFO - Fusing face model...
2024-12-22 15:30:57,092 - kalliste.detectors.yolo_detector - INFO - Fusing face model...
2024-12-22 15:30:57,092 - kalliste.detectors.yolo_detector - INFO - Fusing face model...
2024-12-22 15:30:57,093 - kalliste.detectors.yolo_detector - WARNING - Model fusion failed for face model: 'Conv' object has no attribute 'bn'
2024-12-22 15:30:57,093 - kalliste.detectors.yolo_detector - WARNING - Continuing with unfused model
2024-12-22 15:30:57,094 - kalliste.detectors.yolo_detector - WARNING - Model fusion failed for face model: 'Conv' object has no attribute 'bn'
2024-12-22 15:30:57,094 - kalliste.detectors.yolo_detector - WARNING - Continuing with unfused model
2024-12-22 15:30:57,160 - kalliste.detectors.yolo_detector - INFO - Face Model fused successfully
2024-12-22 15:30:57,454 - kalliste.detectors.yolo_detector - INFO - Fusing main model...
2024-12-22 15:30:57,490 - kalliste.detectors.yolo_detector - INFO - Main Model fused successfully
2024-12-22 15:30:57,821 - kalliste.detectors.yolo_detector - INFO - Detection complete. Found 2 total regions
2024-12-22 15:30:57,822 - kalliste.image.original_image - INFO - Found 2 detections in /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3297.png
2024-12-22 15:30:57,822 - kalliste.image.cropped_image - INFO - Starting crop processing for face from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3297.png
2024-12-22 15:30:57,822 - kalliste.image.cropped_image - INFO - Starting crop processing for person from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3297.png
2024-12-22 15:30:58,047 - kalliste.image.cropped_image - INFO - Running taggers for face crop
2024-12-22 15:30:58,087 - kalliste.taggers.tagger_pipeline - INFO - Running orientation tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_3297_face_crop.png
2024-12-22 15:30:58,119 - kalliste.detectors.yolo_detector - INFO - Detection complete. Found 2 total regions
2024-12-22 15:30:58,424 - kalliste.detectors.yolo_detector - INFO - Detection complete. Found 2 total regions
2024-12-22 15:30:59,000 - kalliste.image.cropped_image - INFO - Running taggers for person crop
2024-12-22 15:31:01,367 - kalliste.taggers.tagger_pipeline - INFO - Running caption tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_3297_person_crop.png
2024-12-22 15:31:16,122 - kalliste.image.batch_processor - INFO - Cleaning up model registry
2024-12-22 15:31:16,122 - kalliste.image.model_registry - INFO - Starting model registry cleanup
2024-12-22 15:31:16,122 - kalliste.image.model_registry - INFO - Model registry cleanup complete
2024-12-22 15:31:16,123 - kalliste.image.batch_processor - INFO - Model registry cleanup complete
2024-12-22 15:31:16,123 - __main__ - INFO - Pipeline test complete
2024-12-22 15:31:16,126 - __main__ - INFO - Pipeline test interrupted by user
2024-12-22 15:31:19,961 - __main__ - INFO - Starting pipeline test
2024-12-22 15:31:19,961 - __main__ - INFO - Input directory: /Users/rob/repos/kalliste/test_images_input
2024-12-22 15:31:19,961 - __main__ - INFO - Output directory: /Users/rob/repos/kalliste/test_images_output
2024-12-22 15:31:19,961 - __main__ - INFO - Initializing BatchProcessor
2024-12-22 15:31:19,961 - kalliste.image.batch_processor - INFO - Initializing BatchProcessor with input_root=/Users/rob/repos/kalliste/test_images_input, output_root=/Users/rob/repos/kalliste/test_images_output
2024-12-22 15:31:19,961 - kalliste.image.batch_processor - INFO - Scanning for batches in /Users/rob/repos/kalliste/test_images_input
2024-12-22 15:31:19,961 - kalliste.image.batch - INFO - Initializing Batch with input_path=/Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2, max_concurrent=3
2024-12-22 15:31:19,961 - kalliste.image.batch - INFO - Scanning for images in /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2
2024-12-22 15:31:19,961 - kalliste.image.batch - INFO - Found 9 images to process in batch 20180312_Photoshoot2
2024-12-22 15:31:19,961 - kalliste.image.batch - INFO - Initializing Batch with input_path=/Users/rob/repos/kalliste/test_images_input/20241012_Photoshoot1, max_concurrent=3
2024-12-22 15:31:19,961 - kalliste.image.batch - INFO - Scanning for images in /Users/rob/repos/kalliste/test_images_input/20241012_Photoshoot1
2024-12-22 15:31:19,961 - kalliste.image.batch - INFO - Found 12 images to process in batch 20241012_Photoshoot1
2024-12-22 15:31:19,961 - kalliste.image.batch_processor - INFO - Found 2 batches to process
2024-12-22 15:31:19,961 - __main__ - INFO - BatchProcessor created
2024-12-22 15:31:19,961 - __main__ - INFO - Initializing models
2024-12-22 15:31:19,962 - kalliste.image.batch_processor - INFO - Initializing model registry
2024-12-22 15:31:19,962 - kalliste.image.model_registry - INFO - Starting model registry initialization
2024-12-22 15:31:19,962 - kalliste.image.model_registry - INFO - Initializing tagger pipeline...
2024-12-22 15:31:19,962 - kalliste.taggers.tagger_pipeline - INFO - Creating TaggerPipeline instance
2024-12-22 15:31:20,019 - kalliste.taggers.base_tagger - INFO - MPS device validated
2024-12-22 15:31:20,019 - kalliste.taggers.tagger_pipeline - INFO - TaggerPipeline created with device: mps
2024-12-22 15:31:20,019 - kalliste.taggers.tagger_pipeline - INFO - Starting TaggerPipeline initialization
2024-12-22 15:31:20,019 - kalliste.taggers.tagger_pipeline - INFO - Initializing wd14 tagger
2024-12-22 15:31:20,019 - kalliste.taggers.base_tagger - INFO - Initializing WD14Tagger on device: mps
2024-12-22 15:31:20,019 - kalliste.taggers.wd14_tagger - INFO - Loading WD14 model: hf_hub:SmilingWolf/wd-vit-large-tagger-v3
2024-12-22 15:31:33,906 - timm.models._builder - INFO - Loading pretrained weights from Hugging Face hub (SmilingWolf/wd-vit-large-tagger-v3)
2024-12-22 15:31:34,012 - timm.models._hub - INFO - [SmilingWolf/wd-vit-large-tagger-v3] Safe alternative available for 'pytorch_model.bin' (as 'model.safetensors'). Loading weights using safetensors.
2024-12-22 15:31:34,194 - kalliste.taggers.wd14_tagger - INFO - Loaded 10861 WD14 tags
2024-12-22 15:31:34,194 - kalliste.taggers.tagger_pipeline - INFO - Successfully initialized wd14 tagger
2024-12-22 15:31:34,194 - kalliste.taggers.tagger_pipeline - INFO - Initializing caption tagger
2024-12-22 15:31:34,194 - kalliste.taggers.base_tagger - INFO - Initializing CaptionTagger on device: mps
2024-12-22 15:31:34,195 - kalliste.taggers.caption_tagger - INFO - Loading BLIP2 model: Salesforce/blip2-opt-2.7b
2024-12-22 15:31:35,125 - __main__ - INFO - Pipeline test interrupted by user
2024-12-22 15:31:39,783 - __main__ - INFO - Starting pipeline test
2024-12-22 15:31:39,783 - __main__ - INFO - Input directory: /Users/rob/repos/kalliste/test_images_input
2024-12-22 15:31:39,783 - __main__ - INFO - Output directory: /Users/rob/repos/kalliste/test_images_output
2024-12-22 15:31:39,784 - __main__ - INFO - Initializing BatchProcessor
2024-12-22 15:31:39,784 - kalliste.image.batch_processor - INFO - Initializing BatchProcessor with input_root=/Users/rob/repos/kalliste/test_images_input, output_root=/Users/rob/repos/kalliste/test_images_output
2024-12-22 15:31:39,784 - kalliste.image.batch_processor - INFO - Scanning for batches in /Users/rob/repos/kalliste/test_images_input
2024-12-22 15:31:39,784 - kalliste.image.batch - INFO - Initializing Batch with input_path=/Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2, max_concurrent=3
2024-12-22 15:31:39,784 - kalliste.image.batch - INFO - Scanning for images in /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2
2024-12-22 15:31:39,784 - kalliste.image.batch - INFO - Found 9 images to process in batch 20180312_Photoshoot2
2024-12-22 15:31:39,784 - kalliste.image.batch - INFO - Initializing Batch with input_path=/Users/rob/repos/kalliste/test_images_input/20241012_Photoshoot1, max_concurrent=3
2024-12-22 15:31:39,784 - kalliste.image.batch - INFO - Scanning for images in /Users/rob/repos/kalliste/test_images_input/20241012_Photoshoot1
2024-12-22 15:31:39,784 - kalliste.image.batch - INFO - Found 12 images to process in batch 20241012_Photoshoot1
2024-12-22 15:31:39,784 - kalliste.image.batch_processor - INFO - Found 2 batches to process
2024-12-22 15:31:39,784 - __main__ - INFO - BatchProcessor created
2024-12-22 15:31:39,784 - __main__ - INFO - Initializing models
2024-12-22 15:31:39,784 - kalliste.image.batch_processor - INFO - Initializing model registry
2024-12-22 15:31:39,784 - kalliste.image.model_registry - INFO - Starting model registry initialization
2024-12-22 15:31:39,784 - kalliste.image.model_registry - INFO - Initializing tagger pipeline...
2024-12-22 15:31:39,784 - kalliste.taggers.tagger_pipeline - INFO - Creating TaggerPipeline instance
2024-12-22 15:31:39,840 - kalliste.taggers.base_tagger - INFO - MPS device validated
2024-12-22 15:31:39,840 - kalliste.taggers.tagger_pipeline - INFO - TaggerPipeline created with device: mps
2024-12-22 15:31:39,840 - kalliste.taggers.tagger_pipeline - INFO - Starting TaggerPipeline initialization
2024-12-22 15:31:39,840 - kalliste.taggers.tagger_pipeline - INFO - Initializing caption tagger
2024-12-22 15:31:39,840 - kalliste.taggers.base_tagger - INFO - Initializing CaptionTagger on device: mps
2024-12-22 15:31:39,840 - kalliste.taggers.caption_tagger - INFO - Loading BLIP2 model: Salesforce/blip2-opt-2.7b
2024-12-22 15:31:42,050 - kalliste.taggers.caption_tagger - INFO - BLIP2 model loaded successfully on cpu
2024-12-22 15:31:42,051 - kalliste.taggers.tagger_pipeline - INFO - Successfully initialized caption tagger
2024-12-22 15:31:42,051 - kalliste.taggers.tagger_pipeline - INFO - Initializing wd14 tagger
2024-12-22 15:31:42,051 - kalliste.taggers.base_tagger - INFO - Initializing WD14Tagger on device: mps
2024-12-22 15:31:42,051 - kalliste.taggers.wd14_tagger - INFO - Loading WD14 model: hf_hub:SmilingWolf/wd-vit-large-tagger-v3
2024-12-22 15:31:56,053 - timm.models._builder - INFO - Loading pretrained weights from Hugging Face hub (SmilingWolf/wd-vit-large-tagger-v3)
2024-12-22 15:31:56,156 - timm.models._hub - INFO - [SmilingWolf/wd-vit-large-tagger-v3] Safe alternative available for 'pytorch_model.bin' (as 'model.safetensors'). Loading weights using safetensors.
2024-12-22 15:31:56,334 - kalliste.taggers.wd14_tagger - INFO - Loaded 10861 WD14 tags
2024-12-22 15:31:56,334 - kalliste.taggers.tagger_pipeline - INFO - Successfully initialized wd14 tagger
2024-12-22 15:31:56,334 - kalliste.taggers.tagger_pipeline - INFO - Initializing orientation tagger
2024-12-22 15:31:56,334 - kalliste.taggers.base_tagger - INFO - Initializing OrientationTagger on device: mps
2024-12-22 15:31:56,334 - kalliste.taggers.orientation_tagger - INFO - Loading orientation model: LucyintheSky/pose-estimation-front-side-back
2024-12-22 15:31:57,885 - kalliste.taggers.orientation_tagger - INFO - Orientation model loaded successfully on cpu
2024-12-22 15:31:57,885 - kalliste.taggers.tagger_pipeline - INFO - Successfully initialized orientation tagger
2024-12-22 15:31:57,885 - kalliste.taggers.tagger_pipeline - INFO - TaggerPipeline initialization complete
2024-12-22 15:31:57,885 - kalliste.image.model_registry - INFO - Tagger pipeline initialized successfully
2024-12-22 15:31:57,885 - kalliste.image.model_registry - INFO - Initializing YOLO detector...
2024-12-22 15:31:57,885 - kalliste.detectors.yolo_detector - INFO - Initializing YOLO detector
2024-12-22 15:31:57,885 - kalliste.detectors.yolo_detector - INFO - Loading YOLO model from /Users/rob/.cache/ultralytics/yolov8n.pt
2024-12-22 15:31:57,902 - kalliste.detectors.yolo_detector - INFO - YOLO model loaded successfully
2024-12-22 15:31:57,902 - kalliste.detectors.yolo_detector - INFO - Loading YOLO face model from /Users/rob/.cache/ultralytics/yolov8n-face.pt
2024-12-22 15:31:57,941 - kalliste.detectors.yolo_detector - INFO - YOLO face model loaded successfully
2024-12-22 15:31:57,941 - kalliste.detectors.yolo_detector - INFO - YOLODetector initialized with 1 active classes
2024-12-22 15:31:57,941 - kalliste.image.model_registry - INFO - YOLO detector initialized successfully
2024-12-22 15:31:57,941 - kalliste.image.model_registry - INFO - Model registry initialization complete
2024-12-22 15:31:57,941 - kalliste.image.batch_processor - INFO - Model registry initialized successfully
2024-12-22 15:31:57,941 - __main__ - INFO - BatchProcessor initialized successfully
2024-12-22 15:31:57,941 - __main__ - INFO - Starting batch processing
2024-12-22 15:31:57,941 - kalliste.image.batch_processor - INFO - Starting batch processing
2024-12-22 15:31:57,941 - kalliste.image.batch_processor - INFO - Starting batch: 20180312_Photoshoot2
2024-12-22 15:31:57,941 - kalliste.image.batch - INFO - Starting batch processing for 20180312_Photoshoot2 with 9 images
2024-12-22 15:31:57,941 - kalliste.image.original_image - INFO - Starting processing for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3136.png
2024-12-22 15:31:57,941 - kalliste.image.original_image - INFO - Starting processing for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3320.png
2024-12-22 15:31:57,941 - kalliste.image.original_image - INFO - Starting processing for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3297.png
2024-12-22 15:31:57,946 - kalliste.detectors.yolo_detector - INFO - Running detection on /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3297.png
2024-12-22 15:31:57,949 - kalliste.detectors.yolo_detector - INFO - Running detection on /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3320.png
2024-12-22 15:31:57,950 - kalliste.detectors.yolo_detector - INFO - Running detection on /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3136.png
2024-12-22 15:31:57,961 - kalliste.detectors.yolo_detector - INFO - Fusing face model...
2024-12-22 15:31:57,961 - kalliste.detectors.yolo_detector - INFO - Fusing face model...
2024-12-22 15:31:57,962 - kalliste.detectors.yolo_detector - INFO - Fusing face model...
2024-12-22 15:31:57,963 - kalliste.detectors.yolo_detector - WARNING - Model fusion failed for face model: 'Conv' object has no attribute 'bn'
2024-12-22 15:31:57,963 - kalliste.detectors.yolo_detector - WARNING - Continuing with unfused model
2024-12-22 15:31:57,964 - kalliste.detectors.yolo_detector - WARNING - Model fusion failed for face model: 'Conv' object has no attribute 'bn'
2024-12-22 15:31:57,964 - kalliste.detectors.yolo_detector - WARNING - Continuing with unfused model
2024-12-22 15:31:58,029 - kalliste.detectors.yolo_detector - INFO - Face Model fused successfully
2024-12-22 15:31:58,315 - kalliste.detectors.yolo_detector - INFO - Fusing main model...
2024-12-22 15:31:58,350 - kalliste.detectors.yolo_detector - INFO - Main Model fused successfully
2024-12-22 15:31:58,678 - kalliste.detectors.yolo_detector - INFO - Detection complete. Found 2 total regions
2024-12-22 15:31:58,678 - kalliste.image.original_image - INFO - Found 2 detections in /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3297.png
2024-12-22 15:31:58,679 - kalliste.image.cropped_image - INFO - Starting crop processing for face from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3297.png
2024-12-22 15:31:58,679 - kalliste.image.cropped_image - INFO - Starting crop processing for person from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3297.png
2024-12-22 15:31:58,897 - kalliste.image.cropped_image - INFO - Running taggers for face crop
2024-12-22 15:31:58,936 - kalliste.taggers.tagger_pipeline - INFO - Running orientation tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_3297_face_crop.png
2024-12-22 15:31:58,972 - kalliste.detectors.yolo_detector - INFO - Detection complete. Found 2 total regions
2024-12-22 15:31:59,059 - kalliste.image.cropped_image - INFO - Running taggers for person crop
2024-12-22 15:31:59,249 - kalliste.detectors.yolo_detector - INFO - Detection complete. Found 2 total regions
2024-12-22 15:32:01,374 - kalliste.taggers.tagger_pipeline - INFO - Running caption tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_3297_person_crop.png
2024-12-22 15:32:13,584 - kalliste.taggers.tagger_pipeline - INFO - Running wd14 tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_3297_person_crop.png
2024-12-22 15:32:16,165 - kalliste.taggers.wd14_tagger - ERROR - WD14 tagging failed: argument of type 'NoneType' is not iterable
2024-12-22 15:32:16,167 - kalliste.taggers.tagger_pipeline - INFO - Running orientation tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_3297_person_crop.png
2024-12-22 15:32:17,182 - kalliste.image.original_image - INFO - Found 2 detections in /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3136.png
2024-12-22 15:32:17,183 - kalliste.image.cropped_image - ERROR - Error during tagging: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined
2024-12-22 15:32:17,183 - kalliste.image.cropped_image - ERROR - Error processing crop from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3297.png: Image tagging failed: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 38, in process
    await self.run_taggers()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 159, in run_taggers
    raise RuntimeError(f"Image tagging failed: {e}") from e
RuntimeError: Image tagging failed: name 'tag_category' is not defined
2024-12-22 15:32:17,184 - kalliste.image.original_image - INFO - Found 2 detections in /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3320.png
2024-12-22 15:32:17,184 - kalliste.image.cropped_image - INFO - Starting crop processing for face from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3136.png
2024-12-22 15:32:17,184 - kalliste.image.cropped_image - INFO - Starting crop processing for person from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3136.png
2024-12-22 15:32:17,184 - kalliste.image.cropped_image - INFO - Starting crop processing for face from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3320.png
2024-12-22 15:32:17,184 - kalliste.image.cropped_image - INFO - Starting crop processing for person from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3320.png
2024-12-22 15:32:17,184 - kalliste.image.cropped_image - ERROR - Error during tagging: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined
2024-12-22 15:32:17,185 - kalliste.image.cropped_image - ERROR - Error processing crop from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3297.png: Image tagging failed: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 38, in process
    await self.run_taggers()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 159, in run_taggers
    raise RuntimeError(f"Image tagging failed: {e}") from e
RuntimeError: Image tagging failed: name 'tag_category' is not defined
2024-12-22 15:32:17,185 - kalliste.image.original_image - ERROR - Error processing crops for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3297.png: Crop processing failed: Image tagging failed: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 38, in process
    await self.run_taggers()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 159, in run_taggers
    raise RuntimeError(f"Image tagging failed: {e}") from e
RuntimeError: Image tagging failed: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 66, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 50, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: Image tagging failed: name 'tag_category' is not defined
2024-12-22 15:32:17,194 - kalliste.image.original_image - ERROR - Error processing /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3297.png: Crop processing failed: Image tagging failed: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 38, in process
    await self.run_taggers()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 159, in run_taggers
    raise RuntimeError(f"Image tagging failed: {e}") from e
RuntimeError: Image tagging failed: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 66, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 50, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: Image tagging failed: name 'tag_category' is not defined
2024-12-22 15:32:17,194 - kalliste.image.batch - ERROR - Failed to process IMG_3297.png
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 38, in process
    await self.run_taggers()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 159, in run_taggers
    raise RuntimeError(f"Image tagging failed: {e}") from e
RuntimeError: Image tagging failed: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 44, in process_image
    return await image.process()
           ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 66, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 50, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: Image tagging failed: name 'tag_category' is not defined
2024-12-22 15:32:17,195 - kalliste.image.original_image - INFO - Starting processing for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3152.png
2024-12-22 15:32:17,200 - kalliste.detectors.yolo_detector - INFO - Running detection on /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3152.png
2024-12-22 15:32:17,476 - kalliste.image.cropped_image - INFO - Running taggers for face crop
2024-12-22 15:32:17,523 - kalliste.taggers.tagger_pipeline - INFO - Running orientation tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_3320_face_crop.png
2024-12-22 15:32:17,570 - kalliste.detectors.yolo_detector - INFO - Detection complete. Found 2 total regions
2024-12-22 15:32:17,632 - kalliste.image.cropped_image - INFO - Running taggers for face crop
2024-12-22 15:32:17,715 - kalliste.image.cropped_image - INFO - Running taggers for person crop
2024-12-22 15:32:20,173 - kalliste.image.cropped_image - INFO - Running taggers for person crop
2024-12-22 15:32:23,860 - kalliste.taggers.tagger_pipeline - INFO - Running orientation tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_3136_face_crop.png
2024-12-22 15:32:23,970 - kalliste.taggers.tagger_pipeline - INFO - Running caption tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_3320_person_crop.png
2024-12-22 15:32:35,841 - kalliste.taggers.tagger_pipeline - INFO - Running wd14 tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_3320_person_crop.png
2024-12-22 15:32:38,259 - kalliste.taggers.wd14_tagger - ERROR - WD14 tagging failed: argument of type 'NoneType' is not iterable
2024-12-22 15:32:38,260 - kalliste.taggers.tagger_pipeline - INFO - Running orientation tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_3320_person_crop.png
2024-12-22 15:32:38,574 - kalliste.taggers.tagger_pipeline - INFO - Running caption tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_3136_person_crop.png
2024-12-22 15:32:44,476 - kalliste.taggers.tagger_pipeline - INFO - Running wd14 tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_3136_person_crop.png
2024-12-22 15:32:47,061 - kalliste.taggers.wd14_tagger - ERROR - WD14 tagging failed: argument of type 'NoneType' is not iterable
2024-12-22 15:32:47,070 - kalliste.taggers.tagger_pipeline - INFO - Running orientation tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_3136_person_crop.png
2024-12-22 15:32:47,504 - kalliste.image.original_image - INFO - Found 2 detections in /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3152.png
2024-12-22 15:32:47,504 - kalliste.image.cropped_image - ERROR - Error during tagging: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined
2024-12-22 15:32:47,504 - kalliste.image.cropped_image - ERROR - Error processing crop from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3320.png: Image tagging failed: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 38, in process
    await self.run_taggers()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 159, in run_taggers
    raise RuntimeError(f"Image tagging failed: {e}") from e
RuntimeError: Image tagging failed: name 'tag_category' is not defined
2024-12-22 15:32:47,504 - kalliste.image.cropped_image - INFO - Starting crop processing for face from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3152.png
2024-12-22 15:32:47,504 - kalliste.image.cropped_image - INFO - Starting crop processing for person from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3152.png
2024-12-22 15:32:47,505 - kalliste.image.cropped_image - ERROR - Error during tagging: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined
2024-12-22 15:32:47,505 - kalliste.image.cropped_image - ERROR - Error processing crop from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3136.png: Image tagging failed: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 38, in process
    await self.run_taggers()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 159, in run_taggers
    raise RuntimeError(f"Image tagging failed: {e}") from e
RuntimeError: Image tagging failed: name 'tag_category' is not defined
2024-12-22 15:32:47,505 - kalliste.image.cropped_image - ERROR - Error during tagging: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined
2024-12-22 15:32:47,505 - kalliste.image.cropped_image - ERROR - Error processing crop from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3320.png: Image tagging failed: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 38, in process
    await self.run_taggers()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 159, in run_taggers
    raise RuntimeError(f"Image tagging failed: {e}") from e
RuntimeError: Image tagging failed: name 'tag_category' is not defined
2024-12-22 15:32:47,508 - kalliste.image.cropped_image - ERROR - Error during tagging: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined
2024-12-22 15:32:47,508 - kalliste.image.cropped_image - ERROR - Error processing crop from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3136.png: Image tagging failed: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 38, in process
    await self.run_taggers()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 159, in run_taggers
    raise RuntimeError(f"Image tagging failed: {e}") from e
RuntimeError: Image tagging failed: name 'tag_category' is not defined
2024-12-22 15:32:47,511 - kalliste.image.original_image - ERROR - Error processing crops for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3320.png: Crop processing failed: Image tagging failed: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 38, in process
    await self.run_taggers()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 159, in run_taggers
    raise RuntimeError(f"Image tagging failed: {e}") from e
RuntimeError: Image tagging failed: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 66, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 50, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: Image tagging failed: name 'tag_category' is not defined
2024-12-22 15:32:47,511 - kalliste.image.original_image - ERROR - Error processing /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3320.png: Crop processing failed: Image tagging failed: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 38, in process
    await self.run_taggers()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 159, in run_taggers
    raise RuntimeError(f"Image tagging failed: {e}") from e
RuntimeError: Image tagging failed: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 66, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 50, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: Image tagging failed: name 'tag_category' is not defined
2024-12-22 15:32:47,512 - kalliste.image.batch - ERROR - Failed to process IMG_3320.png
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 38, in process
    await self.run_taggers()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 159, in run_taggers
    raise RuntimeError(f"Image tagging failed: {e}") from e
RuntimeError: Image tagging failed: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 44, in process_image
    return await image.process()
           ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 66, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 50, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: Image tagging failed: name 'tag_category' is not defined
2024-12-22 15:32:47,512 - kalliste.image.original_image - INFO - Starting processing for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A9668.png
2024-12-22 15:32:47,512 - kalliste.image.original_image - ERROR - Error processing crops for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3136.png: Crop processing failed: Image tagging failed: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 38, in process
    await self.run_taggers()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 159, in run_taggers
    raise RuntimeError(f"Image tagging failed: {e}") from e
RuntimeError: Image tagging failed: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 66, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 50, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: Image tagging failed: name 'tag_category' is not defined
2024-12-22 15:32:47,513 - kalliste.image.original_image - ERROR - Error processing /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3136.png: Crop processing failed: Image tagging failed: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 38, in process
    await self.run_taggers()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 159, in run_taggers
    raise RuntimeError(f"Image tagging failed: {e}") from e
RuntimeError: Image tagging failed: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 66, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 50, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: Image tagging failed: name 'tag_category' is not defined
2024-12-22 15:32:47,513 - kalliste.image.batch - ERROR - Failed to process IMG_3136.png
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 38, in process
    await self.run_taggers()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 159, in run_taggers
    raise RuntimeError(f"Image tagging failed: {e}") from e
RuntimeError: Image tagging failed: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 44, in process_image
    return await image.process()
           ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 66, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 50, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: Image tagging failed: name 'tag_category' is not defined
2024-12-22 15:32:47,513 - kalliste.image.original_image - INFO - Starting processing for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_0241-2.png
2024-12-22 15:32:47,540 - kalliste.detectors.yolo_detector - INFO - Running detection on /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_0241-2.png
2024-12-22 15:32:47,542 - kalliste.detectors.yolo_detector - INFO - Running detection on /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A9668.png
2024-12-22 15:32:47,650 - kalliste.image.cropped_image - INFO - Running taggers for face crop
2024-12-22 15:32:47,688 - kalliste.taggers.tagger_pipeline - INFO - Running orientation tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_3152_face_crop.png
2024-12-22 15:32:47,816 - kalliste.image.cropped_image - INFO - Running taggers for person crop
2024-12-22 15:32:48,158 - kalliste.detectors.yolo_detector - INFO - Detection complete. Found 2 total regions
2024-12-22 15:32:49,130 - kalliste.detectors.yolo_detector - INFO - Detection complete. Found 2 total regions
2024-12-22 15:32:49,762 - kalliste.taggers.tagger_pipeline - INFO - Running caption tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_3152_person_crop.png
2024-12-22 15:32:59,007 - kalliste.taggers.tagger_pipeline - INFO - Running wd14 tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_3152_person_crop.png
2024-12-22 15:33:01,445 - kalliste.taggers.wd14_tagger - ERROR - WD14 tagging failed: argument of type 'NoneType' is not iterable
2024-12-22 15:33:01,451 - kalliste.taggers.tagger_pipeline - INFO - Running orientation tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_3152_person_crop.png
2024-12-22 15:33:01,821 - kalliste.image.cropped_image - ERROR - Error during tagging: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined
2024-12-22 15:33:01,822 - kalliste.image.cropped_image - ERROR - Error processing crop from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3152.png: Image tagging failed: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 38, in process
    await self.run_taggers()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 159, in run_taggers
    raise RuntimeError(f"Image tagging failed: {e}") from e
RuntimeError: Image tagging failed: name 'tag_category' is not defined
2024-12-22 15:33:01,822 - kalliste.image.original_image - INFO - Found 2 detections in /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_0241-2.png
2024-12-22 15:33:01,822 - kalliste.image.original_image - INFO - Found 2 detections in /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A9668.png
2024-12-22 15:33:01,822 - kalliste.image.cropped_image - INFO - Starting crop processing for face from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_0241-2.png
2024-12-22 15:33:01,822 - kalliste.image.cropped_image - INFO - Starting crop processing for person from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_0241-2.png
2024-12-22 15:33:01,822 - kalliste.image.cropped_image - INFO - Starting crop processing for face from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A9668.png
2024-12-22 15:33:01,822 - kalliste.image.cropped_image - INFO - Starting crop processing for person from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A9668.png
2024-12-22 15:33:01,823 - kalliste.image.cropped_image - ERROR - Error during tagging: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined
2024-12-22 15:33:01,823 - kalliste.image.cropped_image - ERROR - Error processing crop from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3152.png: Image tagging failed: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 38, in process
    await self.run_taggers()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 159, in run_taggers
    raise RuntimeError(f"Image tagging failed: {e}") from e
RuntimeError: Image tagging failed: name 'tag_category' is not defined
2024-12-22 15:33:01,823 - kalliste.image.original_image - ERROR - Error processing crops for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3152.png: Crop processing failed: Image tagging failed: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 38, in process
    await self.run_taggers()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 159, in run_taggers
    raise RuntimeError(f"Image tagging failed: {e}") from e
RuntimeError: Image tagging failed: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 66, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 50, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: Image tagging failed: name 'tag_category' is not defined
2024-12-22 15:33:01,823 - kalliste.image.original_image - ERROR - Error processing /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3152.png: Crop processing failed: Image tagging failed: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 38, in process
    await self.run_taggers()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 159, in run_taggers
    raise RuntimeError(f"Image tagging failed: {e}") from e
RuntimeError: Image tagging failed: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 66, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 50, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: Image tagging failed: name 'tag_category' is not defined
2024-12-22 15:33:01,852 - kalliste.image.batch - ERROR - Failed to process IMG_3152.png
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 38, in process
    await self.run_taggers()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 159, in run_taggers
    raise RuntimeError(f"Image tagging failed: {e}") from e
RuntimeError: Image tagging failed: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 44, in process_image
    return await image.process()
           ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 66, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 50, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: Image tagging failed: name 'tag_category' is not defined
2024-12-22 15:33:01,892 - kalliste.image.original_image - INFO - Starting processing for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_2455.png
2024-12-22 15:33:01,906 - kalliste.detectors.yolo_detector - INFO - Running detection on /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_2455.png
2024-12-22 15:33:02,166 - kalliste.image.cropped_image - INFO - Running taggers for face crop
2024-12-22 15:33:02,803 - kalliste.taggers.tagger_pipeline - INFO - Running orientation tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_0241-2_face_crop.png
2024-12-22 15:33:02,891 - kalliste.detectors.yolo_detector - INFO - Detection complete. Found 2 total regions
2024-12-22 15:33:02,975 - kalliste.image.cropped_image - INFO - Running taggers for person crop
2024-12-22 15:33:04,865 - kalliste.image.cropped_image - INFO - Running taggers for face crop
2024-12-22 15:33:08,785 - kalliste.image.cropped_image - INFO - Running taggers for person crop
2024-12-22 15:33:23,590 - kalliste.taggers.tagger_pipeline - INFO - Running caption tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_0241-2_person_crop.png
2024-12-22 15:33:31,652 - kalliste.taggers.tagger_pipeline - INFO - Running wd14 tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_0241-2_person_crop.png
2024-12-22 15:33:34,413 - kalliste.taggers.wd14_tagger - ERROR - WD14 tagging failed: argument of type 'NoneType' is not iterable
2024-12-22 15:33:34,421 - kalliste.taggers.tagger_pipeline - INFO - Running orientation tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_0241-2_person_crop.png
2024-12-22 15:33:34,722 - kalliste.taggers.tagger_pipeline - INFO - Running orientation tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A9668_face_crop.png
2024-12-22 15:33:35,190 - kalliste.taggers.tagger_pipeline - INFO - Running caption tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A9668_person_crop.png
2024-12-22 15:33:43,553 - kalliste.taggers.tagger_pipeline - INFO - Running wd14 tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A9668_person_crop.png
2024-12-22 15:33:46,685 - kalliste.taggers.wd14_tagger - ERROR - WD14 tagging failed: argument of type 'NoneType' is not iterable
2024-12-22 15:33:46,691 - kalliste.taggers.tagger_pipeline - INFO - Running orientation tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A9668_person_crop.png
2024-12-22 15:33:47,915 - kalliste.image.original_image - INFO - Found 2 detections in /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_2455.png
2024-12-22 15:33:47,915 - kalliste.image.cropped_image - ERROR - Error during tagging: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined
2024-12-22 15:33:47,915 - kalliste.image.cropped_image - ERROR - Error processing crop from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_0241-2.png: Image tagging failed: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 38, in process
    await self.run_taggers()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 159, in run_taggers
    raise RuntimeError(f"Image tagging failed: {e}") from e
RuntimeError: Image tagging failed: name 'tag_category' is not defined
2024-12-22 15:33:47,916 - kalliste.image.cropped_image - INFO - Starting crop processing for face from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_2455.png
2024-12-22 15:33:47,916 - kalliste.image.cropped_image - INFO - Starting crop processing for person from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_2455.png
2024-12-22 15:33:47,916 - kalliste.image.cropped_image - ERROR - Error during tagging: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined
2024-12-22 15:33:47,916 - kalliste.image.cropped_image - ERROR - Error processing crop from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_0241-2.png: Image tagging failed: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 38, in process
    await self.run_taggers()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 159, in run_taggers
    raise RuntimeError(f"Image tagging failed: {e}") from e
RuntimeError: Image tagging failed: name 'tag_category' is not defined
2024-12-22 15:33:47,916 - kalliste.image.cropped_image - ERROR - Error during tagging: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined
2024-12-22 15:33:47,916 - kalliste.image.cropped_image - ERROR - Error processing crop from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A9668.png: Image tagging failed: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 38, in process
    await self.run_taggers()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 159, in run_taggers
    raise RuntimeError(f"Image tagging failed: {e}") from e
RuntimeError: Image tagging failed: name 'tag_category' is not defined
2024-12-22 15:33:47,917 - kalliste.image.cropped_image - ERROR - Error during tagging: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined
2024-12-22 15:33:47,917 - kalliste.image.cropped_image - ERROR - Error processing crop from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A9668.png: Image tagging failed: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 38, in process
    await self.run_taggers()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 159, in run_taggers
    raise RuntimeError(f"Image tagging failed: {e}") from e
RuntimeError: Image tagging failed: name 'tag_category' is not defined
2024-12-22 15:33:47,925 - kalliste.image.original_image - ERROR - Error processing crops for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_0241-2.png: Crop processing failed: Image tagging failed: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 38, in process
    await self.run_taggers()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 159, in run_taggers
    raise RuntimeError(f"Image tagging failed: {e}") from e
RuntimeError: Image tagging failed: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 66, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 50, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: Image tagging failed: name 'tag_category' is not defined
2024-12-22 15:33:47,933 - kalliste.image.original_image - ERROR - Error processing /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_0241-2.png: Crop processing failed: Image tagging failed: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 38, in process
    await self.run_taggers()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 159, in run_taggers
    raise RuntimeError(f"Image tagging failed: {e}") from e
RuntimeError: Image tagging failed: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 66, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 50, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: Image tagging failed: name 'tag_category' is not defined
2024-12-22 15:33:47,935 - kalliste.image.batch - ERROR - Failed to process IMG_0241-2.png
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 38, in process
    await self.run_taggers()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 159, in run_taggers
    raise RuntimeError(f"Image tagging failed: {e}") from e
RuntimeError: Image tagging failed: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 44, in process_image
    return await image.process()
           ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 66, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 50, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: Image tagging failed: name 'tag_category' is not defined
2024-12-22 15:33:47,935 - kalliste.image.original_image - INFO - Starting processing for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png
2024-12-22 15:33:47,935 - kalliste.image.original_image - ERROR - Error processing crops for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A9668.png: Crop processing failed: Image tagging failed: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 38, in process
    await self.run_taggers()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 159, in run_taggers
    raise RuntimeError(f"Image tagging failed: {e}") from e
RuntimeError: Image tagging failed: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 66, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 50, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: Image tagging failed: name 'tag_category' is not defined
2024-12-22 15:33:47,936 - kalliste.image.original_image - ERROR - Error processing /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A9668.png: Crop processing failed: Image tagging failed: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 38, in process
    await self.run_taggers()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 159, in run_taggers
    raise RuntimeError(f"Image tagging failed: {e}") from e
RuntimeError: Image tagging failed: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 66, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 50, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: Image tagging failed: name 'tag_category' is not defined
2024-12-22 15:33:47,936 - kalliste.image.batch - ERROR - Failed to process 3M2A9668.png
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 38, in process
    await self.run_taggers()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 159, in run_taggers
    raise RuntimeError(f"Image tagging failed: {e}") from e
RuntimeError: Image tagging failed: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 44, in process_image
    return await image.process()
           ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 66, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 50, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: Image tagging failed: name 'tag_category' is not defined
2024-12-22 15:33:47,936 - kalliste.image.original_image - INFO - Starting processing for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_2418.png
2024-12-22 15:33:47,957 - kalliste.detectors.yolo_detector - INFO - Running detection on /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_2418.png
2024-12-22 15:33:47,970 - kalliste.detectors.yolo_detector - INFO - Running detection on /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png
2024-12-22 15:33:48,394 - kalliste.image.cropped_image - INFO - Running taggers for face crop
2024-12-22 15:33:48,920 - kalliste.detectors.yolo_detector - INFO - Detection complete. Found 2 total regions
2024-12-22 15:33:49,644 - kalliste.taggers.tagger_pipeline - INFO - Running orientation tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_2455_face_crop.png
2024-12-22 15:33:49,893 - kalliste.image.cropped_image - INFO - Running taggers for person crop
2024-12-22 15:33:50,088 - kalliste.detectors.yolo_detector - INFO - Detection complete. Found 6 total regions
2024-12-22 15:33:50,599 - __main__ - INFO - Pipeline test interrupted by user
2024-12-22 15:33:50,715 - kalliste.image.batch_processor - INFO - Cleaning up model registry
2024-12-22 15:33:50,715 - kalliste.image.model_registry - INFO - Starting model registry cleanup
2024-12-22 15:33:50,715 - kalliste.image.model_registry - INFO - Model registry cleanup complete
2024-12-22 15:33:50,715 - kalliste.image.batch_processor - INFO - Model registry cleanup complete
2024-12-22 15:33:50,715 - __main__ - INFO - Pipeline test complete
2024-12-22 15:33:50,716 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task cancelling name='Task-1' coro=<main() done, defined at /Users/rob/repos/kalliste/scripts/test_pipeline.py:27> wait_for=<_GatheringFuture pending cb=[Task.task_wakeup()]> cb=[gather.<locals>._done_callback() at /opt/miniconda3/envs/kalliste/lib/python3.11/asyncio/tasks.py:764]>
2024-12-22 15:33:50,716 - asyncio - ERROR - Task exception was never retrieved
future: <Task finished name='Task-8' coro=<Batch.process_image() done, defined at /Users/rob/repos/kalliste/kalliste/image/batch.py:38> exception=KeyboardInterrupt()>
Traceback (most recent call last):
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/PIL/ImageFile.py", line 554, in _save
    fh = fp.fileno()
         ^^^^^^^^^
AttributeError: '_idat' object has no attribute 'fileno'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/scripts/test_pipeline.py", line 69, in <module>
    logger.error("[red bold]Error during batch processing[/]")
    ^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/asyncio/runners.py", line 189, in run
    with Runner(debug=debug) as runner:
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/asyncio/runners.py", line 63, in __exit__
    self.close()
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/asyncio/runners.py", line 71, in close
    _cancel_all_tasks(loop)
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/asyncio/runners.py", line 201, in _cancel_all_tasks
    loop.run_until_complete(tasks.gather(*to_cancel, return_exceptions=True))
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/asyncio/base_events.py", line 641, in run_until_complete
    self.run_forever()
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/asyncio/base_events.py", line 608, in run_forever
    self._run_once()
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/asyncio/base_events.py", line 1936, in _run_once
    handle._run()
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/asyncio/events.py", line 84, in _run
    self._context.run(self._callback, *self._args)
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 44, in process_image
    return await image.process()
           ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 66, in process
    await asyncio.gather(*crop_tasks)
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
           ^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/asyncio/base_events.py", line 641, in run_until_complete
    self.run_forever()
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/asyncio/base_events.py", line 608, in run_forever
    self._run_once()
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/asyncio/base_events.py", line 1936, in _run_once
    handle._run()
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/asyncio/events.py", line 84, in _run
    self._context.run(self._callback, *self._args)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 38, in process
    await self.run_taggers()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 139, in run_taggers
    self.cropped_image.save(self.output_path, format, quality=quality)
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/PIL/Image.py", line 2605, in save
    save_handler(self, fp, filename)
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/PIL/PngImagePlugin.py", line 1488, in _save
    ImageFile._save(
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/PIL/ImageFile.py", line 558, in _save
    _encode_tile(im, fp, tile, bufsize, None, exc)
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/PIL/ImageFile.py", line 584, in _encode_tile
    errcode, data = encoder.encode(bufsize)[1:]
                    ^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/asyncio/runners.py", line 157, in _on_sigint
    raise KeyboardInterrupt()
KeyboardInterrupt
[blue]Starting pipeline test[/]
Input directory: [cyan]/Users/rob/repos/kalliste/test_images_input[/]
Output directory: [cyan]/Users/rob/repos/kalliste/test_images_output[/]
[green]Initializing BatchProcessor[/]
Initializing BatchProcessor with input_root=/Users/rob/repos/kalliste/test_images_input, output_root=/Users/rob/repos/kalliste/test_images_output
Scanning for batches in /Users/rob/repos/kalliste/test_images_input
Initializing Batch with input_path=/Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2, max_concurrent=3
Scanning for images in /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2
Found 9 images to process in batch 20180312_Photoshoot2
Initializing Batch with input_path=/Users/rob/repos/kalliste/test_images_input/20241012_Photoshoot1, max_concurrent=3
Scanning for images in /Users/rob/repos/kalliste/test_images_input/20241012_Photoshoot1
Found 12 images to process in batch 20241012_Photoshoot1
Found 2 batches to process
BatchProcessor created
Initializing models
Initializing model registry
Starting model registry initialization
Initializing tagger pipeline...
Creating TaggerPipeline instance
MPS device validated
TaggerPipeline created with device: mps
Starting TaggerPipeline initialization
Initializing wd14 tagger
Initializing WD14Tagger on device: mps
Loading WD14 model: hf_hub:SmilingWolf/wd-vit-large-tagger-v3
Loading pretrained weights from Hugging Face hub (SmilingWolf/wd-vit-large-tagger-v3)
[SmilingWolf/wd-vit-large-tagger-v3] Safe alternative available for 'pytorch_model.bin' (as 'model.safetensors'). Loading weights using safetensors.
Loaded 10861 WD14 tags
Successfully initialized wd14 tagger
Initializing orientation tagger
Initializing OrientationTagger on device: mps
Loading orientation model: LucyintheSky/pose-estimation-front-side-back
Orientation model loaded successfully on cpu
Successfully initialized orientation tagger
Initializing caption tagger
Initializing CaptionTagger on device: mps
Loading BLIP2 model: Salesforce/blip2-opt-2.7b
BLIP2 model loaded successfully on cpu
Successfully initialized caption tagger
TaggerPipeline initialization complete
Tagger pipeline initialized successfully
Initializing YOLO detector...
Initializing YOLO detector
Loading YOLO model from /Users/rob/.cache/ultralytics/yolov8n.pt
YOLO model loaded successfully
Loading YOLO face model from /Users/rob/.cache/ultralytics/yolov8n-face.pt
YOLO face model loaded successfully
YOLODetector initialized with 1 active classes
YOLO detector initialized successfully
Model registry initialization complete
Model registry initialized successfully
[green]BatchProcessor initialized successfully[/]
[green]Starting batch processing[/]
Starting batch processing
Starting batch: 20180312_Photoshoot2
Starting batch processing for 20180312_Photoshoot2 with 9 images
Starting processing for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3136.png
Starting processing for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3320.png
Starting processing for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3297.png
Running detection on /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3297.png
Running detection on /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3136.png
Running detection on /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3320.png
Fusing face model...
Fusing face model...
Fusing face model...
Model fusion failed for face model: 'Conv' object has no attribute 'bn'
Continuing with unfused model
Model fusion failed for face model: 'Conv' object has no attribute 'bn'
Continuing with unfused model
Face Model fused successfully
Fusing main model...
Main Model fused successfully
Detection complete. Found 2 total regions
Found 2 detections in /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3320.png
Starting crop processing for face from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3320.png
Starting crop processing for person from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3320.png
Running taggers for face crop
Detection complete. Found 2 total regions
Running orientation tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_3320_face_crop.png
Running taggers for person crop
Detection complete. Found 2 total regions
Found 2 detections in /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3136.png
Running wd14 tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_3320_person_crop.png
WD14 tagging failed: argument of type 'NoneType' is not iterable
Running caption tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_3320_person_crop.png
Running orientation tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_3320_person_crop.png
Starting crop processing for face from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3136.png
Starting crop processing for person from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3136.png
Error during tagging: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined
Error processing crop from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3320.png: Image tagging failed: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 38, in process
    await self.run_taggers()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 159, in run_taggers
    raise RuntimeError(f"Image tagging failed: {e}") from e
RuntimeError: Image tagging failed: name 'tag_category' is not defined
Found 2 detections in /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3297.png
Starting crop processing for face from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3297.png
Starting crop processing for person from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3297.png
Error during tagging: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined
Error processing crop from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3320.png: Image tagging failed: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 38, in process
    await self.run_taggers()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 159, in run_taggers
    raise RuntimeError(f"Image tagging failed: {e}") from e
RuntimeError: Image tagging failed: name 'tag_category' is not defined
Error processing crops for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3320.png: Crop processing failed: Image tagging failed: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 38, in process
    await self.run_taggers()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 159, in run_taggers
    raise RuntimeError(f"Image tagging failed: {e}") from e
RuntimeError: Image tagging failed: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 66, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 50, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: Image tagging failed: name 'tag_category' is not defined
Error processing /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3320.png: Crop processing failed: Image tagging failed: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 38, in process
    await self.run_taggers()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 159, in run_taggers
    raise RuntimeError(f"Image tagging failed: {e}") from e
RuntimeError: Image tagging failed: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 66, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 50, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: Image tagging failed: name 'tag_category' is not defined
Failed to process IMG_3320.png
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 38, in process
    await self.run_taggers()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 159, in run_taggers
    raise RuntimeError(f"Image tagging failed: {e}") from e
RuntimeError: Image tagging failed: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 44, in process_image
    return await image.process()
           ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 66, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 50, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: Image tagging failed: name 'tag_category' is not defined
Starting processing for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3152.png
Running detection on /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3152.png
Running taggers for face crop
Running orientation tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_3297_face_crop.png
Running taggers for person crop
Detection complete. Found 2 total regions
Running wd14 tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_3297_person_crop.png
WD14 tagging failed: argument of type 'NoneType' is not iterable
Running caption tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_3297_person_crop.png
Running orientation tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_3297_person_crop.png
Running taggers for face crop
Running taggers for person crop
Error during tagging: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined
Error processing crop from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3297.png: Image tagging failed: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 38, in process
    await self.run_taggers()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 159, in run_taggers
    raise RuntimeError(f"Image tagging failed: {e}") from e
RuntimeError: Image tagging failed: name 'tag_category' is not defined
Found 2 detections in /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3152.png
Running orientation tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_3136_face_crop.png
Running wd14 tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_3136_person_crop.png
WD14 tagging failed: argument of type 'NoneType' is not iterable
Running caption tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_3136_person_crop.png
Running orientation tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_3136_person_crop.png
Starting crop processing for face from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3152.png
Starting crop processing for person from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3152.png
Error during tagging: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined
Error processing crop from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3297.png: Image tagging failed: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 38, in process
    await self.run_taggers()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 159, in run_taggers
    raise RuntimeError(f"Image tagging failed: {e}") from e
RuntimeError: Image tagging failed: name 'tag_category' is not defined
Error processing crops for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3297.png: Crop processing failed: Image tagging failed: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 38, in process
    await self.run_taggers()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 159, in run_taggers
    raise RuntimeError(f"Image tagging failed: {e}") from e
RuntimeError: Image tagging failed: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 66, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 50, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: Image tagging failed: name 'tag_category' is not defined
Error processing /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3297.png: Crop processing failed: Image tagging failed: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 38, in process
    await self.run_taggers()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 159, in run_taggers
    raise RuntimeError(f"Image tagging failed: {e}") from e
RuntimeError: Image tagging failed: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 66, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 50, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: Image tagging failed: name 'tag_category' is not defined
Failed to process IMG_3297.png
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 38, in process
    await self.run_taggers()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 159, in run_taggers
    raise RuntimeError(f"Image tagging failed: {e}") from e
RuntimeError: Image tagging failed: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 44, in process_image
    return await image.process()
           ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 66, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 50, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: Image tagging failed: name 'tag_category' is not defined
Error during tagging: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined
Error processing crop from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3136.png: Image tagging failed: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 38, in process
    await self.run_taggers()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 159, in run_taggers
    raise RuntimeError(f"Image tagging failed: {e}") from e
RuntimeError: Image tagging failed: name 'tag_category' is not defined
Error during tagging: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined
Error processing crop from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3136.png: Image tagging failed: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 38, in process
    await self.run_taggers()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 159, in run_taggers
    raise RuntimeError(f"Image tagging failed: {e}") from e
RuntimeError: Image tagging failed: name 'tag_category' is not defined
Starting processing for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A9668.png
Error processing crops for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3136.png: Crop processing failed: Image tagging failed: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 38, in process
    await self.run_taggers()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 159, in run_taggers
    raise RuntimeError(f"Image tagging failed: {e}") from e
RuntimeError: Image tagging failed: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 66, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 50, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: Image tagging failed: name 'tag_category' is not defined
Error processing /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3136.png: Crop processing failed: Image tagging failed: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 38, in process
    await self.run_taggers()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 159, in run_taggers
    raise RuntimeError(f"Image tagging failed: {e}") from e
RuntimeError: Image tagging failed: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 66, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 50, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: Image tagging failed: name 'tag_category' is not defined
Failed to process IMG_3136.png
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 38, in process
    await self.run_taggers()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 159, in run_taggers
    raise RuntimeError(f"Image tagging failed: {e}") from e
RuntimeError: Image tagging failed: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 44, in process_image
    return await image.process()
           ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 66, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 50, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: Image tagging failed: name 'tag_category' is not defined
Starting processing for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_0241-2.png
Running detection on /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A9668.png
Running detection on /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_0241-2.png
Running taggers for face crop
Running orientation tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_3152_face_crop.png
Running taggers for person crop
Detection complete. Found 2 total regions
Detection complete. Found 2 total regions
Running wd14 tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_3152_person_crop.png
WD14 tagging failed: argument of type 'NoneType' is not iterable
Running caption tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_3152_person_crop.png
Running orientation tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_3152_person_crop.png
Error during tagging: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined
Error processing crop from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3152.png: Image tagging failed: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 38, in process
    await self.run_taggers()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 159, in run_taggers
    raise RuntimeError(f"Image tagging failed: {e}") from e
RuntimeError: Image tagging failed: name 'tag_category' is not defined
Found 2 detections in /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A9668.png
Found 2 detections in /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_0241-2.png
Starting crop processing for face from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A9668.png
Starting crop processing for person from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A9668.png
Starting crop processing for face from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_0241-2.png
Starting crop processing for person from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_0241-2.png
Error during tagging: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined
Error processing crop from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3152.png: Image tagging failed: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 38, in process
    await self.run_taggers()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 159, in run_taggers
    raise RuntimeError(f"Image tagging failed: {e}") from e
RuntimeError: Image tagging failed: name 'tag_category' is not defined
Error processing crops for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3152.png: Crop processing failed: Image tagging failed: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 38, in process
    await self.run_taggers()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 159, in run_taggers
    raise RuntimeError(f"Image tagging failed: {e}") from e
RuntimeError: Image tagging failed: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 66, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 50, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: Image tagging failed: name 'tag_category' is not defined
Error processing /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3152.png: Crop processing failed: Image tagging failed: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 38, in process
    await self.run_taggers()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 159, in run_taggers
    raise RuntimeError(f"Image tagging failed: {e}") from e
RuntimeError: Image tagging failed: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 66, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 50, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: Image tagging failed: name 'tag_category' is not defined
Failed to process IMG_3152.png
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 38, in process
    await self.run_taggers()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 159, in run_taggers
    raise RuntimeError(f"Image tagging failed: {e}") from e
RuntimeError: Image tagging failed: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 44, in process_image
    return await image.process()
           ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 66, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 50, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: Image tagging failed: name 'tag_category' is not defined
Starting processing for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_2455.png
Running detection on /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_2455.png
Running taggers for face crop
Running orientation tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_0241-2_face_crop.png
Detection complete. Found 2 total regions
Running taggers for person crop
Running taggers for face crop
Running taggers for person crop
Running wd14 tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_0241-2_person_crop.png
WD14 tagging failed: argument of type 'NoneType' is not iterable
Running caption tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_0241-2_person_crop.png
Running orientation tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_0241-2_person_crop.png
Running orientation tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A9668_face_crop.png
Running wd14 tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A9668_person_crop.png
WD14 tagging failed: argument of type 'NoneType' is not iterable
Running caption tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A9668_person_crop.png
Running orientation tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A9668_person_crop.png
Found 2 detections in /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_2455.png
Error during tagging: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined
Error processing crop from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_0241-2.png: Image tagging failed: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 38, in process
    await self.run_taggers()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 159, in run_taggers
    raise RuntimeError(f"Image tagging failed: {e}") from e
RuntimeError: Image tagging failed: name 'tag_category' is not defined
Starting crop processing for face from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_2455.png
Starting crop processing for person from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_2455.png
Error during tagging: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined
Error processing crop from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_0241-2.png: Image tagging failed: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 38, in process
    await self.run_taggers()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 159, in run_taggers
    raise RuntimeError(f"Image tagging failed: {e}") from e
RuntimeError: Image tagging failed: name 'tag_category' is not defined
Error during tagging: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined
Error processing crop from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A9668.png: Image tagging failed: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 38, in process
    await self.run_taggers()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 159, in run_taggers
    raise RuntimeError(f"Image tagging failed: {e}") from e
RuntimeError: Image tagging failed: name 'tag_category' is not defined
Error during tagging: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined
Error processing crop from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A9668.png: Image tagging failed: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 38, in process
    await self.run_taggers()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 159, in run_taggers
    raise RuntimeError(f"Image tagging failed: {e}") from e
RuntimeError: Image tagging failed: name 'tag_category' is not defined
Error processing crops for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_0241-2.png: Crop processing failed: Image tagging failed: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 38, in process
    await self.run_taggers()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 159, in run_taggers
    raise RuntimeError(f"Image tagging failed: {e}") from e
RuntimeError: Image tagging failed: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 66, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 50, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: Image tagging failed: name 'tag_category' is not defined
Error processing /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_0241-2.png: Crop processing failed: Image tagging failed: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 38, in process
    await self.run_taggers()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 159, in run_taggers
    raise RuntimeError(f"Image tagging failed: {e}") from e
RuntimeError: Image tagging failed: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 66, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 50, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: Image tagging failed: name 'tag_category' is not defined
Failed to process IMG_0241-2.png
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 38, in process
    await self.run_taggers()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 159, in run_taggers
    raise RuntimeError(f"Image tagging failed: {e}") from e
RuntimeError: Image tagging failed: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 44, in process_image
    return await image.process()
           ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 66, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 50, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: Image tagging failed: name 'tag_category' is not defined
Starting processing for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png
Error processing crops for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A9668.png: Crop processing failed: Image tagging failed: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 38, in process
    await self.run_taggers()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 159, in run_taggers
    raise RuntimeError(f"Image tagging failed: {e}") from e
RuntimeError: Image tagging failed: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 66, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 50, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: Image tagging failed: name 'tag_category' is not defined
Error processing /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A9668.png: Crop processing failed: Image tagging failed: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 38, in process
    await self.run_taggers()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 159, in run_taggers
    raise RuntimeError(f"Image tagging failed: {e}") from e
RuntimeError: Image tagging failed: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 66, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 50, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: Image tagging failed: name 'tag_category' is not defined
Failed to process 3M2A9668.png
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 38, in process
    await self.run_taggers()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 159, in run_taggers
    raise RuntimeError(f"Image tagging failed: {e}") from e
RuntimeError: Image tagging failed: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 44, in process_image
    return await image.process()
           ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 66, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 50, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: Image tagging failed: name 'tag_category' is not defined
Starting processing for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_2418.png
Running detection on /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png
Running detection on /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_2418.png
Running taggers for face crop
Detection complete. Found 6 total regions
Running orientation tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_2455_face_crop.png
Running taggers for person crop
Detection complete. Found 2 total regions
Found 6 detections in /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png
Running wd14 tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_2455_person_crop.png
WD14 tagging failed: argument of type 'NoneType' is not iterable
Running caption tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_2455_person_crop.png
Running orientation tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_2455_person_crop.png
Starting crop processing for face from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png
Starting crop processing for face from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png
Starting crop processing for face from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png
Starting crop processing for person from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png
Starting crop processing for person from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png
Starting crop processing for person from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png
Error during tagging: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined
Error processing crop from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_2455.png: Image tagging failed: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 38, in process
    await self.run_taggers()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 159, in run_taggers
    raise RuntimeError(f"Image tagging failed: {e}") from e
RuntimeError: Image tagging failed: name 'tag_category' is not defined
Found 2 detections in /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_2418.png
Starting crop processing for face from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_2418.png
Starting crop processing for person from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_2418.png
Error during tagging: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined
Error processing crop from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_2455.png: Image tagging failed: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 38, in process
    await self.run_taggers()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 159, in run_taggers
    raise RuntimeError(f"Image tagging failed: {e}") from e
RuntimeError: Image tagging failed: name 'tag_category' is not defined
Error processing crops for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_2455.png: Crop processing failed: Image tagging failed: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 38, in process
    await self.run_taggers()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 159, in run_taggers
    raise RuntimeError(f"Image tagging failed: {e}") from e
RuntimeError: Image tagging failed: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 66, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 50, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: Image tagging failed: name 'tag_category' is not defined
Error processing /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_2455.png: Crop processing failed: Image tagging failed: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 38, in process
    await self.run_taggers()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 159, in run_taggers
    raise RuntimeError(f"Image tagging failed: {e}") from e
RuntimeError: Image tagging failed: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 66, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 50, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: Image tagging failed: name 'tag_category' is not defined
Failed to process IMG_2455.png
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 38, in process
    await self.run_taggers()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 159, in run_taggers
    raise RuntimeError(f"Image tagging failed: {e}") from e
RuntimeError: Image tagging failed: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 44, in process_image
    return await image.process()
           ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 66, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 50, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: Image tagging failed: name 'tag_category' is not defined
Running taggers for face crop
Running orientation tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_2418_face_crop.png
Running taggers for person crop
Running taggers for face crop
Running taggers for face crop
Running taggers for person crop
Running taggers for face crop
Running taggers for person crop
Running taggers for person crop
Running wd14 tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_2418_person_crop.png
WD14 tagging failed: argument of type 'NoneType' is not iterable
Running caption tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_2418_person_crop.png
Running orientation tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_2418_person_crop.png
Running orientation tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_face_crop.png
Running orientation tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_face_crop.png
Running wd14 tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_person_crop.png
WD14 tagging failed: argument of type 'NoneType' is not iterable
Running caption tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_person_crop.png
Running orientation tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_person_crop.png
Running orientation tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_face_crop.png
Running wd14 tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_person_crop.png
WD14 tagging failed: argument of type 'NoneType' is not iterable
Running caption tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_person_crop.png
Running orientation tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_person_crop.png
Running wd14 tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_person_crop.png
WD14 tagging failed: argument of type 'NoneType' is not iterable
Running caption tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_person_crop.png
Running orientation tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_person_crop.png
Error during tagging: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined
Error processing crop from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_2418.png: Image tagging failed: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 38, in process
    await self.run_taggers()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 159, in run_taggers
    raise RuntimeError(f"Image tagging failed: {e}") from e
RuntimeError: Image tagging failed: name 'tag_category' is not defined
Error during tagging: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined
Error processing crop from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_2418.png: Image tagging failed: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 38, in process
    await self.run_taggers()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 159, in run_taggers
    raise RuntimeError(f"Image tagging failed: {e}") from e
RuntimeError: Image tagging failed: name 'tag_category' is not defined
Error during tagging: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined
Error processing crop from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png: Image tagging failed: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 38, in process
    await self.run_taggers()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 159, in run_taggers
    raise RuntimeError(f"Image tagging failed: {e}") from e
RuntimeError: Image tagging failed: name 'tag_category' is not defined
Error during tagging: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined
Error processing crop from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png: Image tagging failed: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 38, in process
    await self.run_taggers()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 159, in run_taggers
    raise RuntimeError(f"Image tagging failed: {e}") from e
RuntimeError: Image tagging failed: name 'tag_category' is not defined
Error during tagging: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined
Error processing crop from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png: Image tagging failed: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 38, in process
    await self.run_taggers()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 159, in run_taggers
    raise RuntimeError(f"Image tagging failed: {e}") from e
RuntimeError: Image tagging failed: name 'tag_category' is not defined
Error during tagging: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined
Error processing crop from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png: Image tagging failed: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 38, in process
    await self.run_taggers()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 159, in run_taggers
    raise RuntimeError(f"Image tagging failed: {e}") from e
RuntimeError: Image tagging failed: name 'tag_category' is not defined
Error during tagging: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined
Error processing crop from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png: Image tagging failed: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 38, in process
    await self.run_taggers()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 159, in run_taggers
    raise RuntimeError(f"Image tagging failed: {e}") from e
RuntimeError: Image tagging failed: name 'tag_category' is not defined
Error during tagging: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined
Error processing crop from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png: Image tagging failed: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 38, in process
    await self.run_taggers()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 159, in run_taggers
    raise RuntimeError(f"Image tagging failed: {e}") from e
RuntimeError: Image tagging failed: name 'tag_category' is not defined
Error processing crops for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_2418.png: Crop processing failed: Image tagging failed: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 38, in process
    await self.run_taggers()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 159, in run_taggers
    raise RuntimeError(f"Image tagging failed: {e}") from e
RuntimeError: Image tagging failed: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 66, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 50, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: Image tagging failed: name 'tag_category' is not defined
Error processing /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_2418.png: Crop processing failed: Image tagging failed: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 38, in process
    await self.run_taggers()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 159, in run_taggers
    raise RuntimeError(f"Image tagging failed: {e}") from e
RuntimeError: Image tagging failed: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 66, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 50, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: Image tagging failed: name 'tag_category' is not defined
Failed to process IMG_2418.png
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 38, in process
    await self.run_taggers()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 159, in run_taggers
    raise RuntimeError(f"Image tagging failed: {e}") from e
RuntimeError: Image tagging failed: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 44, in process_image
    return await image.process()
           ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 66, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 50, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: Image tagging failed: name 'tag_category' is not defined
Error processing crops for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png: Crop processing failed: Image tagging failed: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 38, in process
    await self.run_taggers()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 159, in run_taggers
    raise RuntimeError(f"Image tagging failed: {e}") from e
RuntimeError: Image tagging failed: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 66, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 50, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: Image tagging failed: name 'tag_category' is not defined
Error processing /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png: Crop processing failed: Image tagging failed: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 38, in process
    await self.run_taggers()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 159, in run_taggers
    raise RuntimeError(f"Image tagging failed: {e}") from e
RuntimeError: Image tagging failed: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 66, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 50, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: Image tagging failed: name 'tag_category' is not defined
Failed to process 3M2A2876.png
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 38, in process
    await self.run_taggers()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 159, in run_taggers
    raise RuntimeError(f"Image tagging failed: {e}") from e
RuntimeError: Image tagging failed: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 44, in process_image
    return await image.process()
           ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 66, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 50, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: Image tagging failed: name 'tag_category' is not defined
Batch processing completed with 9 errors
Batch processing failed
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 38, in process
    await self.run_taggers()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 159, in run_taggers
    raise RuntimeError(f"Image tagging failed: {e}") from e
RuntimeError: Image tagging failed: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 75, in process
    raise errors[0]
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 44, in process_image
    return await image.process()
           ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 66, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 50, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: Image tagging failed: name 'tag_category' is not defined
Failed to process batch 20180312_Photoshoot2
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 38, in process
    await self.run_taggers()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 159, in run_taggers
    raise RuntimeError(f"Image tagging failed: {e}") from e
RuntimeError: Image tagging failed: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/batch_processor.py", line 73, in process_batch
    await batch.process()
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 75, in process
    raise errors[0]
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 44, in process_image
    return await image.process()
           ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 66, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 50, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: Image tagging failed: name 'tag_category' is not defined
Starting batch: 20241012_Photoshoot1
Starting batch processing for 20241012_Photoshoot1 with 12 images
Starting processing for /Users/rob/repos/kalliste/test_images_input/20241012_Photoshoot1/IMG_6840.png
Starting processing for /Users/rob/repos/kalliste/test_images_input/20241012_Photoshoot1/IMG_3455.png
Starting processing for /Users/rob/repos/kalliste/test_images_input/20241012_Photoshoot1/IMG_7608.png
Running detection on /Users/rob/repos/kalliste/test_images_input/20241012_Photoshoot1/IMG_3455.png
Running detection on /Users/rob/repos/kalliste/test_images_input/20241012_Photoshoot1/IMG_7608.png
Running detection on /Users/rob/repos/kalliste/test_images_input/20241012_Photoshoot1/IMG_6840.png
Detection complete. Found 2 total regions
Found 2 detections in /Users/rob/repos/kalliste/test_images_input/20241012_Photoshoot1/IMG_7608.png
Starting crop processing for face from /Users/rob/repos/kalliste/test_images_input/20241012_Photoshoot1/IMG_7608.png
Starting crop processing for person from /Users/rob/repos/kalliste/test_images_input/20241012_Photoshoot1/IMG_7608.png
Running taggers for face crop
Detection complete. Found 2 total regions
Detection complete. Found 2 total regions
Running orientation tagger on /Users/rob/repos/kalliste/test_images_output/20241012_Photoshoot1/IMG_7608_face_crop.png
Running taggers for person crop
Found 2 detections in /Users/rob/repos/kalliste/test_images_input/20241012_Photoshoot1/IMG_3455.png
Found 2 detections in /Users/rob/repos/kalliste/test_images_input/20241012_Photoshoot1/IMG_6840.png
Running wd14 tagger on /Users/rob/repos/kalliste/test_images_output/20241012_Photoshoot1/IMG_7608_person_crop.png
WD14 tagging failed: argument of type 'NoneType' is not iterable
Running caption tagger on /Users/rob/repos/kalliste/test_images_output/20241012_Photoshoot1/IMG_7608_person_crop.png
Running orientation tagger on /Users/rob/repos/kalliste/test_images_output/20241012_Photoshoot1/IMG_7608_person_crop.png
Starting crop processing for face from /Users/rob/repos/kalliste/test_images_input/20241012_Photoshoot1/IMG_3455.png
Starting crop processing for person from /Users/rob/repos/kalliste/test_images_input/20241012_Photoshoot1/IMG_3455.png
Starting crop processing for face from /Users/rob/repos/kalliste/test_images_input/20241012_Photoshoot1/IMG_6840.png
Starting crop processing for person from /Users/rob/repos/kalliste/test_images_input/20241012_Photoshoot1/IMG_6840.png
Error during tagging: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined
Error processing crop from /Users/rob/repos/kalliste/test_images_input/20241012_Photoshoot1/IMG_7608.png: Image tagging failed: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 38, in process
    await self.run_taggers()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 159, in run_taggers
    raise RuntimeError(f"Image tagging failed: {e}") from e
RuntimeError: Image tagging failed: name 'tag_category' is not defined
Error during tagging: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined
Error processing crop from /Users/rob/repos/kalliste/test_images_input/20241012_Photoshoot1/IMG_7608.png: Image tagging failed: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 38, in process
    await self.run_taggers()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 159, in run_taggers
    raise RuntimeError(f"Image tagging failed: {e}") from e
RuntimeError: Image tagging failed: name 'tag_category' is not defined
Error processing crops for /Users/rob/repos/kalliste/test_images_input/20241012_Photoshoot1/IMG_7608.png: Crop processing failed: Image tagging failed: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 38, in process
    await self.run_taggers()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 159, in run_taggers
    raise RuntimeError(f"Image tagging failed: {e}") from e
RuntimeError: Image tagging failed: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 66, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 50, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: Image tagging failed: name 'tag_category' is not defined
Error processing /Users/rob/repos/kalliste/test_images_input/20241012_Photoshoot1/IMG_7608.png: Crop processing failed: Image tagging failed: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 38, in process
    await self.run_taggers()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 159, in run_taggers
    raise RuntimeError(f"Image tagging failed: {e}") from e
RuntimeError: Image tagging failed: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 66, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 50, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: Image tagging failed: name 'tag_category' is not defined
Failed to process IMG_7608.png
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 38, in process
    await self.run_taggers()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 159, in run_taggers
    raise RuntimeError(f"Image tagging failed: {e}") from e
RuntimeError: Image tagging failed: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 44, in process_image
    return await image.process()
           ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 66, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 50, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: Image tagging failed: name 'tag_category' is not defined
Starting processing for /Users/rob/repos/kalliste/test_images_input/20241012_Photoshoot1/IMG_3451.png
Running detection on /Users/rob/repos/kalliste/test_images_input/20241012_Photoshoot1/IMG_3451.png
Running taggers for face crop
Detection complete. Found 2 total regions
Running orientation tagger on /Users/rob/repos/kalliste/test_images_output/20241012_Photoshoot1/IMG_3455_face_crop.png
Running taggers for person crop
Running taggers for face crop
Running taggers for person crop
Found 2 detections in /Users/rob/repos/kalliste/test_images_input/20241012_Photoshoot1/IMG_3451.png
Running wd14 tagger on /Users/rob/repos/kalliste/test_images_output/20241012_Photoshoot1/IMG_3455_person_crop.png
WD14 tagging failed: argument of type 'NoneType' is not iterable
Running caption tagger on /Users/rob/repos/kalliste/test_images_output/20241012_Photoshoot1/IMG_3455_person_crop.png
Running orientation tagger on /Users/rob/repos/kalliste/test_images_output/20241012_Photoshoot1/IMG_3455_person_crop.png
Running orientation tagger on /Users/rob/repos/kalliste/test_images_output/20241012_Photoshoot1/IMG_6840_face_crop.png
Running wd14 tagger on /Users/rob/repos/kalliste/test_images_output/20241012_Photoshoot1/IMG_6840_person_crop.png
WD14 tagging failed: argument of type 'NoneType' is not iterable
Running caption tagger on /Users/rob/repos/kalliste/test_images_output/20241012_Photoshoot1/IMG_6840_person_crop.png
Running orientation tagger on /Users/rob/repos/kalliste/test_images_output/20241012_Photoshoot1/IMG_6840_person_crop.png
Starting crop processing for face from /Users/rob/repos/kalliste/test_images_input/20241012_Photoshoot1/IMG_3451.png
Starting crop processing for person from /Users/rob/repos/kalliste/test_images_input/20241012_Photoshoot1/IMG_3451.png
Error during tagging: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined
Error processing crop from /Users/rob/repos/kalliste/test_images_input/20241012_Photoshoot1/IMG_3455.png: Image tagging failed: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 38, in process
    await self.run_taggers()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 159, in run_taggers
    raise RuntimeError(f"Image tagging failed: {e}") from e
RuntimeError: Image tagging failed: name 'tag_category' is not defined
Error during tagging: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined
Error processing crop from /Users/rob/repos/kalliste/test_images_input/20241012_Photoshoot1/IMG_3455.png: Image tagging failed: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 38, in process
    await self.run_taggers()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 159, in run_taggers
    raise RuntimeError(f"Image tagging failed: {e}") from e
RuntimeError: Image tagging failed: name 'tag_category' is not defined
Error during tagging: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined
Error processing crop from /Users/rob/repos/kalliste/test_images_input/20241012_Photoshoot1/IMG_6840.png: Image tagging failed: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 38, in process
    await self.run_taggers()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 159, in run_taggers
    raise RuntimeError(f"Image tagging failed: {e}") from e
RuntimeError: Image tagging failed: name 'tag_category' is not defined
Error during tagging: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined
Error processing crop from /Users/rob/repos/kalliste/test_images_input/20241012_Photoshoot1/IMG_6840.png: Image tagging failed: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 38, in process
    await self.run_taggers()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 159, in run_taggers
    raise RuntimeError(f"Image tagging failed: {e}") from e
RuntimeError: Image tagging failed: name 'tag_category' is not defined
Error processing crops for /Users/rob/repos/kalliste/test_images_input/20241012_Photoshoot1/IMG_3455.png: Crop processing failed: Image tagging failed: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 38, in process
    await self.run_taggers()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 159, in run_taggers
    raise RuntimeError(f"Image tagging failed: {e}") from e
RuntimeError: Image tagging failed: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 66, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 50, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: Image tagging failed: name 'tag_category' is not defined
Error processing /Users/rob/repos/kalliste/test_images_input/20241012_Photoshoot1/IMG_3455.png: Crop processing failed: Image tagging failed: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 38, in process
    await self.run_taggers()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 159, in run_taggers
    raise RuntimeError(f"Image tagging failed: {e}") from e
RuntimeError: Image tagging failed: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 66, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 50, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: Image tagging failed: name 'tag_category' is not defined
Failed to process IMG_3455.png
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 38, in process
    await self.run_taggers()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 159, in run_taggers
    raise RuntimeError(f"Image tagging failed: {e}") from e
RuntimeError: Image tagging failed: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 44, in process_image
    return await image.process()
           ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 66, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 50, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: Image tagging failed: name 'tag_category' is not defined
Starting processing for /Users/rob/repos/kalliste/test_images_input/20241012_Photoshoot1/IMG_7295.png
Error processing crops for /Users/rob/repos/kalliste/test_images_input/20241012_Photoshoot1/IMG_6840.png: Crop processing failed: Image tagging failed: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 38, in process
    await self.run_taggers()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 159, in run_taggers
    raise RuntimeError(f"Image tagging failed: {e}") from e
RuntimeError: Image tagging failed: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 66, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 50, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: Image tagging failed: name 'tag_category' is not defined
Error processing /Users/rob/repos/kalliste/test_images_input/20241012_Photoshoot1/IMG_6840.png: Crop processing failed: Image tagging failed: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 38, in process
    await self.run_taggers()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 159, in run_taggers
    raise RuntimeError(f"Image tagging failed: {e}") from e
RuntimeError: Image tagging failed: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 66, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 50, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: Image tagging failed: name 'tag_category' is not defined
Failed to process IMG_6840.png
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 38, in process
    await self.run_taggers()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 159, in run_taggers
    raise RuntimeError(f"Image tagging failed: {e}") from e
RuntimeError: Image tagging failed: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 44, in process_image
    return await image.process()
           ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 66, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 50, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: Image tagging failed: name 'tag_category' is not defined
Starting processing for /Users/rob/repos/kalliste/test_images_input/20241012_Photoshoot1/IMG_6978.png
Running detection on /Users/rob/repos/kalliste/test_images_input/20241012_Photoshoot1/IMG_7295.png
Running detection on /Users/rob/repos/kalliste/test_images_input/20241012_Photoshoot1/IMG_6978.png
Running taggers for face crop
Detection complete. Found 1 total regions
Detection complete. Found 1 total regions
Running orientation tagger on /Users/rob/repos/kalliste/test_images_output/20241012_Photoshoot1/IMG_3451_face_crop.png
Running taggers for person crop
Found 1 detections in /Users/rob/repos/kalliste/test_images_input/20241012_Photoshoot1/IMG_7295.png
Found 1 detections in /Users/rob/repos/kalliste/test_images_input/20241012_Photoshoot1/IMG_6978.png
Running wd14 tagger on /Users/rob/repos/kalliste/test_images_output/20241012_Photoshoot1/IMG_3451_person_crop.png
WD14 tagging failed: argument of type 'NoneType' is not iterable
Running caption tagger on /Users/rob/repos/kalliste/test_images_output/20241012_Photoshoot1/IMG_3451_person_crop.png
Running orientation tagger on /Users/rob/repos/kalliste/test_images_output/20241012_Photoshoot1/IMG_3451_person_crop.png
Starting crop processing for person from /Users/rob/repos/kalliste/test_images_input/20241012_Photoshoot1/IMG_7295.png
Starting crop processing for person from /Users/rob/repos/kalliste/test_images_input/20241012_Photoshoot1/IMG_6978.png
Error during tagging: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined
Error processing crop from /Users/rob/repos/kalliste/test_images_input/20241012_Photoshoot1/IMG_3451.png: Image tagging failed: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 38, in process
    await self.run_taggers()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 159, in run_taggers
    raise RuntimeError(f"Image tagging failed: {e}") from e
RuntimeError: Image tagging failed: name 'tag_category' is not defined
Error during tagging: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined
Error processing crop from /Users/rob/repos/kalliste/test_images_input/20241012_Photoshoot1/IMG_3451.png: Image tagging failed: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 38, in process
    await self.run_taggers()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 159, in run_taggers
    raise RuntimeError(f"Image tagging failed: {e}") from e
RuntimeError: Image tagging failed: name 'tag_category' is not defined
Error processing crops for /Users/rob/repos/kalliste/test_images_input/20241012_Photoshoot1/IMG_3451.png: Crop processing failed: Image tagging failed: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 38, in process
    await self.run_taggers()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 159, in run_taggers
    raise RuntimeError(f"Image tagging failed: {e}") from e
RuntimeError: Image tagging failed: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 66, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 50, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: Image tagging failed: name 'tag_category' is not defined
Error processing /Users/rob/repos/kalliste/test_images_input/20241012_Photoshoot1/IMG_3451.png: Crop processing failed: Image tagging failed: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 38, in process
    await self.run_taggers()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 159, in run_taggers
    raise RuntimeError(f"Image tagging failed: {e}") from e
RuntimeError: Image tagging failed: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 66, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 50, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: Image tagging failed: name 'tag_category' is not defined
Failed to process IMG_3451.png
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 38, in process
    await self.run_taggers()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 159, in run_taggers
    raise RuntimeError(f"Image tagging failed: {e}") from e
RuntimeError: Image tagging failed: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 44, in process_image
    return await image.process()
           ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 66, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 50, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: Image tagging failed: name 'tag_category' is not defined
Starting processing for /Users/rob/repos/kalliste/test_images_input/20241012_Photoshoot1/IMG_7328.png
Running detection on /Users/rob/repos/kalliste/test_images_input/20241012_Photoshoot1/IMG_7328.png
Running taggers for person crop
Detection complete. Found 2 total regions
Running wd14 tagger on /Users/rob/repos/kalliste/test_images_output/20241012_Photoshoot1/IMG_7295_person_crop.png
WD14 tagging failed: argument of type 'NoneType' is not iterable
Running caption tagger on /Users/rob/repos/kalliste/test_images_output/20241012_Photoshoot1/IMG_7295_person_crop.png
Running orientation tagger on /Users/rob/repos/kalliste/test_images_output/20241012_Photoshoot1/IMG_7295_person_crop.png
Running taggers for person crop
Found 2 detections in /Users/rob/repos/kalliste/test_images_input/20241012_Photoshoot1/IMG_7328.png
Running wd14 tagger on /Users/rob/repos/kalliste/test_images_output/20241012_Photoshoot1/IMG_6978_person_crop.png
WD14 tagging failed: argument of type 'NoneType' is not iterable
Running caption tagger on /Users/rob/repos/kalliste/test_images_output/20241012_Photoshoot1/IMG_6978_person_crop.png
Running orientation tagger on /Users/rob/repos/kalliste/test_images_output/20241012_Photoshoot1/IMG_6978_person_crop.png
Starting crop processing for face from /Users/rob/repos/kalliste/test_images_input/20241012_Photoshoot1/IMG_7328.png
Starting crop processing for person from /Users/rob/repos/kalliste/test_images_input/20241012_Photoshoot1/IMG_7328.png
Error during tagging: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined
Error processing crop from /Users/rob/repos/kalliste/test_images_input/20241012_Photoshoot1/IMG_7295.png: Image tagging failed: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 38, in process
    await self.run_taggers()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 159, in run_taggers
    raise RuntimeError(f"Image tagging failed: {e}") from e
RuntimeError: Image tagging failed: name 'tag_category' is not defined
Error during tagging: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined
Error processing crop from /Users/rob/repos/kalliste/test_images_input/20241012_Photoshoot1/IMG_6978.png: Image tagging failed: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 38, in process
    await self.run_taggers()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 159, in run_taggers
    raise RuntimeError(f"Image tagging failed: {e}") from e
RuntimeError: Image tagging failed: name 'tag_category' is not defined
Error processing crops for /Users/rob/repos/kalliste/test_images_input/20241012_Photoshoot1/IMG_7295.png: Crop processing failed: Image tagging failed: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 38, in process
    await self.run_taggers()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 159, in run_taggers
    raise RuntimeError(f"Image tagging failed: {e}") from e
RuntimeError: Image tagging failed: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 66, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 50, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: Image tagging failed: name 'tag_category' is not defined
Error processing /Users/rob/repos/kalliste/test_images_input/20241012_Photoshoot1/IMG_7295.png: Crop processing failed: Image tagging failed: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 38, in process
    await self.run_taggers()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 159, in run_taggers
    raise RuntimeError(f"Image tagging failed: {e}") from e
RuntimeError: Image tagging failed: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 66, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 50, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: Image tagging failed: name 'tag_category' is not defined
Failed to process IMG_7295.png
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 38, in process
    await self.run_taggers()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 159, in run_taggers
    raise RuntimeError(f"Image tagging failed: {e}") from e
RuntimeError: Image tagging failed: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 44, in process_image
    return await image.process()
           ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 66, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 50, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: Image tagging failed: name 'tag_category' is not defined
Starting processing for /Users/rob/repos/kalliste/test_images_input/20241012_Photoshoot1/IMG_6975.png
Error processing crops for /Users/rob/repos/kalliste/test_images_input/20241012_Photoshoot1/IMG_6978.png: Crop processing failed: Image tagging failed: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 38, in process
    await self.run_taggers()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 159, in run_taggers
    raise RuntimeError(f"Image tagging failed: {e}") from e
RuntimeError: Image tagging failed: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 66, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 50, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: Image tagging failed: name 'tag_category' is not defined
Error processing /Users/rob/repos/kalliste/test_images_input/20241012_Photoshoot1/IMG_6978.png: Crop processing failed: Image tagging failed: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 38, in process
    await self.run_taggers()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 159, in run_taggers
    raise RuntimeError(f"Image tagging failed: {e}") from e
RuntimeError: Image tagging failed: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 66, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 50, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: Image tagging failed: name 'tag_category' is not defined
Failed to process IMG_6978.png
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 38, in process
    await self.run_taggers()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 159, in run_taggers
    raise RuntimeError(f"Image tagging failed: {e}") from e
RuntimeError: Image tagging failed: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 44, in process_image
    return await image.process()
           ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 66, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 50, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: Image tagging failed: name 'tag_category' is not defined
Starting processing for /Users/rob/repos/kalliste/test_images_input/20241012_Photoshoot1/IMG_3503.png
Running detection on /Users/rob/repos/kalliste/test_images_input/20241012_Photoshoot1/IMG_6975.png
Running detection on /Users/rob/repos/kalliste/test_images_input/20241012_Photoshoot1/IMG_3503.png
Running taggers for face crop
Detection complete. Found 2 total regions
Detection complete. Found 2 total regions
Running orientation tagger on /Users/rob/repos/kalliste/test_images_output/20241012_Photoshoot1/IMG_7328_face_crop.png
Running taggers for person crop
Found 2 detections in /Users/rob/repos/kalliste/test_images_input/20241012_Photoshoot1/IMG_6975.png
Found 2 detections in /Users/rob/repos/kalliste/test_images_input/20241012_Photoshoot1/IMG_3503.png
Running wd14 tagger on /Users/rob/repos/kalliste/test_images_output/20241012_Photoshoot1/IMG_7328_person_crop.png
Cleaning up model registry
Starting model registry cleanup
Model registry cleanup complete
Model registry cleanup complete
[blue]Pipeline test complete[/]
[yellow]Pipeline test interrupted by user[/]
[blue]Starting pipeline test[/]
Input directory: [cyan]/Users/rob/repos/kalliste/test_images_input[/]
Output directory: [cyan]/Users/rob/repos/kalliste/test_images_output[/]
[green]Initializing BatchProcessor[/]
Initializing BatchProcessor with input_root=/Users/rob/repos/kalliste/test_images_input, output_root=/Users/rob/repos/kalliste/test_images_output
Scanning for batches in /Users/rob/repos/kalliste/test_images_input
Initializing Batch with input_path=/Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2, max_concurrent=3
Scanning for images in /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2
Found 9 images to process in batch 20180312_Photoshoot2
Initializing Batch with input_path=/Users/rob/repos/kalliste/test_images_input/20241012_Photoshoot1, max_concurrent=3
Scanning for images in /Users/rob/repos/kalliste/test_images_input/20241012_Photoshoot1
Found 12 images to process in batch 20241012_Photoshoot1
Found 2 batches to process
BatchProcessor created
Initializing models
Initializing model registry
Starting model registry initialization
Initializing tagger pipeline...
Creating TaggerPipeline instance
MPS device validated
TaggerPipeline created with device: mps
Starting TaggerPipeline initialization
Initializing wd14 tagger
Initializing WD14Tagger on device: mps
Loading WD14 model: hf_hub:SmilingWolf/wd-vit-large-tagger-v3
Loading pretrained weights from Hugging Face hub (SmilingWolf/wd-vit-large-tagger-v3)
[SmilingWolf/wd-vit-large-tagger-v3] Safe alternative available for 'pytorch_model.bin' (as 'model.safetensors'). Loading weights using safetensors.
Loaded 10861 WD14 tags
Successfully initialized wd14 tagger
Initializing caption tagger
Initializing CaptionTagger on device: mps
Loading BLIP2 model: Salesforce/blip2-opt-2.7b
BLIP2 model loaded successfully on cpu
Successfully initialized caption tagger
Initializing orientation tagger
Initializing OrientationTagger on device: mps
Loading orientation model: LucyintheSky/pose-estimation-front-side-back
Orientation model loaded successfully on cpu
Successfully initialized orientation tagger
TaggerPipeline initialization complete
Tagger pipeline initialized successfully
Initializing YOLO detector...
Initializing YOLO detector
Loading YOLO model from /Users/rob/.cache/ultralytics/yolov8n.pt
YOLO model loaded successfully
Loading YOLO face model from /Users/rob/.cache/ultralytics/yolov8n-face.pt
YOLO face model loaded successfully
YOLODetector initialized with 1 active classes
YOLO detector initialized successfully
Model registry initialization complete
Model registry initialized successfully
[green]BatchProcessor initialized successfully[/]
[green]Starting batch processing[/]
Starting batch processing
Starting batch: 20180312_Photoshoot2
Starting batch processing for 20180312_Photoshoot2 with 9 images
Starting processing for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3136.png
Starting processing for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3320.png
Starting processing for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3297.png
Running detection on /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3297.png
Running detection on /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3136.png
Running detection on /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3320.png
Fusing face model...
Fusing face model...
Fusing face model...
Model fusion failed for face model: 'Conv' object has no attribute 'bn'
Model fusion failed for face model: 'Conv' object has no attribute 'bn'
Continuing with unfused model
Continuing with unfused model
Face Model fused successfully
Fusing main model...
Main Model fused successfully
Detection complete. Found 2 total regions
Found 2 detections in /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3297.png
Starting crop processing for face from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3297.png
Starting crop processing for person from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3297.png
Running taggers for face crop
Running orientation tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_3297_face_crop.png
Detection complete. Found 2 total regions
Detection complete. Found 2 total regions
Running taggers for person crop
Running wd14 tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_3297_person_crop.png
WD14 tagging failed: argument of type 'NoneType' is not iterable
Running caption tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_3297_person_crop.png
Cleaning up model registry
Starting model registry cleanup
Model registry cleanup complete
Model registry cleanup complete
[blue]Pipeline test complete[/]
[yellow]Pipeline test interrupted by user[/]
[blue]Starting pipeline test[/]
Input directory: [cyan]/Users/rob/repos/kalliste/test_images_input[/]
Output directory: [cyan]/Users/rob/repos/kalliste/test_images_output[/]
[green]Initializing BatchProcessor[/]
Initializing BatchProcessor with input_root=/Users/rob/repos/kalliste/test_images_input, output_root=/Users/rob/repos/kalliste/test_images_output
Scanning for batches in /Users/rob/repos/kalliste/test_images_input
Initializing Batch with input_path=/Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2, max_concurrent=3
Scanning for images in /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2
Found 9 images to process in batch 20180312_Photoshoot2
Initializing Batch with input_path=/Users/rob/repos/kalliste/test_images_input/20241012_Photoshoot1, max_concurrent=3
Scanning for images in /Users/rob/repos/kalliste/test_images_input/20241012_Photoshoot1
Found 12 images to process in batch 20241012_Photoshoot1
Found 2 batches to process
BatchProcessor created
Initializing models
Initializing model registry
Starting model registry initialization
Initializing tagger pipeline...
Creating TaggerPipeline instance
MPS device validated
TaggerPipeline created with device: mps
Starting TaggerPipeline initialization
Initializing wd14 tagger
Initializing WD14Tagger on device: mps
Loading WD14 model: hf_hub:SmilingWolf/wd-vit-large-tagger-v3
Loading pretrained weights from Hugging Face hub (SmilingWolf/wd-vit-large-tagger-v3)
[SmilingWolf/wd-vit-large-tagger-v3] Safe alternative available for 'pytorch_model.bin' (as 'model.safetensors'). Loading weights using safetensors.
Loaded 10861 WD14 tags
Successfully initialized wd14 tagger
Initializing caption tagger
Initializing CaptionTagger on device: mps
Loading BLIP2 model: Salesforce/blip2-opt-2.7b
BLIP2 model loaded successfully on cpu
Successfully initialized caption tagger
Initializing orientation tagger
Initializing OrientationTagger on device: mps
Loading orientation model: LucyintheSky/pose-estimation-front-side-back
Orientation model loaded successfully on cpu
Successfully initialized orientation tagger
TaggerPipeline initialization complete
Tagger pipeline initialized successfully
Initializing YOLO detector...
Initializing YOLO detector
Loading YOLO model from /Users/rob/.cache/ultralytics/yolov8n.pt
YOLO model loaded successfully
Loading YOLO face model from /Users/rob/.cache/ultralytics/yolov8n-face.pt
YOLO face model loaded successfully
YOLODetector initialized with 1 active classes
YOLO detector initialized successfully
Model registry initialization complete
Model registry initialized successfully
[green]BatchProcessor initialized successfully[/]
[green]Starting batch processing[/]
Starting batch processing
Starting batch: 20180312_Photoshoot2
Starting batch processing for 20180312_Photoshoot2 with 9 images
Starting processing for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3136.png
Starting processing for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3320.png
Starting processing for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3297.png
Running detection on /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3297.png
Running detection on /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3136.png
Running detection on /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3320.png
Fusing face model...
Fusing face model...
Fusing face model...
Model fusion failed for face model: 'Conv' object has no attribute 'bn'
Model fusion failed for face model: 'Conv' object has no attribute 'bn'
Continuing with unfused model
Continuing with unfused model
Face Model fused successfully
Fusing main model...
Main Model fused successfully
Detection complete. Found 2 total regions
Found 2 detections in /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3297.png
Starting crop processing for face from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3297.png
Starting crop processing for person from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3297.png
Running taggers for face crop
Running orientation tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_3297_face_crop.png
Detection complete. Found 2 total regions
Running taggers for person crop
Detection complete. Found 2 total regions
Running wd14 tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_3297_person_crop.png
WD14 tagging failed: name 'row' is not defined
Running caption tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_3297_person_crop.png
Running orientation tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_3297_person_crop.png
Found 2 detections in /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3320.png
Error during tagging: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined
Error processing crop from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3297.png: Image tagging failed: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 38, in process
    await self.run_taggers()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 159, in run_taggers
    raise RuntimeError(f"Image tagging failed: {e}") from e
RuntimeError: Image tagging failed: name 'tag_category' is not defined
Found 2 detections in /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3136.png
Starting crop processing for face from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3320.png
Starting crop processing for person from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3320.png
Starting crop processing for face from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3136.png
Starting crop processing for person from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3136.png
Error during tagging: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined
Error processing crop from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3297.png: Image tagging failed: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 38, in process
    await self.run_taggers()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 159, in run_taggers
    raise RuntimeError(f"Image tagging failed: {e}") from e
RuntimeError: Image tagging failed: name 'tag_category' is not defined
Error processing crops for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3297.png: Crop processing failed: Image tagging failed: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 38, in process
    await self.run_taggers()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 159, in run_taggers
    raise RuntimeError(f"Image tagging failed: {e}") from e
RuntimeError: Image tagging failed: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 66, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 50, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: Image tagging failed: name 'tag_category' is not defined
Error processing /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3297.png: Crop processing failed: Image tagging failed: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 38, in process
    await self.run_taggers()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 159, in run_taggers
    raise RuntimeError(f"Image tagging failed: {e}") from e
RuntimeError: Image tagging failed: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 66, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 50, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: Image tagging failed: name 'tag_category' is not defined
Failed to process IMG_3297.png
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 38, in process
    await self.run_taggers()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 159, in run_taggers
    raise RuntimeError(f"Image tagging failed: {e}") from e
RuntimeError: Image tagging failed: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 44, in process_image
    return await image.process()
           ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 66, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 50, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: Image tagging failed: name 'tag_category' is not defined
Starting processing for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3152.png
Running detection on /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3152.png
Running taggers for face crop
Running orientation tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_3320_face_crop.png
Detection complete. Found 2 total regions
Running taggers for person crop
Running taggers for face crop
Running taggers for person crop
Running wd14 tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_3320_person_crop.png
Cleaning up model registry
Starting model registry cleanup
Model registry cleanup complete
Model registry cleanup complete
[blue]Pipeline test complete[/]
[yellow]Pipeline test interrupted by user[/]
[blue]Starting pipeline test[/]
Input directory: [cyan]/Users/rob/repos/kalliste/test_images_input[/]
Output directory: [cyan]/Users/rob/repos/kalliste/test_images_output[/]
[green]Initializing BatchProcessor[/]
Initializing BatchProcessor with input_root=/Users/rob/repos/kalliste/test_images_input, output_root=/Users/rob/repos/kalliste/test_images_output
Scanning for batches in /Users/rob/repos/kalliste/test_images_input
Initializing Batch with input_path=/Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2, max_concurrent=3
Scanning for images in /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2
Found 9 images to process in batch 20180312_Photoshoot2
Initializing Batch with input_path=/Users/rob/repos/kalliste/test_images_input/20241012_Photoshoot1, max_concurrent=3
Scanning for images in /Users/rob/repos/kalliste/test_images_input/20241012_Photoshoot1
Found 12 images to process in batch 20241012_Photoshoot1
Found 2 batches to process
BatchProcessor created
Initializing models
Initializing model registry
Starting model registry initialization
Initializing tagger pipeline...
Creating TaggerPipeline instance
MPS device validated
TaggerPipeline created with device: mps
Starting TaggerPipeline initialization
Initializing orientation tagger
Initializing OrientationTagger on device: mps
Loading orientation model: LucyintheSky/pose-estimation-front-side-back
Orientation model loaded successfully on cpu
Successfully initialized orientation tagger
Initializing wd14 tagger
Initializing WD14Tagger on device: mps
Loading WD14 model: hf_hub:SmilingWolf/wd-vit-large-tagger-v3
Loading pretrained weights from Hugging Face hub (SmilingWolf/wd-vit-large-tagger-v3)
[SmilingWolf/wd-vit-large-tagger-v3] Safe alternative available for 'pytorch_model.bin' (as 'model.safetensors'). Loading weights using safetensors.
Loaded 10861 WD14 tags
Successfully initialized wd14 tagger
Initializing caption tagger
Initializing CaptionTagger on device: mps
Loading BLIP2 model: Salesforce/blip2-opt-2.7b
BLIP2 model loaded successfully on cpu
Successfully initialized caption tagger
TaggerPipeline initialization complete
Tagger pipeline initialized successfully
Initializing YOLO detector...
Initializing YOLO detector
Loading YOLO model from /Users/rob/.cache/ultralytics/yolov8n.pt
YOLO model loaded successfully
Loading YOLO face model from /Users/rob/.cache/ultralytics/yolov8n-face.pt
YOLO face model loaded successfully
YOLODetector initialized with 1 active classes
YOLO detector initialized successfully
Model registry initialization complete
Model registry initialized successfully
[green]BatchProcessor initialized successfully[/]
[green]Starting batch processing[/]
Starting batch processing
Starting batch: 20180312_Photoshoot2
Starting batch processing for 20180312_Photoshoot2 with 9 images
Starting processing for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3136.png
Starting processing for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3320.png
Starting processing for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3297.png
Running detection on /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3297.png
Running detection on /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3320.png
Running detection on /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3136.png
Fusing face model...
Fusing face model...
Fusing face model...
Model fusion failed for face model: 'Conv' object has no attribute 'bn'
Continuing with unfused model
Model fusion failed for face model: 'Conv' object has no attribute 'bn'
Continuing with unfused model
Face Model fused successfully
Fusing main model...
Main Model fused successfully
Detection complete. Found 2 total regions
Found 2 detections in /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3136.png
Starting crop processing for face from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3136.png
Starting crop processing for person from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3136.png
Detection complete. Found 2 total regions
Found 2 detections in /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3297.png
Starting crop processing for face from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3297.png
Starting crop processing for person from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3297.png
Running taggers for face crop
Running orientation tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_3136_face_crop.png
Running taggers for person crop
Detection complete. Found 2 total regions
Running wd14 tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_3136_person_crop.png
WD14 tagging failed: name 'row_tuple' is not defined
Running caption tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_3136_person_crop.png
Cleaning up model registry
Starting model registry cleanup
Model registry cleanup complete
Model registry cleanup complete
[blue]Pipeline test complete[/]
[yellow]Pipeline test interrupted by user[/]
[blue]Starting pipeline test[/]
Input directory: [cyan]/Users/rob/repos/kalliste/test_images_input[/]
Output directory: [cyan]/Users/rob/repos/kalliste/test_images_output[/]
[green]Initializing BatchProcessor[/]
Initializing BatchProcessor with input_root=/Users/rob/repos/kalliste/test_images_input, output_root=/Users/rob/repos/kalliste/test_images_output
Scanning for batches in /Users/rob/repos/kalliste/test_images_input
Initializing Batch with input_path=/Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2, max_concurrent=3
Scanning for images in /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2
Found 9 images to process in batch 20180312_Photoshoot2
Initializing Batch with input_path=/Users/rob/repos/kalliste/test_images_input/20241012_Photoshoot1, max_concurrent=3
Scanning for images in /Users/rob/repos/kalliste/test_images_input/20241012_Photoshoot1
Found 12 images to process in batch 20241012_Photoshoot1
Found 2 batches to process
BatchProcessor created
Initializing models
Initializing model registry
Starting model registry initialization
Initializing tagger pipeline...
Creating TaggerPipeline instance
MPS device validated
TaggerPipeline created with device: mps
Starting TaggerPipeline initialization
Initializing caption tagger
Initializing CaptionTagger on device: mps
Loading BLIP2 model: Salesforce/blip2-opt-2.7b
BLIP2 model loaded successfully on cpu
Successfully initialized caption tagger
Initializing orientation tagger
Initializing OrientationTagger on device: mps
Loading orientation model: LucyintheSky/pose-estimation-front-side-back
Orientation model loaded successfully on cpu
Successfully initialized orientation tagger
Initializing wd14 tagger
Initializing WD14Tagger on device: mps
Loading WD14 model: hf_hub:SmilingWolf/wd-vit-large-tagger-v3
Loading pretrained weights from Hugging Face hub (SmilingWolf/wd-vit-large-tagger-v3)
[SmilingWolf/wd-vit-large-tagger-v3] Safe alternative available for 'pytorch_model.bin' (as 'model.safetensors'). Loading weights using safetensors.
Loaded 10861 WD14 tags
Successfully initialized wd14 tagger
TaggerPipeline initialization complete
Tagger pipeline initialized successfully
Initializing YOLO detector...
Initializing YOLO detector
Loading YOLO model from /Users/rob/.cache/ultralytics/yolov8n.pt
YOLO model loaded successfully
Loading YOLO face model from /Users/rob/.cache/ultralytics/yolov8n-face.pt
YOLO face model loaded successfully
YOLODetector initialized with 1 active classes
YOLO detector initialized successfully
Model registry initialization complete
Model registry initialized successfully
[green]BatchProcessor initialized successfully[/]
[green]Starting batch processing[/]
Starting batch processing
Starting batch: 20180312_Photoshoot2
Starting batch processing for 20180312_Photoshoot2 with 9 images
Starting processing for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3136.png
Starting processing for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3320.png
Starting processing for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3297.png
Running detection on /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3297.png
Running detection on /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3320.png
Running detection on /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3136.png
Fusing face model...
Fusing face model...
Fusing face model...
Model fusion failed for face model: 'Conv' object has no attribute 'bn'
Model fusion failed for face model: 'Conv' object has no attribute 'bn'
Continuing with unfused model
Continuing with unfused model
Face Model fused successfully
Fusing main model...
Main Model fused successfully
Detection complete. Found 2 total regions
Found 2 detections in /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3136.png
Starting crop processing for face from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3136.png
Starting crop processing for person from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3136.png
Detection complete. Found 2 total regions
Found 2 detections in /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3297.png
Starting crop processing for face from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3297.png
Starting crop processing for person from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3297.png
Running taggers for face crop
Running orientation tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_3136_face_crop.png
Running taggers for person crop
Detection complete. Found 2 total regions
Running wd14 tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_3136_person_crop.png
WD14 tagging failed: argument of type 'NoneType' is not iterable
Running orientation tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_3136_person_crop.png
Running caption tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_3136_person_crop.png
Running taggers for face crop
Running taggers for person crop
Error during tagging: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined
Error processing crop from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3136.png: Image tagging failed: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 38, in process
    await self.run_taggers()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 159, in run_taggers
    raise RuntimeError(f"Image tagging failed: {e}") from e
RuntimeError: Image tagging failed: name 'tag_category' is not defined
Found 2 detections in /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3320.png
Running orientation tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_3297_face_crop.png
Running wd14 tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_3297_person_crop.png
WD14 tagging failed: argument of type 'NoneType' is not iterable
Running orientation tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_3297_person_crop.png
Running caption tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_3297_person_crop.png
Starting crop processing for face from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3320.png
Starting crop processing for person from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3320.png
Error during tagging: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined
Error processing crop from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3136.png: Image tagging failed: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 38, in process
    await self.run_taggers()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 159, in run_taggers
    raise RuntimeError(f"Image tagging failed: {e}") from e
RuntimeError: Image tagging failed: name 'tag_category' is not defined
Error processing crops for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3136.png: Crop processing failed: Image tagging failed: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 38, in process
    await self.run_taggers()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 159, in run_taggers
    raise RuntimeError(f"Image tagging failed: {e}") from e
RuntimeError: Image tagging failed: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 66, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 50, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: Image tagging failed: name 'tag_category' is not defined
Error processing /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3136.png: Crop processing failed: Image tagging failed: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 38, in process
    await self.run_taggers()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 159, in run_taggers
    raise RuntimeError(f"Image tagging failed: {e}") from e
RuntimeError: Image tagging failed: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 66, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 50, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: Image tagging failed: name 'tag_category' is not defined
Failed to process IMG_3136.png
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 38, in process
    await self.run_taggers()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 159, in run_taggers
    raise RuntimeError(f"Image tagging failed: {e}") from e
RuntimeError: Image tagging failed: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 44, in process_image
    return await image.process()
           ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 66, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 50, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: Image tagging failed: name 'tag_category' is not defined
Error during tagging: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined
Error processing crop from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3297.png: Image tagging failed: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 38, in process
    await self.run_taggers()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 159, in run_taggers
    raise RuntimeError(f"Image tagging failed: {e}") from e
RuntimeError: Image tagging failed: name 'tag_category' is not defined
Error during tagging: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined
Error processing crop from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3297.png: Image tagging failed: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 38, in process
    await self.run_taggers()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 159, in run_taggers
    raise RuntimeError(f"Image tagging failed: {e}") from e
RuntimeError: Image tagging failed: name 'tag_category' is not defined
Starting processing for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3152.png
Error processing crops for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3297.png: Crop processing failed: Image tagging failed: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 38, in process
    await self.run_taggers()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 159, in run_taggers
    raise RuntimeError(f"Image tagging failed: {e}") from e
RuntimeError: Image tagging failed: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 66, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 50, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: Image tagging failed: name 'tag_category' is not defined
Error processing /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3297.png: Crop processing failed: Image tagging failed: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 38, in process
    await self.run_taggers()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 159, in run_taggers
    raise RuntimeError(f"Image tagging failed: {e}") from e
RuntimeError: Image tagging failed: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 66, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 50, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: Image tagging failed: name 'tag_category' is not defined
Failed to process IMG_3297.png
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 38, in process
    await self.run_taggers()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 159, in run_taggers
    raise RuntimeError(f"Image tagging failed: {e}") from e
RuntimeError: Image tagging failed: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 44, in process_image
    return await image.process()
           ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 66, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 50, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: Image tagging failed: name 'tag_category' is not defined
Starting processing for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A9668.png
Running detection on /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3152.png
Running detection on /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A9668.png
Running taggers for face crop
Running orientation tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_3320_face_crop.png
Detection complete. Found 2 total regions
Running taggers for person crop
Detection complete. Found 2 total regions
Running wd14 tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_3320_person_crop.png
WD14 tagging failed: argument of type 'NoneType' is not iterable
Running orientation tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_3320_person_crop.png
Running caption tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_3320_person_crop.png
Found 2 detections in /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3152.png
Error during tagging: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined
Error processing crop from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3320.png: Image tagging failed: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 38, in process
    await self.run_taggers()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 159, in run_taggers
    raise RuntimeError(f"Image tagging failed: {e}") from e
RuntimeError: Image tagging failed: name 'tag_category' is not defined
Found 2 detections in /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A9668.png
Starting crop processing for face from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3152.png
Starting crop processing for person from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3152.png
Starting crop processing for face from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A9668.png
Starting crop processing for person from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A9668.png
Error during tagging: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined
Error processing crop from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3320.png: Image tagging failed: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 38, in process
    await self.run_taggers()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 159, in run_taggers
    raise RuntimeError(f"Image tagging failed: {e}") from e
RuntimeError: Image tagging failed: name 'tag_category' is not defined
Error processing crops for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3320.png: Crop processing failed: Image tagging failed: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 38, in process
    await self.run_taggers()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 159, in run_taggers
    raise RuntimeError(f"Image tagging failed: {e}") from e
RuntimeError: Image tagging failed: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 66, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 50, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: Image tagging failed: name 'tag_category' is not defined
Error processing /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3320.png: Crop processing failed: Image tagging failed: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 38, in process
    await self.run_taggers()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 159, in run_taggers
    raise RuntimeError(f"Image tagging failed: {e}") from e
RuntimeError: Image tagging failed: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 66, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 50, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: Image tagging failed: name 'tag_category' is not defined
Failed to process IMG_3320.png
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 38, in process
    await self.run_taggers()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 159, in run_taggers
    raise RuntimeError(f"Image tagging failed: {e}") from e
RuntimeError: Image tagging failed: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 44, in process_image
    return await image.process()
           ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 66, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 50, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: Image tagging failed: name 'tag_category' is not defined
Starting processing for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_0241-2.png
Running detection on /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_0241-2.png
Running taggers for face crop
Running orientation tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_3152_face_crop.png
Running taggers for person crop
Detection complete. Found 2 total regions
Running wd14 tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_3152_person_crop.png
WD14 tagging failed: argument of type 'NoneType' is not iterable
Running orientation tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_3152_person_crop.png
Running caption tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_3152_person_crop.png
Cleaning up model registry
Starting model registry cleanup
Model registry cleanup complete
Model registry cleanup complete
[blue]Pipeline test complete[/]
[yellow]Pipeline test interrupted by user[/]
[blue]Starting pipeline test[/]
Input directory: [cyan]/Users/rob/repos/kalliste/test_images_input[/]
Output directory: [cyan]/Users/rob/repos/kalliste/test_images_output[/]
[green]Initializing BatchProcessor[/]
Initializing BatchProcessor with input_root=/Users/rob/repos/kalliste/test_images_input, output_root=/Users/rob/repos/kalliste/test_images_output
Scanning for batches in /Users/rob/repos/kalliste/test_images_input
Initializing Batch with input_path=/Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2, max_concurrent=3
Scanning for images in /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2
Found 9 images to process in batch 20180312_Photoshoot2
Initializing Batch with input_path=/Users/rob/repos/kalliste/test_images_input/20241012_Photoshoot1, max_concurrent=3
Scanning for images in /Users/rob/repos/kalliste/test_images_input/20241012_Photoshoot1
Found 12 images to process in batch 20241012_Photoshoot1
Found 2 batches to process
BatchProcessor created
Initializing models
Initializing model registry
Starting model registry initialization
Initializing tagger pipeline...
Creating TaggerPipeline instance
MPS device validated
TaggerPipeline created with device: mps
Starting TaggerPipeline initialization
Initializing caption tagger
Initializing CaptionTagger on device: mps
Loading BLIP2 model: Salesforce/blip2-opt-2.7b
BLIP2 model loaded successfully on cpu
Successfully initialized caption tagger
Initializing orientation tagger
Initializing OrientationTagger on device: mps
Loading orientation model: LucyintheSky/pose-estimation-front-side-back
Orientation model loaded successfully on cpu
Successfully initialized orientation tagger
Initializing wd14 tagger
Initializing WD14Tagger on device: mps
Loading WD14 model: hf_hub:SmilingWolf/wd-vit-large-tagger-v3
Loading pretrained weights from Hugging Face hub (SmilingWolf/wd-vit-large-tagger-v3)
[SmilingWolf/wd-vit-large-tagger-v3] Safe alternative available for 'pytorch_model.bin' (as 'model.safetensors'). Loading weights using safetensors.
Loaded 10861 WD14 tags
Successfully initialized wd14 tagger
TaggerPipeline initialization complete
Tagger pipeline initialized successfully
Initializing YOLO detector...
Initializing YOLO detector
Loading YOLO model from /Users/rob/.cache/ultralytics/yolov8n.pt
YOLO model loaded successfully
Loading YOLO face model from /Users/rob/.cache/ultralytics/yolov8n-face.pt
YOLO face model loaded successfully
YOLODetector initialized with 1 active classes
YOLO detector initialized successfully
Model registry initialization complete
Model registry initialized successfully
[green]BatchProcessor initialized successfully[/]
[green]Starting batch processing[/]
Starting batch processing
Starting batch: 20180312_Photoshoot2
Starting batch processing for 20180312_Photoshoot2 with 9 images
Starting processing for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3136.png
Starting processing for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3320.png
Starting processing for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3297.png
Running detection on /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3320.png
Running detection on /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3297.png
Running detection on /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3136.png
Fusing face model...
Fusing face model...
Fusing face model...
Model fusion failed for face model: 'Conv' object has no attribute 'bn'
Model fusion failed for face model: 'Conv' object has no attribute 'bn'
Continuing with unfused model
Continuing with unfused model
Face Model fused successfully
Fusing main model...
Main Model fused successfully
Detection complete. Found 2 total regions
Found 2 detections in /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3297.png
Starting crop processing for face from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3297.png
Starting crop processing for person from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3297.png
Running taggers for face crop
Running orientation tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_3297_face_crop.png
Detection complete. Found 2 total regions
Running taggers for person crop
Detection complete. Found 2 total regions
Running caption tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_3297_person_crop.png
Running orientation tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_3297_person_crop.png
Running wd14 tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_3297_person_crop.png
WD14 tagging failed: argument of type 'NoneType' is not iterable
Found 2 detections in /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3136.png
Error during tagging: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined
Error processing crop from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3297.png: Image tagging failed: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 38, in process
    await self.run_taggers()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 159, in run_taggers
    raise RuntimeError(f"Image tagging failed: {e}") from e
RuntimeError: Image tagging failed: name 'tag_category' is not defined
Found 2 detections in /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3320.png
Starting crop processing for face from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3136.png
Starting crop processing for person from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3136.png
Starting crop processing for face from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3320.png
Starting crop processing for person from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3320.png
Error during tagging: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined
Error processing crop from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3297.png: Image tagging failed: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 38, in process
    await self.run_taggers()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 159, in run_taggers
    raise RuntimeError(f"Image tagging failed: {e}") from e
RuntimeError: Image tagging failed: name 'tag_category' is not defined
Error processing crops for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3297.png: Crop processing failed: Image tagging failed: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 38, in process
    await self.run_taggers()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 159, in run_taggers
    raise RuntimeError(f"Image tagging failed: {e}") from e
RuntimeError: Image tagging failed: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 66, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 50, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: Image tagging failed: name 'tag_category' is not defined
Error processing /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3297.png: Crop processing failed: Image tagging failed: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 38, in process
    await self.run_taggers()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 159, in run_taggers
    raise RuntimeError(f"Image tagging failed: {e}") from e
RuntimeError: Image tagging failed: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 66, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 50, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: Image tagging failed: name 'tag_category' is not defined
Failed to process IMG_3297.png
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 38, in process
    await self.run_taggers()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 159, in run_taggers
    raise RuntimeError(f"Image tagging failed: {e}") from e
RuntimeError: Image tagging failed: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 44, in process_image
    return await image.process()
           ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 66, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 50, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: Image tagging failed: name 'tag_category' is not defined
Starting processing for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3152.png
Running detection on /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3152.png
Running taggers for face crop
Running orientation tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_3136_face_crop.png
Detection complete. Found 2 total regions
Running taggers for face crop
Running taggers for person crop
Running taggers for person crop
Running orientation tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_3320_face_crop.png
Running caption tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_3136_person_crop.png
Running orientation tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_3136_person_crop.png
Running wd14 tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_3136_person_crop.png
WD14 tagging failed: argument of type 'NoneType' is not iterable
Running caption tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_3320_person_crop.png
Running orientation tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_3320_person_crop.png
Running wd14 tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_3320_person_crop.png
WD14 tagging failed: argument of type 'NoneType' is not iterable
Found 2 detections in /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3152.png
Error during tagging: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined
Error processing crop from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3136.png: Image tagging failed: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 38, in process
    await self.run_taggers()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 159, in run_taggers
    raise RuntimeError(f"Image tagging failed: {e}") from e
RuntimeError: Image tagging failed: name 'tag_category' is not defined
Starting crop processing for face from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3152.png
Starting crop processing for person from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3152.png
Error during tagging: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined
Error processing crop from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3320.png: Image tagging failed: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 38, in process
    await self.run_taggers()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 159, in run_taggers
    raise RuntimeError(f"Image tagging failed: {e}") from e
RuntimeError: Image tagging failed: name 'tag_category' is not defined
Error during tagging: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined
Error processing crop from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3136.png: Image tagging failed: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 38, in process
    await self.run_taggers()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 159, in run_taggers
    raise RuntimeError(f"Image tagging failed: {e}") from e
RuntimeError: Image tagging failed: name 'tag_category' is not defined
Error during tagging: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined
Error processing crop from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3320.png: Image tagging failed: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 38, in process
    await self.run_taggers()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 159, in run_taggers
    raise RuntimeError(f"Image tagging failed: {e}") from e
RuntimeError: Image tagging failed: name 'tag_category' is not defined
Error processing crops for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3136.png: Crop processing failed: Image tagging failed: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 38, in process
    await self.run_taggers()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 159, in run_taggers
    raise RuntimeError(f"Image tagging failed: {e}") from e
RuntimeError: Image tagging failed: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 66, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 50, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: Image tagging failed: name 'tag_category' is not defined
Error processing /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3136.png: Crop processing failed: Image tagging failed: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 38, in process
    await self.run_taggers()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 159, in run_taggers
    raise RuntimeError(f"Image tagging failed: {e}") from e
RuntimeError: Image tagging failed: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 66, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 50, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: Image tagging failed: name 'tag_category' is not defined
Failed to process IMG_3136.png
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 38, in process
    await self.run_taggers()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 159, in run_taggers
    raise RuntimeError(f"Image tagging failed: {e}") from e
RuntimeError: Image tagging failed: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 44, in process_image
    return await image.process()
           ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 66, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 50, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: Image tagging failed: name 'tag_category' is not defined
Starting processing for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A9668.png
Error processing crops for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3320.png: Crop processing failed: Image tagging failed: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 38, in process
    await self.run_taggers()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 159, in run_taggers
    raise RuntimeError(f"Image tagging failed: {e}") from e
RuntimeError: Image tagging failed: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 66, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 50, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: Image tagging failed: name 'tag_category' is not defined
Error processing /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3320.png: Crop processing failed: Image tagging failed: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 38, in process
    await self.run_taggers()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 159, in run_taggers
    raise RuntimeError(f"Image tagging failed: {e}") from e
RuntimeError: Image tagging failed: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 66, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 50, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: Image tagging failed: name 'tag_category' is not defined
Failed to process IMG_3320.png
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 38, in process
    await self.run_taggers()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 159, in run_taggers
    raise RuntimeError(f"Image tagging failed: {e}") from e
RuntimeError: Image tagging failed: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 44, in process_image
    return await image.process()
           ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 66, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 50, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: Image tagging failed: name 'tag_category' is not defined
Starting processing for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_0241-2.png
Running detection on /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A9668.png
Running detection on /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_0241-2.png
Running taggers for face crop
Running orientation tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_3152_face_crop.png
Running taggers for person crop
Detection complete. Found 2 total regions
Detection complete. Found 2 total regions
[yellow]Pipeline test interrupted by user[/]
Cleaning up model registry
Starting model registry cleanup
Model registry cleanup complete
Model registry cleanup complete
[blue]Pipeline test complete[/]
Task was destroyed but it is pending!
task: <Task cancelling name='Task-1' coro=<main() done, defined at /Users/rob/repos/kalliste/scripts/test_pipeline.py:33> wait_for=<_GatheringFuture pending cb=[Task.task_wakeup()]> cb=[gather.<locals>._done_callback() at /opt/miniconda3/envs/kalliste/lib/python3.11/asyncio/tasks.py:764]>
[blue]Starting pipeline test[/]
Input directory: [cyan]/Users/rob/repos/kalliste/test_images_input[/]
Output directory: [cyan]/Users/rob/repos/kalliste/test_images_output[/]
[green]Initializing BatchProcessor[/]
Initializing BatchProcessor with input_root=/Users/rob/repos/kalliste/test_images_input, output_root=/Users/rob/repos/kalliste/test_images_output
Scanning for batches in /Users/rob/repos/kalliste/test_images_input
Initializing Batch with input_path=/Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2, max_concurrent=3
Scanning for images in /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2
Found 9 images to process in batch 20180312_Photoshoot2
Initializing Batch with input_path=/Users/rob/repos/kalliste/test_images_input/20241012_Photoshoot1, max_concurrent=3
Scanning for images in /Users/rob/repos/kalliste/test_images_input/20241012_Photoshoot1
Found 12 images to process in batch 20241012_Photoshoot1
Found 2 batches to process
BatchProcessor created
Initializing models
Initializing model registry
Starting model registry initialization
Initializing tagger pipeline...
Creating TaggerPipeline instance
MPS device validated
TaggerPipeline created with device: mps
Starting TaggerPipeline initialization
Initializing caption tagger
Initializing CaptionTagger on device: mps
Loading BLIP2 model: Salesforce/blip2-opt-2.7b
BLIP2 model loaded successfully on cpu
Successfully initialized caption tagger
Initializing orientation tagger
Initializing OrientationTagger on device: mps
Loading orientation model: LucyintheSky/pose-estimation-front-side-back
Orientation model loaded successfully on cpu
Successfully initialized orientation tagger
Initializing wd14 tagger
Initializing WD14Tagger on device: mps
Loading WD14 model: hf_hub:SmilingWolf/wd-vit-large-tagger-v3
Loading pretrained weights from Hugging Face hub (SmilingWolf/wd-vit-large-tagger-v3)
[SmilingWolf/wd-vit-large-tagger-v3] Safe alternative available for 'pytorch_model.bin' (as 'model.safetensors'). Loading weights using safetensors.
Loading tags from: /Users/rob/repos/kalliste/weights/wd14/selected_tags.csv
Loaded 10861 tags
Successfully initialized wd14 tagger
TaggerPipeline initialization complete
Tagger pipeline initialized successfully
Initializing YOLO detector...
Initializing YOLO detector
Loading YOLO model from /Users/rob/.cache/ultralytics/yolov8n.pt
YOLO model loaded successfully
Loading YOLO face model from /Users/rob/.cache/ultralytics/yolov8n-face.pt
YOLO face model loaded successfully
YOLODetector initialized with 1 active classes
YOLO detector initialized successfully
Model registry initialization complete
Model registry initialized successfully
[green]BatchProcessor initialized successfully[/]
[green]Starting batch processing[/]
Starting batch processing
Starting batch: 20180312_Photoshoot2
Starting batch processing for 20180312_Photoshoot2 with 9 images
Starting processing for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3136.png
Starting processing for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3320.png
Starting processing for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3297.png
Running detection on /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3136.png
Running detection on /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3297.png
Running detection on /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3320.png
Fusing face model...
Fusing face model...
Fusing face model...
Model fusion failed for face model: 'Conv' object has no attribute 'bn'
Continuing with unfused model
Model fusion failed for face model: 'Conv' object has no attribute 'bn'
Continuing with unfused model
Face Model fused successfully
Fusing main model...
Main Model fused successfully
Detection complete. Found 2 total regions
Found 2 detections in /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3320.png
Starting crop processing for face from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3320.png
Starting crop processing for person from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3320.png
Detection complete. Found 2 total regions
Found 2 detections in /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3297.png
Starting crop processing for face from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3297.png
Starting crop processing for person from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3297.png
Running taggers for face crop
Running orientation tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_3320_face_crop.png
Running taggers for person crop
Detection complete. Found 2 total regions
Running caption tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_3320_person_crop.png
Running orientation tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_3320_person_crop.png
Running wd14 tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_3320_person_crop.png
WD14 tagging failed: argument of type 'NoneType' is not iterable
Error during tagging: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined
Error processing crop from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3320.png: Image tagging failed: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 38, in process
    await self.run_taggers()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 159, in run_taggers
    raise RuntimeError(f"Image tagging failed: {e}") from e
RuntimeError: Image tagging failed: name 'tag_category' is not defined
Running taggers for face crop
Running taggers for person crop
Found 2 detections in /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3136.png
Running orientation tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_3297_face_crop.png
Running caption tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_3297_person_crop.png
Error during tagging: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined
Error processing crop from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3320.png: Image tagging failed: name 'tag_category' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 155, in run_taggers
    self._add_tag_results(tag_results)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 168, in _add_tag_results
    tag=f"{tag_category}:{tag.label}",
           ^^^^^^^^^^^^
NameError: name 'tag_category' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 38, in process
    await self.run_taggers()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 159, in run_taggers
    raise RuntimeError(f"Image tagging failed: {e}") from e
RuntimeError: Image tagging failed: name 'tag_category' is not defined
Cleaning up model registry
Starting model registry cleanup
Model registry cleanup complete
Model registry cleanup complete
[blue]Pipeline test complete[/]
[yellow]Pipeline test interrupted by user[/]
[blue]Starting pipeline test[/]
Input directory: [cyan]/Users/rob/repos/kalliste/test_images_input[/]
Output directory: [cyan]/Users/rob/repos/kalliste/test_images_output[/]
[green]Initializing BatchProcessor[/]
Initializing BatchProcessor with input_root=/Users/rob/repos/kalliste/test_images_input, output_root=/Users/rob/repos/kalliste/test_images_output
Scanning for batches in /Users/rob/repos/kalliste/test_images_input
Initializing Batch with input_path=/Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2, max_concurrent=3
Scanning for images in /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2
Found 9 images to process in batch 20180312_Photoshoot2
Initializing Batch with input_path=/Users/rob/repos/kalliste/test_images_input/20241012_Photoshoot1, max_concurrent=3
Scanning for images in /Users/rob/repos/kalliste/test_images_input/20241012_Photoshoot1
Found 12 images to process in batch 20241012_Photoshoot1
Found 2 batches to process
BatchProcessor created
Initializing models
Initializing model registry
Starting model registry initialization
Initializing tagger pipeline...
Creating TaggerPipeline instance
MPS device validated
TaggerPipeline created with device: mps
Starting TaggerPipeline initialization
Initializing wd14 tagger
Initializing WD14Tagger on device: mps
Loading WD14 model: hf_hub:SmilingWolf/wd-vit-large-tagger-v3
Loading pretrained weights from Hugging Face hub (SmilingWolf/wd-vit-large-tagger-v3)
[SmilingWolf/wd-vit-large-tagger-v3] Safe alternative available for 'pytorch_model.bin' (as 'model.safetensors'). Loading weights using safetensors.
Loading tags from: /Users/rob/repos/kalliste/weights/wd14/selected_tags.csv
Loaded 10861 tags
Loaded 10861 WD14 tags
Successfully initialized wd14 tagger
Initializing orientation tagger
Initializing OrientationTagger on device: mps
Loading orientation model: LucyintheSky/pose-estimation-front-side-back
Orientation model loaded successfully on cpu
Successfully initialized orientation tagger
Initializing caption tagger
Initializing CaptionTagger on device: mps
Loading BLIP2 model: Salesforce/blip2-opt-2.7b
BLIP2 model loaded successfully on cpu
Successfully initialized caption tagger
TaggerPipeline initialization complete
Tagger pipeline initialized successfully
Initializing YOLO detector...
Initializing YOLO detector
Loading YOLO model from /Users/rob/.cache/ultralytics/yolov8n.pt
YOLO model loaded successfully
Loading YOLO face model from /Users/rob/.cache/ultralytics/yolov8n-face.pt
YOLO face model loaded successfully
YOLODetector initialized with 1 active classes
YOLO detector initialized successfully
Model registry initialization complete
Model registry initialized successfully
[green]BatchProcessor initialized successfully[/]
[green]Starting batch processing[/]
Starting batch processing
Starting batch: 20180312_Photoshoot2
Starting batch processing for 20180312_Photoshoot2 with 9 images
Starting processing for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3136.png
Starting processing for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3320.png
Starting processing for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3297.png
Running detection on /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3136.png
Running detection on /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3297.png
Running detection on /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3320.png
Fusing face model...
Fusing face model...
Fusing face model...
Model fusion failed for face model: 'Conv' object has no attribute 'bn'
Continuing with unfused model
Model fusion failed for face model: 'Conv' object has no attribute 'bn'
Continuing with unfused model
Face Model fused successfully
Fusing main model...
Main Model fused successfully
Detection complete. Found 2 total regions
Found 2 detections in /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3136.png
Starting crop processing for face from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3136.png
Starting crop processing for person from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3136.png
Detection complete. Found 2 total regions
Found 2 detections in /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3297.png
Starting crop processing for face from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3297.png
Starting crop processing for person from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3297.png
Running taggers for face crop
Running orientation tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_3136_face_crop.png
Running taggers for person crop
Detection complete. Found 2 total regions
Running caption tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_3136_person_crop.png
Running wd14 tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_3136_person_crop.png
WD14 tagging failed: argument of type 'NoneType' is not iterable
Running orientation tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_3136_person_crop.png
Running taggers for face crop
Running taggers for person crop
Found 2 detections in /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3320.png
Running orientation tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_3297_face_crop.png
Running caption tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_3297_person_crop.png
Cleaning up model registry
Starting model registry cleanup
Model registry cleanup complete
Model registry cleanup complete
[blue]Pipeline test complete[/]
[yellow]Pipeline test interrupted by user[/]
[blue]Starting pipeline test[/]
Input directory: [cyan]/Users/rob/repos/kalliste/test_images_input[/]
Output directory: [cyan]/Users/rob/repos/kalliste/test_images_output[/]
[green]Initializing BatchProcessor[/]
Initializing BatchProcessor with input_root=/Users/rob/repos/kalliste/test_images_input, output_root=/Users/rob/repos/kalliste/test_images_output
Scanning for batches in /Users/rob/repos/kalliste/test_images_input
Initializing Batch with input_path=/Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2, max_concurrent=3
Scanning for images in /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2
Found 9 images to process in batch 20180312_Photoshoot2
Initializing Batch with input_path=/Users/rob/repos/kalliste/test_images_input/20241012_Photoshoot1, max_concurrent=3
Scanning for images in /Users/rob/repos/kalliste/test_images_input/20241012_Photoshoot1
Found 12 images to process in batch 20241012_Photoshoot1
Found 2 batches to process
BatchProcessor created
Initializing models
Initializing model registry
Starting model registry initialization
Initializing tagger pipeline...
Creating TaggerPipeline instance
MPS device validated
TaggerPipeline created with device: mps
Starting TaggerPipeline initialization
Initializing caption tagger
Initializing CaptionTagger on device: mps
Loading BLIP2 model: Salesforce/blip2-opt-2.7b
BLIP2 model loaded successfully on cpu
Successfully initialized caption tagger
Initializing wd14 tagger
Initializing WD14Tagger on device: mps
Tags file absolute path: /Users/rob/repos/kalliste/weights/wd14/selected_tags.csv
Tags file exists: True
Tags file header: tag_id,name,category,count

Loaded 10861 tags
Columns: ['tag_id', 'name', 'category', 'count']
Successfully initialized wd14 tagger
Initializing orientation tagger
Initializing OrientationTagger on device: mps
Loading orientation model: LucyintheSky/pose-estimation-front-side-back
Orientation model loaded successfully on cpu
Successfully initialized orientation tagger
TaggerPipeline initialization complete
Tagger pipeline initialized successfully
Initializing YOLO detector...
Initializing YOLO detector
Loading YOLO model from /Users/rob/.cache/ultralytics/yolov8n.pt
YOLO model loaded successfully
Loading YOLO face model from /Users/rob/.cache/ultralytics/yolov8n-face.pt
YOLO face model loaded successfully
YOLODetector initialized with 1 active classes
YOLO detector initialized successfully
Model registry initialization complete
Model registry initialized successfully
[green]BatchProcessor initialized successfully[/]
[green]Starting batch processing[/]
Starting batch processing
Starting batch: 20180312_Photoshoot2
Starting batch processing for 20180312_Photoshoot2 with 9 images
Starting processing for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3136.png
Starting processing for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3320.png
Starting processing for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3297.png
Running detection on /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3297.png
Running detection on /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3320.png
Running detection on /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3136.png
Fusing face model...
Fusing face model...
Fusing face model...
Model fusion failed for face model: 'Conv' object has no attribute 'bn'
Continuing with unfused model
Model fusion failed for face model: 'Conv' object has no attribute 'bn'
Continuing with unfused model
Face Model fused successfully
Fusing main model...
Main Model fused successfully
Detection complete. Found 2 total regions
Found 2 detections in /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3136.png
Starting crop processing for face from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3136.png
Starting crop processing for person from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3136.png
Detection complete. Found 2 total regions
Found 2 detections in /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3297.png
Starting crop processing for face from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3297.png
Starting crop processing for person from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3297.png
Running taggers for face crop
Running orientation tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_3136_face_crop.png
Running taggers for person crop
Detection complete. Found 2 total regions
Running caption tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_3136_person_crop.png
Running wd14 tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_3136_person_crop.png
WD14 tagging failed: 'NoneType' object is not callable
Running orientation tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_3136_person_crop.png
Running taggers for face crop
Running taggers for person crop
Found 2 detections in /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3320.png
Running orientation tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_3297_face_crop.png
Running caption tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_3297_person_crop.png
Running wd14 tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_3297_person_crop.png
WD14 tagging failed: 'NoneType' object is not callable
Running orientation tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_3297_person_crop.png
Starting crop processing for face from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3320.png
Starting crop processing for person from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3320.png
ExifTool error while injecting tags: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.

Error injecting Kalliste tags: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 240, in inject_kalliste_tags
    raise RuntimeError(f"Tag injection failed: {error_msg}")
RuntimeError: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.

Error processing crop from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3136.png: Tag injection failed: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 240, in inject_kalliste_tags
    raise RuntimeError(f"Tag injection failed: {error_msg}")
RuntimeError: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 40, in process
    await self.inject_kalliste_tags()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 246, in inject_kalliste_tags
    raise RuntimeError(f"Tag injection failed: {e}") from e
RuntimeError: Tag injection failed: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.

Error processing crops for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3136.png: Crop processing failed: Tag injection failed: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 240, in inject_kalliste_tags
    raise RuntimeError(f"Tag injection failed: {error_msg}")
RuntimeError: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 40, in process
    await self.inject_kalliste_tags()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 246, in inject_kalliste_tags
    raise RuntimeError(f"Tag injection failed: {e}") from e
RuntimeError: Tag injection failed: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 66, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 50, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: Tag injection failed: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.

Error processing /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3136.png: Crop processing failed: Tag injection failed: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 240, in inject_kalliste_tags
    raise RuntimeError(f"Tag injection failed: {error_msg}")
RuntimeError: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 40, in process
    await self.inject_kalliste_tags()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 246, in inject_kalliste_tags
    raise RuntimeError(f"Tag injection failed: {e}") from e
RuntimeError: Tag injection failed: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 66, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 50, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: Tag injection failed: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.

Failed to process IMG_3136.png
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 240, in inject_kalliste_tags
    raise RuntimeError(f"Tag injection failed: {error_msg}")
RuntimeError: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 40, in process
    await self.inject_kalliste_tags()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 246, in inject_kalliste_tags
    raise RuntimeError(f"Tag injection failed: {e}") from e
RuntimeError: Tag injection failed: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 44, in process_image
    return await image.process()
           ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 66, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 50, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: Tag injection failed: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.

Starting processing for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3152.png
Running detection on /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3152.png
ExifTool error while injecting tags: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.

Error injecting Kalliste tags: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 240, in inject_kalliste_tags
    raise RuntimeError(f"Tag injection failed: {error_msg}")
RuntimeError: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.

Error processing crop from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3297.png: Tag injection failed: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 240, in inject_kalliste_tags
    raise RuntimeError(f"Tag injection failed: {error_msg}")
RuntimeError: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 40, in process
    await self.inject_kalliste_tags()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 246, in inject_kalliste_tags
    raise RuntimeError(f"Tag injection failed: {e}") from e
RuntimeError: Tag injection failed: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.

Error processing crops for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3297.png: Crop processing failed: Tag injection failed: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 240, in inject_kalliste_tags
    raise RuntimeError(f"Tag injection failed: {error_msg}")
RuntimeError: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 40, in process
    await self.inject_kalliste_tags()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 246, in inject_kalliste_tags
    raise RuntimeError(f"Tag injection failed: {e}") from e
RuntimeError: Tag injection failed: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 66, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 50, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: Tag injection failed: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.

Error processing /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3297.png: Crop processing failed: Tag injection failed: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 240, in inject_kalliste_tags
    raise RuntimeError(f"Tag injection failed: {error_msg}")
RuntimeError: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 40, in process
    await self.inject_kalliste_tags()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 246, in inject_kalliste_tags
    raise RuntimeError(f"Tag injection failed: {e}") from e
RuntimeError: Tag injection failed: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 66, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 50, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: Tag injection failed: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.

Failed to process IMG_3297.png
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 240, in inject_kalliste_tags
    raise RuntimeError(f"Tag injection failed: {error_msg}")
RuntimeError: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 40, in process
    await self.inject_kalliste_tags()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 246, in inject_kalliste_tags
    raise RuntimeError(f"Tag injection failed: {e}") from e
RuntimeError: Tag injection failed: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 44, in process_image
    return await image.process()
           ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 66, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 50, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: Tag injection failed: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.

Starting processing for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A9668.png
Running detection on /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A9668.png
Running taggers for face crop
Running orientation tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_3320_face_crop.png
Running taggers for person crop
Detection complete. Found 2 total regions
Detection complete. Found 2 total regions
Running caption tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_3320_person_crop.png
Cleaning up model registry
Starting model registry cleanup
Model registry cleanup complete
Model registry cleanup complete
[blue]Pipeline test complete[/]
[yellow]Pipeline test interrupted by user[/]
[blue]Starting pipeline test[/]
Input directory: [cyan]/Users/rob/repos/kalliste/test_images_input[/]
Output directory: [cyan]/Users/rob/repos/kalliste/test_images_output[/]
[green]Initializing BatchProcessor[/]
Initializing BatchProcessor with input_root=/Users/rob/repos/kalliste/test_images_input, output_root=/Users/rob/repos/kalliste/test_images_output
Scanning for batches in /Users/rob/repos/kalliste/test_images_input
Initializing Batch with input_path=/Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2, max_concurrent=3
Scanning for images in /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2
Found 9 images to process in batch 20180312_Photoshoot2
Initializing Batch with input_path=/Users/rob/repos/kalliste/test_images_input/20241012_Photoshoot1, max_concurrent=3
Scanning for images in /Users/rob/repos/kalliste/test_images_input/20241012_Photoshoot1
Found 12 images to process in batch 20241012_Photoshoot1
Found 2 batches to process
BatchProcessor created
Initializing models
Initializing model registry
Starting model registry initialization
Initializing tagger pipeline...
Creating TaggerPipeline instance
MPS device validated
TaggerPipeline created with device: mps
Starting TaggerPipeline initialization
Initializing orientation tagger
Initializing OrientationTagger on device: mps
Loading orientation model: LucyintheSky/pose-estimation-front-side-back
Orientation model loaded successfully on cpu
Successfully initialized orientation tagger
Initializing caption tagger
Initializing CaptionTagger on device: mps
Loading BLIP2 model: Salesforce/blip2-opt-2.7b
BLIP2 model loaded successfully on cpu
Successfully initialized caption tagger
Initializing wd14 tagger
Initializing WD14Tagger on device: mps
Tags file absolute path: /Users/rob/repos/kalliste/weights/wd14/selected_tags.csv
Tags file exists: True
Tags file header: tag_id,name,category,count

Loaded 10861 tags
Columns: ['tag_id', 'name', 'category', 'count']
Successfully initialized wd14 tagger
TaggerPipeline initialization complete
Tagger pipeline initialized successfully
Initializing YOLO detector...
Initializing YOLO detector
Loading YOLO model from /Users/rob/.cache/ultralytics/yolov8n.pt
YOLO model loaded successfully
Loading YOLO face model from /Users/rob/.cache/ultralytics/yolov8n-face.pt
YOLO face model loaded successfully
YOLODetector initialized with 1 active classes
YOLO detector initialized successfully
Model registry initialization complete
Model registry initialized successfully
[green]BatchProcessor initialized successfully[/]
[green]Starting batch processing[/]
Starting batch processing
Starting batch: 20180312_Photoshoot2
Starting batch processing for 20180312_Photoshoot2 with 9 images
Starting processing for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3136.png
Starting processing for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3320.png
Starting processing for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3297.png
Running detection on /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3136.png
Running detection on /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3320.png
Running detection on /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3297.png
Fusing face model...
Fusing face model...
Fusing face model...
Model fusion failed for face model: 'Conv' object has no attribute 'bn'
Continuing with unfused model
Model fusion failed for face model: 'Conv' object has no attribute 'bn'
Continuing with unfused model
Face Model fused successfully
Fusing main model...
Main Model fused successfully
Detection complete. Found 2 total regions
Found 2 detections in /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3297.png
Starting crop processing for face from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3297.png
Starting crop processing for person from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3297.png
Running taggers for face crop
Running orientation tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_3297_face_crop.png
Detection complete. Found 2 total regions
Running taggers for person crop
Detection complete. Found 2 total regions
Running caption tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_3297_person_crop.png
Running wd14 tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_3297_person_crop.png
WD14 tagging failed: 'NoneType' object is not callable
Running orientation tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_3297_person_crop.png
Found 2 detections in /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3136.png
Found 2 detections in /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3320.png
Starting crop processing for face from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3136.png
Starting crop processing for person from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3136.png
Starting crop processing for face from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3320.png
Starting crop processing for person from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3320.png
Running taggers for face crop
Running orientation tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_3320_face_crop.png
Running taggers for person crop
Cleaning up model registry
Starting model registry cleanup
Model registry cleanup complete
Model registry cleanup complete
[blue]Pipeline test complete[/]
[yellow]Pipeline test interrupted by user[/]
[blue]Starting pipeline test[/]
Input directory: [cyan]/Users/rob/repos/kalliste/test_images_input[/]
Output directory: [cyan]/Users/rob/repos/kalliste/test_images_output[/]
[green]Initializing BatchProcessor[/]
Initializing BatchProcessor with input_root=/Users/rob/repos/kalliste/test_images_input, output_root=/Users/rob/repos/kalliste/test_images_output
Scanning for batches in /Users/rob/repos/kalliste/test_images_input
Initializing Batch with input_path=/Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2, max_concurrent=3
Scanning for images in /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2
Found 9 images to process in batch 20180312_Photoshoot2
Initializing Batch with input_path=/Users/rob/repos/kalliste/test_images_input/20241012_Photoshoot1, max_concurrent=3
Scanning for images in /Users/rob/repos/kalliste/test_images_input/20241012_Photoshoot1
Found 12 images to process in batch 20241012_Photoshoot1
Found 2 batches to process
BatchProcessor created
Initializing models
Initializing model registry
Starting model registry initialization
Initializing tagger pipeline...
Creating TaggerPipeline instance
MPS device validated
TaggerPipeline created with device: mps
Starting TaggerPipeline initialization
Initializing orientation tagger
Initializing OrientationTagger on device: mps
Loading orientation model: LucyintheSky/pose-estimation-front-side-back
Orientation model loaded successfully on cpu
Successfully initialized orientation tagger
Initializing caption tagger
Initializing CaptionTagger on device: mps
Loading BLIP2 model: Salesforce/blip2-opt-2.7b
BLIP2 model loaded successfully on cpu
Successfully initialized caption tagger
Initializing wd14 tagger
Initializing WD14Tagger on device: mps
Tags file absolute path: /Users/rob/repos/kalliste/weights/wd14/selected_tags.csv
Tags file exists: True
Tags file header: tag_id,name,category,count

Loaded 10861 tags
Columns: ['tag_id', 'name', 'category', 'count']
Successfully initialized wd14 tagger
TaggerPipeline initialization complete
Tagger pipeline initialized successfully
Initializing YOLO detector...
Initializing YOLO detector
Loading YOLO model from /Users/rob/.cache/ultralytics/yolov8n.pt
YOLO model loaded successfully
Loading YOLO face model from /Users/rob/.cache/ultralytics/yolov8n-face.pt
YOLO face model loaded successfully
YOLODetector initialized with 1 active classes
YOLO detector initialized successfully
Model registry initialization complete
Model registry initialized successfully
[green]BatchProcessor initialized successfully[/]
[green]Starting batch processing[/]
Starting batch processing
Starting batch: 20180312_Photoshoot2
Starting batch processing for 20180312_Photoshoot2 with 9 images
Starting processing for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3136.png
Starting processing for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3320.png
Starting processing for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3297.png
Running detection on /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3136.png
Running detection on /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3320.png
Running detection on /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3297.png
Fusing face model...
Fusing face model...
Fusing face model...
Model fusion failed for face model: 'Conv' object has no attribute 'bn'
Continuing with unfused model
Model fusion failed for face model: 'Conv' object has no attribute 'bn'
Continuing with unfused model
Face Model fused successfully
Fusing main model...
Main Model fused successfully
Detection complete. Found 2 total regions
Found 2 detections in /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3320.png
Starting crop processing for face from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3320.png
Starting crop processing for person from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3320.png
Running taggers for face crop
Detection complete. Found 2 total regions
Running orientation tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_3320_face_crop.png
Running taggers for person crop
Detection complete. Found 2 total regions
Found 2 detections in /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3136.png
Running caption tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_3320_person_crop.png
Running wd14 tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_3320_person_crop.png
WD14 tagging failed at step: 'NoneType' object is not callable
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/taggers/wd14_tagger.py", line 133, in tag_image
    img_tensor = self._preprocess_image(image)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/taggers/wd14_tagger.py", line 95, in _preprocess_image
    img_tensor = self.transform(image)
                 ^^^^^^^^^^^^^^^^^^^^^
TypeError: 'NoneType' object is not callable
Error in wd14 tagger: 'NoneType' object is not callable
Running orientation tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_3320_person_crop.png
Starting crop processing for face from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3136.png
Starting crop processing for person from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3136.png
Found 2 detections in /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3297.png
Starting crop processing for face from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3297.png
Starting crop processing for person from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3297.png
Tagger wd14 failed: 'NoneType' object is not callable
Running taggers for face crop
Running orientation tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_3297_face_crop.png
Running taggers for person crop
Running caption tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_3297_person_crop.png
Cleaning up model registry
Starting model registry cleanup
Model registry cleanup complete
Model registry cleanup complete
[blue]Pipeline test complete[/]
[yellow]Pipeline test interrupted by user[/]
[blue]Starting pipeline test[/]
Input directory: [cyan]/Users/rob/repos/kalliste/test_images_input[/]
Output directory: [cyan]/Users/rob/repos/kalliste/test_images_output[/]
[green]Initializing BatchProcessor[/]
Initializing BatchProcessor with input_root=/Users/rob/repos/kalliste/test_images_input, output_root=/Users/rob/repos/kalliste/test_images_output
Scanning for batches in /Users/rob/repos/kalliste/test_images_input
Initializing Batch with input_path=/Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2, max_concurrent=3
Scanning for images in /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2
Found 9 images to process in batch 20180312_Photoshoot2
Initializing Batch with input_path=/Users/rob/repos/kalliste/test_images_input/20241012_Photoshoot1, max_concurrent=3
Scanning for images in /Users/rob/repos/kalliste/test_images_input/20241012_Photoshoot1
Found 12 images to process in batch 20241012_Photoshoot1
Found 2 batches to process
BatchProcessor created
Initializing models
Initializing model registry
Starting model registry initialization
Initializing tagger pipeline...
Creating TaggerPipeline instance
MPS device validated
TaggerPipeline created with device: mps
Starting TaggerPipeline initialization
Initializing caption tagger
Initializing CaptionTagger on device: mps
Successfully initialized caption tagger
Initializing wd14 tagger
Initializing WD14Tagger on device: mps
Successfully initialized wd14 tagger
Initializing orientation tagger
Initializing OrientationTagger on device: mps
Successfully initialized orientation tagger
TaggerPipeline initialization complete
Tagger pipeline initialized successfully
Initializing YOLO detector...
Initializing YOLO detector
Loading YOLO model from /Users/rob/.cache/ultralytics/yolov8n.pt
YOLO model loaded successfully
Loading YOLO face model from /Users/rob/.cache/ultralytics/yolov8n-face.pt
YOLO face model loaded successfully
YOLODetector initialized with 1 active classes
YOLO detector initialized successfully
Model registry initialization complete
Model registry initialized successfully
[green]BatchProcessor initialized successfully[/]
[green]Starting batch processing[/]
Starting batch processing
Starting batch: 20180312_Photoshoot2
Starting batch processing for 20180312_Photoshoot2 with 9 images
Starting processing for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3136.png
Starting processing for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3320.png
Starting processing for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3297.png
Running detection on /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3297.png
Running detection on /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3136.png
Fusing face model...
Fusing face model...
Running detection on /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3320.png
Fusing face model...
Model fusion failed for face model: 'Conv' object has no attribute 'bn'
Continuing with unfused model
Model fusion failed for face model: 'Conv' object has no attribute 'bn'
Continuing with unfused model
Face Model fused successfully
Fusing main model...
Main Model fused successfully
Detection complete. Found 2 total regions
Found 2 detections in /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3297.png
Starting crop processing for face from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3297.png
Starting crop processing for person from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3297.png
Running taggers for face crop
Running orientation tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_3297_face_crop.png
Error in orientation tagger: Orientation tagger not properly initialized
Running taggers for person crop
Detection complete. Found 2 total regions
Detection complete. Found 2 total regions
Running caption tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_3297_person_crop.png
Error in caption tagger: Caption tagger not properly initialized
Running wd14 tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_3297_person_crop.png
Error in wd14 tagger: WD14 tagger not properly initialized
Running orientation tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_3297_person_crop.png
Error in orientation tagger: Orientation tagger not properly initialized
Tagger orientation failed: Orientation tagger not properly initialized
Found 2 detections in /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3320.png
Found 2 detections in /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3136.png
Starting crop processing for face from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3320.png
Starting crop processing for person from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3320.png
Starting crop processing for face from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3136.png
Starting crop processing for person from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3136.png
Tagger caption failed: Caption tagger not properly initialized
Tagger wd14 failed: WD14 tagger not properly initialized
Tagger orientation failed: Orientation tagger not properly initialized
Running taggers for person crop
Running caption tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_3320_person_crop.png
Error in caption tagger: Caption tagger not properly initialized
Running wd14 tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_3320_person_crop.png
Error in wd14 tagger: WD14 tagger not properly initialized
Running orientation tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_3320_person_crop.png
Error in orientation tagger: Orientation tagger not properly initialized
Running taggers for face crop
Running taggers for face crop
Running taggers for person crop
[yellow]Pipeline test interrupted by user[/]
Cleaning up model registry
Starting model registry cleanup
Model registry cleanup complete
Model registry cleanup complete
[blue]Pipeline test complete[/]
Task was destroyed but it is pending!
task: <Task cancelling name='Task-1' coro=<main() done, defined at /Users/rob/repos/kalliste/scripts/test_pipeline.py:33> wait_for=<_GatheringFuture pending cb=[Task.task_wakeup()]> cb=[gather.<locals>._done_callback() at /opt/miniconda3/envs/kalliste/lib/python3.11/asyncio/tasks.py:764]>
[blue]Starting pipeline test[/]
Input directory: [cyan]/Users/rob/repos/kalliste/test_images_input[/]
Output directory: [cyan]/Users/rob/repos/kalliste/test_images_output[/]
[green]Initializing BatchProcessor[/]
Initializing BatchProcessor with input_root=/Users/rob/repos/kalliste/test_images_input, output_root=/Users/rob/repos/kalliste/test_images_output
Scanning for batches in /Users/rob/repos/kalliste/test_images_input
Initializing Batch with input_path=/Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2, max_concurrent=3
Scanning for images in /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2
Found 9 images to process in batch 20180312_Photoshoot2
Initializing Batch with input_path=/Users/rob/repos/kalliste/test_images_input/20241012_Photoshoot1, max_concurrent=3
Scanning for images in /Users/rob/repos/kalliste/test_images_input/20241012_Photoshoot1
Found 12 images to process in batch 20241012_Photoshoot1
Found 2 batches to process
BatchProcessor created
Initializing models
Initializing BatchProcessor and model registry
Starting model registry initialization
Initializing tagger pipeline...
Creating TaggerPipeline instance
MPS device validated
TaggerPipeline created with device: mps
Starting TaggerPipeline initialization
Initializing caption tagger
Initializing CaptionTagger on device: mps
Successfully initialized caption tagger
Initializing orientation tagger
Initializing OrientationTagger on device: mps
Successfully initialized orientation tagger
Initializing wd14 tagger
Initializing WD14Tagger on device: mps
Successfully initialized wd14 tagger
TaggerPipeline initialization complete
Tagger pipeline initialized successfully
Initializing YOLO detector...
Initializing YOLO detector
Loading YOLO model from /Users/rob/.cache/ultralytics/yolov8n.pt
YOLO model loaded successfully
Loading YOLO face model from /Users/rob/.cache/ultralytics/yolov8n-face.pt
YOLO face model loaded successfully
YOLODetector initialized with 1 active classes
YOLO detector initialized successfully
Model registry initialization complete
BatchProcessor and model registry initialized successfully
[green]BatchProcessor initialized successfully[/]
[green]Starting batch processing[/]
BatchProcessor already initialized
Starting batch processing
Starting batch: 20180312_Photoshoot2
Starting batch processing for 20180312_Photoshoot2 with 9 images
Starting processing for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3136.png
Starting processing for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3320.png
Starting processing for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3297.png
Running detection on /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3297.png
Running detection on /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3136.png
Running detection on /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3320.png
Fusing face model...
Fusing face model...
Fusing face model...
Model fusion failed for face model: 'Conv' object has no attribute 'bn'
Continuing with unfused model
Model fusion failed for face model: 'Conv' object has no attribute 'bn'
Continuing with unfused model
Face Model fused successfully
Fusing main model...
Main Model fused successfully
Detection complete. Found 2 total regions
Found 2 detections in /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3320.png
Starting crop processing for face from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3320.png
Starting crop processing for person from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3320.png
Detection complete. Found 2 total regions
Found 2 detections in /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3297.png
Starting crop processing for face from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3297.png
Starting crop processing for person from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3297.png
Running taggers for face crop
Running orientation tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_3320_face_crop.png
Error in orientation tagger: Orientation tagger not properly initialized
Running taggers for person crop
Detection complete. Found 2 total regions
Running caption tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_3320_person_crop.png
Error in caption tagger: Caption tagger not properly initialized
Running orientation tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_3320_person_crop.png
Error in orientation tagger: Orientation tagger not properly initialized
Running wd14 tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_3320_person_crop.png
Error in wd14 tagger: WD14 tagger not properly initialized
Tagger orientation failed: Orientation tagger not properly initialized
Running taggers for face crop
Running taggers for person crop
Found 2 detections in /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3136.png
Running orientation tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_3297_face_crop.png
Error in orientation tagger: Orientation tagger not properly initialized
Running caption tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_3297_person_crop.png
Error in caption tagger: Caption tagger not properly initialized
Running orientation tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_3297_person_crop.png
Error in orientation tagger: Orientation tagger not properly initialized
Running wd14 tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_3297_person_crop.png
Error in wd14 tagger: WD14 tagger not properly initialized
Starting crop processing for face from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3136.png
Starting crop processing for person from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3136.png
Tagger caption failed: Caption tagger not properly initialized
Tagger orientation failed: Orientation tagger not properly initialized
Tagger wd14 failed: WD14 tagger not properly initialized
Tagger orientation failed: Orientation tagger not properly initialized
Tagger caption failed: Caption tagger not properly initialized
Tagger orientation failed: Orientation tagger not properly initialized
Tagger wd14 failed: WD14 tagger not properly initialized
ExifTool error while injecting tags: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.

Error injecting Kalliste tags: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 240, in inject_kalliste_tags
    raise RuntimeError(f"Tag injection failed: {error_msg}")
RuntimeError: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.

Error processing crop from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3320.png: Tag injection failed: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 240, in inject_kalliste_tags
    raise RuntimeError(f"Tag injection failed: {error_msg}")
RuntimeError: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 40, in process
    await self.inject_kalliste_tags()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 246, in inject_kalliste_tags
    raise RuntimeError(f"Tag injection failed: {e}") from e
RuntimeError: Tag injection failed: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.

Error processing crops for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3320.png: Crop processing failed: Tag injection failed: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 240, in inject_kalliste_tags
    raise RuntimeError(f"Tag injection failed: {error_msg}")
RuntimeError: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 40, in process
    await self.inject_kalliste_tags()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 246, in inject_kalliste_tags
    raise RuntimeError(f"Tag injection failed: {e}") from e
RuntimeError: Tag injection failed: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 66, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 50, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: Tag injection failed: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.

Error processing /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3320.png: Crop processing failed: Tag injection failed: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 240, in inject_kalliste_tags
    raise RuntimeError(f"Tag injection failed: {error_msg}")
RuntimeError: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 40, in process
    await self.inject_kalliste_tags()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 246, in inject_kalliste_tags
    raise RuntimeError(f"Tag injection failed: {e}") from e
RuntimeError: Tag injection failed: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 66, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 50, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: Tag injection failed: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.

Failed to process IMG_3320.png
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 240, in inject_kalliste_tags
    raise RuntimeError(f"Tag injection failed: {error_msg}")
RuntimeError: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 40, in process
    await self.inject_kalliste_tags()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 246, in inject_kalliste_tags
    raise RuntimeError(f"Tag injection failed: {e}") from e
RuntimeError: Tag injection failed: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 44, in process_image
    return await image.process()
           ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 66, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 50, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: Tag injection failed: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.

Starting processing for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3152.png
Running detection on /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3152.png
ExifTool error while injecting tags: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.

Error injecting Kalliste tags: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 240, in inject_kalliste_tags
    raise RuntimeError(f"Tag injection failed: {error_msg}")
RuntimeError: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.

Error processing crop from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3297.png: Tag injection failed: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 240, in inject_kalliste_tags
    raise RuntimeError(f"Tag injection failed: {error_msg}")
RuntimeError: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 40, in process
    await self.inject_kalliste_tags()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 246, in inject_kalliste_tags
    raise RuntimeError(f"Tag injection failed: {e}") from e
RuntimeError: Tag injection failed: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.

Error processing crops for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3297.png: Crop processing failed: Tag injection failed: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 240, in inject_kalliste_tags
    raise RuntimeError(f"Tag injection failed: {error_msg}")
RuntimeError: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 40, in process
    await self.inject_kalliste_tags()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 246, in inject_kalliste_tags
    raise RuntimeError(f"Tag injection failed: {e}") from e
RuntimeError: Tag injection failed: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 66, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 50, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: Tag injection failed: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.

Error processing /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3297.png: Crop processing failed: Tag injection failed: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 240, in inject_kalliste_tags
    raise RuntimeError(f"Tag injection failed: {error_msg}")
RuntimeError: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 40, in process
    await self.inject_kalliste_tags()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 246, in inject_kalliste_tags
    raise RuntimeError(f"Tag injection failed: {e}") from e
RuntimeError: Tag injection failed: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 66, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 50, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: Tag injection failed: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.

Failed to process IMG_3297.png
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 240, in inject_kalliste_tags
    raise RuntimeError(f"Tag injection failed: {error_msg}")
RuntimeError: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 40, in process
    await self.inject_kalliste_tags()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 246, in inject_kalliste_tags
    raise RuntimeError(f"Tag injection failed: {e}") from e
RuntimeError: Tag injection failed: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 44, in process_image
    return await image.process()
           ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 66, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 50, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: Tag injection failed: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.

Starting processing for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A9668.png
Running detection on /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A9668.png
Running taggers for face crop
Running orientation tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_3136_face_crop.png
Error in orientation tagger: Orientation tagger not properly initialized
Running taggers for person crop
Detection complete. Found 2 total regions
Detection complete. Found 2 total regions
Running caption tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_3136_person_crop.png
Error in caption tagger: Caption tagger not properly initialized
Running orientation tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_3136_person_crop.png
Error in orientation tagger: Orientation tagger not properly initialized
Running wd14 tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_3136_person_crop.png
Error in wd14 tagger: WD14 tagger not properly initialized
Tagger orientation failed: Orientation tagger not properly initialized
Found 2 detections in /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3152.png
Found 2 detections in /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A9668.png
Starting crop processing for face from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3152.png
Starting crop processing for person from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3152.png
Starting crop processing for face from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A9668.png
Starting crop processing for person from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A9668.png
Tagger caption failed: Caption tagger not properly initialized
Tagger orientation failed: Orientation tagger not properly initialized
Tagger wd14 failed: WD14 tagger not properly initialized
ExifTool error while injecting tags: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.

Error injecting Kalliste tags: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 240, in inject_kalliste_tags
    raise RuntimeError(f"Tag injection failed: {error_msg}")
RuntimeError: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.

Error processing crop from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3297.png: Tag injection failed: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 240, in inject_kalliste_tags
    raise RuntimeError(f"Tag injection failed: {error_msg}")
RuntimeError: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 40, in process
    await self.inject_kalliste_tags()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 246, in inject_kalliste_tags
    raise RuntimeError(f"Tag injection failed: {e}") from e
RuntimeError: Tag injection failed: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.

ExifTool error while injecting tags: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.

Error injecting Kalliste tags: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 240, in inject_kalliste_tags
    raise RuntimeError(f"Tag injection failed: {error_msg}")
RuntimeError: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.

Error processing crop from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3320.png: Tag injection failed: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 240, in inject_kalliste_tags
    raise RuntimeError(f"Tag injection failed: {error_msg}")
RuntimeError: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 40, in process
    await self.inject_kalliste_tags()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 246, in inject_kalliste_tags
    raise RuntimeError(f"Tag injection failed: {e}") from e
RuntimeError: Tag injection failed: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.

Running taggers for face crop
Running orientation tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_3152_face_crop.png
Error in orientation tagger: Orientation tagger not properly initialized
Running taggers for person crop
Running caption tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_3152_person_crop.png
Error in caption tagger: Caption tagger not properly initialized
Running orientation tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_3152_person_crop.png
Error in orientation tagger: Orientation tagger not properly initialized
Running wd14 tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_3152_person_crop.png
Error in wd14 tagger: WD14 tagger not properly initialized
Tagger orientation failed: Orientation tagger not properly initialized
Running taggers for face crop
[yellow]Pipeline test interrupted by user[/]
Cleaning up model registry
Starting model registry cleanup
Model registry cleanup complete
Model registry cleanup complete
[blue]Pipeline test complete[/]
Task was destroyed but it is pending!
task: <Task cancelling name='Task-1' coro=<main() done, defined at /Users/rob/repos/kalliste/scripts/test_pipeline.py:33> wait_for=<_GatheringFuture pending cb=[Task.task_wakeup()]> cb=[gather.<locals>._done_callback() at /opt/miniconda3/envs/kalliste/lib/python3.11/asyncio/tasks.py:764]>
[blue]Starting pipeline test[/]
Input directory: [cyan]/Users/rob/repos/kalliste/test_images_input[/]
Output directory: [cyan]/Users/rob/repos/kalliste/test_images_output[/]
[green]Initializing BatchProcessor[/]
Initializing BatchProcessor with input_root=/Users/rob/repos/kalliste/test_images_input, output_root=/Users/rob/repos/kalliste/test_images_output
Scanning for batches in /Users/rob/repos/kalliste/test_images_input
Initializing Batch with input_path=/Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2, max_concurrent=3
Scanning for images in /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2
Found 9 images to process in batch 20180312_Photoshoot2
Initializing Batch with input_path=/Users/rob/repos/kalliste/test_images_input/20241012_Photoshoot1, max_concurrent=3
Scanning for images in /Users/rob/repos/kalliste/test_images_input/20241012_Photoshoot1
Found 12 images to process in batch 20241012_Photoshoot1
Found 2 batches to process
BatchProcessor created
Initializing models
Initializing BatchProcessor and model registry
Starting model registry initialization
Initializing tagger pipeline...
Creating TaggerPipeline instance
MPS device validated
TaggerPipeline created with device: mps
Starting TaggerPipeline initialization
Initializing caption tagger
Initializing CaptionTagger on device: mps
Successfully initialized caption tagger
Initializing orientation tagger
Initializing OrientationTagger on device: mps
Successfully initialized orientation tagger
Initializing wd14 tagger
Initializing WD14Tagger on device: mps
Successfully initialized wd14 tagger
TaggerPipeline initialization complete
Tagger pipeline initialized successfully
Initializing YOLO detector...
Initializing YOLO detector
Loading YOLO model from /Users/rob/.cache/ultralytics/yolov8n.pt
YOLO model loaded successfully
Loading YOLO face model from /Users/rob/.cache/ultralytics/yolov8n-face.pt
YOLO face model loaded successfully
YOLODetector initialized with 1 active classes
YOLO detector initialized successfully
Model registry initialization complete
BatchProcessor and model registry initialized successfully
[green]BatchProcessor initialized successfully[/]
[green]Starting batch processing[/]
BatchProcessor already initialized
Starting batch processing
Starting batch: 20180312_Photoshoot2
Starting batch processing for 20180312_Photoshoot2 with 9 images
Starting processing for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3136.png
Starting processing for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3320.png
Starting processing for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3297.png
Running detection on /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3297.png
Running detection on /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3136.png
Running detection on /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3320.png
Fusing face model...
Fusing face model...
Fusing face model...
Model fusion failed for face model: 'Conv' object has no attribute 'bn'
Continuing with unfused model
Model fusion failed for face model: 'Conv' object has no attribute 'bn'
Continuing with unfused model
Face Model fused successfully
Fusing main model...
Main Model fused successfully
Detection complete. Found 2 total regions
Found 2 detections in /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3320.png
Starting crop processing for face from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3320.png
Starting crop processing for person from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3320.png
Cleaning up model registry
Starting model registry cleanup
Model registry cleanup complete
Model registry cleanup complete
[blue]Pipeline test complete[/]
Detection complete. Found 2 total regions
[yellow]Pipeline test interrupted by user[/]
Detection complete. Found 2 total regions
[blue]Starting pipeline test[/]
Input directory: [cyan]/Users/rob/repos/kalliste/test_images_input[/]
Output directory: [cyan]/Users/rob/repos/kalliste/test_images_output[/]
[green]Initializing BatchProcessor[/]
Initializing BatchProcessor with input_root=/Users/rob/repos/kalliste/test_images_input, output_root=/Users/rob/repos/kalliste/test_images_output
Scanning for batches in /Users/rob/repos/kalliste/test_images_input
Initializing Batch with input_path=/Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2, max_concurrent=3
Scanning for images in /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2
Found 9 images to process in batch 20180312_Photoshoot2
Initializing Batch with input_path=/Users/rob/repos/kalliste/test_images_input/20241012_Photoshoot1, max_concurrent=3
Scanning for images in /Users/rob/repos/kalliste/test_images_input/20241012_Photoshoot1
Found 12 images to process in batch 20241012_Photoshoot1
Found 2 batches to process
BatchProcessor created
Initializing models
Initializing BatchProcessor and model registry
Starting model registry initialization
Initializing tagger pipeline...
Creating TaggerPipeline instance
MPS device validated
TaggerPipeline created with device: mps
Starting TaggerPipeline initialization
Initializing orientation tagger
Initializing OrientationTagger on device: mps
Successfully initialized orientation tagger
Initializing wd14 tagger
Initializing WD14Tagger on device: mps
Successfully initialized wd14 tagger
Initializing caption tagger
Initializing CaptionTagger on device: mps
Successfully initialized caption tagger
TaggerPipeline initialization complete
Tagger pipeline initialized successfully
Initializing YOLO detector...
Initializing YOLO detector
Loading YOLO model from /Users/rob/.cache/ultralytics/yolov8n.pt
YOLO model loaded successfully
Loading YOLO face model from /Users/rob/.cache/ultralytics/yolov8n-face.pt
YOLO face model loaded successfully
YOLODetector initialized with 1 active classes
YOLO detector initialized successfully
Model registry initialization complete
BatchProcessor and model registry initialized successfully
[green]BatchProcessor initialized successfully[/]
[green]Starting batch processing[/]
BatchProcessor already initialized
Starting batch processing
Starting batch: 20180312_Photoshoot2
Starting batch processing for 20180312_Photoshoot2 with 9 images
Starting processing for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3136.png
Starting processing for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3320.png
Starting processing for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3297.png
Running detection on /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3297.png
Running detection on /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3136.png
Running detection on /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3320.png
Fusing face model...
Fusing face model...
Fusing face model...
Model fusion failed for face model: 'Conv' object has no attribute 'bn'
Continuing with unfused model
Model fusion failed for face model: 'Conv' object has no attribute 'bn'
Continuing with unfused model
Face Model fused successfully
Fusing main model...
Main Model fused successfully
Detection complete. Found 2 total regions
Found 2 detections in /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3320.png
Starting crop processing for face from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3320.png
Starting crop processing for person from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3320.png
Detection complete. Found 2 total regions
Found 2 detections in /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3297.png
Starting crop processing for face from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3297.png
Starting crop processing for person from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3297.png
Running taggers for face crop
Running orientation tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_3320_face_crop.png
Error in orientation tagger: Orientation tagger not properly initialized
Running taggers for person crop
Detection complete. Found 2 total regions
Running orientation tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_3320_person_crop.png
Error in orientation tagger: Orientation tagger not properly initialized
Running wd14 tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_3320_person_crop.png
Error in wd14 tagger: WD14 tagger not properly initialized
Running caption tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_3320_person_crop.png
Error in caption tagger: Caption tagger not properly initialized
Tagger orientation failed: Orientation tagger not properly initialized
Running taggers for face crop
Running taggers for person crop
[yellow]Pipeline test interrupted by user[/]
Cleaning up model registry
Starting model registry cleanup
Model registry cleanup complete
Model registry cleanup complete
[blue]Pipeline test complete[/]
Task was destroyed but it is pending!
task: <Task cancelling name='Task-1' coro=<main() done, defined at /Users/rob/repos/kalliste/scripts/test_pipeline.py:33> wait_for=<_GatheringFuture pending cb=[Task.task_wakeup()]> cb=[gather.<locals>._done_callback() at /opt/miniconda3/envs/kalliste/lib/python3.11/asyncio/tasks.py:764]>
[blue]Starting pipeline test[/]
Input directory: [cyan]/Users/rob/repos/kalliste/test_images_input[/]
Output directory: [cyan]/Users/rob/repos/kalliste/test_images_output[/]
[green]Initializing BatchProcessor[/]
Initializing BatchProcessor with input_root=/Users/rob/repos/kalliste/test_images_input, output_root=/Users/rob/repos/kalliste/test_images_output
Scanning for batches in /Users/rob/repos/kalliste/test_images_input
Initializing Batch with input_path=/Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2, max_concurrent=3
Scanning for images in /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2
Found 9 images to process in batch 20180312_Photoshoot2
Initializing Batch with input_path=/Users/rob/repos/kalliste/test_images_input/20241012_Photoshoot1, max_concurrent=3
Scanning for images in /Users/rob/repos/kalliste/test_images_input/20241012_Photoshoot1
Found 12 images to process in batch 20241012_Photoshoot1
Found 2 batches to process
BatchProcessor created
Initializing models
Initializing BatchProcessor and model registry
Starting model registry initialization
Initializing tagger pipeline...
Creating TaggerPipeline instance
MPS device validated
TaggerPipeline created with device: mps
Starting TaggerPipeline initialization
Initializing orientation tagger
Failed to create orientation tagger: Can't instantiate abstract class OrientationTagger with abstract method _initialize
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/taggers/tagger_pipeline.py", line 102, in initialize
    tagger = tagger_class(device=self.device)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: Can't instantiate abstract class OrientationTagger with abstract method _initialize
Failed to initialize models: Can't instantiate abstract class OrientationTagger with abstract method _initialize
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/model_registry.py", line 28, in initialize
    await tagger.initialize()
  File "/Users/rob/repos/kalliste/kalliste/taggers/tagger_pipeline.py", line 102, in initialize
    tagger = tagger_class(device=self.device)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: Can't instantiate abstract class OrientationTagger with abstract method _initialize
Starting model registry cleanup
[yellow]Pipeline test interrupted by user[/]
[blue]Starting pipeline test[/]
Input directory: [cyan]/Users/rob/repos/kalliste/test_images_input[/]
Output directory: [cyan]/Users/rob/repos/kalliste/test_images_output[/]
[green]Initializing BatchProcessor[/]
Initializing BatchProcessor with input_root=/Users/rob/repos/kalliste/test_images_input, output_root=/Users/rob/repos/kalliste/test_images_output
Scanning for batches in /Users/rob/repos/kalliste/test_images_input
Initializing Batch with input_path=/Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2, max_concurrent=3
Scanning for images in /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2
Found 9 images to process in batch 20180312_Photoshoot2
Initializing Batch with input_path=/Users/rob/repos/kalliste/test_images_input/20241012_Photoshoot1, max_concurrent=3
Scanning for images in /Users/rob/repos/kalliste/test_images_input/20241012_Photoshoot1
Found 12 images to process in batch 20241012_Photoshoot1
Found 2 batches to process
BatchProcessor created
Initializing models
Initializing BatchProcessor and model registry
Starting model registry initialization
Initializing tagger pipeline...
Creating TaggerPipeline instance
MPS device validated
TaggerPipeline created with device: mps
Failed to initialize models: 'TaggerPipeline' object has no attribute 'initialize'
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/model_registry.py", line 28, in initialize
    await tagger.initialize()
          ^^^^^^^^^^^^^^^^^
AttributeError: 'TaggerPipeline' object has no attribute 'initialize'
Starting model registry cleanup
[yellow]Pipeline test interrupted by user[/]
[blue]Starting pipeline test[/]
Input directory: [cyan]/Users/rob/repos/kalliste/test_images_input[/]
Output directory: [cyan]/Users/rob/repos/kalliste/test_images_output[/]
[green]Initializing BatchProcessor[/]
Initializing BatchProcessor with input_root=/Users/rob/repos/kalliste/test_images_input, output_root=/Users/rob/repos/kalliste/test_images_output
Scanning for batches in /Users/rob/repos/kalliste/test_images_input
Initializing Batch with input_path=/Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2, max_concurrent=3
Scanning for images in /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2
Found 9 images to process in batch 20180312_Photoshoot2
Initializing Batch with input_path=/Users/rob/repos/kalliste/test_images_input/20241012_Photoshoot1, max_concurrent=3
Scanning for images in /Users/rob/repos/kalliste/test_images_input/20241012_Photoshoot1
Found 12 images to process in batch 20241012_Photoshoot1
Found 2 batches to process
BatchProcessor created
Initializing models
Initializing BatchProcessor and model registry
Starting model registry initialization
Initializing tagger pipeline...
Creating TaggerPipeline instance
MPS device validated
TaggerPipeline created with device: mps
Starting tagger pipeline initialization
Initializing orientation tagger...
Creating OrientationTagger instance for device: mps
Orientation tagger created successfully
Initializing caption tagger...
Creating CaptionTagger instance for device: mps
Caption tagger created successfully
Initializing WD14 tagger...
Loading pretrained weights from Hugging Face hub (SmilingWolf/wd-vit-large-tagger-v3)
[SmilingWolf/wd-vit-large-tagger-v3] Safe alternative available for 'pytorch_model.bin' (as 'model.safetensors'). Loading weights using safetensors.
Loaded 10861 WD14 tags
Creating WD14Tagger instance for device: mps
WD14 tagger created successfully
All taggers initialized successfully
Tagger pipeline initialized successfully
Initializing YOLO detector...
Initializing YOLO detector
Loading YOLO model from /Users/rob/.cache/ultralytics/yolov8n.pt
YOLO model loaded successfully
Loading YOLO face model from /Users/rob/.cache/ultralytics/yolov8n-face.pt
YOLO face model loaded successfully
YOLODetector initialized with 1 active classes
YOLO detector initialized successfully
Model registry initialization complete
BatchProcessor and model registry initialized successfully
[green]BatchProcessor initialized successfully[/]
[green]Starting batch processing[/]
Starting batch processing
Starting batch: 20180312_Photoshoot2
Starting batch processing for 20180312_Photoshoot2 with 9 images
Starting processing for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3136.png
Starting processing for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3320.png
Starting processing for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3297.png
Running detection on /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3136.png
Running detection on /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3297.png
Running detection on /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3320.png
Fusing face model...
Fusing face model...
Fusing face model...
Model fusion failed for face model: 'Conv' object has no attribute 'bn'
Continuing with unfused model
Model fusion failed for face model: 'Conv' object has no attribute 'bn'
Continuing with unfused model
Face Model fused successfully
Fusing main model...
Main Model fused successfully
Detection complete. Found 2 total regions
Found 2 detections in /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3136.png
Starting crop processing for face from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3136.png
Starting crop processing for person from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3136.png
Running taggers for face crop
Detection complete. Found 2 total regions
Running orientation tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_3136_face_crop.png
Running taggers for person crop
Detection complete. Found 2 total regions
Found 2 detections in /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3320.png
Running wd14 tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_3136_person_crop.png
WD14 tagging failed for /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_3136_person_crop.png: argument of type 'NoneType' is not iterable
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/taggers/wd14_tagger.py", line 129, in tag_image
    return self._postprocess_output(output)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/taggers/wd14_tagger.py", line 85, in _postprocess_output
    if self._filter_tags(tag, prob, category):
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/taggers/wd14_tagger.py", line 70, in _filter_tags
    if tag in self.blacklist:
       ^^^^^^^^^^^^^^^^^^^^^
TypeError: argument of type 'NoneType' is not iterable
Error in wd14 tagger: argument of type 'NoneType' is not iterable
Running caption tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_3136_person_crop.png
Running orientation tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_3136_person_crop.png
Starting crop processing for face from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3320.png
Starting crop processing for person from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3320.png
Found 2 detections in /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3297.png
Starting crop processing for face from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3297.png
Starting crop processing for person from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3297.png
Tagger wd14 failed: argument of type 'NoneType' is not iterable
Running taggers for face crop
Running orientation tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_3297_face_crop.png
Running taggers for person crop
Running taggers for face crop
Running wd14 tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_3297_person_crop.png
WD14 tagging failed for /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_3297_person_crop.png: argument of type 'NoneType' is not iterable
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/taggers/wd14_tagger.py", line 129, in tag_image
    return self._postprocess_output(output)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/taggers/wd14_tagger.py", line 85, in _postprocess_output
    if self._filter_tags(tag, prob, category):
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/taggers/wd14_tagger.py", line 70, in _filter_tags
    if tag in self.blacklist:
       ^^^^^^^^^^^^^^^^^^^^^
TypeError: argument of type 'NoneType' is not iterable
Error in wd14 tagger: argument of type 'NoneType' is not iterable
Running caption tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_3297_person_crop.png
Running orientation tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_3297_person_crop.png
Running orientation tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_3320_face_crop.png
Running taggers for person crop
Running wd14 tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_3320_person_crop.png
WD14 tagging failed for /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_3320_person_crop.png: argument of type 'NoneType' is not iterable
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/taggers/wd14_tagger.py", line 129, in tag_image
    return self._postprocess_output(output)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/taggers/wd14_tagger.py", line 85, in _postprocess_output
    if self._filter_tags(tag, prob, category):
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/taggers/wd14_tagger.py", line 70, in _filter_tags
    if tag in self.blacklist:
       ^^^^^^^^^^^^^^^^^^^^^
TypeError: argument of type 'NoneType' is not iterable
Error in wd14 tagger: argument of type 'NoneType' is not iterable
Running caption tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_3320_person_crop.png
Running orientation tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_3320_person_crop.png
Tagger wd14 failed: argument of type 'NoneType' is not iterable
Tagger wd14 failed: argument of type 'NoneType' is not iterable
ExifTool error while injecting tags: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.

Error injecting Kalliste tags: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 240, in inject_kalliste_tags
    raise RuntimeError(f"Tag injection failed: {error_msg}")
RuntimeError: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.

Error processing crop from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3136.png: Tag injection failed: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 240, in inject_kalliste_tags
    raise RuntimeError(f"Tag injection failed: {error_msg}")
RuntimeError: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 40, in process
    await self.inject_kalliste_tags()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 246, in inject_kalliste_tags
    raise RuntimeError(f"Tag injection failed: {e}") from e
RuntimeError: Tag injection failed: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.

Error processing crops for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3136.png: Crop processing failed: Tag injection failed: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 240, in inject_kalliste_tags
    raise RuntimeError(f"Tag injection failed: {error_msg}")
RuntimeError: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 40, in process
    await self.inject_kalliste_tags()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 246, in inject_kalliste_tags
    raise RuntimeError(f"Tag injection failed: {e}") from e
RuntimeError: Tag injection failed: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 66, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 50, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: Tag injection failed: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.

Error processing /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3136.png: Crop processing failed: Tag injection failed: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 240, in inject_kalliste_tags
    raise RuntimeError(f"Tag injection failed: {error_msg}")
RuntimeError: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 40, in process
    await self.inject_kalliste_tags()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 246, in inject_kalliste_tags
    raise RuntimeError(f"Tag injection failed: {e}") from e
RuntimeError: Tag injection failed: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 66, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 50, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: Tag injection failed: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.

Failed to process IMG_3136.png
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 240, in inject_kalliste_tags
    raise RuntimeError(f"Tag injection failed: {error_msg}")
RuntimeError: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 40, in process
    await self.inject_kalliste_tags()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 246, in inject_kalliste_tags
    raise RuntimeError(f"Tag injection failed: {e}") from e
RuntimeError: Tag injection failed: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 44, in process_image
    return await image.process()
           ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 66, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 50, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: Tag injection failed: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.

Starting processing for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3152.png
ExifTool error while injecting tags: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.

Error injecting Kalliste tags: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 240, in inject_kalliste_tags
    raise RuntimeError(f"Tag injection failed: {error_msg}")
RuntimeError: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.

Error processing crop from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3136.png: Tag injection failed: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 240, in inject_kalliste_tags
    raise RuntimeError(f"Tag injection failed: {error_msg}")
RuntimeError: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 40, in process
    await self.inject_kalliste_tags()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 246, in inject_kalliste_tags
    raise RuntimeError(f"Tag injection failed: {e}") from e
RuntimeError: Tag injection failed: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.

ExifTool error while injecting tags: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.

Running detection on /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3152.png
Error injecting Kalliste tags: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 240, in inject_kalliste_tags
    raise RuntimeError(f"Tag injection failed: {error_msg}")
RuntimeError: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.

Error processing crop from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3297.png: Tag injection failed: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 240, in inject_kalliste_tags
    raise RuntimeError(f"Tag injection failed: {error_msg}")
RuntimeError: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 40, in process
    await self.inject_kalliste_tags()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 246, in inject_kalliste_tags
    raise RuntimeError(f"Tag injection failed: {e}") from e
RuntimeError: Tag injection failed: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.

Error processing crops for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3297.png: Crop processing failed: Tag injection failed: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 240, in inject_kalliste_tags
    raise RuntimeError(f"Tag injection failed: {error_msg}")
RuntimeError: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 40, in process
    await self.inject_kalliste_tags()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 246, in inject_kalliste_tags
    raise RuntimeError(f"Tag injection failed: {e}") from e
RuntimeError: Tag injection failed: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 66, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 50, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: Tag injection failed: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.

Error processing /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3297.png: Crop processing failed: Tag injection failed: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 240, in inject_kalliste_tags
    raise RuntimeError(f"Tag injection failed: {error_msg}")
RuntimeError: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 40, in process
    await self.inject_kalliste_tags()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 246, in inject_kalliste_tags
    raise RuntimeError(f"Tag injection failed: {e}") from e
RuntimeError: Tag injection failed: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 66, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 50, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: Tag injection failed: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.

Failed to process IMG_3297.png
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 240, in inject_kalliste_tags
    raise RuntimeError(f"Tag injection failed: {error_msg}")
RuntimeError: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 40, in process
    await self.inject_kalliste_tags()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 246, in inject_kalliste_tags
    raise RuntimeError(f"Tag injection failed: {e}") from e
RuntimeError: Tag injection failed: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 44, in process_image
    return await image.process()
           ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 66, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 50, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: Tag injection failed: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.

Starting processing for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A9668.png
ExifTool error while injecting tags: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.

Error injecting Kalliste tags: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 240, in inject_kalliste_tags
    raise RuntimeError(f"Tag injection failed: {error_msg}")
RuntimeError: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.

Error processing crop from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3320.png: Tag injection failed: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 240, in inject_kalliste_tags
    raise RuntimeError(f"Tag injection failed: {error_msg}")
RuntimeError: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 40, in process
    await self.inject_kalliste_tags()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 246, in inject_kalliste_tags
    raise RuntimeError(f"Tag injection failed: {e}") from e
RuntimeError: Tag injection failed: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.

Error processing crops for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3320.png: Crop processing failed: Tag injection failed: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 240, in inject_kalliste_tags
    raise RuntimeError(f"Tag injection failed: {error_msg}")
RuntimeError: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 40, in process
    await self.inject_kalliste_tags()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 246, in inject_kalliste_tags
    raise RuntimeError(f"Tag injection failed: {e}") from e
RuntimeError: Tag injection failed: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 66, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 50, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: Tag injection failed: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.

Running detection on /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A9668.png
Error processing /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3320.png: Crop processing failed: Tag injection failed: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 240, in inject_kalliste_tags
    raise RuntimeError(f"Tag injection failed: {error_msg}")
RuntimeError: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 40, in process
    await self.inject_kalliste_tags()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 246, in inject_kalliste_tags
    raise RuntimeError(f"Tag injection failed: {e}") from e
RuntimeError: Tag injection failed: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 66, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 50, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: Tag injection failed: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.

Failed to process IMG_3320.png
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 240, in inject_kalliste_tags
    raise RuntimeError(f"Tag injection failed: {error_msg}")
RuntimeError: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 40, in process
    await self.inject_kalliste_tags()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 246, in inject_kalliste_tags
    raise RuntimeError(f"Tag injection failed: {e}") from e
RuntimeError: Tag injection failed: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 44, in process_image
    return await image.process()
           ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 66, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 50, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: Tag injection failed: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.

Starting processing for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_0241-2.png
Running detection on /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_0241-2.png
ExifTool error while injecting tags: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.

Error injecting Kalliste tags: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 240, in inject_kalliste_tags
    raise RuntimeError(f"Tag injection failed: {error_msg}")
RuntimeError: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.

Error processing crop from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3297.png: Tag injection failed: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 240, in inject_kalliste_tags
    raise RuntimeError(f"Tag injection failed: {error_msg}")
RuntimeError: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 40, in process
    await self.inject_kalliste_tags()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 246, in inject_kalliste_tags
    raise RuntimeError(f"Tag injection failed: {e}") from e
RuntimeError: Tag injection failed: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.

Detection complete. Found 2 total regions
Found 2 detections in /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3152.png
Starting crop processing for face from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3152.png
Starting crop processing for person from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3152.png
Running taggers for face crop
Running orientation tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_3152_face_crop.png
Running taggers for person crop
Detection complete. Found 2 total regions
Detection complete. Found 2 total regions
Running wd14 tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_3152_person_crop.png
Cleaning up model registry
Starting model registry cleanup
Model registry cleanup complete
Model registry cleanup complete
[blue]Pipeline test complete[/]
[yellow]Pipeline test interrupted by user[/]
[blue]Starting pipeline test[/]
Input directory: [cyan]/Users/rob/repos/kalliste/test_images_input[/]
Output directory: [cyan]/Users/rob/repos/kalliste/test_images_output[/]
[green]Initializing BatchProcessor[/]
Initializing BatchProcessor with input_root=/Users/rob/repos/kalliste/test_images_input, output_root=/Users/rob/repos/kalliste/test_images_output
Scanning for batches in /Users/rob/repos/kalliste/test_images_input
Initializing Batch with input_path=/Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2, max_concurrent=3
Scanning for images in /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2
Found 9 images to process in batch 20180312_Photoshoot2
Initializing Batch with input_path=/Users/rob/repos/kalliste/test_images_input/20241012_Photoshoot1, max_concurrent=3
Scanning for images in /Users/rob/repos/kalliste/test_images_input/20241012_Photoshoot1
Found 12 images to process in batch 20241012_Photoshoot1
Found 2 batches to process
BatchProcessor created
Initializing models
Initializing BatchProcessor and model registry
Starting model registry initialization
Initializing tagger pipeline...
Creating TaggerPipeline instance
MPS device validated
TaggerPipeline created with device: mps
Starting tagger pipeline initialization
Initializing orientation tagger...
Creating OrientationTagger instance for device: mps
Orientation tagger created successfully
Initializing caption tagger...
Creating CaptionTagger instance for device: mps
Caption tagger created successfully
Initializing WD14 tagger...
Loading pretrained weights from Hugging Face hub (SmilingWolf/wd-vit-large-tagger-v3)
[SmilingWolf/wd-vit-large-tagger-v3] Safe alternative available for 'pytorch_model.bin' (as 'model.safetensors'). Loading weights using safetensors.
Loaded 10861 WD14 tags
Creating WD14Tagger instance for device: mps
WD14 tagger created successfully
All taggers initialized successfully
Tagger pipeline initialized successfully
Initializing YOLO detector...
Initializing YOLO detector
Loading YOLO model from /Users/rob/.cache/ultralytics/yolov8n.pt
YOLO model loaded successfully
Loading YOLO face model from /Users/rob/.cache/ultralytics/yolov8n-face.pt
YOLO face model loaded successfully
YOLODetector initialized with 1 active classes
YOLO detector initialized successfully
Model registry initialization complete
BatchProcessor and model registry initialized successfully
[green]BatchProcessor initialized successfully[/]
[green]Starting batch processing[/]
Starting batch processing
Starting batch: 20180312_Photoshoot2
Starting batch processing for 20180312_Photoshoot2 with 9 images
Starting processing for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3136.png
Starting processing for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3320.png
Starting processing for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3297.png
Running detection on /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3297.png
Running detection on /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3136.png
Running detection on /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3320.png
Fusing face model...
Fusing face model...
Fusing face model...
Model fusion failed for face model: 'Conv' object has no attribute 'bn'
Continuing with unfused model
Model fusion failed for face model: 'Conv' object has no attribute 'bn'
Continuing with unfused model
Face Model fused successfully
Fusing main model...
Main Model fused successfully
Cleaning up model registry
Starting model registry cleanup
Model registry cleanup complete
Model registry cleanup complete
[blue]Pipeline test complete[/]
Detection complete. Found 2 total regions
Detection complete. Found 2 total regions
[yellow]Pipeline test interrupted by user[/]
Detection complete. Found 2 total regions
[blue]Starting pipeline test[/]
Input directory: [cyan]/Users/rob/repos/kalliste/test_images_input[/]
Output directory: [cyan]/Users/rob/repos/kalliste/test_images_output[/]
[green]Initializing BatchProcessor[/]
Initializing BatchProcessor with input_root=/Users/rob/repos/kalliste/test_images_input, output_root=/Users/rob/repos/kalliste/test_images_output
Scanning for batches in /Users/rob/repos/kalliste/test_images_input
Initializing Batch with input_path=/Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2, max_concurrent=3
Scanning for images in /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2
Found 9 images to process in batch 20180312_Photoshoot2
Initializing Batch with input_path=/Users/rob/repos/kalliste/test_images_input/20241012_Photoshoot1, max_concurrent=3
Scanning for images in /Users/rob/repos/kalliste/test_images_input/20241012_Photoshoot1
Found 12 images to process in batch 20241012_Photoshoot1
Found 2 batches to process
BatchProcessor created
Initializing models
Initializing BatchProcessor and model registry
Starting model registry initialization
Initializing tagger pipeline...
Creating TaggerPipeline instance
MPS device validated
TaggerPipeline created with device: mps
Starting tagger pipeline initialization
Initializing orientation tagger...
Creating OrientationTagger instance for device: mps
Orientation tagger created successfully
Initializing caption tagger...
Creating CaptionTagger instance for device: mps
Caption tagger created successfully
Initializing WD14 tagger...
Loading pretrained weights from Hugging Face hub (SmilingWolf/wd-vit-large-tagger-v3)
[SmilingWolf/wd-vit-large-tagger-v3] Safe alternative available for 'pytorch_model.bin' (as 'model.safetensors'). Loading weights using safetensors.
Loaded 10861 WD14 tags
Creating WD14Tagger instance for device: mps
WD14 tagger created successfully
All taggers initialized successfully
Tagger pipeline initialized successfully
Initializing YOLO detector...
Initializing YOLO detector
Loading YOLO model from /Users/rob/.cache/ultralytics/yolov8n.pt
YOLO model loaded successfully
Loading YOLO face model from /Users/rob/.cache/ultralytics/yolov8n-face.pt
YOLO face model loaded successfully
YOLODetector initialized with 1 active classes
YOLO detector initialized successfully
Model registry initialization complete
BatchProcessor and model registry initialized successfully
[green]BatchProcessor initialized successfully[/]
[green]Starting batch processing[/]
Starting batch processing
Starting batch: 20180312_Photoshoot2
Starting batch processing for 20180312_Photoshoot2 with 9 images
Starting processing for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3136.png
Starting processing for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3320.png
Starting processing for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3297.png
Running detection on /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3297.png
Running detection on /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3136.png
Running detection on /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3320.png
Fusing face model...
Fusing face model...
Fusing face model...
Model fusion failed for face model: 'Conv' object has no attribute 'bn'
Continuing with unfused model
Model fusion failed for face model: 'Conv' object has no attribute 'bn'
Continuing with unfused model
Face Model fused successfully
Fusing main model...
Main Model fused successfully
Detection complete. Found 2 total regions
Found 2 detections in /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3297.png
Starting crop processing for face from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3297.png
Starting crop processing for person from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3297.png
Running taggers for face crop
Running orientation tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_3297_face_crop.png
Detection complete. Found 2 total regions
Running taggers for person crop
Detection complete. Found 2 total regions
Running caption tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_3297_person_crop.png
Running orientation tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_3297_person_crop.png
Running wd14 tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_3297_person_crop.png
WD14 tagging failed for /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_3297_person_crop.png: argument of type 'NoneType' is not iterable
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/taggers/wd14_tagger.py", line 129, in tag_image
    return self._postprocess_output(output)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/taggers/wd14_tagger.py", line 85, in _postprocess_output
    if self._filter_tags(tag, prob, category):
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/taggers/wd14_tagger.py", line 70, in _filter_tags
    if tag in self.blacklist:
       ^^^^^^^^^^^^^^^^^^^^^
TypeError: argument of type 'NoneType' is not iterable
Error in wd14 tagger: argument of type 'NoneType' is not iterable
Found 2 detections in /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3320.png
Found 2 detections in /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3136.png
Starting crop processing for face from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3320.png
Starting crop processing for person from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3320.png
Starting crop processing for face from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3136.png
Starting crop processing for person from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3136.png
Tagger wd14 failed: argument of type 'NoneType' is not iterable
Running taggers for face crop
Running orientation tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_3320_face_crop.png
Running taggers for face crop
Running taggers for person crop
[yellow]Pipeline test interrupted by user[/]
Cleaning up model registry
Starting model registry cleanup
Model registry cleanup complete
Model registry cleanup complete
[blue]Pipeline test complete[/]
Task was destroyed but it is pending!
task: <Task cancelling name='Task-1' coro=<main() done, defined at /Users/rob/repos/kalliste/scripts/test_pipeline.py:33> wait_for=<_GatheringFuture pending cb=[Task.task_wakeup()]> cb=[gather.<locals>._done_callback() at /opt/miniconda3/envs/kalliste/lib/python3.11/asyncio/tasks.py:764]>
[blue]Starting pipeline test[/]
Input directory: [cyan]/Users/rob/repos/kalliste/test_images_input[/]
Output directory: [cyan]/Users/rob/repos/kalliste/test_images_output[/]
[green]Initializing BatchProcessor[/]
Initializing BatchProcessor with input_root=/Users/rob/repos/kalliste/test_images_input, output_root=/Users/rob/repos/kalliste/test_images_output
Scanning for batches in /Users/rob/repos/kalliste/test_images_input
Initializing Batch with input_path=/Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2, max_concurrent=3
Scanning for images in /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2
Found 9 images to process in batch 20180312_Photoshoot2
Initializing Batch with input_path=/Users/rob/repos/kalliste/test_images_input/20241012_Photoshoot1, max_concurrent=3
Scanning for images in /Users/rob/repos/kalliste/test_images_input/20241012_Photoshoot1
Found 12 images to process in batch 20241012_Photoshoot1
Found 2 batches to process
BatchProcessor created
Initializing models
Initializing BatchProcessor and model registry
Starting model registry initialization
Initializing tagger pipeline...
Creating TaggerPipeline instance
MPS device validated
TaggerPipeline created with device: mps
Starting tagger pipeline initialization
Initializing orientation tagger...
Creating OrientationTagger instance for device: mps
Orientation tagger created successfully
Initializing caption tagger...
Creating CaptionTagger instance for device: mps
Caption tagger created successfully
Initializing WD14 tagger...
Loading pretrained weights from Hugging Face hub (SmilingWolf/wd-vit-large-tagger-v3)
[SmilingWolf/wd-vit-large-tagger-v3] Safe alternative available for 'pytorch_model.bin' (as 'model.safetensors'). Loading weights using safetensors.
Loaded 10861 WD14 tags
Creating WD14Tagger instance for device: mps
WD14 tagger created successfully
All taggers initialized successfully
Tagger pipeline initialized successfully
Initializing YOLO detector...
Initializing YOLO detector
Loading YOLO model from /Users/rob/.cache/ultralytics/yolov8n.pt
YOLO model loaded successfully
Loading YOLO face model from /Users/rob/.cache/ultralytics/yolov8n-face.pt
YOLO face model loaded successfully
YOLODetector initialized with 1 active classes
YOLO detector initialized successfully
Model registry initialization complete
BatchProcessor and model registry initialized successfully
[green]BatchProcessor initialized successfully[/]
[green]Starting batch processing[/]
Starting batch processing
Starting batch: 20180312_Photoshoot2
Starting batch processing for 20180312_Photoshoot2 with 9 images
Starting processing for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3136.png
Starting processing for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3320.png
Starting processing for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3297.png
Running detection on /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3297.png
Running detection on /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3136.png
Running detection on /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3320.png
Fusing face model...
Fusing face model...
Fusing face model...
Model fusion failed for face model: 'Conv' object has no attribute 'bn'
Continuing with unfused model
Model fusion failed for face model: 'Conv' object has no attribute 'bn'
Continuing with unfused model
Face Model fused successfully
Fusing main model...
Main Model fused successfully
Detection complete. Found 2 total regions
Found 2 detections in /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3297.png
Starting crop processing for face from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3297.png
Starting crop processing for person from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3297.png
Running taggers for face crop
Running orientation tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_3297_face_crop.png
Detection complete. Found 2 total regions
Running taggers for person crop
Detection complete. Found 2 total regions
Running orientation tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_3297_person_crop.png
Running caption tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_3297_person_crop.png
Running wd14 tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_3297_person_crop.png
WD14 tagging failed for /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_3297_person_crop.png: argument of type 'NoneType' is not iterable
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/taggers/wd14_tagger.py", line 125, in tag_image
    return self._postprocess_output(output)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/taggers/wd14_tagger.py", line 81, in _postprocess_output
    if self._filter_tags(tag, prob, category):
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/taggers/wd14_tagger.py", line 66, in _filter_tags
    if tag in self.blacklist:
       ^^^^^^^^^^^^^^^^^^^^^
TypeError: argument of type 'NoneType' is not iterable
Error in wd14 tagger: argument of type 'NoneType' is not iterable
Found 2 detections in /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3320.png
Found 2 detections in /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3136.png
Starting crop processing for face from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3320.png
Starting crop processing for person from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3320.png
Starting crop processing for face from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3136.png
Starting crop processing for person from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3136.png
Tagger wd14 failed: argument of type 'NoneType' is not iterable
Running taggers for person crop
Running orientation tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_3320_person_crop.png
Running caption tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_3320_person_crop.png
Running wd14 tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_3320_person_crop.png
WD14 tagging failed for /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_3320_person_crop.png: argument of type 'NoneType' is not iterable
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/taggers/wd14_tagger.py", line 125, in tag_image
    return self._postprocess_output(output)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/taggers/wd14_tagger.py", line 81, in _postprocess_output
    if self._filter_tags(tag, prob, category):
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/taggers/wd14_tagger.py", line 66, in _filter_tags
    if tag in self.blacklist:
       ^^^^^^^^^^^^^^^^^^^^^
TypeError: argument of type 'NoneType' is not iterable
Error in wd14 tagger: argument of type 'NoneType' is not iterable
Running taggers for face crop
Running taggers for face crop
Running taggers for person crop
Running orientation tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_3320_face_crop.png
Running orientation tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_3136_face_crop.png
Running orientation tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_3136_person_crop.png
Running caption tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_3136_person_crop.png
Running wd14 tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_3136_person_crop.png
WD14 tagging failed for /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_3136_person_crop.png: argument of type 'NoneType' is not iterable
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/taggers/wd14_tagger.py", line 125, in tag_image
    return self._postprocess_output(output)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/taggers/wd14_tagger.py", line 81, in _postprocess_output
    if self._filter_tags(tag, prob, category):
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/taggers/wd14_tagger.py", line 66, in _filter_tags
    if tag in self.blacklist:
       ^^^^^^^^^^^^^^^^^^^^^
TypeError: argument of type 'NoneType' is not iterable
Error in wd14 tagger: argument of type 'NoneType' is not iterable
Tagger wd14 failed: argument of type 'NoneType' is not iterable
Tagger wd14 failed: argument of type 'NoneType' is not iterable
ExifTool error while injecting tags: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.

Error injecting Kalliste tags: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 240, in inject_kalliste_tags
    raise RuntimeError(f"Tag injection failed: {error_msg}")
RuntimeError: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.

Error processing crop from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3297.png: Tag injection failed: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 240, in inject_kalliste_tags
    raise RuntimeError(f"Tag injection failed: {error_msg}")
RuntimeError: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 40, in process
    await self.inject_kalliste_tags()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 246, in inject_kalliste_tags
    raise RuntimeError(f"Tag injection failed: {e}") from e
RuntimeError: Tag injection failed: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.

Error processing crops for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3297.png: Crop processing failed: Tag injection failed: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 240, in inject_kalliste_tags
    raise RuntimeError(f"Tag injection failed: {error_msg}")
RuntimeError: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 40, in process
    await self.inject_kalliste_tags()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 246, in inject_kalliste_tags
    raise RuntimeError(f"Tag injection failed: {e}") from e
RuntimeError: Tag injection failed: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 66, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 50, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: Tag injection failed: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.

Error processing /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3297.png: Crop processing failed: Tag injection failed: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 240, in inject_kalliste_tags
    raise RuntimeError(f"Tag injection failed: {error_msg}")
RuntimeError: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 40, in process
    await self.inject_kalliste_tags()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 246, in inject_kalliste_tags
    raise RuntimeError(f"Tag injection failed: {e}") from e
RuntimeError: Tag injection failed: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 66, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 50, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: Tag injection failed: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.

Failed to process IMG_3297.png
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 240, in inject_kalliste_tags
    raise RuntimeError(f"Tag injection failed: {error_msg}")
RuntimeError: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 40, in process
    await self.inject_kalliste_tags()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 246, in inject_kalliste_tags
    raise RuntimeError(f"Tag injection failed: {e}") from e
RuntimeError: Tag injection failed: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 44, in process_image
    return await image.process()
           ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 66, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 50, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: Tag injection failed: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.

Starting processing for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3152.png
ExifTool error while injecting tags: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.

Error injecting Kalliste tags: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 240, in inject_kalliste_tags
    raise RuntimeError(f"Tag injection failed: {error_msg}")
RuntimeError: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.

Error processing crop from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3297.png: Tag injection failed: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 240, in inject_kalliste_tags
    raise RuntimeError(f"Tag injection failed: {error_msg}")
RuntimeError: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 40, in process
    await self.inject_kalliste_tags()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 246, in inject_kalliste_tags
    raise RuntimeError(f"Tag injection failed: {e}") from e
RuntimeError: Tag injection failed: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.

Running detection on /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3152.png
ExifTool error while injecting tags: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.

Error injecting Kalliste tags: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 240, in inject_kalliste_tags
    raise RuntimeError(f"Tag injection failed: {error_msg}")
RuntimeError: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.

Error processing crop from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3320.png: Tag injection failed: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 240, in inject_kalliste_tags
    raise RuntimeError(f"Tag injection failed: {error_msg}")
RuntimeError: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 40, in process
    await self.inject_kalliste_tags()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 246, in inject_kalliste_tags
    raise RuntimeError(f"Tag injection failed: {e}") from e
RuntimeError: Tag injection failed: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.

Error processing crops for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3320.png: Crop processing failed: Tag injection failed: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 240, in inject_kalliste_tags
    raise RuntimeError(f"Tag injection failed: {error_msg}")
RuntimeError: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 40, in process
    await self.inject_kalliste_tags()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 246, in inject_kalliste_tags
    raise RuntimeError(f"Tag injection failed: {e}") from e
RuntimeError: Tag injection failed: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 66, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 50, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: Tag injection failed: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.

Error processing /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3320.png: Crop processing failed: Tag injection failed: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 240, in inject_kalliste_tags
    raise RuntimeError(f"Tag injection failed: {error_msg}")
RuntimeError: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 40, in process
    await self.inject_kalliste_tags()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 246, in inject_kalliste_tags
    raise RuntimeError(f"Tag injection failed: {e}") from e
RuntimeError: Tag injection failed: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 66, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 50, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: Tag injection failed: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.

Failed to process IMG_3320.png
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 240, in inject_kalliste_tags
    raise RuntimeError(f"Tag injection failed: {error_msg}")
RuntimeError: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 40, in process
    await self.inject_kalliste_tags()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 246, in inject_kalliste_tags
    raise RuntimeError(f"Tag injection failed: {e}") from e
RuntimeError: Tag injection failed: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 44, in process_image
    return await image.process()
           ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 66, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 50, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: Tag injection failed: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.

Starting processing for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A9668.png
ExifTool error while injecting tags: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.

Error injecting Kalliste tags: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 240, in inject_kalliste_tags
    raise RuntimeError(f"Tag injection failed: {error_msg}")
RuntimeError: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.

Error processing crop from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3136.png: Tag injection failed: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 240, in inject_kalliste_tags
    raise RuntimeError(f"Tag injection failed: {error_msg}")
RuntimeError: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 40, in process
    await self.inject_kalliste_tags()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 246, in inject_kalliste_tags
    raise RuntimeError(f"Tag injection failed: {e}") from e
RuntimeError: Tag injection failed: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.

Error processing crops for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3136.png: Crop processing failed: Tag injection failed: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 240, in inject_kalliste_tags
    raise RuntimeError(f"Tag injection failed: {error_msg}")
RuntimeError: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 40, in process
    await self.inject_kalliste_tags()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 246, in inject_kalliste_tags
    raise RuntimeError(f"Tag injection failed: {e}") from e
RuntimeError: Tag injection failed: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 66, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 50, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: Tag injection failed: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.

Running detection on /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A9668.png
Error processing /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3136.png: Crop processing failed: Tag injection failed: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 240, in inject_kalliste_tags
    raise RuntimeError(f"Tag injection failed: {error_msg}")
RuntimeError: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 40, in process
    await self.inject_kalliste_tags()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 246, in inject_kalliste_tags
    raise RuntimeError(f"Tag injection failed: {e}") from e
RuntimeError: Tag injection failed: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 66, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 50, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: Tag injection failed: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.

Failed to process IMG_3136.png
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 240, in inject_kalliste_tags
    raise RuntimeError(f"Tag injection failed: {error_msg}")
RuntimeError: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 40, in process
    await self.inject_kalliste_tags()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 246, in inject_kalliste_tags
    raise RuntimeError(f"Tag injection failed: {e}") from e
RuntimeError: Tag injection failed: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 44, in process_image
    return await image.process()
           ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 66, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 50, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: Tag injection failed: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.

Starting processing for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_0241-2.png
Running detection on /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_0241-2.png
Detection complete. Found 2 total regions
Found 2 detections in /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3152.png
Starting crop processing for face from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3152.png
Starting crop processing for person from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3152.png
Running taggers for face crop
Running orientation tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_3152_face_crop.png
Running taggers for person crop
Detection complete. Found 2 total regions
Detection complete. Found 2 total regions
Cleaning up model registry
Starting model registry cleanup
Model registry cleanup complete
Model registry cleanup complete
[blue]Pipeline test complete[/]
ExifTool error while injecting tags: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.

Error injecting Kalliste tags: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 240, in inject_kalliste_tags
    raise RuntimeError(f"Tag injection failed: {error_msg}")
RuntimeError: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.

Error processing crop from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3320.png: Tag injection failed: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 240, in inject_kalliste_tags
    raise RuntimeError(f"Tag injection failed: {error_msg}")
RuntimeError: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 40, in process
    await self.inject_kalliste_tags()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 246, in inject_kalliste_tags
    raise RuntimeError(f"Tag injection failed: {e}") from e
RuntimeError: Tag injection failed: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.

[yellow]Pipeline test interrupted by user[/]
[blue]Starting pipeline test[/]
Input directory: [cyan]/Users/rob/repos/kalliste/test_images_input[/]
Output directory: [cyan]/Users/rob/repos/kalliste/test_images_output[/]
[green]Initializing BatchProcessor[/]
Initializing BatchProcessor with input_root=/Users/rob/repos/kalliste/test_images_input, output_root=/Users/rob/repos/kalliste/test_images_output
Scanning for batches in /Users/rob/repos/kalliste/test_images_input
Initializing Batch with input_path=/Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2, max_concurrent=3
Scanning for images in /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2
Found 9 images to process in batch 20180312_Photoshoot2
Initializing Batch with input_path=/Users/rob/repos/kalliste/test_images_input/20241012_Photoshoot1, max_concurrent=3
Scanning for images in /Users/rob/repos/kalliste/test_images_input/20241012_Photoshoot1
Found 12 images to process in batch 20241012_Photoshoot1
Found 2 batches to process
BatchProcessor created
Initializing models
Initializing BatchProcessor and model registry
Starting model registry initialization
Initializing tagger pipeline...
Creating TaggerPipeline instance
MPS device validated
TaggerPipeline created with device: mps
Starting tagger pipeline initialization
Initializing orientation tagger...
Creating OrientationTagger instance for device: mps
Orientation tagger created successfully
Initializing caption tagger...
Creating CaptionTagger instance for device: mps
Caption tagger created successfully
Initializing WD14 tagger...
Loading pretrained weights from Hugging Face hub (SmilingWolf/wd-vit-large-tagger-v3)
[SmilingWolf/wd-vit-large-tagger-v3] Safe alternative available for 'pytorch_model.bin' (as 'model.safetensors'). Loading weights using safetensors.
Loaded 10861 WD14 tags
Creating WD14Tagger instance for device: mps
WD14 tagger created successfully
All taggers initialized successfully
Tagger pipeline initialized successfully
Initializing YOLO detector...
Initializing YOLO detector
Loading YOLO model from /Users/rob/.cache/ultralytics/yolov8n.pt
YOLO model loaded successfully
Loading YOLO face model from /Users/rob/.cache/ultralytics/yolov8n-face.pt
YOLO face model loaded successfully
YOLODetector initialized with 1 active classes
YOLO detector initialized successfully
Model registry initialization complete
BatchProcessor and model registry initialized successfully
[green]BatchProcessor initialized successfully[/]
[green]Starting batch processing[/]
Starting batch processing
Starting batch: 20180312_Photoshoot2
Starting batch processing for 20180312_Photoshoot2 with 9 images
Starting processing for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3136.png
Starting processing for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3320.png
Starting processing for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3297.png
Running detection on /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3297.png
Running detection on /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3136.png
Running detection on /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3320.png
Fusing face model...
Fusing face model...
Fusing face model...
Model fusion failed for face model: 'Conv' object has no attribute 'bn'
Continuing with unfused model
Model fusion failed for face model: 'Conv' object has no attribute 'bn'
Continuing with unfused model
Face Model fused successfully
Fusing main model...
Main Model fused successfully
Detection complete. Found 2 total regions
Found 2 detections in /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3136.png
Starting crop processing for face from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3136.png
Starting crop processing for person from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3136.png
Running taggers for person crop
Detection complete. Found 2 total regions
Detection complete. Found 2 total regions
Running wd14 tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_3136_person_crop.png
Running caption tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_3136_person_crop.png
Running orientation tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_3136_person_crop.png
Found 2 detections in /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3320.png
Running taggers for face crop
Found 2 detections in /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3297.png
Starting crop processing for face from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3320.png
Starting crop processing for person from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3320.png
Running orientation tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_3136_face_crop.png
Starting crop processing for face from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3297.png
Starting crop processing for person from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3297.png
Running taggers for face crop
Running orientation tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_3320_face_crop.png
Running taggers for person crop
Running wd14 tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_3320_person_crop.png
Running caption tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_3320_person_crop.png
Running orientation tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_3320_person_crop.png
Running taggers for face crop
Running taggers for person crop
Running orientation tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_3297_face_crop.png
Running wd14 tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_3297_person_crop.png
Running caption tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_3297_person_crop.png
Running orientation tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_3297_person_crop.png
ExifTool error while injecting tags: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.

Error injecting Kalliste tags: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 240, in inject_kalliste_tags
    raise RuntimeError(f"Tag injection failed: {error_msg}")
RuntimeError: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.

Error processing crop from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3136.png: Tag injection failed: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 240, in inject_kalliste_tags
    raise RuntimeError(f"Tag injection failed: {error_msg}")
RuntimeError: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 40, in process
    await self.inject_kalliste_tags()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 246, in inject_kalliste_tags
    raise RuntimeError(f"Tag injection failed: {e}") from e
RuntimeError: Tag injection failed: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.

Error processing crops for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3136.png: Crop processing failed: Tag injection failed: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 240, in inject_kalliste_tags
    raise RuntimeError(f"Tag injection failed: {error_msg}")
RuntimeError: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 40, in process
    await self.inject_kalliste_tags()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 246, in inject_kalliste_tags
    raise RuntimeError(f"Tag injection failed: {e}") from e
RuntimeError: Tag injection failed: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 66, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 50, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: Tag injection failed: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.

Error processing /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3136.png: Crop processing failed: Tag injection failed: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 240, in inject_kalliste_tags
    raise RuntimeError(f"Tag injection failed: {error_msg}")
RuntimeError: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 40, in process
    await self.inject_kalliste_tags()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 246, in inject_kalliste_tags
    raise RuntimeError(f"Tag injection failed: {e}") from e
RuntimeError: Tag injection failed: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 66, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 50, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: Tag injection failed: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.

Failed to process IMG_3136.png
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 240, in inject_kalliste_tags
    raise RuntimeError(f"Tag injection failed: {error_msg}")
RuntimeError: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 40, in process
    await self.inject_kalliste_tags()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 246, in inject_kalliste_tags
    raise RuntimeError(f"Tag injection failed: {e}") from e
RuntimeError: Tag injection failed: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 44, in process_image
    return await image.process()
           ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 66, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 50, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: Tag injection failed: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.

Starting processing for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3152.png
ExifTool error while injecting tags: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.

Error injecting Kalliste tags: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 240, in inject_kalliste_tags
    raise RuntimeError(f"Tag injection failed: {error_msg}")
RuntimeError: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.

Error processing crop from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3136.png: Tag injection failed: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 240, in inject_kalliste_tags
    raise RuntimeError(f"Tag injection failed: {error_msg}")
RuntimeError: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 40, in process
    await self.inject_kalliste_tags()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 246, in inject_kalliste_tags
    raise RuntimeError(f"Tag injection failed: {e}") from e
RuntimeError: Tag injection failed: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.

ExifTool error while injecting tags: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.

Error injecting Kalliste tags: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 240, in inject_kalliste_tags
    raise RuntimeError(f"Tag injection failed: {error_msg}")
RuntimeError: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.

Error processing crop from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3320.png: Tag injection failed: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 240, in inject_kalliste_tags
    raise RuntimeError(f"Tag injection failed: {error_msg}")
RuntimeError: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 40, in process
    await self.inject_kalliste_tags()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 246, in inject_kalliste_tags
    raise RuntimeError(f"Tag injection failed: {e}") from e
RuntimeError: Tag injection failed: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.

Error processing crops for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3320.png: Crop processing failed: Tag injection failed: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 240, in inject_kalliste_tags
    raise RuntimeError(f"Tag injection failed: {error_msg}")
RuntimeError: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 40, in process
    await self.inject_kalliste_tags()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 246, in inject_kalliste_tags
    raise RuntimeError(f"Tag injection failed: {e}") from e
RuntimeError: Tag injection failed: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 66, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 50, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: Tag injection failed: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.

Running detection on /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3152.png
Error processing /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3320.png: Crop processing failed: Tag injection failed: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 240, in inject_kalliste_tags
    raise RuntimeError(f"Tag injection failed: {error_msg}")
RuntimeError: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 40, in process
    await self.inject_kalliste_tags()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 246, in inject_kalliste_tags
    raise RuntimeError(f"Tag injection failed: {e}") from e
RuntimeError: Tag injection failed: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 66, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 50, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: Tag injection failed: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.

Failed to process IMG_3320.png
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 240, in inject_kalliste_tags
    raise RuntimeError(f"Tag injection failed: {error_msg}")
RuntimeError: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 40, in process
    await self.inject_kalliste_tags()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 246, in inject_kalliste_tags
    raise RuntimeError(f"Tag injection failed: {e}") from e
RuntimeError: Tag injection failed: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 44, in process_image
    return await image.process()
           ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 66, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 50, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: Tag injection failed: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.

Starting processing for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A9668.png
Running detection on /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A9668.png
ExifTool error while injecting tags: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.

Error injecting Kalliste tags: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 240, in inject_kalliste_tags
    raise RuntimeError(f"Tag injection failed: {error_msg}")
RuntimeError: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.

Error processing crop from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3297.png: Tag injection failed: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 240, in inject_kalliste_tags
    raise RuntimeError(f"Tag injection failed: {error_msg}")
RuntimeError: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 40, in process
    await self.inject_kalliste_tags()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 246, in inject_kalliste_tags
    raise RuntimeError(f"Tag injection failed: {e}") from e
RuntimeError: Tag injection failed: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.

Error processing crops for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3297.png: Crop processing failed: Tag injection failed: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 240, in inject_kalliste_tags
    raise RuntimeError(f"Tag injection failed: {error_msg}")
RuntimeError: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 40, in process
    await self.inject_kalliste_tags()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 246, in inject_kalliste_tags
    raise RuntimeError(f"Tag injection failed: {e}") from e
RuntimeError: Tag injection failed: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 66, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 50, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: Tag injection failed: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.

Error processing /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3297.png: Crop processing failed: Tag injection failed: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 240, in inject_kalliste_tags
    raise RuntimeError(f"Tag injection failed: {error_msg}")
RuntimeError: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 40, in process
    await self.inject_kalliste_tags()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 246, in inject_kalliste_tags
    raise RuntimeError(f"Tag injection failed: {e}") from e
RuntimeError: Tag injection failed: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 66, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 50, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: Tag injection failed: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.

Failed to process IMG_3297.png
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 240, in inject_kalliste_tags
    raise RuntimeError(f"Tag injection failed: {error_msg}")
RuntimeError: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 40, in process
    await self.inject_kalliste_tags()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 246, in inject_kalliste_tags
    raise RuntimeError(f"Tag injection failed: {e}") from e
RuntimeError: Tag injection failed: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 44, in process_image
    return await image.process()
           ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 66, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 50, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: Tag injection failed: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.

Starting processing for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_0241-2.png
Running detection on /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_0241-2.png
ExifTool error while injecting tags: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.

Error injecting Kalliste tags: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 240, in inject_kalliste_tags
    raise RuntimeError(f"Tag injection failed: {error_msg}")
RuntimeError: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.

Error processing crop from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3297.png: Tag injection failed: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 240, in inject_kalliste_tags
    raise RuntimeError(f"Tag injection failed: {error_msg}")
RuntimeError: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 40, in process
    await self.inject_kalliste_tags()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 246, in inject_kalliste_tags
    raise RuntimeError(f"Tag injection failed: {e}") from e
RuntimeError: Tag injection failed: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.

Detection complete. Found 2 total regions
Found 2 detections in /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3152.png
Starting crop processing for face from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3152.png
Starting crop processing for person from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3152.png
Running taggers for face crop
Running orientation tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_3152_face_crop.png
Running taggers for person crop
Detection complete. Found 2 total regions
Detection complete. Found 2 total regions
Running wd14 tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_3152_person_crop.png
Running caption tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_3152_person_crop.png
Cleaning up model registry
Starting model registry cleanup
Model registry cleanup complete
Model registry cleanup complete
[blue]Pipeline test complete[/]
ExifTool error while injecting tags: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.

Error injecting Kalliste tags: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 240, in inject_kalliste_tags
    raise RuntimeError(f"Tag injection failed: {error_msg}")
RuntimeError: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.

Error processing crop from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3320.png: Tag injection failed: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 240, in inject_kalliste_tags
    raise RuntimeError(f"Tag injection failed: {error_msg}")
RuntimeError: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 40, in process
    await self.inject_kalliste_tags()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 246, in inject_kalliste_tags
    raise RuntimeError(f"Tag injection failed: {e}") from e
RuntimeError: Tag injection failed: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.

[yellow]Pipeline test interrupted by user[/]
[blue]Starting pipeline test[/]
Input directory: [cyan]/Users/rob/repos/kalliste/test_images_input[/]
Output directory: [cyan]/Users/rob/repos/kalliste/test_images_output[/]
[green]Initializing BatchProcessor[/]
Initializing BatchProcessor with input_root=/Users/rob/repos/kalliste/test_images_input, output_root=/Users/rob/repos/kalliste/test_images_output
Scanning for batches in /Users/rob/repos/kalliste/test_images_input
Initializing Batch with input_path=/Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2, max_concurrent=3
Scanning for images in /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2
Found 9 images to process in batch 20180312_Photoshoot2
Initializing Batch with input_path=/Users/rob/repos/kalliste/test_images_input/20241012_Photoshoot1, max_concurrent=3
Scanning for images in /Users/rob/repos/kalliste/test_images_input/20241012_Photoshoot1
Found 12 images to process in batch 20241012_Photoshoot1
Found 2 batches to process
BatchProcessor created
Initializing models
Initializing BatchProcessor and model registry
Starting model registry initialization
Initializing tagger pipeline...
Creating TaggerPipeline instance
MPS device validated
TaggerPipeline created with device: mps
Starting tagger pipeline initialization
Initializing orientation tagger...
Creating OrientationTagger instance for device: mps
Orientation tagger created successfully
Initializing caption tagger...
Creating CaptionTagger instance for device: mps
Caption tagger created successfully
Initializing WD14 tagger...
Loading pretrained weights from Hugging Face hub (SmilingWolf/wd-vit-large-tagger-v3)
[SmilingWolf/wd-vit-large-tagger-v3] Safe alternative available for 'pytorch_model.bin' (as 'model.safetensors'). Loading weights using safetensors.
Loaded 10861 WD14 tags
Creating WD14Tagger instance for device: mps
WD14 tagger created successfully
All taggers initialized successfully
Tagger pipeline initialized successfully
Initializing YOLO detector...
Initializing YOLO detector
Loading YOLO model from /Users/rob/.cache/ultralytics/yolov8n.pt
YOLO model loaded successfully
Loading YOLO face model from /Users/rob/.cache/ultralytics/yolov8n-face.pt
YOLO face model loaded successfully
YOLODetector initialized with 1 active classes
YOLO detector initialized successfully
Model registry initialization complete
BatchProcessor and model registry initialized successfully
[green]BatchProcessor initialized successfully[/]
[green]Starting batch processing[/]
Starting batch processing
Starting batch: 20180312_Photoshoot2
Starting batch processing for 20180312_Photoshoot2 with 9 images
Starting processing for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3136.png
Starting processing for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3320.png
Starting processing for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3297.png
Running detection on /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3297.png
Running detection on /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3136.png
Fusing face model...
Fusing face model...
Model fusion failed for face model: 'Conv' object has no attribute 'bn'
Continuing with unfused model
Running detection on /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3320.png
Fusing face model...
Face Model fused successfully
Face Model fused successfully
Fusing main model...
Main Model fused successfully
Detection complete. Found 2 total regions
Found 2 detections in /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3136.png
Starting crop processing for face from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3136.png
Starting crop processing for person from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3136.png
Detection complete. Found 2 total regions
Found 2 detections in /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3297.png
Starting crop processing for face from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3297.png
Starting crop processing for person from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3297.png
Running taggers for face crop
Running orientation tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_3136_face_crop.png
Detection complete. Found 2 total regions
Running taggers for person crop
Running orientation tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_3136_person_crop.png
Running caption tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_3136_person_crop.png
Running wd14 tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_3136_person_crop.png
Running taggers for face crop
Running taggers for person crop
Found 2 detections in /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3320.png
Running orientation tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_3297_face_crop.png
Running orientation tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_3297_person_crop.png
Running caption tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_3297_person_crop.png
Running wd14 tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_3297_person_crop.png
Starting crop processing for face from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3320.png
Starting crop processing for person from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3320.png
ExifTool error while injecting tags: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.

Error injecting Kalliste tags: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 240, in inject_kalliste_tags
    raise RuntimeError(f"Tag injection failed: {error_msg}")
RuntimeError: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.

Error processing crop from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3136.png: Tag injection failed: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 240, in inject_kalliste_tags
    raise RuntimeError(f"Tag injection failed: {error_msg}")
RuntimeError: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 40, in process
    await self.inject_kalliste_tags()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 246, in inject_kalliste_tags
    raise RuntimeError(f"Tag injection failed: {e}") from e
RuntimeError: Tag injection failed: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.

Error processing crops for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3136.png: Crop processing failed: Tag injection failed: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 240, in inject_kalliste_tags
    raise RuntimeError(f"Tag injection failed: {error_msg}")
RuntimeError: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 40, in process
    await self.inject_kalliste_tags()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 246, in inject_kalliste_tags
    raise RuntimeError(f"Tag injection failed: {e}") from e
RuntimeError: Tag injection failed: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 66, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 50, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: Tag injection failed: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.

Error processing /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3136.png: Crop processing failed: Tag injection failed: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 240, in inject_kalliste_tags
    raise RuntimeError(f"Tag injection failed: {error_msg}")
RuntimeError: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 40, in process
    await self.inject_kalliste_tags()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 246, in inject_kalliste_tags
    raise RuntimeError(f"Tag injection failed: {e}") from e
RuntimeError: Tag injection failed: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 66, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 50, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: Tag injection failed: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.

Failed to process IMG_3136.png
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 240, in inject_kalliste_tags
    raise RuntimeError(f"Tag injection failed: {error_msg}")
RuntimeError: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 40, in process
    await self.inject_kalliste_tags()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 246, in inject_kalliste_tags
    raise RuntimeError(f"Tag injection failed: {e}") from e
RuntimeError: Tag injection failed: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 44, in process_image
    return await image.process()
           ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 66, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 50, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: Tag injection failed: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.

Starting processing for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3152.png
Running detection on /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3152.png
ExifTool error while injecting tags: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.

Error injecting Kalliste tags: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 240, in inject_kalliste_tags
    raise RuntimeError(f"Tag injection failed: {error_msg}")
RuntimeError: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.

Error processing crop from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3297.png: Tag injection failed: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 240, in inject_kalliste_tags
    raise RuntimeError(f"Tag injection failed: {error_msg}")
RuntimeError: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 40, in process
    await self.inject_kalliste_tags()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 246, in inject_kalliste_tags
    raise RuntimeError(f"Tag injection failed: {e}") from e
RuntimeError: Tag injection failed: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.

Error processing crops for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3297.png: Crop processing failed: Tag injection failed: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 240, in inject_kalliste_tags
    raise RuntimeError(f"Tag injection failed: {error_msg}")
RuntimeError: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 40, in process
    await self.inject_kalliste_tags()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 246, in inject_kalliste_tags
    raise RuntimeError(f"Tag injection failed: {e}") from e
RuntimeError: Tag injection failed: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 66, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 50, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: Tag injection failed: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.

Error processing /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3297.png: Crop processing failed: Tag injection failed: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 240, in inject_kalliste_tags
    raise RuntimeError(f"Tag injection failed: {error_msg}")
RuntimeError: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 40, in process
    await self.inject_kalliste_tags()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 246, in inject_kalliste_tags
    raise RuntimeError(f"Tag injection failed: {e}") from e
RuntimeError: Tag injection failed: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 66, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 50, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: Tag injection failed: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.

Failed to process IMG_3297.png
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 240, in inject_kalliste_tags
    raise RuntimeError(f"Tag injection failed: {error_msg}")
RuntimeError: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 40, in process
    await self.inject_kalliste_tags()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 246, in inject_kalliste_tags
    raise RuntimeError(f"Tag injection failed: {e}") from e
RuntimeError: Tag injection failed: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 44, in process_image
    return await image.process()
           ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 66, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 50, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: Tag injection failed: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.

Starting processing for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A9668.png
Running taggers for face crop
Running orientation tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_3320_face_crop.png
Running taggers for person crop
Detection complete. Found 2 total regions
Running detection on /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A9668.png
Running orientation tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_3320_person_crop.png
Running caption tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_3320_person_crop.png
Detection complete. Found 2 total regions
Running wd14 tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_3320_person_crop.png
Found 2 detections in /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3152.png
Starting crop processing for face from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3152.png
Starting crop processing for person from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3152.png
Found 2 detections in /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A9668.png
Starting crop processing for face from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A9668.png
Starting crop processing for person from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A9668.png
ExifTool error while injecting tags: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.

Error injecting Kalliste tags: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 240, in inject_kalliste_tags
    raise RuntimeError(f"Tag injection failed: {error_msg}")
RuntimeError: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.

Error processing crop from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3297.png: Tag injection failed: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 240, in inject_kalliste_tags
    raise RuntimeError(f"Tag injection failed: {error_msg}")
RuntimeError: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 40, in process
    await self.inject_kalliste_tags()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 246, in inject_kalliste_tags
    raise RuntimeError(f"Tag injection failed: {e}") from e
RuntimeError: Tag injection failed: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.

ExifTool error while injecting tags: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.

Error injecting Kalliste tags: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 240, in inject_kalliste_tags
    raise RuntimeError(f"Tag injection failed: {error_msg}")
RuntimeError: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.

Error processing crop from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/IMG_3136.png: Tag injection failed: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 240, in inject_kalliste_tags
    raise RuntimeError(f"Tag injection failed: {error_msg}")
RuntimeError: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 40, in process
    await self.inject_kalliste_tags()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 246, in inject_kalliste_tags
    raise RuntimeError(f"Tag injection failed: {e}") from e
RuntimeError: Tag injection failed: Tag injection failed: Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Warning: Tag 'XMP:Kalliste:Tag' is not defined
Warning: Tag 'XMP:Kalliste:TagSource' is not defined
Warning: Tag 'XMP:Kalliste:TagConfidence' is not defined
Nothing to do.

Running taggers for face crop
Running orientation tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_3152_face_crop.png
Running taggers for person crop
Running orientation tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_3152_person_crop.png
Running caption tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/IMG_3152_person_crop.png
Cleaning up model registry
Starting model registry cleanup
Model registry cleanup complete
Model registry cleanup complete
[blue]Pipeline test complete[/]
[yellow]Pipeline test interrupted by user[/]
[blue]Starting pipeline test[/]
Input directory: [cyan]/Users/rob/repos/kalliste/test_images_input[/]
Output directory: [cyan]/Users/rob/repos/kalliste/test_images_output[/]
[green]Initializing BatchProcessor[/]
Initializing BatchProcessor with input_root=/Users/rob/repos/kalliste/test_images_input, output_root=/Users/rob/repos/kalliste/test_images_output
Scanning for batches in /Users/rob/repos/kalliste/test_images_input
Initializing Batch with input_path=/Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2, max_concurrent=3
Scanning for images in /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2
Found 1 images to process in batch 20180312_Photoshoot2
Found 1 batches to process
BatchProcessor created
Initializing models
Initializing BatchProcessor and model registry
Starting model registry initialization
Initializing tagger pipeline...
Creating TaggerPipeline instance
MPS device validated
TaggerPipeline created with device: mps
Starting tagger pipeline initialization
Initializing orientation tagger...
Creating OrientationTagger instance for device: mps
Orientation tagger created successfully
Initializing caption tagger...
Creating CaptionTagger instance for device: mps
Caption tagger created successfully
Initializing WD14 tagger...
Loading pretrained weights from Hugging Face hub (SmilingWolf/wd-vit-large-tagger-v3)
[SmilingWolf/wd-vit-large-tagger-v3] Safe alternative available for 'pytorch_model.bin' (as 'model.safetensors'). Loading weights using safetensors.
Loaded 10861 WD14 tags
Creating WD14Tagger instance for device: mps
WD14 tagger created successfully
All taggers initialized successfully
Tagger pipeline initialized successfully
Initializing YOLO detector...
Initializing YOLO detector
Loading YOLO model from /Users/rob/.cache/ultralytics/yolov8n.pt
YOLO model loaded successfully
Loading YOLO face model from /Users/rob/.cache/ultralytics/yolov8n-face.pt
YOLO face model loaded successfully
YOLODetector initialized with 1 active classes
YOLO detector initialized successfully
Model registry initialization complete
BatchProcessor and model registry initialized successfully
[green]BatchProcessor initialized successfully[/]
[green]Starting batch processing[/]
Starting batch processing
Starting batch: 20180312_Photoshoot2
Starting batch processing for 20180312_Photoshoot2 with 1 images
Starting processing for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png
Running detection on /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png
Fusing face model...
Face Model fused successfully
Fusing main model...
Main Model fused successfully
Detection complete. Found 6 total regions
Found 6 detections in /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png
Starting crop processing for face from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png
Error processing crop from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png: 'CroppedImage' object has no attribute 'crop_image'
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 38, in process
    await self.crop_image()
          ^^^^^^^^^^^^^^^
AttributeError: 'CroppedImage' object has no attribute 'crop_image'
Starting crop processing for face from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png
Error processing crop from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png: 'CroppedImage' object has no attribute 'crop_image'
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 38, in process
    await self.crop_image()
          ^^^^^^^^^^^^^^^
AttributeError: 'CroppedImage' object has no attribute 'crop_image'
Starting crop processing for face from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png
Error processing crop from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png: 'CroppedImage' object has no attribute 'crop_image'
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 38, in process
    await self.crop_image()
          ^^^^^^^^^^^^^^^
AttributeError: 'CroppedImage' object has no attribute 'crop_image'
Starting crop processing for person from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png
Error processing crop from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png: 'CroppedImage' object has no attribute 'crop_image'
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 38, in process
    await self.crop_image()
          ^^^^^^^^^^^^^^^
AttributeError: 'CroppedImage' object has no attribute 'crop_image'
Starting crop processing for person from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png
Error processing crop from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png: 'CroppedImage' object has no attribute 'crop_image'
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 38, in process
    await self.crop_image()
          ^^^^^^^^^^^^^^^
AttributeError: 'CroppedImage' object has no attribute 'crop_image'
Starting crop processing for person from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png
Error processing crop from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png: 'CroppedImage' object has no attribute 'crop_image'
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 38, in process
    await self.crop_image()
          ^^^^^^^^^^^^^^^
AttributeError: 'CroppedImage' object has no attribute 'crop_image'
Error processing crops for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png: Crop processing failed: 'CroppedImage' object has no attribute 'crop_image'
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 38, in process
    await self.crop_image()
          ^^^^^^^^^^^^^^^
AttributeError: 'CroppedImage' object has no attribute 'crop_image'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 66, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 57, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: 'CroppedImage' object has no attribute 'crop_image'
Error processing /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png: Crop processing failed: 'CroppedImage' object has no attribute 'crop_image'
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 38, in process
    await self.crop_image()
          ^^^^^^^^^^^^^^^
AttributeError: 'CroppedImage' object has no attribute 'crop_image'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 66, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 57, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: 'CroppedImage' object has no attribute 'crop_image'
Failed to process 3M2A2876.png
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 38, in process
    await self.crop_image()
          ^^^^^^^^^^^^^^^
AttributeError: 'CroppedImage' object has no attribute 'crop_image'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 44, in process_image
    return await image.process()
           ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 66, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 57, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: 'CroppedImage' object has no attribute 'crop_image'
Batch processing completed with 1 errors
Batch processing failed
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 38, in process
    await self.crop_image()
          ^^^^^^^^^^^^^^^
AttributeError: 'CroppedImage' object has no attribute 'crop_image'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 75, in process
    raise errors[0]
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 44, in process_image
    return await image.process()
           ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 66, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 57, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: 'CroppedImage' object has no attribute 'crop_image'
Failed to process batch 20180312_Photoshoot2
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 38, in process
    await self.crop_image()
          ^^^^^^^^^^^^^^^
AttributeError: 'CroppedImage' object has no attribute 'crop_image'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/batch_processor.py", line 82, in process_batch
    await batch.process()
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 75, in process
    raise errors[0]
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 44, in process_image
    return await image.process()
           ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 66, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 57, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: 'CroppedImage' object has no attribute 'crop_image'
Batch processing failed
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/batch_processor.py", line 118, in process_all
    raise RuntimeError(
RuntimeError: Failed to process 1 batch(es):
Batch 20180312_Photoshoot2: Crop processing failed: 'CroppedImage' object has no attribute 'crop_image'
Cleaning up model registry
Starting model registry cleanup
Model registry cleanup complete
Model registry cleanup complete
[red bold]Error during batch processing[/]
[blue]Pipeline test complete[/]
[red bold]Pipeline test failed[/]
[blue]Starting pipeline test[/]
Input directory: [cyan]/Users/rob/repos/kalliste/test_images_input[/]
Output directory: [cyan]/Users/rob/repos/kalliste/test_images_output[/]
[green]Initializing BatchProcessor[/]
Initializing BatchProcessor with input_root=/Users/rob/repos/kalliste/test_images_input, output_root=/Users/rob/repos/kalliste/test_images_output
Scanning for batches in /Users/rob/repos/kalliste/test_images_input
Initializing Batch with input_path=/Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2, max_concurrent=3
Scanning for images in /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2
Found 1 images to process in batch 20180312_Photoshoot2
Found 1 batches to process
BatchProcessor created
Initializing models
Initializing BatchProcessor and model registry
Starting model registry initialization
Initializing tagger pipeline...
Creating TaggerPipeline instance
MPS device validated
TaggerPipeline created with device: mps
Starting tagger pipeline initialization
Initializing orientation tagger...
Creating OrientationTagger instance for device: mps
Orientation tagger created successfully
Initializing caption tagger...
Creating CaptionTagger instance for device: mps
Caption tagger created successfully
Initializing WD14 tagger...
Loading pretrained weights from Hugging Face hub (SmilingWolf/wd-vit-large-tagger-v3)
[SmilingWolf/wd-vit-large-tagger-v3] Safe alternative available for 'pytorch_model.bin' (as 'model.safetensors'). Loading weights using safetensors.
Loaded 10861 WD14 tags
Creating WD14Tagger instance for device: mps
WD14 tagger created successfully
All taggers initialized successfully
Tagger pipeline initialized successfully
Initializing YOLO detector...
Initializing YOLO detector
Loading YOLO model from /Users/rob/.cache/ultralytics/yolov8n.pt
YOLO model loaded successfully
Loading YOLO face model from /Users/rob/.cache/ultralytics/yolov8n-face.pt
YOLO face model loaded successfully
YOLODetector initialized with 1 active classes
YOLO detector initialized successfully
Model registry initialization complete
BatchProcessor and model registry initialized successfully
[green]BatchProcessor initialized successfully[/]
[green]Starting batch processing[/]
Starting batch processing
Starting batch: 20180312_Photoshoot2
Starting batch processing for 20180312_Photoshoot2 with 1 images
Starting processing for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png
Running detection on /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png
Fusing face model...
Face Model fused successfully
Fusing main model...
Main Model fused successfully
Detection complete. Found 6 total regions
Found 6 detections in /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png
Starting crop processing for face from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png
Starting crop processing for face from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png
Starting crop processing for face from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png
Starting crop processing for person from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png
Starting crop processing for person from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png
Starting crop processing for person from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png
ExifTool error: Warning: Tag 'PixelDimensions' is not defined
Error: File already exists: /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_face_crop.png_exiftool_tmp - /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_face_crop.png

Error copying metadata: ExifTool failed: Warning: Tag 'PixelDimensions' is not defined
Error: File already exists: /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_face_crop.png_exiftool_tmp - /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_face_crop.png
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 196, in copy_metadata_from_source
    raise RuntimeError(f"ExifTool failed: {error_msg}")
RuntimeError: ExifTool failed: Warning: Tag 'PixelDimensions' is not defined
Error: File already exists: /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_face_crop.png_exiftool_tmp - /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_face_crop.png

Error processing crop from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png: Metadata copy failed: ExifTool failed: Warning: Tag 'PixelDimensions' is not defined
Error: File already exists: /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_face_crop.png_exiftool_tmp - /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_face_crop.png
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 196, in copy_metadata_from_source
    raise RuntimeError(f"ExifTool failed: {error_msg}")
RuntimeError: ExifTool failed: Warning: Tag 'PixelDimensions' is not defined
Error: File already exists: /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_face_crop.png_exiftool_tmp - /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_face_crop.png


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 44, in process
    await self.copy_metadata_from_source()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 202, in copy_metadata_from_source
    raise RuntimeError(f"Metadata copy failed: {e}") from e
RuntimeError: Metadata copy failed: ExifTool failed: Warning: Tag 'PixelDimensions' is not defined
Error: File already exists: /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_face_crop.png_exiftool_tmp - /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_face_crop.png

Error processing crops for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png: Crop processing failed: Metadata copy failed: ExifTool failed: Warning: Tag 'PixelDimensions' is not defined
Error: File already exists: /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_face_crop.png_exiftool_tmp - /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_face_crop.png
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 196, in copy_metadata_from_source
    raise RuntimeError(f"ExifTool failed: {error_msg}")
RuntimeError: ExifTool failed: Warning: Tag 'PixelDimensions' is not defined
Error: File already exists: /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_face_crop.png_exiftool_tmp - /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_face_crop.png


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 44, in process
    await self.copy_metadata_from_source()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 202, in copy_metadata_from_source
    raise RuntimeError(f"Metadata copy failed: {e}") from e
RuntimeError: Metadata copy failed: ExifTool failed: Warning: Tag 'PixelDimensions' is not defined
Error: File already exists: /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_face_crop.png_exiftool_tmp - /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_face_crop.png


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 66, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 57, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: Metadata copy failed: ExifTool failed: Warning: Tag 'PixelDimensions' is not defined
Error: File already exists: /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_face_crop.png_exiftool_tmp - /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_face_crop.png

Error processing /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png: Crop processing failed: Metadata copy failed: ExifTool failed: Warning: Tag 'PixelDimensions' is not defined
Error: File already exists: /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_face_crop.png_exiftool_tmp - /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_face_crop.png
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 196, in copy_metadata_from_source
    raise RuntimeError(f"ExifTool failed: {error_msg}")
RuntimeError: ExifTool failed: Warning: Tag 'PixelDimensions' is not defined
Error: File already exists: /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_face_crop.png_exiftool_tmp - /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_face_crop.png


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 44, in process
    await self.copy_metadata_from_source()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 202, in copy_metadata_from_source
    raise RuntimeError(f"Metadata copy failed: {e}") from e
RuntimeError: Metadata copy failed: ExifTool failed: Warning: Tag 'PixelDimensions' is not defined
Error: File already exists: /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_face_crop.png_exiftool_tmp - /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_face_crop.png


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 66, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 57, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: Metadata copy failed: ExifTool failed: Warning: Tag 'PixelDimensions' is not defined
Error: File already exists: /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_face_crop.png_exiftool_tmp - /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_face_crop.png

Failed to process 3M2A2876.png
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 196, in copy_metadata_from_source
    raise RuntimeError(f"ExifTool failed: {error_msg}")
RuntimeError: ExifTool failed: Warning: Tag 'PixelDimensions' is not defined
Error: File already exists: /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_face_crop.png_exiftool_tmp - /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_face_crop.png


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 44, in process
    await self.copy_metadata_from_source()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 202, in copy_metadata_from_source
    raise RuntimeError(f"Metadata copy failed: {e}") from e
RuntimeError: Metadata copy failed: ExifTool failed: Warning: Tag 'PixelDimensions' is not defined
Error: File already exists: /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_face_crop.png_exiftool_tmp - /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_face_crop.png


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 44, in process_image
    return await image.process()
           ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 66, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 57, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: Metadata copy failed: ExifTool failed: Warning: Tag 'PixelDimensions' is not defined
Error: File already exists: /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_face_crop.png_exiftool_tmp - /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_face_crop.png

Batch processing completed with 1 errors
Batch processing failed
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 196, in copy_metadata_from_source
    raise RuntimeError(f"ExifTool failed: {error_msg}")
RuntimeError: ExifTool failed: Warning: Tag 'PixelDimensions' is not defined
Error: File already exists: /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_face_crop.png_exiftool_tmp - /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_face_crop.png


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 44, in process
    await self.copy_metadata_from_source()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 202, in copy_metadata_from_source
    raise RuntimeError(f"Metadata copy failed: {e}") from e
RuntimeError: Metadata copy failed: ExifTool failed: Warning: Tag 'PixelDimensions' is not defined
Error: File already exists: /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_face_crop.png_exiftool_tmp - /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_face_crop.png


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 75, in process
    raise errors[0]
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 44, in process_image
    return await image.process()
           ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 66, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 57, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: Metadata copy failed: ExifTool failed: Warning: Tag 'PixelDimensions' is not defined
Error: File already exists: /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_face_crop.png_exiftool_tmp - /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_face_crop.png

Failed to process batch 20180312_Photoshoot2
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 196, in copy_metadata_from_source
    raise RuntimeError(f"ExifTool failed: {error_msg}")
RuntimeError: ExifTool failed: Warning: Tag 'PixelDimensions' is not defined
Error: File already exists: /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_face_crop.png_exiftool_tmp - /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_face_crop.png


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 44, in process
    await self.copy_metadata_from_source()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 202, in copy_metadata_from_source
    raise RuntimeError(f"Metadata copy failed: {e}") from e
RuntimeError: Metadata copy failed: ExifTool failed: Warning: Tag 'PixelDimensions' is not defined
Error: File already exists: /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_face_crop.png_exiftool_tmp - /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_face_crop.png


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/batch_processor.py", line 82, in process_batch
    await batch.process()
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 75, in process
    raise errors[0]
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 44, in process_image
    return await image.process()
           ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 66, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 57, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: Metadata copy failed: ExifTool failed: Warning: Tag 'PixelDimensions' is not defined
Error: File already exists: /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_face_crop.png_exiftool_tmp - /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_face_crop.png

Batch processing failed
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/batch_processor.py", line 118, in process_all
    raise RuntimeError(
RuntimeError: Failed to process 1 batch(es):
Batch 20180312_Photoshoot2: Crop processing failed: Metadata copy failed: ExifTool failed: Warning: Tag 'PixelDimensions' is not defined
Error: File already exists: /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_face_crop.png_exiftool_tmp - /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_face_crop.png

Cleaning up model registry
Starting model registry cleanup
Model registry cleanup complete
Model registry cleanup complete
[red bold]Error during batch processing[/]
[blue]Pipeline test complete[/]
[red bold]Pipeline test failed[/]
[blue]Starting pipeline test[/]
Input directory: [cyan]/Users/rob/repos/kalliste/test_images_input[/]
Output directory: [cyan]/Users/rob/repos/kalliste/test_images_output[/]
[green]Initializing BatchProcessor[/]
Initializing BatchProcessor with input_root=/Users/rob/repos/kalliste/test_images_input, output_root=/Users/rob/repos/kalliste/test_images_output
Scanning for batches in /Users/rob/repos/kalliste/test_images_input
Initializing Batch with input_path=/Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2, max_concurrent=3
Scanning for images in /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2
Found 1 images to process in batch 20180312_Photoshoot2
Found 1 batches to process
BatchProcessor created
Initializing models
Initializing BatchProcessor and model registry
Starting model registry initialization
Initializing tagger pipeline...
Creating TaggerPipeline instance
MPS device validated
TaggerPipeline created with device: mps
Starting tagger pipeline initialization
Initializing orientation tagger...
Creating OrientationTagger instance for device: mps
Orientation tagger created successfully
Initializing caption tagger...
Creating CaptionTagger instance for device: mps
Caption tagger created successfully
Initializing WD14 tagger...
Loading pretrained weights from Hugging Face hub (SmilingWolf/wd-vit-large-tagger-v3)
[SmilingWolf/wd-vit-large-tagger-v3] Safe alternative available for 'pytorch_model.bin' (as 'model.safetensors'). Loading weights using safetensors.
Loaded 10861 WD14 tags
Creating WD14Tagger instance for device: mps
WD14 tagger created successfully
All taggers initialized successfully
Tagger pipeline initialized successfully
Initializing YOLO detector...
Initializing YOLO detector
Loading YOLO model from /Users/rob/.cache/ultralytics/yolov8n.pt
YOLO model loaded successfully
Loading YOLO face model from /Users/rob/.cache/ultralytics/yolov8n-face.pt
YOLO face model loaded successfully
YOLODetector initialized with 1 active classes
YOLO detector initialized successfully
Model registry initialization complete
BatchProcessor and model registry initialized successfully
[green]BatchProcessor initialized successfully[/]
[green]Starting batch processing[/]
Starting batch processing
Starting batch: 20180312_Photoshoot2
Starting batch processing for 20180312_Photoshoot2 with 1 images
Starting processing for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png
Running detection on /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png
Fusing face model...
Face Model fused successfully
Fusing main model...
Main Model fused successfully
Detection complete. Found 6 total regions
Found 6 detections in /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png
Starting crop processing for face from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png
Starting crop processing for face from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png
Starting crop processing for face from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png
Starting crop processing for person from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png
Starting crop processing for person from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png
Starting crop processing for person from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png
Running taggers for face crop
Running orientation tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_face_crop.png
Orientation tagging failed for /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_face_crop.png: unrecognized data stream contents when reading image file
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/taggers/orientation_tagger.py", line 43, in tag_image
    inputs = self.processor(images=image, return_tensors="pt").to(device)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/transformers/image_processing_utils.py", line 41, in __call__
    return self.preprocess(images, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/transformers/utils/generic.py", line 852, in wrapper
    return func(*args, **valid_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/transformers/models/vit/image_processing_vit.py", line 248, in preprocess
    images = [to_numpy_array(image) for image in images]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/transformers/models/vit/image_processing_vit.py", line 248, in <listcomp>
    images = [to_numpy_array(image) for image in images]
              ^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/transformers/image_utils.py", line 217, in to_numpy_array
    return np.array(img)
           ^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/PIL/Image.py", line 756, in __array_interface__
    new["data"] = self.tobytes()
                  ^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/PIL/Image.py", line 805, in tobytes
    self.load()
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/PIL/ImageFile.py", line 319, in load
    raise _get_oserror(err_code, encoder=False)
OSError: unrecognized data stream contents when reading image file
Error in orientation tagger: unrecognized data stream contents when reading image file
Running taggers for face crop
Running taggers for face crop
Tagger orientation failed: unrecognized data stream contents when reading image file
Running orientation tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_face_crop.png
Running orientation tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_face_crop.png
Completed processing crop from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png
Cropped image /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_face_crop.png complete
ExifTool error: Warning: Sorry, FileSize is not writable
Warning: Sorry, FileType is not writable
Warning: Sorry, FileTypeExtension is not writable
Error: Temporary file already exists: /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_face_crop.png_exiftool_tmp

Error copying metadata: ExifTool failed: Warning: Sorry, FileSize is not writable
Warning: Sorry, FileType is not writable
Warning: Sorry, FileTypeExtension is not writable
Error: Temporary file already exists: /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_face_crop.png_exiftool_tmp
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 204, in copy_metadata_from_source
    raise RuntimeError(f"ExifTool failed: {error_msg}")
RuntimeError: ExifTool failed: Warning: Sorry, FileSize is not writable
Warning: Sorry, FileType is not writable
Warning: Sorry, FileTypeExtension is not writable
Error: Temporary file already exists: /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_face_crop.png_exiftool_tmp

Error processing crop from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png: Metadata copy failed: ExifTool failed: Warning: Sorry, FileSize is not writable
Warning: Sorry, FileType is not writable
Warning: Sorry, FileTypeExtension is not writable
Error: Temporary file already exists: /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_face_crop.png_exiftool_tmp
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 204, in copy_metadata_from_source
    raise RuntimeError(f"ExifTool failed: {error_msg}")
RuntimeError: ExifTool failed: Warning: Sorry, FileSize is not writable
Warning: Sorry, FileType is not writable
Warning: Sorry, FileTypeExtension is not writable
Error: Temporary file already exists: /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_face_crop.png_exiftool_tmp


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 49, in process
    await self.copy_metadata_from_source()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 210, in copy_metadata_from_source
    raise RuntimeError(f"Metadata copy failed: {e}") from e
RuntimeError: Metadata copy failed: ExifTool failed: Warning: Sorry, FileSize is not writable
Warning: Sorry, FileType is not writable
Warning: Sorry, FileTypeExtension is not writable
Error: Temporary file already exists: /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_face_crop.png_exiftool_tmp

Error processing crops for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png: Crop processing failed: Metadata copy failed: ExifTool failed: Warning: Sorry, FileSize is not writable
Warning: Sorry, FileType is not writable
Warning: Sorry, FileTypeExtension is not writable
Error: Temporary file already exists: /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_face_crop.png_exiftool_tmp
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 204, in copy_metadata_from_source
    raise RuntimeError(f"ExifTool failed: {error_msg}")
RuntimeError: ExifTool failed: Warning: Sorry, FileSize is not writable
Warning: Sorry, FileType is not writable
Warning: Sorry, FileTypeExtension is not writable
Error: Temporary file already exists: /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_face_crop.png_exiftool_tmp


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 49, in process
    await self.copy_metadata_from_source()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 210, in copy_metadata_from_source
    raise RuntimeError(f"Metadata copy failed: {e}") from e
RuntimeError: Metadata copy failed: ExifTool failed: Warning: Sorry, FileSize is not writable
Warning: Sorry, FileType is not writable
Warning: Sorry, FileTypeExtension is not writable
Error: Temporary file already exists: /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_face_crop.png_exiftool_tmp


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 66, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 59, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: Metadata copy failed: ExifTool failed: Warning: Sorry, FileSize is not writable
Warning: Sorry, FileType is not writable
Warning: Sorry, FileTypeExtension is not writable
Error: Temporary file already exists: /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_face_crop.png_exiftool_tmp

Error processing /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png: Crop processing failed: Metadata copy failed: ExifTool failed: Warning: Sorry, FileSize is not writable
Warning: Sorry, FileType is not writable
Warning: Sorry, FileTypeExtension is not writable
Error: Temporary file already exists: /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_face_crop.png_exiftool_tmp
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 204, in copy_metadata_from_source
    raise RuntimeError(f"ExifTool failed: {error_msg}")
RuntimeError: ExifTool failed: Warning: Sorry, FileSize is not writable
Warning: Sorry, FileType is not writable
Warning: Sorry, FileTypeExtension is not writable
Error: Temporary file already exists: /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_face_crop.png_exiftool_tmp


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 49, in process
    await self.copy_metadata_from_source()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 210, in copy_metadata_from_source
    raise RuntimeError(f"Metadata copy failed: {e}") from e
RuntimeError: Metadata copy failed: ExifTool failed: Warning: Sorry, FileSize is not writable
Warning: Sorry, FileType is not writable
Warning: Sorry, FileTypeExtension is not writable
Error: Temporary file already exists: /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_face_crop.png_exiftool_tmp


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 66, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 59, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: Metadata copy failed: ExifTool failed: Warning: Sorry, FileSize is not writable
Warning: Sorry, FileType is not writable
Warning: Sorry, FileTypeExtension is not writable
Error: Temporary file already exists: /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_face_crop.png_exiftool_tmp

Failed to process 3M2A2876.png
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 204, in copy_metadata_from_source
    raise RuntimeError(f"ExifTool failed: {error_msg}")
RuntimeError: ExifTool failed: Warning: Sorry, FileSize is not writable
Warning: Sorry, FileType is not writable
Warning: Sorry, FileTypeExtension is not writable
Error: Temporary file already exists: /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_face_crop.png_exiftool_tmp


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 49, in process
    await self.copy_metadata_from_source()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 210, in copy_metadata_from_source
    raise RuntimeError(f"Metadata copy failed: {e}") from e
RuntimeError: Metadata copy failed: ExifTool failed: Warning: Sorry, FileSize is not writable
Warning: Sorry, FileType is not writable
Warning: Sorry, FileTypeExtension is not writable
Error: Temporary file already exists: /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_face_crop.png_exiftool_tmp


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 44, in process_image
    return await image.process()
           ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 66, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 59, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: Metadata copy failed: ExifTool failed: Warning: Sorry, FileSize is not writable
Warning: Sorry, FileType is not writable
Warning: Sorry, FileTypeExtension is not writable
Error: Temporary file already exists: /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_face_crop.png_exiftool_tmp

Batch processing completed with 1 errors
Batch processing failed
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 204, in copy_metadata_from_source
    raise RuntimeError(f"ExifTool failed: {error_msg}")
RuntimeError: ExifTool failed: Warning: Sorry, FileSize is not writable
Warning: Sorry, FileType is not writable
Warning: Sorry, FileTypeExtension is not writable
Error: Temporary file already exists: /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_face_crop.png_exiftool_tmp


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 49, in process
    await self.copy_metadata_from_source()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 210, in copy_metadata_from_source
    raise RuntimeError(f"Metadata copy failed: {e}") from e
RuntimeError: Metadata copy failed: ExifTool failed: Warning: Sorry, FileSize is not writable
Warning: Sorry, FileType is not writable
Warning: Sorry, FileTypeExtension is not writable
Error: Temporary file already exists: /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_face_crop.png_exiftool_tmp


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 75, in process
    raise errors[0]
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 44, in process_image
    return await image.process()
           ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 66, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 59, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: Metadata copy failed: ExifTool failed: Warning: Sorry, FileSize is not writable
Warning: Sorry, FileType is not writable
Warning: Sorry, FileTypeExtension is not writable
Error: Temporary file already exists: /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_face_crop.png_exiftool_tmp

Failed to process batch 20180312_Photoshoot2
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 204, in copy_metadata_from_source
    raise RuntimeError(f"ExifTool failed: {error_msg}")
RuntimeError: ExifTool failed: Warning: Sorry, FileSize is not writable
Warning: Sorry, FileType is not writable
Warning: Sorry, FileTypeExtension is not writable
Error: Temporary file already exists: /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_face_crop.png_exiftool_tmp


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 49, in process
    await self.copy_metadata_from_source()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 210, in copy_metadata_from_source
    raise RuntimeError(f"Metadata copy failed: {e}") from e
RuntimeError: Metadata copy failed: ExifTool failed: Warning: Sorry, FileSize is not writable
Warning: Sorry, FileType is not writable
Warning: Sorry, FileTypeExtension is not writable
Error: Temporary file already exists: /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_face_crop.png_exiftool_tmp


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/batch_processor.py", line 82, in process_batch
    await batch.process()
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 75, in process
    raise errors[0]
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 44, in process_image
    return await image.process()
           ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 66, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 59, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: Metadata copy failed: ExifTool failed: Warning: Sorry, FileSize is not writable
Warning: Sorry, FileType is not writable
Warning: Sorry, FileTypeExtension is not writable
Error: Temporary file already exists: /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_face_crop.png_exiftool_tmp

Batch processing failed
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/batch_processor.py", line 118, in process_all
    raise RuntimeError(
RuntimeError: Failed to process 1 batch(es):
Batch 20180312_Photoshoot2: Crop processing failed: Metadata copy failed: ExifTool failed: Warning: Sorry, FileSize is not writable
Warning: Sorry, FileType is not writable
Warning: Sorry, FileTypeExtension is not writable
Error: Temporary file already exists: /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_face_crop.png_exiftool_tmp

Cleaning up model registry
Starting model registry cleanup
Model registry cleanup complete
Model registry cleanup complete
[red bold]Error during batch processing[/]
[blue]Pipeline test complete[/]
[red bold]Pipeline test failed[/]
[blue]Starting pipeline test[/]
Input directory: [cyan]/Users/rob/repos/kalliste/test_images_input[/]
Output directory: [cyan]/Users/rob/repos/kalliste/test_images_output[/]
[green]Initializing BatchProcessor[/]
Initializing BatchProcessor with input_root=/Users/rob/repos/kalliste/test_images_input, output_root=/Users/rob/repos/kalliste/test_images_output
Scanning for batches in /Users/rob/repos/kalliste/test_images_input
Initializing Batch with input_path=/Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2, max_concurrent=3
Scanning for images in /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2
Found 1 images to process in batch 20180312_Photoshoot2
Found 1 batches to process
BatchProcessor created
Initializing models
Initializing BatchProcessor and model registry
Starting model registry initialization
Initializing tagger pipeline...
Creating TaggerPipeline instance
MPS device validated
TaggerPipeline created with device: mps
Starting tagger pipeline initialization
Initializing orientation tagger...
Creating OrientationTagger instance for device: mps
Orientation tagger created successfully
Initializing caption tagger...
Creating CaptionTagger instance for device: mps
Caption tagger created successfully
Initializing WD14 tagger...
Loading pretrained weights from Hugging Face hub (SmilingWolf/wd-vit-large-tagger-v3)
[SmilingWolf/wd-vit-large-tagger-v3] Safe alternative available for 'pytorch_model.bin' (as 'model.safetensors'). Loading weights using safetensors.
Loaded 10861 WD14 tags
Creating WD14Tagger instance for device: mps
WD14 tagger created successfully
All taggers initialized successfully
Tagger pipeline initialized successfully
Initializing YOLO detector...
Initializing YOLO detector
Loading YOLO model from /Users/rob/.cache/ultralytics/yolov8n.pt
YOLO model loaded successfully
Loading YOLO face model from /Users/rob/.cache/ultralytics/yolov8n-face.pt
YOLO face model loaded successfully
YOLODetector initialized with 1 active classes
YOLO detector initialized successfully
Model registry initialization complete
BatchProcessor and model registry initialized successfully
[green]BatchProcessor initialized successfully[/]
[green]Starting batch processing[/]
Starting batch processing
Starting batch: 20180312_Photoshoot2
Starting batch processing for 20180312_Photoshoot2 with 1 images
Starting processing for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png
Running detection on /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png
Fusing face model...
Face Model fused successfully
Fusing main model...
Main Model fused successfully
Detection complete. Found 6 total regions
Found 6 detections in /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png
Starting crop processing for face from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png
Error processing crop from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png: 'CroppedImage' object has no attribute 'crop_image'
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 36, in process
    await self.crop_image()
          ^^^^^^^^^^^^^^^
AttributeError: 'CroppedImage' object has no attribute 'crop_image'
Starting crop processing for face from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png
Error processing crop from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png: 'CroppedImage' object has no attribute 'crop_image'
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 36, in process
    await self.crop_image()
          ^^^^^^^^^^^^^^^
AttributeError: 'CroppedImage' object has no attribute 'crop_image'
Starting crop processing for face from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png
Error processing crop from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png: 'CroppedImage' object has no attribute 'crop_image'
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 36, in process
    await self.crop_image()
          ^^^^^^^^^^^^^^^
AttributeError: 'CroppedImage' object has no attribute 'crop_image'
Starting crop processing for person from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png
Error processing crop from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png: 'CroppedImage' object has no attribute 'crop_image'
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 36, in process
    await self.crop_image()
          ^^^^^^^^^^^^^^^
AttributeError: 'CroppedImage' object has no attribute 'crop_image'
Starting crop processing for person from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png
Error processing crop from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png: 'CroppedImage' object has no attribute 'crop_image'
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 36, in process
    await self.crop_image()
          ^^^^^^^^^^^^^^^
AttributeError: 'CroppedImage' object has no attribute 'crop_image'
Starting crop processing for person from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png
Error processing crop from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png: 'CroppedImage' object has no attribute 'crop_image'
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 36, in process
    await self.crop_image()
          ^^^^^^^^^^^^^^^
AttributeError: 'CroppedImage' object has no attribute 'crop_image'
Error processing crops for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png: Crop processing failed: 'CroppedImage' object has no attribute 'crop_image'
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 36, in process
    await self.crop_image()
          ^^^^^^^^^^^^^^^
AttributeError: 'CroppedImage' object has no attribute 'crop_image'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 66, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 58, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: 'CroppedImage' object has no attribute 'crop_image'
Error processing /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png: Crop processing failed: 'CroppedImage' object has no attribute 'crop_image'
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 36, in process
    await self.crop_image()
          ^^^^^^^^^^^^^^^
AttributeError: 'CroppedImage' object has no attribute 'crop_image'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 66, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 58, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: 'CroppedImage' object has no attribute 'crop_image'
Failed to process 3M2A2876.png
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 36, in process
    await self.crop_image()
          ^^^^^^^^^^^^^^^
AttributeError: 'CroppedImage' object has no attribute 'crop_image'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 44, in process_image
    return await image.process()
           ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 66, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 58, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: 'CroppedImage' object has no attribute 'crop_image'
Batch processing completed with 1 errors
Batch processing failed
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 36, in process
    await self.crop_image()
          ^^^^^^^^^^^^^^^
AttributeError: 'CroppedImage' object has no attribute 'crop_image'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 75, in process
    raise errors[0]
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 44, in process_image
    return await image.process()
           ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 66, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 58, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: 'CroppedImage' object has no attribute 'crop_image'
Failed to process batch 20180312_Photoshoot2
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 36, in process
    await self.crop_image()
          ^^^^^^^^^^^^^^^
AttributeError: 'CroppedImage' object has no attribute 'crop_image'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/batch_processor.py", line 82, in process_batch
    await batch.process()
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 75, in process
    raise errors[0]
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 44, in process_image
    return await image.process()
           ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 66, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 58, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: 'CroppedImage' object has no attribute 'crop_image'
Batch processing failed
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/batch_processor.py", line 118, in process_all
    raise RuntimeError(
RuntimeError: Failed to process 1 batch(es):
Batch 20180312_Photoshoot2: Crop processing failed: 'CroppedImage' object has no attribute 'crop_image'
Cleaning up model registry
Starting model registry cleanup
Model registry cleanup complete
Model registry cleanup complete
[red bold]Error during batch processing[/]
[blue]Pipeline test complete[/]
[red bold]Pipeline test failed[/]
[blue]Starting pipeline test[/]
Input directory: [cyan]/Users/rob/repos/kalliste/test_images_input[/]
Output directory: [cyan]/Users/rob/repos/kalliste/test_images_output[/]
[green]Initializing BatchProcessor[/]
Initializing BatchProcessor with input_root=/Users/rob/repos/kalliste/test_images_input, output_root=/Users/rob/repos/kalliste/test_images_output
Scanning for batches in /Users/rob/repos/kalliste/test_images_input
Initializing Batch with input_path=/Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2, max_concurrent=3
Scanning for images in /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2
Found 1 images to process in batch 20180312_Photoshoot2
Found 1 batches to process
BatchProcessor created
Initializing models
Initializing BatchProcessor and model registry
Starting model registry initialization
Initializing tagger pipeline...
Creating TaggerPipeline instance
MPS device validated
TaggerPipeline created with device: mps
Starting tagger pipeline initialization
Initializing orientation tagger...
Creating OrientationTagger instance for device: mps
Orientation tagger created successfully
Initializing caption tagger...
Creating CaptionTagger instance for device: mps
Caption tagger created successfully
Initializing WD14 tagger...
Loading pretrained weights from Hugging Face hub (SmilingWolf/wd-vit-large-tagger-v3)
[SmilingWolf/wd-vit-large-tagger-v3] Safe alternative available for 'pytorch_model.bin' (as 'model.safetensors'). Loading weights using safetensors.
Loaded 10861 WD14 tags
Creating WD14Tagger instance for device: mps
WD14 tagger created successfully
All taggers initialized successfully
Tagger pipeline initialized successfully
Initializing YOLO detector...
Initializing YOLO detector
Loading YOLO model from /Users/rob/.cache/ultralytics/yolov8n.pt
YOLO model loaded successfully
Loading YOLO face model from /Users/rob/.cache/ultralytics/yolov8n-face.pt
YOLO face model loaded successfully
YOLODetector initialized with 1 active classes
YOLO detector initialized successfully
Model registry initialization complete
BatchProcessor and model registry initialized successfully
[green]BatchProcessor initialized successfully[/]
[green]Starting batch processing[/]
Starting batch processing
Starting batch: 20180312_Photoshoot2
Starting batch processing for 20180312_Photoshoot2 with 1 images
Starting processing for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png
Running detection on /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png
Fusing face model...
Face Model fused successfully
Fusing main model...
Main Model fused successfully
Detection complete. Found 6 total regions
Found 6 detections in /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png
Starting crop processing for face from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png
Starting crop processing for face from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png
Starting crop processing for face from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png
Starting crop processing for person from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png
Starting crop processing for person from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png
Starting crop processing for person from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png
Running taggers for face crop
Running orientation tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_face_crop.png
Running taggers for face crop
Running orientation tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_face_crop.png
Running taggers for face crop
Running orientation tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_face_crop.png
ExifTool error: Warning: Sorry, FileSize is not writable
Warning: Sorry, FileType is not writable
Warning: Sorry, FileTypeExtension is not writable
Error: Temporary file already exists: /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_face_crop.png_exiftool_tmp

Error copying metadata: ExifTool failed: Warning: Sorry, FileSize is not writable
Warning: Sorry, FileType is not writable
Warning: Sorry, FileTypeExtension is not writable
Error: Temporary file already exists: /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_face_crop.png_exiftool_tmp
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 242, in copy_metadata_from_source
    raise RuntimeError(f"ExifTool failed: {error_msg}")
RuntimeError: ExifTool failed: Warning: Sorry, FileSize is not writable
Warning: Sorry, FileType is not writable
Warning: Sorry, FileTypeExtension is not writable
Error: Temporary file already exists: /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_face_crop.png_exiftool_tmp

Error processing crop from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png: Metadata copy failed: ExifTool failed: Warning: Sorry, FileSize is not writable
Warning: Sorry, FileType is not writable
Warning: Sorry, FileTypeExtension is not writable
Error: Temporary file already exists: /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_face_crop.png_exiftool_tmp
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 242, in copy_metadata_from_source
    raise RuntimeError(f"ExifTool failed: {error_msg}")
RuntimeError: ExifTool failed: Warning: Sorry, FileSize is not writable
Warning: Sorry, FileType is not writable
Warning: Sorry, FileTypeExtension is not writable
Error: Temporary file already exists: /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_face_crop.png_exiftool_tmp


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 53, in process
    await self.copy_metadata_from_source()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 248, in copy_metadata_from_source
    raise RuntimeError(f"Metadata copy failed: {e}") from e
RuntimeError: Metadata copy failed: ExifTool failed: Warning: Sorry, FileSize is not writable
Warning: Sorry, FileType is not writable
Warning: Sorry, FileTypeExtension is not writable
Error: Temporary file already exists: /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_face_crop.png_exiftool_tmp

Error processing crops for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png: Crop processing failed: Metadata copy failed: ExifTool failed: Warning: Sorry, FileSize is not writable
Warning: Sorry, FileType is not writable
Warning: Sorry, FileTypeExtension is not writable
Error: Temporary file already exists: /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_face_crop.png_exiftool_tmp
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 242, in copy_metadata_from_source
    raise RuntimeError(f"ExifTool failed: {error_msg}")
RuntimeError: ExifTool failed: Warning: Sorry, FileSize is not writable
Warning: Sorry, FileType is not writable
Warning: Sorry, FileTypeExtension is not writable
Error: Temporary file already exists: /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_face_crop.png_exiftool_tmp


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 53, in process
    await self.copy_metadata_from_source()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 248, in copy_metadata_from_source
    raise RuntimeError(f"Metadata copy failed: {e}") from e
RuntimeError: Metadata copy failed: ExifTool failed: Warning: Sorry, FileSize is not writable
Warning: Sorry, FileType is not writable
Warning: Sorry, FileTypeExtension is not writable
Error: Temporary file already exists: /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_face_crop.png_exiftool_tmp


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 66, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 63, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: Metadata copy failed: ExifTool failed: Warning: Sorry, FileSize is not writable
Warning: Sorry, FileType is not writable
Warning: Sorry, FileTypeExtension is not writable
Error: Temporary file already exists: /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_face_crop.png_exiftool_tmp

Error processing /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png: Crop processing failed: Metadata copy failed: ExifTool failed: Warning: Sorry, FileSize is not writable
Warning: Sorry, FileType is not writable
Warning: Sorry, FileTypeExtension is not writable
Error: Temporary file already exists: /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_face_crop.png_exiftool_tmp
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 242, in copy_metadata_from_source
    raise RuntimeError(f"ExifTool failed: {error_msg}")
RuntimeError: ExifTool failed: Warning: Sorry, FileSize is not writable
Warning: Sorry, FileType is not writable
Warning: Sorry, FileTypeExtension is not writable
Error: Temporary file already exists: /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_face_crop.png_exiftool_tmp


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 53, in process
    await self.copy_metadata_from_source()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 248, in copy_metadata_from_source
    raise RuntimeError(f"Metadata copy failed: {e}") from e
RuntimeError: Metadata copy failed: ExifTool failed: Warning: Sorry, FileSize is not writable
Warning: Sorry, FileType is not writable
Warning: Sorry, FileTypeExtension is not writable
Error: Temporary file already exists: /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_face_crop.png_exiftool_tmp


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 66, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 63, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: Metadata copy failed: ExifTool failed: Warning: Sorry, FileSize is not writable
Warning: Sorry, FileType is not writable
Warning: Sorry, FileTypeExtension is not writable
Error: Temporary file already exists: /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_face_crop.png_exiftool_tmp

Failed to process 3M2A2876.png
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 242, in copy_metadata_from_source
    raise RuntimeError(f"ExifTool failed: {error_msg}")
RuntimeError: ExifTool failed: Warning: Sorry, FileSize is not writable
Warning: Sorry, FileType is not writable
Warning: Sorry, FileTypeExtension is not writable
Error: Temporary file already exists: /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_face_crop.png_exiftool_tmp


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 53, in process
    await self.copy_metadata_from_source()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 248, in copy_metadata_from_source
    raise RuntimeError(f"Metadata copy failed: {e}") from e
RuntimeError: Metadata copy failed: ExifTool failed: Warning: Sorry, FileSize is not writable
Warning: Sorry, FileType is not writable
Warning: Sorry, FileTypeExtension is not writable
Error: Temporary file already exists: /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_face_crop.png_exiftool_tmp


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 44, in process_image
    return await image.process()
           ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 66, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 63, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: Metadata copy failed: ExifTool failed: Warning: Sorry, FileSize is not writable
Warning: Sorry, FileType is not writable
Warning: Sorry, FileTypeExtension is not writable
Error: Temporary file already exists: /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_face_crop.png_exiftool_tmp

Batch processing completed with 1 errors
Batch processing failed
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 242, in copy_metadata_from_source
    raise RuntimeError(f"ExifTool failed: {error_msg}")
RuntimeError: ExifTool failed: Warning: Sorry, FileSize is not writable
Warning: Sorry, FileType is not writable
Warning: Sorry, FileTypeExtension is not writable
Error: Temporary file already exists: /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_face_crop.png_exiftool_tmp


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 53, in process
    await self.copy_metadata_from_source()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 248, in copy_metadata_from_source
    raise RuntimeError(f"Metadata copy failed: {e}") from e
RuntimeError: Metadata copy failed: ExifTool failed: Warning: Sorry, FileSize is not writable
Warning: Sorry, FileType is not writable
Warning: Sorry, FileTypeExtension is not writable
Error: Temporary file already exists: /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_face_crop.png_exiftool_tmp


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 75, in process
    raise errors[0]
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 44, in process_image
    return await image.process()
           ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 66, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 63, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: Metadata copy failed: ExifTool failed: Warning: Sorry, FileSize is not writable
Warning: Sorry, FileType is not writable
Warning: Sorry, FileTypeExtension is not writable
Error: Temporary file already exists: /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_face_crop.png_exiftool_tmp

Failed to process batch 20180312_Photoshoot2
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 242, in copy_metadata_from_source
    raise RuntimeError(f"ExifTool failed: {error_msg}")
RuntimeError: ExifTool failed: Warning: Sorry, FileSize is not writable
Warning: Sorry, FileType is not writable
Warning: Sorry, FileTypeExtension is not writable
Error: Temporary file already exists: /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_face_crop.png_exiftool_tmp


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 53, in process
    await self.copy_metadata_from_source()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 248, in copy_metadata_from_source
    raise RuntimeError(f"Metadata copy failed: {e}") from e
RuntimeError: Metadata copy failed: ExifTool failed: Warning: Sorry, FileSize is not writable
Warning: Sorry, FileType is not writable
Warning: Sorry, FileTypeExtension is not writable
Error: Temporary file already exists: /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_face_crop.png_exiftool_tmp


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/batch_processor.py", line 82, in process_batch
    await batch.process()
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 75, in process
    raise errors[0]
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 44, in process_image
    return await image.process()
           ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 66, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 63, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: Metadata copy failed: ExifTool failed: Warning: Sorry, FileSize is not writable
Warning: Sorry, FileType is not writable
Warning: Sorry, FileTypeExtension is not writable
Error: Temporary file already exists: /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_face_crop.png_exiftool_tmp

Batch processing failed
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/batch_processor.py", line 118, in process_all
    raise RuntimeError(
RuntimeError: Failed to process 1 batch(es):
Batch 20180312_Photoshoot2: Crop processing failed: Metadata copy failed: ExifTool failed: Warning: Sorry, FileSize is not writable
Warning: Sorry, FileType is not writable
Warning: Sorry, FileTypeExtension is not writable
Error: Temporary file already exists: /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_face_crop.png_exiftool_tmp

Cleaning up model registry
Starting model registry cleanup
Model registry cleanup complete
Model registry cleanup complete
[red bold]Error during batch processing[/]
[blue]Pipeline test complete[/]
[red bold]Pipeline test failed[/]
[blue]Starting pipeline test[/]
Input directory: [cyan]/Users/rob/repos/kalliste/test_images_input[/]
Output directory: [cyan]/Users/rob/repos/kalliste/test_images_output[/]
[green]Initializing BatchProcessor[/]
Initializing BatchProcessor with input_root=/Users/rob/repos/kalliste/test_images_input, output_root=/Users/rob/repos/kalliste/test_images_output
Scanning for batches in /Users/rob/repos/kalliste/test_images_input
Initializing Batch with input_path=/Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2, max_concurrent=3
Scanning for images in /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2
Found 1 images to process in batch 20180312_Photoshoot2
Found 1 batches to process
BatchProcessor created
Initializing models
Initializing BatchProcessor and model registry
Starting model registry initialization
Initializing tagger pipeline...
Creating TaggerPipeline instance
MPS device validated
TaggerPipeline created with device: mps
Starting tagger pipeline initialization
Initializing orientation tagger...
Creating OrientationTagger instance for device: mps
Orientation tagger created successfully
Initializing caption tagger...
Creating CaptionTagger instance for device: mps
Caption tagger created successfully
Initializing WD14 tagger...
Loading pretrained weights from Hugging Face hub (SmilingWolf/wd-vit-large-tagger-v3)
[SmilingWolf/wd-vit-large-tagger-v3] Safe alternative available for 'pytorch_model.bin' (as 'model.safetensors'). Loading weights using safetensors.
Loaded 10861 WD14 tags
Creating WD14Tagger instance for device: mps
WD14 tagger created successfully
All taggers initialized successfully
Tagger pipeline initialized successfully
Initializing YOLO detector...
Initializing YOLO detector
Loading YOLO model from /Users/rob/.cache/ultralytics/yolov8n.pt
YOLO model loaded successfully
Loading YOLO face model from /Users/rob/.cache/ultralytics/yolov8n-face.pt
YOLO face model loaded successfully
YOLODetector initialized with 1 active classes
YOLO detector initialized successfully
Model registry initialization complete
BatchProcessor and model registry initialized successfully
[green]BatchProcessor initialized successfully[/]
[green]Starting batch processing[/]
Starting batch processing
Starting batch: 20180312_Photoshoot2
Starting batch processing for 20180312_Photoshoot2 with 1 images
Starting processing for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png
Running detection on /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png
Fusing face model...
Face Model fused successfully
Fusing main model...
Main Model fused successfully
Detection complete. Found 6 total regions
Found 6 detections in /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png
Starting crop processing for face from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png
Starting crop processing for face from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png
Starting crop processing for face from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png
Starting crop processing for person from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png
Starting crop processing for person from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png
Starting crop processing for person from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png
Running taggers for face crop
Running orientation tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_face_crop.png
Error processing image /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_face_crop.png: unrecognized data stream contents when reading image file
Orientation tagging failed for /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_face_crop.png: unrecognized data stream contents when reading image file
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/taggers/orientation_tagger.py", line 58, in tag_image
    image = self._ensure_valid_image(image)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/taggers/orientation_tagger.py", line 30, in _ensure_valid_image
    image.load()
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/PIL/ImageFile.py", line 319, in load
    raise _get_oserror(err_code, encoder=False)
OSError: unrecognized data stream contents when reading image file
Error in orientation tagger: unrecognized data stream contents when reading image file
Tagger orientation failed: unrecognized data stream contents when reading image file
ExifTool error: Ignored -config option (not first on command line)
Error: [minor] Bad CRC for IDAT chunk - /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_face_crop.png

Error copying metadata: ExifTool failed: Ignored -config option (not first on command line)
Error: [minor] Bad CRC for IDAT chunk - /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_face_crop.png
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 244, in copy_metadata_from_source
    raise RuntimeError(f"ExifTool failed: {error_msg}")
RuntimeError: ExifTool failed: Ignored -config option (not first on command line)
Error: [minor] Bad CRC for IDAT chunk - /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_face_crop.png

Error processing crop from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png: Metadata copy failed: ExifTool failed: Ignored -config option (not first on command line)
Error: [minor] Bad CRC for IDAT chunk - /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_face_crop.png
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 244, in copy_metadata_from_source
    raise RuntimeError(f"ExifTool failed: {error_msg}")
RuntimeError: ExifTool failed: Ignored -config option (not first on command line)
Error: [minor] Bad CRC for IDAT chunk - /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_face_crop.png


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 56, in process
    await self.copy_metadata_from_source()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 250, in copy_metadata_from_source
    raise RuntimeError(f"Metadata copy failed: {e}") from e
RuntimeError: Metadata copy failed: ExifTool failed: Ignored -config option (not first on command line)
Error: [minor] Bad CRC for IDAT chunk - /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_face_crop.png

Error processing crops for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png: Crop processing failed: Metadata copy failed: ExifTool failed: Ignored -config option (not first on command line)
Error: [minor] Bad CRC for IDAT chunk - /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_face_crop.png
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 244, in copy_metadata_from_source
    raise RuntimeError(f"ExifTool failed: {error_msg}")
RuntimeError: ExifTool failed: Ignored -config option (not first on command line)
Error: [minor] Bad CRC for IDAT chunk - /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_face_crop.png


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 56, in process
    await self.copy_metadata_from_source()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 250, in copy_metadata_from_source
    raise RuntimeError(f"Metadata copy failed: {e}") from e
RuntimeError: Metadata copy failed: ExifTool failed: Ignored -config option (not first on command line)
Error: [minor] Bad CRC for IDAT chunk - /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_face_crop.png


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 66, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 66, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: Metadata copy failed: ExifTool failed: Ignored -config option (not first on command line)
Error: [minor] Bad CRC for IDAT chunk - /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_face_crop.png

Error processing /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png: Crop processing failed: Metadata copy failed: ExifTool failed: Ignored -config option (not first on command line)
Error: [minor] Bad CRC for IDAT chunk - /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_face_crop.png
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 244, in copy_metadata_from_source
    raise RuntimeError(f"ExifTool failed: {error_msg}")
RuntimeError: ExifTool failed: Ignored -config option (not first on command line)
Error: [minor] Bad CRC for IDAT chunk - /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_face_crop.png


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 56, in process
    await self.copy_metadata_from_source()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 250, in copy_metadata_from_source
    raise RuntimeError(f"Metadata copy failed: {e}") from e
RuntimeError: Metadata copy failed: ExifTool failed: Ignored -config option (not first on command line)
Error: [minor] Bad CRC for IDAT chunk - /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_face_crop.png


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 66, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 66, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: Metadata copy failed: ExifTool failed: Ignored -config option (not first on command line)
Error: [minor] Bad CRC for IDAT chunk - /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_face_crop.png

Failed to process 3M2A2876.png
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 244, in copy_metadata_from_source
    raise RuntimeError(f"ExifTool failed: {error_msg}")
RuntimeError: ExifTool failed: Ignored -config option (not first on command line)
Error: [minor] Bad CRC for IDAT chunk - /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_face_crop.png


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 56, in process
    await self.copy_metadata_from_source()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 250, in copy_metadata_from_source
    raise RuntimeError(f"Metadata copy failed: {e}") from e
RuntimeError: Metadata copy failed: ExifTool failed: Ignored -config option (not first on command line)
Error: [minor] Bad CRC for IDAT chunk - /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_face_crop.png


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 44, in process_image
    return await image.process()
           ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 66, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 66, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: Metadata copy failed: ExifTool failed: Ignored -config option (not first on command line)
Error: [minor] Bad CRC for IDAT chunk - /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_face_crop.png

Batch processing completed with 1 errors
Batch processing failed
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 244, in copy_metadata_from_source
    raise RuntimeError(f"ExifTool failed: {error_msg}")
RuntimeError: ExifTool failed: Ignored -config option (not first on command line)
Error: [minor] Bad CRC for IDAT chunk - /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_face_crop.png


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 56, in process
    await self.copy_metadata_from_source()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 250, in copy_metadata_from_source
    raise RuntimeError(f"Metadata copy failed: {e}") from e
RuntimeError: Metadata copy failed: ExifTool failed: Ignored -config option (not first on command line)
Error: [minor] Bad CRC for IDAT chunk - /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_face_crop.png


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 75, in process
    raise errors[0]
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 44, in process_image
    return await image.process()
           ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 66, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 66, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: Metadata copy failed: ExifTool failed: Ignored -config option (not first on command line)
Error: [minor] Bad CRC for IDAT chunk - /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_face_crop.png

Failed to process batch 20180312_Photoshoot2
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 244, in copy_metadata_from_source
    raise RuntimeError(f"ExifTool failed: {error_msg}")
RuntimeError: ExifTool failed: Ignored -config option (not first on command line)
Error: [minor] Bad CRC for IDAT chunk - /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_face_crop.png


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 56, in process
    await self.copy_metadata_from_source()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 250, in copy_metadata_from_source
    raise RuntimeError(f"Metadata copy failed: {e}") from e
RuntimeError: Metadata copy failed: ExifTool failed: Ignored -config option (not first on command line)
Error: [minor] Bad CRC for IDAT chunk - /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_face_crop.png


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/batch_processor.py", line 82, in process_batch
    await batch.process()
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 75, in process
    raise errors[0]
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 44, in process_image
    return await image.process()
           ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 66, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 66, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: Metadata copy failed: ExifTool failed: Ignored -config option (not first on command line)
Error: [minor] Bad CRC for IDAT chunk - /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_face_crop.png

Batch processing failed
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/batch_processor.py", line 118, in process_all
    raise RuntimeError(
RuntimeError: Failed to process 1 batch(es):
Batch 20180312_Photoshoot2: Crop processing failed: Metadata copy failed: ExifTool failed: Ignored -config option (not first on command line)
Error: [minor] Bad CRC for IDAT chunk - /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_face_crop.png

Cleaning up model registry
Starting model registry cleanup
Model registry cleanup complete
Model registry cleanup complete
[red bold]Error during batch processing[/]
[blue]Pipeline test complete[/]
[red bold]Pipeline test failed[/]
[blue]Starting pipeline test[/]
Input directory: [cyan]/Users/rob/repos/kalliste/test_images_input[/]
Output directory: [cyan]/Users/rob/repos/kalliste/test_images_output[/]
[green]Initializing BatchProcessor[/]
Initializing BatchProcessor with input_root=/Users/rob/repos/kalliste/test_images_input, output_root=/Users/rob/repos/kalliste/test_images_output
Scanning for batches in /Users/rob/repos/kalliste/test_images_input
Initializing Batch with input_path=/Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2, max_concurrent=3
Scanning for images in /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2
Found 1 images to process in batch 20180312_Photoshoot2
Found 1 batches to process
BatchProcessor created
Initializing models
Initializing BatchProcessor and model registry
Starting model registry initialization
Initializing tagger pipeline...
Creating TaggerPipeline instance
MPS device validated
TaggerPipeline created with device: mps
Starting tagger pipeline initialization
Initializing orientation tagger...
Creating OrientationTagger instance for device: mps
Orientation tagger created successfully
Initializing caption tagger...
Creating CaptionTagger instance for device: mps
Caption tagger created successfully
Initializing WD14 tagger...
Loading pretrained weights from Hugging Face hub (SmilingWolf/wd-vit-large-tagger-v3)
[SmilingWolf/wd-vit-large-tagger-v3] Safe alternative available for 'pytorch_model.bin' (as 'model.safetensors'). Loading weights using safetensors.
Loaded 10861 WD14 tags
Creating WD14Tagger instance for device: mps
WD14 tagger created successfully
All taggers initialized successfully
Tagger pipeline initialized successfully
Initializing YOLO detector...
Initializing YOLO detector
Loading YOLO model from /Users/rob/.cache/ultralytics/yolov8n.pt
YOLO model loaded successfully
Loading YOLO face model from /Users/rob/.cache/ultralytics/yolov8n-face.pt
YOLO face model loaded successfully
YOLODetector initialized with 1 active classes
YOLO detector initialized successfully
Model registry initialization complete
BatchProcessor and model registry initialized successfully
[green]BatchProcessor initialized successfully[/]
[green]Starting batch processing[/]
Starting batch processing
Starting batch: 20180312_Photoshoot2
Starting batch processing for 20180312_Photoshoot2 with 1 images
Starting processing for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png
Running detection on /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png
Fusing face model...
Face Model fused successfully
Fusing main model...
Main Model fused successfully
Detection complete. Found 6 total regions
Found 6 detections in /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png
Starting crop processing for face from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png
Starting crop processing for face from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png
Starting crop processing for face from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png
Starting crop processing for person from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png
Starting crop processing for person from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png
Starting crop processing for person from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png
Running taggers for face crop
Running orientation tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_face_crop.png
Running taggers for face crop
Running orientation tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_face_crop.png
Running taggers for face crop
Running orientation tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_face_crop.png
ExifTool error while injecting tags: Warning: Shift value for XMP-Kalliste:Tag is not a number
Warning: Shift value for XMP-Kalliste:TagSource is not a number
Warning: Shift value for XMP-Kalliste:Tag is not a number
Warning: Shift value for XMP-Kalliste:TagSource is not a number
Warning: Shift value for XMP-Kalliste:Tag is not a number
Warning: Shift value for XMP-Kalliste:TagSource is not a number
Warning: Shift value for XMP-Kalliste:Tag is not a number
Warning: Shift value for XMP-Kalliste:TagSource is not a number
Warning: Shift value for XMP-Kalliste:Tag is not a number
Warning: Shift value for XMP-Kalliste:TagSource is not a number
Error: Temporary file already exists: /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_face_crop.png_exiftool_tmp

Error injecting Kalliste tags: Tag injection failed: Warning: Shift value for XMP-Kalliste:Tag is not a number
Warning: Shift value for XMP-Kalliste:TagSource is not a number
Warning: Shift value for XMP-Kalliste:Tag is not a number
Warning: Shift value for XMP-Kalliste:TagSource is not a number
Warning: Shift value for XMP-Kalliste:Tag is not a number
Warning: Shift value for XMP-Kalliste:TagSource is not a number
Warning: Shift value for XMP-Kalliste:Tag is not a number
Warning: Shift value for XMP-Kalliste:TagSource is not a number
Warning: Shift value for XMP-Kalliste:Tag is not a number
Warning: Shift value for XMP-Kalliste:TagSource is not a number
Error: Temporary file already exists: /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_face_crop.png_exiftool_tmp
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 288, in inject_kalliste_tags
    raise RuntimeError(f"Tag injection failed: {error_msg}")
RuntimeError: Tag injection failed: Warning: Shift value for XMP-Kalliste:Tag is not a number
Warning: Shift value for XMP-Kalliste:TagSource is not a number
Warning: Shift value for XMP-Kalliste:Tag is not a number
Warning: Shift value for XMP-Kalliste:TagSource is not a number
Warning: Shift value for XMP-Kalliste:Tag is not a number
Warning: Shift value for XMP-Kalliste:TagSource is not a number
Warning: Shift value for XMP-Kalliste:Tag is not a number
Warning: Shift value for XMP-Kalliste:TagSource is not a number
Warning: Shift value for XMP-Kalliste:Tag is not a number
Warning: Shift value for XMP-Kalliste:TagSource is not a number
Error: Temporary file already exists: /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_face_crop.png_exiftool_tmp

Error processing crop from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png: Tag injection failed: Tag injection failed: Warning: Shift value for XMP-Kalliste:Tag is not a number
Warning: Shift value for XMP-Kalliste:TagSource is not a number
Warning: Shift value for XMP-Kalliste:Tag is not a number
Warning: Shift value for XMP-Kalliste:TagSource is not a number
Warning: Shift value for XMP-Kalliste:Tag is not a number
Warning: Shift value for XMP-Kalliste:TagSource is not a number
Warning: Shift value for XMP-Kalliste:Tag is not a number
Warning: Shift value for XMP-Kalliste:TagSource is not a number
Warning: Shift value for XMP-Kalliste:Tag is not a number
Warning: Shift value for XMP-Kalliste:TagSource is not a number
Error: Temporary file already exists: /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_face_crop.png_exiftool_tmp
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 288, in inject_kalliste_tags
    raise RuntimeError(f"Tag injection failed: {error_msg}")
RuntimeError: Tag injection failed: Warning: Shift value for XMP-Kalliste:Tag is not a number
Warning: Shift value for XMP-Kalliste:TagSource is not a number
Warning: Shift value for XMP-Kalliste:Tag is not a number
Warning: Shift value for XMP-Kalliste:TagSource is not a number
Warning: Shift value for XMP-Kalliste:Tag is not a number
Warning: Shift value for XMP-Kalliste:TagSource is not a number
Warning: Shift value for XMP-Kalliste:Tag is not a number
Warning: Shift value for XMP-Kalliste:TagSource is not a number
Warning: Shift value for XMP-Kalliste:Tag is not a number
Warning: Shift value for XMP-Kalliste:TagSource is not a number
Error: Temporary file already exists: /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_face_crop.png_exiftool_tmp


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 57, in process
    await self.inject_kalliste_tags()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 294, in inject_kalliste_tags
    raise RuntimeError(f"Tag injection failed: {e}") from e
RuntimeError: Tag injection failed: Tag injection failed: Warning: Shift value for XMP-Kalliste:Tag is not a number
Warning: Shift value for XMP-Kalliste:TagSource is not a number
Warning: Shift value for XMP-Kalliste:Tag is not a number
Warning: Shift value for XMP-Kalliste:TagSource is not a number
Warning: Shift value for XMP-Kalliste:Tag is not a number
Warning: Shift value for XMP-Kalliste:TagSource is not a number
Warning: Shift value for XMP-Kalliste:Tag is not a number
Warning: Shift value for XMP-Kalliste:TagSource is not a number
Warning: Shift value for XMP-Kalliste:Tag is not a number
Warning: Shift value for XMP-Kalliste:TagSource is not a number
Error: Temporary file already exists: /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_face_crop.png_exiftool_tmp

Error processing crops for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png: Crop processing failed: Tag injection failed: Tag injection failed: Warning: Shift value for XMP-Kalliste:Tag is not a number
Warning: Shift value for XMP-Kalliste:TagSource is not a number
Warning: Shift value for XMP-Kalliste:Tag is not a number
Warning: Shift value for XMP-Kalliste:TagSource is not a number
Warning: Shift value for XMP-Kalliste:Tag is not a number
Warning: Shift value for XMP-Kalliste:TagSource is not a number
Warning: Shift value for XMP-Kalliste:Tag is not a number
Warning: Shift value for XMP-Kalliste:TagSource is not a number
Warning: Shift value for XMP-Kalliste:Tag is not a number
Warning: Shift value for XMP-Kalliste:TagSource is not a number
Error: Temporary file already exists: /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_face_crop.png_exiftool_tmp
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 288, in inject_kalliste_tags
    raise RuntimeError(f"Tag injection failed: {error_msg}")
RuntimeError: Tag injection failed: Warning: Shift value for XMP-Kalliste:Tag is not a number
Warning: Shift value for XMP-Kalliste:TagSource is not a number
Warning: Shift value for XMP-Kalliste:Tag is not a number
Warning: Shift value for XMP-Kalliste:TagSource is not a number
Warning: Shift value for XMP-Kalliste:Tag is not a number
Warning: Shift value for XMP-Kalliste:TagSource is not a number
Warning: Shift value for XMP-Kalliste:Tag is not a number
Warning: Shift value for XMP-Kalliste:TagSource is not a number
Warning: Shift value for XMP-Kalliste:Tag is not a number
Warning: Shift value for XMP-Kalliste:TagSource is not a number
Error: Temporary file already exists: /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_face_crop.png_exiftool_tmp


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 57, in process
    await self.inject_kalliste_tags()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 294, in inject_kalliste_tags
    raise RuntimeError(f"Tag injection failed: {e}") from e
RuntimeError: Tag injection failed: Tag injection failed: Warning: Shift value for XMP-Kalliste:Tag is not a number
Warning: Shift value for XMP-Kalliste:TagSource is not a number
Warning: Shift value for XMP-Kalliste:Tag is not a number
Warning: Shift value for XMP-Kalliste:TagSource is not a number
Warning: Shift value for XMP-Kalliste:Tag is not a number
Warning: Shift value for XMP-Kalliste:TagSource is not a number
Warning: Shift value for XMP-Kalliste:Tag is not a number
Warning: Shift value for XMP-Kalliste:TagSource is not a number
Warning: Shift value for XMP-Kalliste:Tag is not a number
Warning: Shift value for XMP-Kalliste:TagSource is not a number
Error: Temporary file already exists: /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_face_crop.png_exiftool_tmp


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 66, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 66, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: Tag injection failed: Tag injection failed: Warning: Shift value for XMP-Kalliste:Tag is not a number
Warning: Shift value for XMP-Kalliste:TagSource is not a number
Warning: Shift value for XMP-Kalliste:Tag is not a number
Warning: Shift value for XMP-Kalliste:TagSource is not a number
Warning: Shift value for XMP-Kalliste:Tag is not a number
Warning: Shift value for XMP-Kalliste:TagSource is not a number
Warning: Shift value for XMP-Kalliste:Tag is not a number
Warning: Shift value for XMP-Kalliste:TagSource is not a number
Warning: Shift value for XMP-Kalliste:Tag is not a number
Warning: Shift value for XMP-Kalliste:TagSource is not a number
Error: Temporary file already exists: /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_face_crop.png_exiftool_tmp

Error processing /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png: Crop processing failed: Tag injection failed: Tag injection failed: Warning: Shift value for XMP-Kalliste:Tag is not a number
Warning: Shift value for XMP-Kalliste:TagSource is not a number
Warning: Shift value for XMP-Kalliste:Tag is not a number
Warning: Shift value for XMP-Kalliste:TagSource is not a number
Warning: Shift value for XMP-Kalliste:Tag is not a number
Warning: Shift value for XMP-Kalliste:TagSource is not a number
Warning: Shift value for XMP-Kalliste:Tag is not a number
Warning: Shift value for XMP-Kalliste:TagSource is not a number
Warning: Shift value for XMP-Kalliste:Tag is not a number
Warning: Shift value for XMP-Kalliste:TagSource is not a number
Error: Temporary file already exists: /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_face_crop.png_exiftool_tmp
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 288, in inject_kalliste_tags
    raise RuntimeError(f"Tag injection failed: {error_msg}")
RuntimeError: Tag injection failed: Warning: Shift value for XMP-Kalliste:Tag is not a number
Warning: Shift value for XMP-Kalliste:TagSource is not a number
Warning: Shift value for XMP-Kalliste:Tag is not a number
Warning: Shift value for XMP-Kalliste:TagSource is not a number
Warning: Shift value for XMP-Kalliste:Tag is not a number
Warning: Shift value for XMP-Kalliste:TagSource is not a number
Warning: Shift value for XMP-Kalliste:Tag is not a number
Warning: Shift value for XMP-Kalliste:TagSource is not a number
Warning: Shift value for XMP-Kalliste:Tag is not a number
Warning: Shift value for XMP-Kalliste:TagSource is not a number
Error: Temporary file already exists: /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_face_crop.png_exiftool_tmp


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 57, in process
    await self.inject_kalliste_tags()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 294, in inject_kalliste_tags
    raise RuntimeError(f"Tag injection failed: {e}") from e
RuntimeError: Tag injection failed: Tag injection failed: Warning: Shift value for XMP-Kalliste:Tag is not a number
Warning: Shift value for XMP-Kalliste:TagSource is not a number
Warning: Shift value for XMP-Kalliste:Tag is not a number
Warning: Shift value for XMP-Kalliste:TagSource is not a number
Warning: Shift value for XMP-Kalliste:Tag is not a number
Warning: Shift value for XMP-Kalliste:TagSource is not a number
Warning: Shift value for XMP-Kalliste:Tag is not a number
Warning: Shift value for XMP-Kalliste:TagSource is not a number
Warning: Shift value for XMP-Kalliste:Tag is not a number
Warning: Shift value for XMP-Kalliste:TagSource is not a number
Error: Temporary file already exists: /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_face_crop.png_exiftool_tmp


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 66, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 66, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: Tag injection failed: Tag injection failed: Warning: Shift value for XMP-Kalliste:Tag is not a number
Warning: Shift value for XMP-Kalliste:TagSource is not a number
Warning: Shift value for XMP-Kalliste:Tag is not a number
Warning: Shift value for XMP-Kalliste:TagSource is not a number
Warning: Shift value for XMP-Kalliste:Tag is not a number
Warning: Shift value for XMP-Kalliste:TagSource is not a number
Warning: Shift value for XMP-Kalliste:Tag is not a number
Warning: Shift value for XMP-Kalliste:TagSource is not a number
Warning: Shift value for XMP-Kalliste:Tag is not a number
Warning: Shift value for XMP-Kalliste:TagSource is not a number
Error: Temporary file already exists: /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_face_crop.png_exiftool_tmp

Failed to process 3M2A2876.png
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 288, in inject_kalliste_tags
    raise RuntimeError(f"Tag injection failed: {error_msg}")
RuntimeError: Tag injection failed: Warning: Shift value for XMP-Kalliste:Tag is not a number
Warning: Shift value for XMP-Kalliste:TagSource is not a number
Warning: Shift value for XMP-Kalliste:Tag is not a number
Warning: Shift value for XMP-Kalliste:TagSource is not a number
Warning: Shift value for XMP-Kalliste:Tag is not a number
Warning: Shift value for XMP-Kalliste:TagSource is not a number
Warning: Shift value for XMP-Kalliste:Tag is not a number
Warning: Shift value for XMP-Kalliste:TagSource is not a number
Warning: Shift value for XMP-Kalliste:Tag is not a number
Warning: Shift value for XMP-Kalliste:TagSource is not a number
Error: Temporary file already exists: /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_face_crop.png_exiftool_tmp


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 57, in process
    await self.inject_kalliste_tags()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 294, in inject_kalliste_tags
    raise RuntimeError(f"Tag injection failed: {e}") from e
RuntimeError: Tag injection failed: Tag injection failed: Warning: Shift value for XMP-Kalliste:Tag is not a number
Warning: Shift value for XMP-Kalliste:TagSource is not a number
Warning: Shift value for XMP-Kalliste:Tag is not a number
Warning: Shift value for XMP-Kalliste:TagSource is not a number
Warning: Shift value for XMP-Kalliste:Tag is not a number
Warning: Shift value for XMP-Kalliste:TagSource is not a number
Warning: Shift value for XMP-Kalliste:Tag is not a number
Warning: Shift value for XMP-Kalliste:TagSource is not a number
Warning: Shift value for XMP-Kalliste:Tag is not a number
Warning: Shift value for XMP-Kalliste:TagSource is not a number
Error: Temporary file already exists: /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_face_crop.png_exiftool_tmp


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 44, in process_image
    return await image.process()
           ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 66, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 66, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: Tag injection failed: Tag injection failed: Warning: Shift value for XMP-Kalliste:Tag is not a number
Warning: Shift value for XMP-Kalliste:TagSource is not a number
Warning: Shift value for XMP-Kalliste:Tag is not a number
Warning: Shift value for XMP-Kalliste:TagSource is not a number
Warning: Shift value for XMP-Kalliste:Tag is not a number
Warning: Shift value for XMP-Kalliste:TagSource is not a number
Warning: Shift value for XMP-Kalliste:Tag is not a number
Warning: Shift value for XMP-Kalliste:TagSource is not a number
Warning: Shift value for XMP-Kalliste:Tag is not a number
Warning: Shift value for XMP-Kalliste:TagSource is not a number
Error: Temporary file already exists: /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_face_crop.png_exiftool_tmp

Batch processing completed with 1 errors
Batch processing failed
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 288, in inject_kalliste_tags
    raise RuntimeError(f"Tag injection failed: {error_msg}")
RuntimeError: Tag injection failed: Warning: Shift value for XMP-Kalliste:Tag is not a number
Warning: Shift value for XMP-Kalliste:TagSource is not a number
Warning: Shift value for XMP-Kalliste:Tag is not a number
Warning: Shift value for XMP-Kalliste:TagSource is not a number
Warning: Shift value for XMP-Kalliste:Tag is not a number
Warning: Shift value for XMP-Kalliste:TagSource is not a number
Warning: Shift value for XMP-Kalliste:Tag is not a number
Warning: Shift value for XMP-Kalliste:TagSource is not a number
Warning: Shift value for XMP-Kalliste:Tag is not a number
Warning: Shift value for XMP-Kalliste:TagSource is not a number
Error: Temporary file already exists: /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_face_crop.png_exiftool_tmp


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 57, in process
    await self.inject_kalliste_tags()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 294, in inject_kalliste_tags
    raise RuntimeError(f"Tag injection failed: {e}") from e
RuntimeError: Tag injection failed: Tag injection failed: Warning: Shift value for XMP-Kalliste:Tag is not a number
Warning: Shift value for XMP-Kalliste:TagSource is not a number
Warning: Shift value for XMP-Kalliste:Tag is not a number
Warning: Shift value for XMP-Kalliste:TagSource is not a number
Warning: Shift value for XMP-Kalliste:Tag is not a number
Warning: Shift value for XMP-Kalliste:TagSource is not a number
Warning: Shift value for XMP-Kalliste:Tag is not a number
Warning: Shift value for XMP-Kalliste:TagSource is not a number
Warning: Shift value for XMP-Kalliste:Tag is not a number
Warning: Shift value for XMP-Kalliste:TagSource is not a number
Error: Temporary file already exists: /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_face_crop.png_exiftool_tmp


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 75, in process
    raise errors[0]
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 44, in process_image
    return await image.process()
           ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 66, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 66, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: Tag injection failed: Tag injection failed: Warning: Shift value for XMP-Kalliste:Tag is not a number
Warning: Shift value for XMP-Kalliste:TagSource is not a number
Warning: Shift value for XMP-Kalliste:Tag is not a number
Warning: Shift value for XMP-Kalliste:TagSource is not a number
Warning: Shift value for XMP-Kalliste:Tag is not a number
Warning: Shift value for XMP-Kalliste:TagSource is not a number
Warning: Shift value for XMP-Kalliste:Tag is not a number
Warning: Shift value for XMP-Kalliste:TagSource is not a number
Warning: Shift value for XMP-Kalliste:Tag is not a number
Warning: Shift value for XMP-Kalliste:TagSource is not a number
Error: Temporary file already exists: /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_face_crop.png_exiftool_tmp

Failed to process batch 20180312_Photoshoot2
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 288, in inject_kalliste_tags
    raise RuntimeError(f"Tag injection failed: {error_msg}")
RuntimeError: Tag injection failed: Warning: Shift value for XMP-Kalliste:Tag is not a number
Warning: Shift value for XMP-Kalliste:TagSource is not a number
Warning: Shift value for XMP-Kalliste:Tag is not a number
Warning: Shift value for XMP-Kalliste:TagSource is not a number
Warning: Shift value for XMP-Kalliste:Tag is not a number
Warning: Shift value for XMP-Kalliste:TagSource is not a number
Warning: Shift value for XMP-Kalliste:Tag is not a number
Warning: Shift value for XMP-Kalliste:TagSource is not a number
Warning: Shift value for XMP-Kalliste:Tag is not a number
Warning: Shift value for XMP-Kalliste:TagSource is not a number
Error: Temporary file already exists: /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_face_crop.png_exiftool_tmp


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 57, in process
    await self.inject_kalliste_tags()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 294, in inject_kalliste_tags
    raise RuntimeError(f"Tag injection failed: {e}") from e
RuntimeError: Tag injection failed: Tag injection failed: Warning: Shift value for XMP-Kalliste:Tag is not a number
Warning: Shift value for XMP-Kalliste:TagSource is not a number
Warning: Shift value for XMP-Kalliste:Tag is not a number
Warning: Shift value for XMP-Kalliste:TagSource is not a number
Warning: Shift value for XMP-Kalliste:Tag is not a number
Warning: Shift value for XMP-Kalliste:TagSource is not a number
Warning: Shift value for XMP-Kalliste:Tag is not a number
Warning: Shift value for XMP-Kalliste:TagSource is not a number
Warning: Shift value for XMP-Kalliste:Tag is not a number
Warning: Shift value for XMP-Kalliste:TagSource is not a number
Error: Temporary file already exists: /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_face_crop.png_exiftool_tmp


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/batch_processor.py", line 82, in process_batch
    await batch.process()
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 75, in process
    raise errors[0]
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 44, in process_image
    return await image.process()
           ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 66, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 66, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: Tag injection failed: Tag injection failed: Warning: Shift value for XMP-Kalliste:Tag is not a number
Warning: Shift value for XMP-Kalliste:TagSource is not a number
Warning: Shift value for XMP-Kalliste:Tag is not a number
Warning: Shift value for XMP-Kalliste:TagSource is not a number
Warning: Shift value for XMP-Kalliste:Tag is not a number
Warning: Shift value for XMP-Kalliste:TagSource is not a number
Warning: Shift value for XMP-Kalliste:Tag is not a number
Warning: Shift value for XMP-Kalliste:TagSource is not a number
Warning: Shift value for XMP-Kalliste:Tag is not a number
Warning: Shift value for XMP-Kalliste:TagSource is not a number
Error: Temporary file already exists: /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_face_crop.png_exiftool_tmp

Batch processing failed
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/batch_processor.py", line 118, in process_all
    raise RuntimeError(
RuntimeError: Failed to process 1 batch(es):
Batch 20180312_Photoshoot2: Crop processing failed: Tag injection failed: Tag injection failed: Warning: Shift value for XMP-Kalliste:Tag is not a number
Warning: Shift value for XMP-Kalliste:TagSource is not a number
Warning: Shift value for XMP-Kalliste:Tag is not a number
Warning: Shift value for XMP-Kalliste:TagSource is not a number
Warning: Shift value for XMP-Kalliste:Tag is not a number
Warning: Shift value for XMP-Kalliste:TagSource is not a number
Warning: Shift value for XMP-Kalliste:Tag is not a number
Warning: Shift value for XMP-Kalliste:TagSource is not a number
Warning: Shift value for XMP-Kalliste:Tag is not a number
Warning: Shift value for XMP-Kalliste:TagSource is not a number
Error: Temporary file already exists: /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_face_crop.png_exiftool_tmp

Cleaning up model registry
Starting model registry cleanup
Model registry cleanup complete
Model registry cleanup complete
[red bold]Error during batch processing[/]
[blue]Pipeline test complete[/]
[red bold]Pipeline test failed[/]
[blue]Starting pipeline test[/]
Input directory: [cyan]/Users/rob/repos/kalliste/test_images_input[/]
Output directory: [cyan]/Users/rob/repos/kalliste/test_images_output[/]
[green]Initializing BatchProcessor[/]
Initializing BatchProcessor with input_root=/Users/rob/repos/kalliste/test_images_input, output_root=/Users/rob/repos/kalliste/test_images_output
Scanning for batches in /Users/rob/repos/kalliste/test_images_input
Initializing Batch with input_path=/Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2, max_concurrent=3
Scanning for images in /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2
Found 1 images to process in batch 20180312_Photoshoot2
Found 1 batches to process
BatchProcessor created
Initializing models
Initializing BatchProcessor and model registry
Starting model registry initialization
Initializing tagger pipeline...
Creating TaggerPipeline instance
MPS device validated
TaggerPipeline created with device: mps
Starting tagger pipeline initialization
Initializing orientation tagger...
Creating OrientationTagger instance for device: mps
Orientation tagger created successfully
Initializing caption tagger...
Creating CaptionTagger instance for device: mps
Caption tagger created successfully
Initializing WD14 tagger...
Loading pretrained weights from Hugging Face hub (SmilingWolf/wd-vit-large-tagger-v3)
[SmilingWolf/wd-vit-large-tagger-v3] Safe alternative available for 'pytorch_model.bin' (as 'model.safetensors'). Loading weights using safetensors.
Loaded 10861 WD14 tags
Creating WD14Tagger instance for device: mps
WD14 tagger created successfully
All taggers initialized successfully
Tagger pipeline initialized successfully
Initializing YOLO detector...
Initializing YOLO detector
Loading YOLO model from /Users/rob/.cache/ultralytics/yolov8n.pt
YOLO model loaded successfully
Loading YOLO face model from /Users/rob/.cache/ultralytics/yolov8n-face.pt
YOLO face model loaded successfully
YOLODetector initialized with 1 active classes
YOLO detector initialized successfully
Model registry initialization complete
BatchProcessor and model registry initialized successfully
[green]BatchProcessor initialized successfully[/]
[green]Starting batch processing[/]
Starting batch processing
Starting batch: 20180312_Photoshoot2
Starting batch processing for 20180312_Photoshoot2 with 1 images
Starting processing for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png
Running detection on /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png
Fusing face model...
Face Model fused successfully
Fusing main model...
Main Model fused successfully
Detection complete. Found 6 total regions
Found 6 detections in /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png
Starting crop processing for face from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png
Starting crop processing for face from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png
Starting crop processing for face from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png
Starting crop processing for person from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png
Starting crop processing for person from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png
Starting crop processing for person from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png
Running taggers for face crop
Running orientation tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_face_crop.png
Running taggers for face crop
Running orientation tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_face_crop.png
Running taggers for face crop
Running orientation tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_face_crop.png
Completed processing crop from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png
Cropped image /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_face_crop.png complete
ExifTool error: Error: Temporary file already exists: /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_face_crop.png_exiftool_tmp

Error copying metadata: ExifTool failed: Error: Temporary file already exists: /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_face_crop.png_exiftool_tmp
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 243, in copy_metadata_from_source
    raise RuntimeError(f"ExifTool failed: {error_msg}")
RuntimeError: ExifTool failed: Error: Temporary file already exists: /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_face_crop.png_exiftool_tmp

Error processing crop from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png: Metadata copy failed: ExifTool failed: Error: Temporary file already exists: /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_face_crop.png_exiftool_tmp
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 243, in copy_metadata_from_source
    raise RuntimeError(f"ExifTool failed: {error_msg}")
RuntimeError: ExifTool failed: Error: Temporary file already exists: /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_face_crop.png_exiftool_tmp


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 56, in process
    await self.copy_metadata_from_source()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 249, in copy_metadata_from_source
    raise RuntimeError(f"Metadata copy failed: {e}") from e
RuntimeError: Metadata copy failed: ExifTool failed: Error: Temporary file already exists: /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_face_crop.png_exiftool_tmp

Error processing crops for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png: Crop processing failed: Metadata copy failed: ExifTool failed: Error: Temporary file already exists: /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_face_crop.png_exiftool_tmp
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 243, in copy_metadata_from_source
    raise RuntimeError(f"ExifTool failed: {error_msg}")
RuntimeError: ExifTool failed: Error: Temporary file already exists: /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_face_crop.png_exiftool_tmp


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 56, in process
    await self.copy_metadata_from_source()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 249, in copy_metadata_from_source
    raise RuntimeError(f"Metadata copy failed: {e}") from e
RuntimeError: Metadata copy failed: ExifTool failed: Error: Temporary file already exists: /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_face_crop.png_exiftool_tmp


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 66, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 66, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: Metadata copy failed: ExifTool failed: Error: Temporary file already exists: /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_face_crop.png_exiftool_tmp

Error processing /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png: Crop processing failed: Metadata copy failed: ExifTool failed: Error: Temporary file already exists: /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_face_crop.png_exiftool_tmp
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 243, in copy_metadata_from_source
    raise RuntimeError(f"ExifTool failed: {error_msg}")
RuntimeError: ExifTool failed: Error: Temporary file already exists: /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_face_crop.png_exiftool_tmp


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 56, in process
    await self.copy_metadata_from_source()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 249, in copy_metadata_from_source
    raise RuntimeError(f"Metadata copy failed: {e}") from e
RuntimeError: Metadata copy failed: ExifTool failed: Error: Temporary file already exists: /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_face_crop.png_exiftool_tmp


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 66, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 66, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: Metadata copy failed: ExifTool failed: Error: Temporary file already exists: /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_face_crop.png_exiftool_tmp

Failed to process 3M2A2876.png
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 243, in copy_metadata_from_source
    raise RuntimeError(f"ExifTool failed: {error_msg}")
RuntimeError: ExifTool failed: Error: Temporary file already exists: /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_face_crop.png_exiftool_tmp


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 56, in process
    await self.copy_metadata_from_source()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 249, in copy_metadata_from_source
    raise RuntimeError(f"Metadata copy failed: {e}") from e
RuntimeError: Metadata copy failed: ExifTool failed: Error: Temporary file already exists: /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_face_crop.png_exiftool_tmp


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 44, in process_image
    return await image.process()
           ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 66, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 66, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: Metadata copy failed: ExifTool failed: Error: Temporary file already exists: /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_face_crop.png_exiftool_tmp

Batch processing completed with 1 errors
Batch processing failed
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 243, in copy_metadata_from_source
    raise RuntimeError(f"ExifTool failed: {error_msg}")
RuntimeError: ExifTool failed: Error: Temporary file already exists: /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_face_crop.png_exiftool_tmp


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 56, in process
    await self.copy_metadata_from_source()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 249, in copy_metadata_from_source
    raise RuntimeError(f"Metadata copy failed: {e}") from e
RuntimeError: Metadata copy failed: ExifTool failed: Error: Temporary file already exists: /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_face_crop.png_exiftool_tmp


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 75, in process
    raise errors[0]
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 44, in process_image
    return await image.process()
           ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 66, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 66, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: Metadata copy failed: ExifTool failed: Error: Temporary file already exists: /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_face_crop.png_exiftool_tmp

Failed to process batch 20180312_Photoshoot2
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 243, in copy_metadata_from_source
    raise RuntimeError(f"ExifTool failed: {error_msg}")
RuntimeError: ExifTool failed: Error: Temporary file already exists: /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_face_crop.png_exiftool_tmp


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 56, in process
    await self.copy_metadata_from_source()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 249, in copy_metadata_from_source
    raise RuntimeError(f"Metadata copy failed: {e}") from e
RuntimeError: Metadata copy failed: ExifTool failed: Error: Temporary file already exists: /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_face_crop.png_exiftool_tmp


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/batch_processor.py", line 82, in process_batch
    await batch.process()
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 75, in process
    raise errors[0]
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 44, in process_image
    return await image.process()
           ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 66, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 66, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: Metadata copy failed: ExifTool failed: Error: Temporary file already exists: /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_face_crop.png_exiftool_tmp

Batch processing failed
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/batch_processor.py", line 118, in process_all
    raise RuntimeError(
RuntimeError: Failed to process 1 batch(es):
Batch 20180312_Photoshoot2: Crop processing failed: Metadata copy failed: ExifTool failed: Error: Temporary file already exists: /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_face_crop.png_exiftool_tmp

Cleaning up model registry
Starting model registry cleanup
Model registry cleanup complete
Model registry cleanup complete
[red bold]Error during batch processing[/]
[blue]Pipeline test complete[/]
[red bold]Pipeline test failed[/]
[blue]Starting pipeline test[/]
Input directory: [cyan]/Users/rob/repos/kalliste/test_images_input[/]
Output directory: [cyan]/Users/rob/repos/kalliste/test_images_output[/]
[green]Initializing BatchProcessor[/]
Initializing BatchProcessor with input_root=/Users/rob/repos/kalliste/test_images_input, output_root=/Users/rob/repos/kalliste/test_images_output
Scanning for batches in /Users/rob/repos/kalliste/test_images_input
Initializing Batch with input_path=/Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2, max_concurrent=3
Scanning for images in /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2
Found 1 images to process in batch 20180312_Photoshoot2
Found 1 batches to process
BatchProcessor created
Initializing models
Initializing BatchProcessor and model registry
Starting model registry initialization
Initializing tagger pipeline...
Creating TaggerPipeline instance
MPS device validated
TaggerPipeline created with device: mps
Starting tagger pipeline initialization
Initializing orientation tagger...
Creating OrientationTagger instance for device: mps
Orientation tagger created successfully
Initializing caption tagger...
Creating CaptionTagger instance for device: mps
Caption tagger created successfully
Initializing WD14 tagger...
Loading pretrained weights from Hugging Face hub (SmilingWolf/wd-vit-large-tagger-v3)
[SmilingWolf/wd-vit-large-tagger-v3] Safe alternative available for 'pytorch_model.bin' (as 'model.safetensors'). Loading weights using safetensors.
Loaded 10861 WD14 tags
Creating WD14Tagger instance for device: mps
WD14 tagger created successfully
All taggers initialized successfully
Tagger pipeline initialized successfully
Initializing YOLO detector...
Initializing YOLO detector
Loading YOLO model from /Users/rob/.cache/ultralytics/yolov8n.pt
YOLO model loaded successfully
Loading YOLO face model from /Users/rob/.cache/ultralytics/yolov8n-face.pt
YOLO face model loaded successfully
YOLODetector initialized with 1 active classes
YOLO detector initialized successfully
Model registry initialization complete
BatchProcessor and model registry initialized successfully
[green]BatchProcessor initialized successfully[/]
[green]Starting batch processing[/]
Starting batch processing
Starting batch: 20180312_Photoshoot2
Starting batch processing for 20180312_Photoshoot2 with 1 images
Starting processing for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png
Running detection on /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png
Fusing face model...
Face Model fused successfully
Fusing main model...
Main Model fused successfully
Detection complete. Found 6 total regions
Found 6 detections in /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png
Starting crop processing for face from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png
Starting crop processing for face from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png
Starting crop processing for face from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png
Starting crop processing for person from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png
Starting crop processing for person from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png
Starting crop processing for person from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png
Running taggers for face crop
Running orientation tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_face_crop.png
Running taggers for face crop
Running orientation tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_face_crop.png
Running taggers for face crop
Running orientation tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_face_crop.png
Completed processing crop from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png
Cropped image /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_face_crop.png complete
Temp file issue on attempt 1, retrying...
Completed processing crop from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png
Cropped image /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_face_crop.png complete
Completed processing crop from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png
Cropped image /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_face_crop.png complete
Error processing crop from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png: File /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_person_crop.png not ready after 5 attempts
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 55, in process
    await self._wait_for_file()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 103, in _wait_for_file
    raise RuntimeError(f"File {self.output_path} not ready after {max_retries} attempts")
RuntimeError: File /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_person_crop.png not ready after 5 attempts
Error processing crops for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png: Crop processing failed: File /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_person_crop.png not ready after 5 attempts
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 55, in process
    await self._wait_for_file()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 103, in _wait_for_file
    raise RuntimeError(f"File {self.output_path} not ready after {max_retries} attempts")
RuntimeError: File /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_person_crop.png not ready after 5 attempts

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 66, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 71, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: File /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_person_crop.png not ready after 5 attempts
Error processing /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png: Crop processing failed: File /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_person_crop.png not ready after 5 attempts
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 55, in process
    await self._wait_for_file()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 103, in _wait_for_file
    raise RuntimeError(f"File {self.output_path} not ready after {max_retries} attempts")
RuntimeError: File /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_person_crop.png not ready after 5 attempts

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 66, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 71, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: File /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_person_crop.png not ready after 5 attempts
Failed to process 3M2A2876.png
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 55, in process
    await self._wait_for_file()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 103, in _wait_for_file
    raise RuntimeError(f"File {self.output_path} not ready after {max_retries} attempts")
RuntimeError: File /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_person_crop.png not ready after 5 attempts

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 44, in process_image
    return await image.process()
           ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 66, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 71, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: File /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_person_crop.png not ready after 5 attempts
Batch processing completed with 1 errors
Batch processing failed
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 55, in process
    await self._wait_for_file()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 103, in _wait_for_file
    raise RuntimeError(f"File {self.output_path} not ready after {max_retries} attempts")
RuntimeError: File /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_person_crop.png not ready after 5 attempts

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 75, in process
    raise errors[0]
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 44, in process_image
    return await image.process()
           ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 66, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 71, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: File /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_person_crop.png not ready after 5 attempts
Failed to process batch 20180312_Photoshoot2
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 55, in process
    await self._wait_for_file()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 103, in _wait_for_file
    raise RuntimeError(f"File {self.output_path} not ready after {max_retries} attempts")
RuntimeError: File /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_person_crop.png not ready after 5 attempts

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/batch_processor.py", line 82, in process_batch
    await batch.process()
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 75, in process
    raise errors[0]
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 44, in process_image
    return await image.process()
           ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 66, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 71, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: File /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_person_crop.png not ready after 5 attempts
Batch processing failed
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/batch_processor.py", line 118, in process_all
    raise RuntimeError(
RuntimeError: Failed to process 1 batch(es):
Batch 20180312_Photoshoot2: Crop processing failed: File /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_person_crop.png not ready after 5 attempts
Cleaning up model registry
Starting model registry cleanup
Model registry cleanup complete
Model registry cleanup complete
[red bold]Error during batch processing[/]
[blue]Pipeline test complete[/]
[red bold]Pipeline test failed[/]
[blue]Starting pipeline test[/]
Input directory: [cyan]/Users/rob/repos/kalliste/test_images_input[/]
Output directory: [cyan]/Users/rob/repos/kalliste/test_images_output[/]
[green]Initializing BatchProcessor[/]
Initializing BatchProcessor with input_root=/Users/rob/repos/kalliste/test_images_input, output_root=/Users/rob/repos/kalliste/test_images_output
Scanning for batches in /Users/rob/repos/kalliste/test_images_input
Initializing Batch with input_path=/Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2, max_concurrent=3
Scanning for images in /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2
Found 1 images to process in batch 20180312_Photoshoot2
Found 1 batches to process
BatchProcessor created
Initializing models
Initializing BatchProcessor and model registry
Starting model registry initialization
Initializing tagger pipeline...
Creating TaggerPipeline instance
MPS device validated
TaggerPipeline created with device: mps
Starting tagger pipeline initialization
Initializing orientation tagger...
Creating OrientationTagger instance for device: mps
Orientation tagger created successfully
Initializing caption tagger...
Creating CaptionTagger instance for device: mps
Caption tagger created successfully
Initializing WD14 tagger...
Loading pretrained weights from Hugging Face hub (SmilingWolf/wd-vit-large-tagger-v3)
[SmilingWolf/wd-vit-large-tagger-v3] Safe alternative available for 'pytorch_model.bin' (as 'model.safetensors'). Loading weights using safetensors.
Loaded 10861 WD14 tags
Creating WD14Tagger instance for device: mps
WD14 tagger created successfully
All taggers initialized successfully
Tagger pipeline initialized successfully
Initializing YOLO detector...
Initializing YOLO detector
Loading YOLO model from /Users/rob/.cache/ultralytics/yolov8n.pt
YOLO model loaded successfully
Loading YOLO face model from /Users/rob/.cache/ultralytics/yolov8n-face.pt
YOLO face model loaded successfully
YOLODetector initialized with 1 active classes
YOLO detector initialized successfully
Model registry initialization complete
BatchProcessor and model registry initialized successfully
[green]BatchProcessor initialized successfully[/]
[green]Starting batch processing[/]
Starting batch processing
Starting batch: 20180312_Photoshoot2
Starting batch processing for 20180312_Photoshoot2 with 1 images
Starting processing for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png
Running detection on /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png
Fusing face model...
Face Model fused successfully
Fusing main model...
Main Model fused successfully
Detection complete. Found 6 total regions
Found 6 detections in /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png
Starting crop processing for face from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png
Starting crop processing for face from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png
Starting crop processing for face from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png
Starting crop processing for person from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png
Starting crop processing for person from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png
Starting crop processing for person from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png
Running taggers for face crop
Running orientation tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_face_crop.png
Running taggers for face crop
Running orientation tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_face_crop.png
Running taggers for face crop
Running orientation tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_face_crop.png
Completed processing crop from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png
Cropped image /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_face_crop.png complete
Temp file issue on attempt 1, retrying...
Completed processing crop from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png
Cropped image /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_face_crop.png complete
Completed processing crop from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png
Cropped image /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_face_crop.png complete
Error processing crop from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png: File /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_person_crop.png not ready after 5 attempts
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 55, in process
    await self._wait_for_file()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 103, in _wait_for_file
    raise RuntimeError(f"File {self.output_path} not ready after {max_retries} attempts")
RuntimeError: File /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_person_crop.png not ready after 5 attempts
Error processing crops for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png: Crop processing failed: File /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_person_crop.png not ready after 5 attempts
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 55, in process
    await self._wait_for_file()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 103, in _wait_for_file
    raise RuntimeError(f"File {self.output_path} not ready after {max_retries} attempts")
RuntimeError: File /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_person_crop.png not ready after 5 attempts

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 66, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 71, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: File /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_person_crop.png not ready after 5 attempts
Error processing /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png: Crop processing failed: File /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_person_crop.png not ready after 5 attempts
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 55, in process
    await self._wait_for_file()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 103, in _wait_for_file
    raise RuntimeError(f"File {self.output_path} not ready after {max_retries} attempts")
RuntimeError: File /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_person_crop.png not ready after 5 attempts

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 66, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 71, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: File /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_person_crop.png not ready after 5 attempts
Failed to process 3M2A2876.png
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 55, in process
    await self._wait_for_file()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 103, in _wait_for_file
    raise RuntimeError(f"File {self.output_path} not ready after {max_retries} attempts")
RuntimeError: File /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_person_crop.png not ready after 5 attempts

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 44, in process_image
    return await image.process()
           ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 66, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 71, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: File /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_person_crop.png not ready after 5 attempts
Batch processing completed with 1 errors
Batch processing failed
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 55, in process
    await self._wait_for_file()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 103, in _wait_for_file
    raise RuntimeError(f"File {self.output_path} not ready after {max_retries} attempts")
RuntimeError: File /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_person_crop.png not ready after 5 attempts

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 75, in process
    raise errors[0]
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 44, in process_image
    return await image.process()
           ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 66, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 71, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: File /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_person_crop.png not ready after 5 attempts
Failed to process batch 20180312_Photoshoot2
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 55, in process
    await self._wait_for_file()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 103, in _wait_for_file
    raise RuntimeError(f"File {self.output_path} not ready after {max_retries} attempts")
RuntimeError: File /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_person_crop.png not ready after 5 attempts

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/batch_processor.py", line 82, in process_batch
    await batch.process()
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 75, in process
    raise errors[0]
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 44, in process_image
    return await image.process()
           ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 66, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 71, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: File /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_person_crop.png not ready after 5 attempts
Batch processing failed
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/batch_processor.py", line 118, in process_all
    raise RuntimeError(
RuntimeError: Failed to process 1 batch(es):
Batch 20180312_Photoshoot2: Crop processing failed: File /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_person_crop.png not ready after 5 attempts
Cleaning up model registry
Starting model registry cleanup
Model registry cleanup complete
Model registry cleanup complete
[red bold]Error during batch processing[/]
[blue]Pipeline test complete[/]
[red bold]Pipeline test failed[/]
[blue]Starting pipeline test[/]
Input directory: [cyan]/Users/rob/repos/kalliste/test_images_input[/]
Output directory: [cyan]/Users/rob/repos/kalliste/test_images_output[/]
[green]Initializing BatchProcessor[/]
Initializing BatchProcessor with input_root=/Users/rob/repos/kalliste/test_images_input, output_root=/Users/rob/repos/kalliste/test_images_output
Scanning for batches in /Users/rob/repos/kalliste/test_images_input
Initializing Batch with input_path=/Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2, max_concurrent=3
Scanning for images in /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2
Found 1 images to process in batch 20180312_Photoshoot2
Found 1 batches to process
BatchProcessor created
Initializing models
Initializing BatchProcessor and model registry
Starting model registry initialization
Initializing tagger pipeline...
Creating TaggerPipeline instance
MPS device validated
TaggerPipeline created with device: mps
Starting tagger pipeline initialization
Initializing orientation tagger...
Creating OrientationTagger instance for device: mps
Orientation tagger created successfully
Initializing caption tagger...
Creating CaptionTagger instance for device: mps
Caption tagger created successfully
Initializing WD14 tagger...
Loading pretrained weights from Hugging Face hub (SmilingWolf/wd-vit-large-tagger-v3)
[SmilingWolf/wd-vit-large-tagger-v3] Safe alternative available for 'pytorch_model.bin' (as 'model.safetensors'). Loading weights using safetensors.
Loaded 10861 WD14 tags
Creating WD14Tagger instance for device: mps
WD14 tagger created successfully
All taggers initialized successfully
Tagger pipeline initialized successfully
Initializing YOLO detector...
Initializing YOLO detector
Loading YOLO model from /Users/rob/.cache/ultralytics/yolov8n.pt
YOLO model loaded successfully
Loading YOLO face model from /Users/rob/.cache/ultralytics/yolov8n-face.pt
YOLO face model loaded successfully
YOLODetector initialized with 1 active classes
YOLO detector initialized successfully
Model registry initialization complete
BatchProcessor and model registry initialized successfully
[green]BatchProcessor initialized successfully[/]
[green]Starting batch processing[/]
Starting batch processing
Starting batch: 20180312_Photoshoot2
Starting batch processing for 20180312_Photoshoot2 with 1 images
Starting processing for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png
Running detection on /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png
Fusing face model...
Face Model fused successfully
Fusing main model...
Main Model fused successfully
Detection complete. Found 6 total regions
Found 6 detections in /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png
Starting crop processing for face from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png
Starting crop processing for face from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png
Starting crop processing for face from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png
Starting crop processing for person from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png
Starting crop processing for person from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png
Starting crop processing for person from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png
Running taggers for face crop
Running orientation tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_face_crop.png
Running taggers for face crop
Running orientation tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_face_crop.png
Running taggers for face crop
Running orientation tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_face_crop.png
Completed processing crop from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png
Cropped image /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_face_crop.png complete
Temp file issue on attempt 1, retrying...
Completed processing crop from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png
Cropped image /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_face_crop.png complete
Completed processing crop from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png
Cropped image /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_face_crop.png complete
Error processing crop from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png: File /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_person_crop.png not ready after 5 attempts
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 55, in process
    await self._wait_for_file()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 103, in _wait_for_file
    raise RuntimeError(f"File {self.output_path} not ready after {max_retries} attempts")
RuntimeError: File /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_person_crop.png not ready after 5 attempts
Error processing crops for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png: Crop processing failed: File /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_person_crop.png not ready after 5 attempts
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 55, in process
    await self._wait_for_file()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 103, in _wait_for_file
    raise RuntimeError(f"File {self.output_path} not ready after {max_retries} attempts")
RuntimeError: File /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_person_crop.png not ready after 5 attempts

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 63, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 71, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: File /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_person_crop.png not ready after 5 attempts
Error processing /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png: Crop processing failed: File /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_person_crop.png not ready after 5 attempts
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 55, in process
    await self._wait_for_file()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 103, in _wait_for_file
    raise RuntimeError(f"File {self.output_path} not ready after {max_retries} attempts")
RuntimeError: File /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_person_crop.png not ready after 5 attempts

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 63, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 71, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: File /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_person_crop.png not ready after 5 attempts
Failed to process 3M2A2876.png
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 55, in process
    await self._wait_for_file()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 103, in _wait_for_file
    raise RuntimeError(f"File {self.output_path} not ready after {max_retries} attempts")
RuntimeError: File /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_person_crop.png not ready after 5 attempts

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 44, in process_image
    return await image.process()
           ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 63, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 71, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: File /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_person_crop.png not ready after 5 attempts
Batch processing completed with 1 errors
Batch processing failed
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 55, in process
    await self._wait_for_file()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 103, in _wait_for_file
    raise RuntimeError(f"File {self.output_path} not ready after {max_retries} attempts")
RuntimeError: File /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_person_crop.png not ready after 5 attempts

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 75, in process
    raise errors[0]
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 44, in process_image
    return await image.process()
           ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 63, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 71, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: File /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_person_crop.png not ready after 5 attempts
Failed to process batch 20180312_Photoshoot2
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 55, in process
    await self._wait_for_file()
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 103, in _wait_for_file
    raise RuntimeError(f"File {self.output_path} not ready after {max_retries} attempts")
RuntimeError: File /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_person_crop.png not ready after 5 attempts

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/batch_processor.py", line 82, in process_batch
    await batch.process()
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 75, in process
    raise errors[0]
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 44, in process_image
    return await image.process()
           ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 63, in process
    await asyncio.gather(*crop_tasks)
  File "/Users/rob/repos/kalliste/kalliste/image/cropped_image.py", line 71, in process
    raise RuntimeError(f"Crop processing failed: {e}") from e
RuntimeError: Crop processing failed: File /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_person_crop.png not ready after 5 attempts
Batch processing failed
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/batch_processor.py", line 118, in process_all
    raise RuntimeError(
RuntimeError: Failed to process 1 batch(es):
Batch 20180312_Photoshoot2: Crop processing failed: File /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_person_crop.png not ready after 5 attempts
Cleaning up model registry
Starting model registry cleanup
Model registry cleanup complete
Model registry cleanup complete
[red bold]Error during batch processing[/]
[blue]Pipeline test complete[/]
[red bold]Pipeline test failed[/]
[blue]Starting pipeline test[/]
Input directory: [cyan]/Users/rob/repos/kalliste/test_images_input[/]
Output directory: [cyan]/Users/rob/repos/kalliste/test_images_output[/]
[green]Initializing BatchProcessor[/]
Initializing BatchProcessor with input_root=/Users/rob/repos/kalliste/test_images_input, output_root=/Users/rob/repos/kalliste/test_images_output
Scanning for batches in /Users/rob/repos/kalliste/test_images_input
Initializing Batch with input_path=/Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2, max_concurrent=3
Scanning for images in /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2
Found 1 images to process in batch 20180312_Photoshoot2
Found 1 batches to process
BatchProcessor created
Initializing models
Initializing BatchProcessor and model registry
Starting model registry initialization
Initializing tagger pipeline...
Creating TaggerPipeline instance
MPS device validated
TaggerPipeline created with device: mps
Starting tagger pipeline initialization
Initializing orientation tagger...
Creating OrientationTagger instance for device: mps
Orientation tagger created successfully
Initializing caption tagger...
Creating CaptionTagger instance for device: mps
Caption tagger created successfully
Initializing WD14 tagger...
Loading pretrained weights from Hugging Face hub (SmilingWolf/wd-vit-large-tagger-v3)
[SmilingWolf/wd-vit-large-tagger-v3] Safe alternative available for 'pytorch_model.bin' (as 'model.safetensors'). Loading weights using safetensors.
Loaded 10861 WD14 tags
Creating WD14Tagger instance for device: mps
WD14 tagger created successfully
All taggers initialized successfully
Tagger pipeline initialized successfully
Initializing YOLO detector...
Initializing YOLO detector
Loading YOLO model from /Users/rob/.cache/ultralytics/yolov8n.pt
YOLO model loaded successfully
Loading YOLO face model from /Users/rob/.cache/ultralytics/yolov8n-face.pt
YOLO face model loaded successfully
YOLODetector initialized with 1 active classes
YOLO detector initialized successfully
Model registry initialization complete
BatchProcessor and model registry initialized successfully
[green]BatchProcessor initialized successfully[/]
[green]Starting batch processing[/]
Starting batch processing
Starting batch: 20180312_Photoshoot2
Starting batch processing for 20180312_Photoshoot2 with 1 images
Starting processing for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png
Running detection on /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png
Fusing face model...
Face Model fused successfully
Fusing main model...
Main Model fused successfully
Detection complete. Found 6 total regions
Found 6 detections in /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png
Starting crop processing for face from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png
Running taggers for face crop
Starting crop processing for face from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png
Running taggers for face crop
Starting crop processing for face from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png
Running taggers for face crop
Starting crop processing for person from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png
Running taggers for person crop
Starting crop processing for person from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png
Running taggers for person crop
Starting crop processing for person from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png
Running taggers for person crop
Running orientation tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_face_crop.png
Running orientation tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_face_crop.png
Running orientation tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_face_crop.png
Running caption tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_person_crop.png
Running orientation tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_person_crop.png
Running wd14 tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_person_crop.png
Running caption tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_person_crop.png
Running orientation tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_person_crop.png
Running wd14 tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_person_crop.png
Running caption tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_person_crop.png
Running orientation tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_person_crop.png
Running wd14 tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_person_crop.png
Completed processing crop from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png
Completed processing crop from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png
Completed processing crop from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png
Completed processing crop from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png
Completed processing crop from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png
Completed processing crop from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png
Completed processing for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png
Original image /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png processing complete
Successfully processed 1 images in batch 20180312_Photoshoot2
Batch /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2 complete
Completed batch: 20180312_Photoshoot2
All batches processed successfully
Cleaning up model registry
Starting model registry cleanup
Model registry cleanup complete
Model registry cleanup complete
[green bold]All batches processed successfully![/]
[blue]Pipeline test complete[/]
[blue]Starting pipeline test[/]
Input directory: [cyan]/Users/rob/repos/kalliste/test_images_input[/]
Output directory: [cyan]/Users/rob/repos/kalliste/test_images_output[/]
[green]Initializing BatchProcessor[/]
Initializing BatchProcessor with input_root=/Users/rob/repos/kalliste/test_images_input, output_root=/Users/rob/repos/kalliste/test_images_output
Scanning for batches in /Users/rob/repos/kalliste/test_images_input
Initializing Batch with input_path=/Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2, max_concurrent=3
Scanning for images in /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2
Found 1 images to process in batch 20180312_Photoshoot2
Found 1 batches to process
BatchProcessor created
Initializing models
Initializing BatchProcessor and model registry
Starting model registry initialization
Initializing tagger pipeline...
Creating TaggerPipeline instance
MPS device validated
TaggerPipeline created with device: mps
Starting tagger pipeline initialization
Initializing orientation tagger...
Creating OrientationTagger instance for device: mps
Orientation tagger created successfully
Initializing caption tagger...
Creating CaptionTagger instance for device: mps
Caption tagger created successfully
Initializing WD14 tagger...
Loading pretrained weights from Hugging Face hub (SmilingWolf/wd-vit-large-tagger-v3)
[SmilingWolf/wd-vit-large-tagger-v3] Safe alternative available for 'pytorch_model.bin' (as 'model.safetensors'). Loading weights using safetensors.
Loaded 10861 WD14 tags
Creating WD14Tagger instance for device: mps
WD14 tagger created successfully
All taggers initialized successfully
Tagger pipeline initialized successfully
Initializing YOLO detector...
Initializing YOLO detector
Loading YOLO model from /Users/rob/.cache/ultralytics/yolov8n.pt
YOLO model loaded successfully
Loading YOLO face model from /Users/rob/.cache/ultralytics/yolov8n-face.pt
YOLO face model loaded successfully
YOLODetector initialized with 1 active classes
YOLO detector initialized successfully
Model registry initialization complete
BatchProcessor and model registry initialized successfully
[green]BatchProcessor initialized successfully[/]
[green]Starting batch processing[/]
Starting batch processing
Starting batch: 20180312_Photoshoot2
Starting batch processing for 20180312_Photoshoot2 with 1 images
Starting processing for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png
Running detection on /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png
Fusing face model...
Face Model fused successfully
Fusing main model...
Main Model fused successfully
Detection complete. Found 6 total regions
Found 6 detections in /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png
Starting crop processing for face from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png
Running taggers for face crop
Starting crop processing for face from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png
Running taggers for face crop
Starting crop processing for face from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png
Running taggers for face crop
Starting crop processing for person from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png
Running taggers for person crop
Starting crop processing for person from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png
Running taggers for person crop
Starting crop processing for person from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png
Running taggers for person crop
Running orientation tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_face_crop.png
Running orientation tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_face_crop.png
Running orientation tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_face_crop.png
Running caption tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_person_crop.png
Running orientation tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_person_crop.png
Running wd14 tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_person_crop.png
Running caption tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_person_crop.png
Running orientation tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_person_crop.png
Running wd14 tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_person_crop.png
Running caption tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_person_crop.png
Running orientation tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_person_crop.png
Running wd14 tagger on /Users/rob/repos/kalliste/test_images_output/20180312_Photoshoot2/3M2A2876_person_crop.png
Completed processing crop from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png
Completed processing crop from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png
Completed processing crop from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png
Completed processing crop from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png
Completed processing crop from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png
Completed processing crop from /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png
Completed processing for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png
Original image /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png processing complete
Successfully processed 1 images in batch 20180312_Photoshoot2
Batch /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2 complete
Completed batch: 20180312_Photoshoot2
All batches processed successfully
Cleaning up model registry
Starting model registry cleanup
Model registry cleanup complete
Model registry cleanup complete
[green bold]All batches processed successfully![/]
[blue]Pipeline test complete[/]
[blue]Starting pipeline test[/]
Input directory: [cyan]/Users/rob/repos/kalliste/test_images_input[/]
Output directory: [cyan]/Users/rob/repos/kalliste/test_images_output[/]
[green]Initializing BatchProcessor[/]
Initializing BatchProcessor with input_root=/Users/rob/repos/kalliste/test_images_input, output_root=/Users/rob/repos/kalliste/test_images_output
Scanning for batches in /Users/rob/repos/kalliste/test_images_input
Initializing Batch with input_path=/Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2, max_concurrent=3
Scanning for images in /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2
Failed to scan for batches
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/batch_processor.py", line 62, in scan_for_batches
    self.batches.append(Batch(input_path=item, output_path=output_dir))
                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 19, in __init__
    self.scan_for_images()
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 30, in scan_for_images
    self.original_images.append(OriginalImage(
                                ^^^^^^^^^^^^^^
TypeError: OriginalImage.__init__() missing 1 required positional argument: 'detection_config'
[red bold]Failed to initialize BatchProcessor[/]
[red bold]Pipeline test failed[/]
[blue]Starting pipeline test[/]
Input directory: [cyan]/Users/rob/repos/kalliste/test_images_input[/]
Output directory: [cyan]/Users/rob/repos/kalliste/test_images_output[/]
[green]Initializing BatchProcessor[/]
Initializing BatchProcessor with input_root=/Users/rob/repos/kalliste/test_images_input, output_root=/Users/rob/repos/kalliste/test_images_output
Scanning for batches in /Users/rob/repos/kalliste/test_images_input
Initializing Batch with input_path=/Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2, max_concurrent=3
Scanning for images in /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2
Found 1 images to process in batch 20180312_Photoshoot2
Found 1 batches to process
BatchProcessor created
Initializing models
Initializing BatchProcessor and model registry
Starting model registry initialization
Initializing tagger pipeline...
Creating TaggerPipeline instance
MPS device validated
TaggerPipeline created with device: mps
Starting tagger pipeline initialization
Initializing orientation tagger...
Creating OrientationTagger instance for device: mps
Orientation tagger created successfully
Initializing caption tagger...
Creating CaptionTagger instance for device: mps
Caption tagger created successfully
Initializing WD14 tagger...
Loading pretrained weights from Hugging Face hub (SmilingWolf/wd-vit-large-tagger-v3)
[SmilingWolf/wd-vit-large-tagger-v3] Safe alternative available for 'pytorch_model.bin' (as 'model.safetensors'). Loading weights using safetensors.
Loaded 10861 WD14 tags
Creating WD14Tagger instance for device: mps
WD14 tagger created successfully
All taggers initialized successfully
Tagger pipeline initialized successfully
Initializing YOLO detector...
Initializing YOLO detector
Loading YOLO model from /Users/rob/.cache/ultralytics/yolov8n.pt
YOLO model loaded successfully
YOLODetector initialized with 1 active classes
YOLO detector initialized successfully
Model registry initialization complete
BatchProcessor and model registry initialized successfully
[green]BatchProcessor initialized successfully[/]
[green]Starting batch processing[/]
Starting batch processing
Starting batch: 20180312_Photoshoot2
Starting batch processing for 20180312_Photoshoot2 with 1 images
Starting processing for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png
Initializing YOLO detector
Loading YOLO model from /Users/rob/.cache/ultralytics/yolov8n.pt
YOLO model loaded successfully
YOLODetector initialized with 0 active classes
Running detection on /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png
Found 0 regions in /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png
Error matching regions with EXIF data: could not convert string to float: ''
Completed processing for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png
Original image /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png processing complete
Successfully processed 1 images in batch 20180312_Photoshoot2
Batch /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2 complete
Completed batch: 20180312_Photoshoot2
All batches processed successfully
Cleaning up model registry
Starting model registry cleanup
Model registry cleanup complete
Model registry cleanup complete
[green bold]All batches processed successfully![/]
[blue]Pipeline test complete[/]
[blue]Starting pipeline test[/]
Input directory: [cyan]/Users/rob/repos/kalliste/test_images_input[/]
Output directory: [cyan]/Users/rob/repos/kalliste/test_images_output[/]
[green]Initializing BatchProcessor[/]
Initializing BatchProcessor with input_root=/Users/rob/repos/kalliste/test_images_input, output_root=/Users/rob/repos/kalliste/test_images_output
Scanning for batches in /Users/rob/repos/kalliste/test_images_input
Initializing Batch with input_path=/Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2, max_concurrent=3
Scanning for images in /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2
Found 1 images to process in batch 20180312_Photoshoot2
Found 1 batches to process
BatchProcessor created
Initializing models
Initializing BatchProcessor and model registry
Starting model registry initialization
Initializing tagger pipeline...
Creating TaggerPipeline instance
MPS device validated
TaggerPipeline created with device: mps
Starting tagger pipeline initialization
Initializing orientation tagger...
Creating OrientationTagger instance for device: mps
Orientation tagger created successfully
Initializing caption tagger...
Creating CaptionTagger instance for device: mps
Caption tagger created successfully
Initializing WD14 tagger...
Loading pretrained weights from Hugging Face hub (SmilingWolf/wd-vit-large-tagger-v3)
[SmilingWolf/wd-vit-large-tagger-v3] Safe alternative available for 'pytorch_model.bin' (as 'model.safetensors'). Loading weights using safetensors.
Loaded 10861 WD14 tags
Creating WD14Tagger instance for device: mps
WD14 tagger created successfully
All taggers initialized successfully
Tagger pipeline initialized successfully
Initializing YOLO detector...
Initializing YOLO detector
Loading YOLO model from /Users/rob/.cache/ultralytics/yolov8n.pt
YOLO model loaded successfully
YOLODetector initialized with 1 active classes
YOLO detector initialized successfully
Model registry initialization complete
BatchProcessor and model registry initialized successfully
[green]BatchProcessor initialized successfully[/]
[green]Starting batch processing[/]
Starting batch processing
Starting batch: 20180312_Photoshoot2
Starting batch processing for 20180312_Photoshoot2 with 1 images
Starting processing for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png
Initializing YOLO detector
Loading YOLO model from /Users/rob/.cache/ultralytics/yolov8n.pt
YOLO model loaded successfully
YOLODetector initialized with 0 active classes
Running detection on /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png
Found 0 regions in /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png
Error matching regions with EXIF data: could not convert string to float: ''
Completed processing for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png
Original image /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png processing complete
Successfully processed 1 images in batch 20180312_Photoshoot2
Batch /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2 complete
Completed batch: 20180312_Photoshoot2
All batches processed successfully
Cleaning up model registry
Starting model registry cleanup
Model registry cleanup complete
Model registry cleanup complete
[green bold]All batches processed successfully![/]
[blue]Pipeline test complete[/]
[blue]Starting pipeline test[/]
Input directory: [cyan]/Users/rob/repos/kalliste/test_images_input[/]
Output directory: [cyan]/Users/rob/repos/kalliste/test_images_output[/]
[green]Initializing BatchProcessor[/]
Initializing BatchProcessor with input_root=/Users/rob/repos/kalliste/test_images_input, output_root=/Users/rob/repos/kalliste/test_images_output
Scanning for batches in /Users/rob/repos/kalliste/test_images_input
Initializing Batch with input_path=/Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2, max_concurrent=3
Scanning for images in /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2
Found 1 images to process in batch 20180312_Photoshoot2
Found 1 batches to process
BatchProcessor created
Initializing models
Initializing BatchProcessor and model registry
Starting model registry initialization
Initializing tagger pipeline...
Creating TaggerPipeline instance
MPS device validated
TaggerPipeline created with device: mps
Starting tagger pipeline initialization
Initializing orientation tagger...
Creating OrientationTagger instance for device: mps
Orientation tagger created successfully
Initializing caption tagger...
Creating CaptionTagger instance for device: mps
Caption tagger created successfully
Initializing WD14 tagger...
Loading pretrained weights from Hugging Face hub (SmilingWolf/wd-vit-large-tagger-v3)
[SmilingWolf/wd-vit-large-tagger-v3] Safe alternative available for 'pytorch_model.bin' (as 'model.safetensors'). Loading weights using safetensors.
Loaded 10861 WD14 tags
Creating WD14Tagger instance for device: mps
WD14 tagger created successfully
All taggers initialized successfully
Tagger pipeline initialized successfully
Initializing YOLO detector...
Initializing YOLO detector
Loading YOLO model from /Users/rob/.cache/ultralytics/yolov8n.pt
YOLO model loaded successfully
YOLODetector initialized with 1 active classes
YOLO detector initialized successfully
Model registry initialization complete
BatchProcessor and model registry initialized successfully
[green]BatchProcessor initialized successfully[/]
[green]Starting batch processing[/]
Starting batch processing
Starting batch: 20180312_Photoshoot2
Starting batch processing for 20180312_Photoshoot2 with 1 images
Starting processing for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png
Detection pipeline failed for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png: 'DetectionPipeline' object has no attribute 'load_metadata'
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 87, in _run_detection_pipeline
    self.detected_regions = await loop.run_in_executor(
                            ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/detectors/detection_pipeline.py", line 90, in detect
    self.load_metadata(image_path)
    ^^^^^^^^^^^^^^^^^^
AttributeError: 'DetectionPipeline' object has no attribute 'load_metadata'
Detection failed for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png: 'DetectionPipeline' object has no attribute 'load_metadata'
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 38, in process
    await self._run_detection_pipeline()
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 87, in _run_detection_pipeline
    self.detected_regions = await loop.run_in_executor(
                            ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/detectors/detection_pipeline.py", line 90, in detect
    self.load_metadata(image_path)
    ^^^^^^^^^^^^^^^^^^
AttributeError: 'DetectionPipeline' object has no attribute 'load_metadata'
Error processing /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png: 'DetectionPipeline' object has no attribute 'load_metadata'
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 38, in process
    await self._run_detection_pipeline()
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 87, in _run_detection_pipeline
    self.detected_regions = await loop.run_in_executor(
                            ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/detectors/detection_pipeline.py", line 90, in detect
    self.load_metadata(image_path)
    ^^^^^^^^^^^^^^^^^^
AttributeError: 'DetectionPipeline' object has no attribute 'load_metadata'
Failed to process 3M2A2876.png
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 83, in process_image
    return await image.process()
           ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 38, in process
    await self._run_detection_pipeline()
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 87, in _run_detection_pipeline
    self.detected_regions = await loop.run_in_executor(
                            ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/detectors/detection_pipeline.py", line 90, in detect
    self.load_metadata(image_path)
    ^^^^^^^^^^^^^^^^^^
AttributeError: 'DetectionPipeline' object has no attribute 'load_metadata'
Batch processing completed with 1 errors
Batch processing failed
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 114, in process
    raise errors[0]
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 83, in process_image
    return await image.process()
           ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 38, in process
    await self._run_detection_pipeline()
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 87, in _run_detection_pipeline
    self.detected_regions = await loop.run_in_executor(
                            ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/detectors/detection_pipeline.py", line 90, in detect
    self.load_metadata(image_path)
    ^^^^^^^^^^^^^^^^^^
AttributeError: 'DetectionPipeline' object has no attribute 'load_metadata'
Failed to process batch 20180312_Photoshoot2
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/batch_processor.py", line 82, in process_batch
    await batch.process()
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 114, in process
    raise errors[0]
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 83, in process_image
    return await image.process()
           ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 38, in process
    await self._run_detection_pipeline()
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 87, in _run_detection_pipeline
    self.detected_regions = await loop.run_in_executor(
                            ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/detectors/detection_pipeline.py", line 90, in detect
    self.load_metadata(image_path)
    ^^^^^^^^^^^^^^^^^^
AttributeError: 'DetectionPipeline' object has no attribute 'load_metadata'
Batch processing failed
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/batch_processor.py", line 118, in process_all
    raise RuntimeError(
RuntimeError: Failed to process 1 batch(es):
Batch 20180312_Photoshoot2: 'DetectionPipeline' object has no attribute 'load_metadata'
Cleaning up model registry
Starting model registry cleanup
Model registry cleanup complete
Model registry cleanup complete
[red bold]Error during batch processing[/]
[blue]Pipeline test complete[/]
[red bold]Pipeline test failed[/]
[blue]Starting pipeline test[/]
Input directory: [cyan]/Users/rob/repos/kalliste/test_images_input[/]
Output directory: [cyan]/Users/rob/repos/kalliste/test_images_output[/]
[green]Initializing BatchProcessor[/]
Initializing BatchProcessor with input_root=/Users/rob/repos/kalliste/test_images_input, output_root=/Users/rob/repos/kalliste/test_images_output
Scanning for batches in /Users/rob/repos/kalliste/test_images_input
Initializing Batch with input_path=/Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2, max_concurrent=3
Scanning for images in /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2
Found 1 images to process in batch 20180312_Photoshoot2
Found 1 batches to process
BatchProcessor created
Initializing models
Initializing BatchProcessor and model registry
Starting model registry initialization
Initializing tagger pipeline...
Creating TaggerPipeline instance
MPS device validated
TaggerPipeline created with device: mps
Starting tagger pipeline initialization
Initializing orientation tagger...
Creating OrientationTagger instance for device: mps
Orientation tagger created successfully
Initializing caption tagger...
Creating CaptionTagger instance for device: mps
Caption tagger created successfully
Initializing WD14 tagger...
Loading pretrained weights from Hugging Face hub (SmilingWolf/wd-vit-large-tagger-v3)
[SmilingWolf/wd-vit-large-tagger-v3] Safe alternative available for 'pytorch_model.bin' (as 'model.safetensors'). Loading weights using safetensors.
Loaded 10861 WD14 tags
Creating WD14Tagger instance for device: mps
WD14 tagger created successfully
All taggers initialized successfully
Tagger pipeline initialized successfully
Initializing YOLO detector...
Initializing YOLO detector
Loading YOLO model yolov8n.pt
YOLO model loaded successfully
YOLODetector initialized with 1 active classes
YOLO detector initialized successfully
Model registry initialization complete
BatchProcessor and model registry initialized successfully
[green]BatchProcessor initialized successfully[/]
[green]Starting batch processing[/]
Starting batch processing
Starting batch: 20180312_Photoshoot2
Starting batch processing for 20180312_Photoshoot2 with 1 images
Starting processing for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png
Detection pipeline failed for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png: 'DetectionPipeline' object has no attribute 'load_metadata'
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 87, in _run_detection_pipeline
    self.detected_regions = await loop.run_in_executor(
                            ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/detectors/detection_pipeline.py", line 90, in detect
    self.load_metadata(image_path)
    ^^^^^^^^^^^^^^^^^^
AttributeError: 'DetectionPipeline' object has no attribute 'load_metadata'
Detection failed for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png: 'DetectionPipeline' object has no attribute 'load_metadata'
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 38, in process
    await self._run_detection_pipeline()
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 87, in _run_detection_pipeline
    self.detected_regions = await loop.run_in_executor(
                            ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/detectors/detection_pipeline.py", line 90, in detect
    self.load_metadata(image_path)
    ^^^^^^^^^^^^^^^^^^
AttributeError: 'DetectionPipeline' object has no attribute 'load_metadata'
Error processing /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png: 'DetectionPipeline' object has no attribute 'load_metadata'
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 38, in process
    await self._run_detection_pipeline()
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 87, in _run_detection_pipeline
    self.detected_regions = await loop.run_in_executor(
                            ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/detectors/detection_pipeline.py", line 90, in detect
    self.load_metadata(image_path)
    ^^^^^^^^^^^^^^^^^^
AttributeError: 'DetectionPipeline' object has no attribute 'load_metadata'
Failed to process 3M2A2876.png
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 83, in process_image
    return await image.process()
           ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 38, in process
    await self._run_detection_pipeline()
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 87, in _run_detection_pipeline
    self.detected_regions = await loop.run_in_executor(
                            ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/detectors/detection_pipeline.py", line 90, in detect
    self.load_metadata(image_path)
    ^^^^^^^^^^^^^^^^^^
AttributeError: 'DetectionPipeline' object has no attribute 'load_metadata'
Batch processing completed with 1 errors
Batch processing failed
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 114, in process
    raise errors[0]
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 83, in process_image
    return await image.process()
           ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 38, in process
    await self._run_detection_pipeline()
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 87, in _run_detection_pipeline
    self.detected_regions = await loop.run_in_executor(
                            ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/detectors/detection_pipeline.py", line 90, in detect
    self.load_metadata(image_path)
    ^^^^^^^^^^^^^^^^^^
AttributeError: 'DetectionPipeline' object has no attribute 'load_metadata'
Failed to process batch 20180312_Photoshoot2
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/batch_processor.py", line 82, in process_batch
    await batch.process()
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 114, in process
    raise errors[0]
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 83, in process_image
    return await image.process()
           ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 38, in process
    await self._run_detection_pipeline()
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 87, in _run_detection_pipeline
    self.detected_regions = await loop.run_in_executor(
                            ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/detectors/detection_pipeline.py", line 90, in detect
    self.load_metadata(image_path)
    ^^^^^^^^^^^^^^^^^^
AttributeError: 'DetectionPipeline' object has no attribute 'load_metadata'
Batch processing failed
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/batch_processor.py", line 118, in process_all
    raise RuntimeError(
RuntimeError: Failed to process 1 batch(es):
Batch 20180312_Photoshoot2: 'DetectionPipeline' object has no attribute 'load_metadata'
Cleaning up model registry
Starting model registry cleanup
Model registry cleanup complete
Model registry cleanup complete
[red bold]Error during batch processing[/]
[blue]Pipeline test complete[/]
[red bold]Pipeline test failed[/]
[blue]Starting pipeline test[/]
Input directory: [cyan]/Users/rob/repos/kalliste/test_images_input[/]
Output directory: [cyan]/Users/rob/repos/kalliste/test_images_output[/]
[green]Initializing BatchProcessor[/]
Initializing BatchProcessor with input_root=/Users/rob/repos/kalliste/test_images_input, output_root=/Users/rob/repos/kalliste/test_images_output
Scanning for batches in /Users/rob/repos/kalliste/test_images_input
Initializing Batch with input_path=/Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2, max_concurrent=3
Scanning for images in /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2
Found 1 images to process in batch 20180312_Photoshoot2
Found 1 batches to process
BatchProcessor created
Initializing models
Initializing BatchProcessor and model registry
Starting model registry initialization
Initializing tagger pipeline...
Creating TaggerPipeline instance
MPS device validated
TaggerPipeline created with device: mps
Starting tagger pipeline initialization
Initializing orientation tagger...
Creating OrientationTagger instance for device: mps
Orientation tagger created successfully
Initializing caption tagger...
Creating CaptionTagger instance for device: mps
Caption tagger created successfully
Initializing WD14 tagger...
Loading pretrained weights from Hugging Face hub (SmilingWolf/wd-vit-large-tagger-v3)
[SmilingWolf/wd-vit-large-tagger-v3] Safe alternative available for 'pytorch_model.bin' (as 'model.safetensors'). Loading weights using safetensors.
Loaded 10861 WD14 tags
Creating WD14Tagger instance for device: mps
WD14 tagger created successfully
All taggers initialized successfully
Tagger pipeline initialized successfully
Initializing YOLO detector...
Initializing YOLO detector
Loading YOLO model yolov8n.pt
YOLO model loaded successfully
YOLODetector initialized with 1 active classes
YOLO detector initialized successfully
Model registry initialization complete
BatchProcessor and model registry initialized successfully
[green]BatchProcessor initialized successfully[/]
[green]Starting batch processing[/]
Starting batch processing
Starting batch: 20180312_Photoshoot2
Starting batch processing for 20180312_Photoshoot2 with 1 images
Starting processing for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png
No detection types enabled in config
Found 0 regions in /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png
Error matching regions with EXIF data: could not convert string to float: ''
Completed processing for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png
Original image /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png processing complete
Successfully processed 1 images in batch 20180312_Photoshoot2
Batch /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2 complete
Completed batch: 20180312_Photoshoot2
All batches processed successfully
Cleaning up model registry
Starting model registry cleanup
Model registry cleanup complete
Model registry cleanup complete
[green bold]All batches processed successfully![/]
[blue]Pipeline test complete[/]
[blue]Starting pipeline test[/]
Input directory: [cyan]/Users/rob/repos/kalliste/test_images_input[/]
Output directory: [cyan]/Users/rob/repos/kalliste/test_images_output[/]
[green]Initializing BatchProcessor[/]
Initializing BatchProcessor with input_root=/Users/rob/repos/kalliste/test_images_input, output_root=/Users/rob/repos/kalliste/test_images_output
Scanning for batches in /Users/rob/repos/kalliste/test_images_input
Initializing Batch with input_path=/Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2, max_concurrent=3
Scanning for images in /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2
Found 1 images to process in batch 20180312_Photoshoot2
Found 1 batches to process
BatchProcessor created
Initializing models
Initializing BatchProcessor and model registry
Starting model registry initialization
Initializing tagger pipeline...
Creating TaggerPipeline instance
MPS device validated
TaggerPipeline created with device: mps
Starting tagger pipeline initialization
Initializing orientation tagger...
Creating OrientationTagger instance for device: mps
Orientation tagger created successfully
Initializing caption tagger...
Creating CaptionTagger instance for device: mps
Caption tagger created successfully
Initializing WD14 tagger...
Loading pretrained weights from Hugging Face hub (SmilingWolf/wd-vit-large-tagger-v3)
[SmilingWolf/wd-vit-large-tagger-v3] Safe alternative available for 'pytorch_model.bin' (as 'model.safetensors'). Loading weights using safetensors.
Loaded 10861 WD14 tags
Creating WD14Tagger instance for device: mps
WD14 tagger created successfully
All taggers initialized successfully
Tagger pipeline initialized successfully
Initializing YOLO detector...
Initializing YOLO detector
Loading YOLO model yolov8n.pt
YOLO model loaded successfully
YOLODetector initialized with 1 active classes
YOLO detector initialized successfully
Model registry initialization complete
BatchProcessor and model registry initialized successfully
[green]BatchProcessor initialized successfully[/]
[green]Starting batch processing[/]
Starting batch processing
Starting batch: 20180312_Photoshoot2
Starting batch processing for 20180312_Photoshoot2 with 1 images
Starting processing for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png
Initializing detector: yolo_face_yolov8n-face.pt
Initializing YOLO face detector
Loading YOLO face model yolov8n-face.pt
Failed to load YOLO face model: [Errno 2] No such file or directory: 'yolov8n-face.pt'
Detection failed for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png: [Errno 2] No such file or directory: 'yolov8n-face.pt'
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/detectors/detection_pipeline.py", line 100, in detect
    self._init_detector(detector_type, model_identifier, config)
  File "/Users/rob/repos/kalliste/kalliste/detectors/detection_pipeline.py", line 68, in _init_detector
    self._detectors[detector_key] = YOLOFaceDetector(config=detector_configs)
                                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/detectors/yolo_face_detector.py", line 29, in __init__
    self.model = YOLO(YOLO_FACE_MODEL, task='detect')
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/models/yolo/model.py", line 23, in __init__
    super().__init__(model=model, task=task, verbose=verbose)
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/engine/model.py", line 152, in __init__
    self._load(model, task=task)
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/engine/model.py", line 241, in _load
    self.model, self.ckpt = attempt_load_one_weight(weights)
                            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/nn/tasks.py", line 806, in attempt_load_one_weight
    ckpt, weight = torch_safe_load(weight)  # load ckpt
                   ^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/nn/tasks.py", line 732, in torch_safe_load
    ckpt = torch.load(file, map_location="cpu")
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/torch/serialization.py", line 1319, in load
    with _open_file_like(f, "rb") as opened_file:
         ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/torch/serialization.py", line 659, in _open_file_like
    return _open_file(name_or_buffer, mode)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/torch/serialization.py", line 640, in __init__
    super().__init__(open(name, mode))
                     ^^^^^^^^^^^^^^^^
FileNotFoundError: [Errno 2] No such file or directory: 'yolov8n-face.pt'
Detection pipeline failed for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png: Detection failed: [Errno 2] No such file or directory: 'yolov8n-face.pt'
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/detectors/detection_pipeline.py", line 100, in detect
    self._init_detector(detector_type, model_identifier, config)
  File "/Users/rob/repos/kalliste/kalliste/detectors/detection_pipeline.py", line 68, in _init_detector
    self._detectors[detector_key] = YOLOFaceDetector(config=detector_configs)
                                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/detectors/yolo_face_detector.py", line 29, in __init__
    self.model = YOLO(YOLO_FACE_MODEL, task='detect')
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/models/yolo/model.py", line 23, in __init__
    super().__init__(model=model, task=task, verbose=verbose)
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/engine/model.py", line 152, in __init__
    self._load(model, task=task)
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/engine/model.py", line 241, in _load
    self.model, self.ckpt = attempt_load_one_weight(weights)
                            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/nn/tasks.py", line 806, in attempt_load_one_weight
    ckpt, weight = torch_safe_load(weight)  # load ckpt
                   ^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/nn/tasks.py", line 732, in torch_safe_load
    ckpt = torch.load(file, map_location="cpu")
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/torch/serialization.py", line 1319, in load
    with _open_file_like(f, "rb") as opened_file:
         ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/torch/serialization.py", line 659, in _open_file_like
    return _open_file(name_or_buffer, mode)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/torch/serialization.py", line 640, in __init__
    super().__init__(open(name, mode))
                     ^^^^^^^^^^^^^^^^
FileNotFoundError: [Errno 2] No such file or directory: 'yolov8n-face.pt'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 87, in _run_detection_pipeline
    self.detected_regions = await loop.run_in_executor(
                            ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/detectors/detection_pipeline.py", line 118, in detect
    raise RuntimeError(f"Detection failed: {str(e)}") from e
RuntimeError: Detection failed: [Errno 2] No such file or directory: 'yolov8n-face.pt'
Detection failed for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png: Detection failed: [Errno 2] No such file or directory: 'yolov8n-face.pt'
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/detectors/detection_pipeline.py", line 100, in detect
    self._init_detector(detector_type, model_identifier, config)
  File "/Users/rob/repos/kalliste/kalliste/detectors/detection_pipeline.py", line 68, in _init_detector
    self._detectors[detector_key] = YOLOFaceDetector(config=detector_configs)
                                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/detectors/yolo_face_detector.py", line 29, in __init__
    self.model = YOLO(YOLO_FACE_MODEL, task='detect')
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/models/yolo/model.py", line 23, in __init__
    super().__init__(model=model, task=task, verbose=verbose)
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/engine/model.py", line 152, in __init__
    self._load(model, task=task)
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/engine/model.py", line 241, in _load
    self.model, self.ckpt = attempt_load_one_weight(weights)
                            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/nn/tasks.py", line 806, in attempt_load_one_weight
    ckpt, weight = torch_safe_load(weight)  # load ckpt
                   ^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/nn/tasks.py", line 732, in torch_safe_load
    ckpt = torch.load(file, map_location="cpu")
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/torch/serialization.py", line 1319, in load
    with _open_file_like(f, "rb") as opened_file:
         ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/torch/serialization.py", line 659, in _open_file_like
    return _open_file(name_or_buffer, mode)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/torch/serialization.py", line 640, in __init__
    super().__init__(open(name, mode))
                     ^^^^^^^^^^^^^^^^
FileNotFoundError: [Errno 2] No such file or directory: 'yolov8n-face.pt'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 38, in process
    await self._run_detection_pipeline()
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 87, in _run_detection_pipeline
    self.detected_regions = await loop.run_in_executor(
                            ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/detectors/detection_pipeline.py", line 118, in detect
    raise RuntimeError(f"Detection failed: {str(e)}") from e
RuntimeError: Detection failed: [Errno 2] No such file or directory: 'yolov8n-face.pt'
Error processing /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png: Detection failed: [Errno 2] No such file or directory: 'yolov8n-face.pt'
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/detectors/detection_pipeline.py", line 100, in detect
    self._init_detector(detector_type, model_identifier, config)
  File "/Users/rob/repos/kalliste/kalliste/detectors/detection_pipeline.py", line 68, in _init_detector
    self._detectors[detector_key] = YOLOFaceDetector(config=detector_configs)
                                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/detectors/yolo_face_detector.py", line 29, in __init__
    self.model = YOLO(YOLO_FACE_MODEL, task='detect')
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/models/yolo/model.py", line 23, in __init__
    super().__init__(model=model, task=task, verbose=verbose)
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/engine/model.py", line 152, in __init__
    self._load(model, task=task)
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/engine/model.py", line 241, in _load
    self.model, self.ckpt = attempt_load_one_weight(weights)
                            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/nn/tasks.py", line 806, in attempt_load_one_weight
    ckpt, weight = torch_safe_load(weight)  # load ckpt
                   ^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/nn/tasks.py", line 732, in torch_safe_load
    ckpt = torch.load(file, map_location="cpu")
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/torch/serialization.py", line 1319, in load
    with _open_file_like(f, "rb") as opened_file:
         ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/torch/serialization.py", line 659, in _open_file_like
    return _open_file(name_or_buffer, mode)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/torch/serialization.py", line 640, in __init__
    super().__init__(open(name, mode))
                     ^^^^^^^^^^^^^^^^
FileNotFoundError: [Errno 2] No such file or directory: 'yolov8n-face.pt'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 38, in process
    await self._run_detection_pipeline()
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 87, in _run_detection_pipeline
    self.detected_regions = await loop.run_in_executor(
                            ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/detectors/detection_pipeline.py", line 118, in detect
    raise RuntimeError(f"Detection failed: {str(e)}") from e
RuntimeError: Detection failed: [Errno 2] No such file or directory: 'yolov8n-face.pt'
Failed to process 3M2A2876.png
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/detectors/detection_pipeline.py", line 100, in detect
    self._init_detector(detector_type, model_identifier, config)
  File "/Users/rob/repos/kalliste/kalliste/detectors/detection_pipeline.py", line 68, in _init_detector
    self._detectors[detector_key] = YOLOFaceDetector(config=detector_configs)
                                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/detectors/yolo_face_detector.py", line 29, in __init__
    self.model = YOLO(YOLO_FACE_MODEL, task='detect')
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/models/yolo/model.py", line 23, in __init__
    super().__init__(model=model, task=task, verbose=verbose)
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/engine/model.py", line 152, in __init__
    self._load(model, task=task)
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/engine/model.py", line 241, in _load
    self.model, self.ckpt = attempt_load_one_weight(weights)
                            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/nn/tasks.py", line 806, in attempt_load_one_weight
    ckpt, weight = torch_safe_load(weight)  # load ckpt
                   ^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/nn/tasks.py", line 732, in torch_safe_load
    ckpt = torch.load(file, map_location="cpu")
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/torch/serialization.py", line 1319, in load
    with _open_file_like(f, "rb") as opened_file:
         ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/torch/serialization.py", line 659, in _open_file_like
    return _open_file(name_or_buffer, mode)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/torch/serialization.py", line 640, in __init__
    super().__init__(open(name, mode))
                     ^^^^^^^^^^^^^^^^
FileNotFoundError: [Errno 2] No such file or directory: 'yolov8n-face.pt'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 83, in process_image
    return await image.process()
           ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 38, in process
    await self._run_detection_pipeline()
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 87, in _run_detection_pipeline
    self.detected_regions = await loop.run_in_executor(
                            ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/detectors/detection_pipeline.py", line 118, in detect
    raise RuntimeError(f"Detection failed: {str(e)}") from e
RuntimeError: Detection failed: [Errno 2] No such file or directory: 'yolov8n-face.pt'
Batch processing completed with 1 errors
Batch processing failed
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/detectors/detection_pipeline.py", line 100, in detect
    self._init_detector(detector_type, model_identifier, config)
  File "/Users/rob/repos/kalliste/kalliste/detectors/detection_pipeline.py", line 68, in _init_detector
    self._detectors[detector_key] = YOLOFaceDetector(config=detector_configs)
                                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/detectors/yolo_face_detector.py", line 29, in __init__
    self.model = YOLO(YOLO_FACE_MODEL, task='detect')
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/models/yolo/model.py", line 23, in __init__
    super().__init__(model=model, task=task, verbose=verbose)
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/engine/model.py", line 152, in __init__
    self._load(model, task=task)
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/engine/model.py", line 241, in _load
    self.model, self.ckpt = attempt_load_one_weight(weights)
                            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/nn/tasks.py", line 806, in attempt_load_one_weight
    ckpt, weight = torch_safe_load(weight)  # load ckpt
                   ^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/nn/tasks.py", line 732, in torch_safe_load
    ckpt = torch.load(file, map_location="cpu")
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/torch/serialization.py", line 1319, in load
    with _open_file_like(f, "rb") as opened_file:
         ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/torch/serialization.py", line 659, in _open_file_like
    return _open_file(name_or_buffer, mode)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/torch/serialization.py", line 640, in __init__
    super().__init__(open(name, mode))
                     ^^^^^^^^^^^^^^^^
FileNotFoundError: [Errno 2] No such file or directory: 'yolov8n-face.pt'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 114, in process
    raise errors[0]
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 83, in process_image
    return await image.process()
           ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 38, in process
    await self._run_detection_pipeline()
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 87, in _run_detection_pipeline
    self.detected_regions = await loop.run_in_executor(
                            ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/detectors/detection_pipeline.py", line 118, in detect
    raise RuntimeError(f"Detection failed: {str(e)}") from e
RuntimeError: Detection failed: [Errno 2] No such file or directory: 'yolov8n-face.pt'
Failed to process batch 20180312_Photoshoot2
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/detectors/detection_pipeline.py", line 100, in detect
    self._init_detector(detector_type, model_identifier, config)
  File "/Users/rob/repos/kalliste/kalliste/detectors/detection_pipeline.py", line 68, in _init_detector
    self._detectors[detector_key] = YOLOFaceDetector(config=detector_configs)
                                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/detectors/yolo_face_detector.py", line 29, in __init__
    self.model = YOLO(YOLO_FACE_MODEL, task='detect')
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/models/yolo/model.py", line 23, in __init__
    super().__init__(model=model, task=task, verbose=verbose)
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/engine/model.py", line 152, in __init__
    self._load(model, task=task)
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/engine/model.py", line 241, in _load
    self.model, self.ckpt = attempt_load_one_weight(weights)
                            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/nn/tasks.py", line 806, in attempt_load_one_weight
    ckpt, weight = torch_safe_load(weight)  # load ckpt
                   ^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/nn/tasks.py", line 732, in torch_safe_load
    ckpt = torch.load(file, map_location="cpu")
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/torch/serialization.py", line 1319, in load
    with _open_file_like(f, "rb") as opened_file:
         ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/torch/serialization.py", line 659, in _open_file_like
    return _open_file(name_or_buffer, mode)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/torch/serialization.py", line 640, in __init__
    super().__init__(open(name, mode))
                     ^^^^^^^^^^^^^^^^
FileNotFoundError: [Errno 2] No such file or directory: 'yolov8n-face.pt'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/batch_processor.py", line 82, in process_batch
    await batch.process()
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 114, in process
    raise errors[0]
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 83, in process_image
    return await image.process()
           ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 38, in process
    await self._run_detection_pipeline()
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 87, in _run_detection_pipeline
    self.detected_regions = await loop.run_in_executor(
                            ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/detectors/detection_pipeline.py", line 118, in detect
    raise RuntimeError(f"Detection failed: {str(e)}") from e
RuntimeError: Detection failed: [Errno 2] No such file or directory: 'yolov8n-face.pt'
Batch processing failed
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/batch_processor.py", line 118, in process_all
    raise RuntimeError(
RuntimeError: Failed to process 1 batch(es):
Batch 20180312_Photoshoot2: Detection failed: [Errno 2] No such file or directory: 'yolov8n-face.pt'
Cleaning up model registry
Starting model registry cleanup
Model registry cleanup complete
Model registry cleanup complete
[red bold]Error during batch processing[/]
[blue]Pipeline test complete[/]
[red bold]Pipeline test failed[/]
[blue]Starting pipeline test[/]
Input directory: [cyan]/Users/rob/repos/kalliste/test_images_input[/]
Output directory: [cyan]/Users/rob/repos/kalliste/test_images_output[/]
[green]Initializing BatchProcessor[/]
Initializing BatchProcessor with input_root=/Users/rob/repos/kalliste/test_images_input, output_root=/Users/rob/repos/kalliste/test_images_output
Scanning for batches in /Users/rob/repos/kalliste/test_images_input
Initializing Batch with input_path=/Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2, max_concurrent=3
Scanning for images in /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2
Found 1 images to process in batch 20180312_Photoshoot2
Found 1 batches to process
BatchProcessor created
Initializing models
Initializing BatchProcessor and model registry
Starting model registry initialization
Initializing tagger pipeline...
Creating TaggerPipeline instance
MPS device validated
TaggerPipeline created with device: mps
Starting tagger pipeline initialization
Initializing orientation tagger...
Creating OrientationTagger instance for device: mps
Orientation tagger created successfully
Initializing caption tagger...
Creating CaptionTagger instance for device: mps
Caption tagger created successfully
Initializing WD14 tagger...
Loading pretrained weights from Hugging Face hub (SmilingWolf/wd-vit-large-tagger-v3)
[SmilingWolf/wd-vit-large-tagger-v3] Safe alternative available for 'pytorch_model.bin' (as 'model.safetensors'). Loading weights using safetensors.
Loaded 10861 WD14 tags
Creating WD14Tagger instance for device: mps
WD14 tagger created successfully
All taggers initialized successfully
Tagger pipeline initialized successfully
Initializing YOLO detector...
Initializing YOLO detector
Loading YOLO model yolov8n.pt
YOLO model loaded successfully
YOLODetector initialized with 1 active classes
YOLO detector initialized successfully
Model registry initialization complete
BatchProcessor and model registry initialized successfully
[green]BatchProcessor initialized successfully[/]
[green]Starting batch processing[/]
Starting batch processing
Starting batch: 20180312_Photoshoot2
Starting batch processing for 20180312_Photoshoot2 with 1 images
Starting processing for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png
Initializing detector: yolo_face_yolov8n-face.pt
Initializing YOLO face detector
Loading YOLO face model yolov8n-face.pt
YOLO face model loaded successfully
Detector yolo_face_yolov8n-face.pt initialized successfully
Running face detection on /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png
Fusing face model...
Face model fused successfully
Face detection failed
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/detectors/yolo_face_detector.py", line 95, in detect
    adjusted_region = self.adjust_for_sdxl(region, image_size)
                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/detectors/base.py", line 137, in adjust_for_sdxl
    if config.min_size and (width < config.min_size[0] or height < config.min_size[1]):
                                    ~~~~~~~~~~~~~~~^^^
TypeError: 'int' object is not subscriptable
Detection failed for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png: 'int' object is not subscriptable
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/detectors/detection_pipeline.py", line 107, in detect
    regions = detector.detect(image_path)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/detectors/yolo_face_detector.py", line 95, in detect
    adjusted_region = self.adjust_for_sdxl(region, image_size)
                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/detectors/base.py", line 137, in adjust_for_sdxl
    if config.min_size and (width < config.min_size[0] or height < config.min_size[1]):
                                    ~~~~~~~~~~~~~~~^^^
TypeError: 'int' object is not subscriptable
Detection pipeline failed for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png: Detection failed: 'int' object is not subscriptable
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/detectors/detection_pipeline.py", line 107, in detect
    regions = detector.detect(image_path)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/detectors/yolo_face_detector.py", line 95, in detect
    adjusted_region = self.adjust_for_sdxl(region, image_size)
                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/detectors/base.py", line 137, in adjust_for_sdxl
    if config.min_size and (width < config.min_size[0] or height < config.min_size[1]):
                                    ~~~~~~~~~~~~~~~^^^
TypeError: 'int' object is not subscriptable

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 87, in _run_detection_pipeline
    self.detected_regions = await loop.run_in_executor(
                            ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/detectors/detection_pipeline.py", line 118, in detect
    raise RuntimeError(f"Detection failed: {str(e)}") from e
RuntimeError: Detection failed: 'int' object is not subscriptable
Detection failed for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png: Detection failed: 'int' object is not subscriptable
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/detectors/detection_pipeline.py", line 107, in detect
    regions = detector.detect(image_path)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/detectors/yolo_face_detector.py", line 95, in detect
    adjusted_region = self.adjust_for_sdxl(region, image_size)
                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/detectors/base.py", line 137, in adjust_for_sdxl
    if config.min_size and (width < config.min_size[0] or height < config.min_size[1]):
                                    ~~~~~~~~~~~~~~~^^^
TypeError: 'int' object is not subscriptable

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 38, in process
    await self._run_detection_pipeline()
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 87, in _run_detection_pipeline
    self.detected_regions = await loop.run_in_executor(
                            ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/detectors/detection_pipeline.py", line 118, in detect
    raise RuntimeError(f"Detection failed: {str(e)}") from e
RuntimeError: Detection failed: 'int' object is not subscriptable
Error processing /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png: Detection failed: 'int' object is not subscriptable
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/detectors/detection_pipeline.py", line 107, in detect
    regions = detector.detect(image_path)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/detectors/yolo_face_detector.py", line 95, in detect
    adjusted_region = self.adjust_for_sdxl(region, image_size)
                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/detectors/base.py", line 137, in adjust_for_sdxl
    if config.min_size and (width < config.min_size[0] or height < config.min_size[1]):
                                    ~~~~~~~~~~~~~~~^^^
TypeError: 'int' object is not subscriptable

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 38, in process
    await self._run_detection_pipeline()
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 87, in _run_detection_pipeline
    self.detected_regions = await loop.run_in_executor(
                            ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/detectors/detection_pipeline.py", line 118, in detect
    raise RuntimeError(f"Detection failed: {str(e)}") from e
RuntimeError: Detection failed: 'int' object is not subscriptable
Failed to process 3M2A2876.png
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/detectors/detection_pipeline.py", line 107, in detect
    regions = detector.detect(image_path)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/detectors/yolo_face_detector.py", line 95, in detect
    adjusted_region = self.adjust_for_sdxl(region, image_size)
                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/detectors/base.py", line 137, in adjust_for_sdxl
    if config.min_size and (width < config.min_size[0] or height < config.min_size[1]):
                                    ~~~~~~~~~~~~~~~^^^
TypeError: 'int' object is not subscriptable

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 83, in process_image
    return await image.process()
           ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 38, in process
    await self._run_detection_pipeline()
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 87, in _run_detection_pipeline
    self.detected_regions = await loop.run_in_executor(
                            ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/detectors/detection_pipeline.py", line 118, in detect
    raise RuntimeError(f"Detection failed: {str(e)}") from e
RuntimeError: Detection failed: 'int' object is not subscriptable
Batch processing completed with 1 errors
Batch processing failed
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/detectors/detection_pipeline.py", line 107, in detect
    regions = detector.detect(image_path)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/detectors/yolo_face_detector.py", line 95, in detect
    adjusted_region = self.adjust_for_sdxl(region, image_size)
                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/detectors/base.py", line 137, in adjust_for_sdxl
    if config.min_size and (width < config.min_size[0] or height < config.min_size[1]):
                                    ~~~~~~~~~~~~~~~^^^
TypeError: 'int' object is not subscriptable

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 114, in process
    raise errors[0]
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 83, in process_image
    return await image.process()
           ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 38, in process
    await self._run_detection_pipeline()
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 87, in _run_detection_pipeline
    self.detected_regions = await loop.run_in_executor(
                            ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/detectors/detection_pipeline.py", line 118, in detect
    raise RuntimeError(f"Detection failed: {str(e)}") from e
RuntimeError: Detection failed: 'int' object is not subscriptable
Failed to process batch 20180312_Photoshoot2
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/detectors/detection_pipeline.py", line 107, in detect
    regions = detector.detect(image_path)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/detectors/yolo_face_detector.py", line 95, in detect
    adjusted_region = self.adjust_for_sdxl(region, image_size)
                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/detectors/base.py", line 137, in adjust_for_sdxl
    if config.min_size and (width < config.min_size[0] or height < config.min_size[1]):
                                    ~~~~~~~~~~~~~~~^^^
TypeError: 'int' object is not subscriptable

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/batch_processor.py", line 82, in process_batch
    await batch.process()
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 114, in process
    raise errors[0]
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 83, in process_image
    return await image.process()
           ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 38, in process
    await self._run_detection_pipeline()
  File "/Users/rob/repos/kalliste/kalliste/image/original_image.py", line 87, in _run_detection_pipeline
    self.detected_regions = await loop.run_in_executor(
                            ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/detectors/detection_pipeline.py", line 118, in detect
    raise RuntimeError(f"Detection failed: {str(e)}") from e
RuntimeError: Detection failed: 'int' object is not subscriptable
Batch processing failed
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/batch_processor.py", line 118, in process_all
    raise RuntimeError(
RuntimeError: Failed to process 1 batch(es):
Batch 20180312_Photoshoot2: Detection failed: 'int' object is not subscriptable
Cleaning up model registry
Starting model registry cleanup
Model registry cleanup complete
Model registry cleanup complete
[red bold]Error during batch processing[/]
[blue]Pipeline test complete[/]
[red bold]Pipeline test failed[/]
[blue]Starting pipeline test[/]
Input directory: [cyan]/Users/rob/repos/kalliste/test_images_input[/]
Output directory: [cyan]/Users/rob/repos/kalliste/test_images_output[/]
[green]Initializing BatchProcessor[/]
Initializing BatchProcessor with input_root=/Users/rob/repos/kalliste/test_images_input, output_root=/Users/rob/repos/kalliste/test_images_output
Scanning for batches in /Users/rob/repos/kalliste/test_images_input
Initializing Batch with input_path=/Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2, max_concurrent=3
Scanning for images in /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2
Found 1 images to process in batch 20180312_Photoshoot2
Found 1 batches to process
BatchProcessor created
Initializing models
Initializing BatchProcessor and model registry
Starting model registry initialization
Failed to initialize models: name 'ModelDownloadManager' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/model/model_registry.py", line 25, in initialize
    downloader = ModelDownloadManager()
                 ^^^^^^^^^^^^^^^^^^^^
NameError: name 'ModelDownloadManager' is not defined
Starting model registry cleanup
[yellow]Pipeline test interrupted by user[/]
[blue]Starting pipeline test[/]
Input directory: [cyan]/Users/rob/repos/kalliste/test_images_input[/]
Output directory: [cyan]/Users/rob/repos/kalliste/test_images_output[/]
[green]Initializing BatchProcessor[/]
Initializing BatchProcessor with input_root=/Users/rob/repos/kalliste/test_images_input, output_root=/Users/rob/repos/kalliste/test_images_output
Scanning for batches in /Users/rob/repos/kalliste/test_images_input
Initializing Batch with input_path=/Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2, max_concurrent=3
Scanning for images in /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2
Found 1 images to process in batch 20180312_Photoshoot2
Found 1 batches to process
BatchProcessor created
Initializing models
Initializing BatchProcessor and model registry
Starting model registry initialization
Checking and downloading models if needed
Verifying detection models
YOLO model already cached: yolov8n.pt
YOLO model already cached: yolov8n-face.pt
Verifying classification models
Downloading model Salesforce/blip2-opt-2.7b
Failed to verify/download blip2 model: hf_hub_download() missing 1 required positional argument: 'filename'
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/model/model_download_manager.py", line 53, in _ensure_classification_models
    files = await asyncio.get_event_loop().run_in_executor(
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/huggingface_hub/utils/_validators.py", line 114, in _inner_fn
    return fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^
TypeError: hf_hub_download() missing 1 required positional argument: 'filename'
Failed to verify/download models: hf_hub_download() missing 1 required positional argument: 'filename'
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/model/model_download_manager.py", line 21, in download_all
    await self._ensure_classification_models()
  File "/Users/rob/repos/kalliste/kalliste/model/model_download_manager.py", line 53, in _ensure_classification_models
    files = await asyncio.get_event_loop().run_in_executor(
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/huggingface_hub/utils/_validators.py", line 114, in _inner_fn
    return fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^
TypeError: hf_hub_download() missing 1 required positional argument: 'filename'
Failed to initialize models: Model verification failed: hf_hub_download() missing 1 required positional argument: 'filename'
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/model/model_download_manager.py", line 21, in download_all
    await self._ensure_classification_models()
  File "/Users/rob/repos/kalliste/kalliste/model/model_download_manager.py", line 53, in _ensure_classification_models
    files = await asyncio.get_event_loop().run_in_executor(
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/huggingface_hub/utils/_validators.py", line 114, in _inner_fn
    return fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^
TypeError: hf_hub_download() missing 1 required positional argument: 'filename'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/model/model_registry.py", line 27, in initialize
    await downloader.download_all()
  File "/Users/rob/repos/kalliste/kalliste/model/model_download_manager.py", line 25, in download_all
    raise RuntimeError(f"Model verification failed: {str(e)}") from e
RuntimeError: Model verification failed: hf_hub_download() missing 1 required positional argument: 'filename'
Starting model registry cleanup
[yellow]Pipeline test interrupted by user[/]
[blue]Starting pipeline test[/]
Input directory: [cyan]/Users/rob/repos/kalliste/test_images_input[/]
Output directory: [cyan]/Users/rob/repos/kalliste/test_images_output[/]
[green]Initializing BatchProcessor[/]
Initializing BatchProcessor with input_root=/Users/rob/repos/kalliste/test_images_input, output_root=/Users/rob/repos/kalliste/test_images_output
Scanning for batches in /Users/rob/repos/kalliste/test_images_input
Initializing Batch with input_path=/Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2, max_concurrent=3
Scanning for images in /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2
Found 1 images to process in batch 20180312_Photoshoot2
Found 1 batches to process
BatchProcessor created
Initializing models
Initializing BatchProcessor and model registry
Starting model registry initialization
Checking and downloading models if needed
Verifying detection models
YOLO model already cached: yolov8n.pt
YOLO model already cached: yolov8n-face.pt
Verifying classification models
Downloading model Salesforce/blip2-opt-2.7b
Failed to verify/download blip2 model: 404 Client Error. (Request ID: Root=1-676d7ff8-7851a20d0081097f5e413f7f;cfe0627d-5c50-4fbf-9ea4-f14e9d713308)

Entry Not Found for url: https://huggingface.co/Salesforce/blip2-opt-2.7b/resolve/main/pytorch_model.bin.
Traceback (most recent call last):
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/huggingface_hub/utils/_http.py", line 406, in hf_raise_for_status
    response.raise_for_status()
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/requests/models.py", line 1024, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 404 Client Error: Not Found for url: https://huggingface.co/Salesforce/blip2-opt-2.7b/resolve/main/pytorch_model.bin

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/model/model_download_manager.py", line 54, in _ensure_classification_models
    await asyncio.get_event_loop().run_in_executor(
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/huggingface_hub/utils/_validators.py", line 114, in _inner_fn
    return fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/huggingface_hub/file_download.py", line 860, in hf_hub_download
    return _hf_hub_download_to_cache_dir(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/huggingface_hub/file_download.py", line 923, in _hf_hub_download_to_cache_dir
    (url_to_download, etag, commit_hash, expected_size, head_call_error) = _get_metadata_or_catch_error(
                                                                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/huggingface_hub/file_download.py", line 1374, in _get_metadata_or_catch_error
    metadata = get_hf_file_metadata(
               ^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/huggingface_hub/utils/_validators.py", line 114, in _inner_fn
    return fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/huggingface_hub/file_download.py", line 1294, in get_hf_file_metadata
    r = _request_wrapper(
        ^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/huggingface_hub/file_download.py", line 278, in _request_wrapper
    response = _request_wrapper(
               ^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/huggingface_hub/file_download.py", line 302, in _request_wrapper
    hf_raise_for_status(response)
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/huggingface_hub/utils/_http.py", line 417, in hf_raise_for_status
    raise _format(EntryNotFoundError, message, response) from e
huggingface_hub.errors.EntryNotFoundError: 404 Client Error. (Request ID: Root=1-676d7ff8-7851a20d0081097f5e413f7f;cfe0627d-5c50-4fbf-9ea4-f14e9d713308)

Entry Not Found for url: https://huggingface.co/Salesforce/blip2-opt-2.7b/resolve/main/pytorch_model.bin.
Failed to verify/download models: 404 Client Error. (Request ID: Root=1-676d7ff8-7851a20d0081097f5e413f7f;cfe0627d-5c50-4fbf-9ea4-f14e9d713308)

Entry Not Found for url: https://huggingface.co/Salesforce/blip2-opt-2.7b/resolve/main/pytorch_model.bin.
Traceback (most recent call last):
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/huggingface_hub/utils/_http.py", line 406, in hf_raise_for_status
    response.raise_for_status()
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/requests/models.py", line 1024, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 404 Client Error: Not Found for url: https://huggingface.co/Salesforce/blip2-opt-2.7b/resolve/main/pytorch_model.bin

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/model/model_download_manager.py", line 21, in download_all
    await self._ensure_classification_models()
  File "/Users/rob/repos/kalliste/kalliste/model/model_download_manager.py", line 54, in _ensure_classification_models
    await asyncio.get_event_loop().run_in_executor(
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/huggingface_hub/utils/_validators.py", line 114, in _inner_fn
    return fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/huggingface_hub/file_download.py", line 860, in hf_hub_download
    return _hf_hub_download_to_cache_dir(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/huggingface_hub/file_download.py", line 923, in _hf_hub_download_to_cache_dir
    (url_to_download, etag, commit_hash, expected_size, head_call_error) = _get_metadata_or_catch_error(
                                                                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/huggingface_hub/file_download.py", line 1374, in _get_metadata_or_catch_error
    metadata = get_hf_file_metadata(
               ^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/huggingface_hub/utils/_validators.py", line 114, in _inner_fn
    return fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/huggingface_hub/file_download.py", line 1294, in get_hf_file_metadata
    r = _request_wrapper(
        ^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/huggingface_hub/file_download.py", line 278, in _request_wrapper
    response = _request_wrapper(
               ^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/huggingface_hub/file_download.py", line 302, in _request_wrapper
    hf_raise_for_status(response)
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/huggingface_hub/utils/_http.py", line 417, in hf_raise_for_status
    raise _format(EntryNotFoundError, message, response) from e
huggingface_hub.errors.EntryNotFoundError: 404 Client Error. (Request ID: Root=1-676d7ff8-7851a20d0081097f5e413f7f;cfe0627d-5c50-4fbf-9ea4-f14e9d713308)

Entry Not Found for url: https://huggingface.co/Salesforce/blip2-opt-2.7b/resolve/main/pytorch_model.bin.
Failed to initialize models: Model verification failed: 404 Client Error. (Request ID: Root=1-676d7ff8-7851a20d0081097f5e413f7f;cfe0627d-5c50-4fbf-9ea4-f14e9d713308)

Entry Not Found for url: https://huggingface.co/Salesforce/blip2-opt-2.7b/resolve/main/pytorch_model.bin.
Traceback (most recent call last):
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/huggingface_hub/utils/_http.py", line 406, in hf_raise_for_status
    response.raise_for_status()
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/requests/models.py", line 1024, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 404 Client Error: Not Found for url: https://huggingface.co/Salesforce/blip2-opt-2.7b/resolve/main/pytorch_model.bin

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/model/model_download_manager.py", line 21, in download_all
    await self._ensure_classification_models()
  File "/Users/rob/repos/kalliste/kalliste/model/model_download_manager.py", line 54, in _ensure_classification_models
    await asyncio.get_event_loop().run_in_executor(
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/huggingface_hub/utils/_validators.py", line 114, in _inner_fn
    return fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/huggingface_hub/file_download.py", line 860, in hf_hub_download
    return _hf_hub_download_to_cache_dir(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/huggingface_hub/file_download.py", line 923, in _hf_hub_download_to_cache_dir
    (url_to_download, etag, commit_hash, expected_size, head_call_error) = _get_metadata_or_catch_error(
                                                                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/huggingface_hub/file_download.py", line 1374, in _get_metadata_or_catch_error
    metadata = get_hf_file_metadata(
               ^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/huggingface_hub/utils/_validators.py", line 114, in _inner_fn
    return fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/huggingface_hub/file_download.py", line 1294, in get_hf_file_metadata
    r = _request_wrapper(
        ^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/huggingface_hub/file_download.py", line 278, in _request_wrapper
    response = _request_wrapper(
               ^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/huggingface_hub/file_download.py", line 302, in _request_wrapper
    hf_raise_for_status(response)
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/huggingface_hub/utils/_http.py", line 417, in hf_raise_for_status
    raise _format(EntryNotFoundError, message, response) from e
huggingface_hub.errors.EntryNotFoundError: 404 Client Error. (Request ID: Root=1-676d7ff8-7851a20d0081097f5e413f7f;cfe0627d-5c50-4fbf-9ea4-f14e9d713308)

Entry Not Found for url: https://huggingface.co/Salesforce/blip2-opt-2.7b/resolve/main/pytorch_model.bin.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/model/model_registry.py", line 27, in initialize
    await downloader.download_all()
  File "/Users/rob/repos/kalliste/kalliste/model/model_download_manager.py", line 25, in download_all
    raise RuntimeError(f"Model verification failed: {str(e)}") from e
RuntimeError: Model verification failed: 404 Client Error. (Request ID: Root=1-676d7ff8-7851a20d0081097f5e413f7f;cfe0627d-5c50-4fbf-9ea4-f14e9d713308)

Entry Not Found for url: https://huggingface.co/Salesforce/blip2-opt-2.7b/resolve/main/pytorch_model.bin.
Starting model registry cleanup
[yellow]Pipeline test interrupted by user[/]
[blue]Starting pipeline test[/]
Input directory: [cyan]/Users/rob/repos/kalliste/test_images_input[/]
Output directory: [cyan]/Users/rob/repos/kalliste/test_images_output[/]
[green]Initializing BatchProcessor[/]
Initializing BatchProcessor with input_root=/Users/rob/repos/kalliste/test_images_input, output_root=/Users/rob/repos/kalliste/test_images_output
Scanning for batches in /Users/rob/repos/kalliste/test_images_input
Initializing Batch with input_path=/Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2, max_concurrent=3
Scanning for images in /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2
Found 1 images to process in batch 20180312_Photoshoot2
Found 1 batches to process
BatchProcessor created
Initializing models
Initializing BatchProcessor and model registry
Starting model registry initialization
Checking and downloading models if needed
Verifying detection models
YOLO model already cached: yolov8n.pt
YOLO model already cached: yolov8n-face.pt
Verifying classification models
Verifying blip2 model: Salesforce/blip2-opt-2.7b
Successfully verified blip2 model
Verifying orientation model: LucyintheSky/pose-estimation-front-side-back
Successfully verified orientation model
Verifying wd14 model: SmilingWolf/wd-vit-large-tagger-v3
Failed to verify/download wd14 model: SmilingWolf/wd-vit-large-tagger-v3 does not appear to have a file named preprocessor_config.json. Checkout 'https://huggingface.co/SmilingWolf/wd-vit-large-tagger-v3/tree/main' for available files.
Traceback (most recent call last):
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/huggingface_hub/utils/_http.py", line 406, in hf_raise_for_status
    response.raise_for_status()
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/requests/models.py", line 1024, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 404 Client Error: Not Found for url: https://huggingface.co/SmilingWolf/wd-vit-large-tagger-v3/resolve/main/preprocessor_config.json

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/transformers/utils/hub.py", line 403, in cached_file
    resolved_file = hf_hub_download(
                    ^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/huggingface_hub/utils/_validators.py", line 114, in _inner_fn
    return fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/huggingface_hub/file_download.py", line 860, in hf_hub_download
    return _hf_hub_download_to_cache_dir(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/huggingface_hub/file_download.py", line 923, in _hf_hub_download_to_cache_dir
    (url_to_download, etag, commit_hash, expected_size, head_call_error) = _get_metadata_or_catch_error(
                                                                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/huggingface_hub/file_download.py", line 1374, in _get_metadata_or_catch_error
    metadata = get_hf_file_metadata(
               ^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/huggingface_hub/utils/_validators.py", line 114, in _inner_fn
    return fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/huggingface_hub/file_download.py", line 1294, in get_hf_file_metadata
    r = _request_wrapper(
        ^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/huggingface_hub/file_download.py", line 278, in _request_wrapper
    response = _request_wrapper(
               ^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/huggingface_hub/file_download.py", line 302, in _request_wrapper
    hf_raise_for_status(response)
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/huggingface_hub/utils/_http.py", line 417, in hf_raise_for_status
    raise _format(EntryNotFoundError, message, response) from e
huggingface_hub.errors.EntryNotFoundError: 404 Client Error. (Request ID: Root=1-676d82e9-06ea64b479509abc581386aa;9f6d4324-3a3a-462b-8f19-b338e9c2fa8f)

Entry Not Found for url: https://huggingface.co/SmilingWolf/wd-vit-large-tagger-v3/resolve/main/preprocessor_config.json.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/model/model_download_manager.py", line 64, in _ensure_classification_models
    await asyncio.get_event_loop().run_in_executor(
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/transformers/models/auto/feature_extraction_auto.py", line 346, in from_pretrained
    config_dict, _ = FeatureExtractionMixin.get_feature_extractor_dict(pretrained_model_name_or_path, **kwargs)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/transformers/feature_extraction_utils.py", line 509, in get_feature_extractor_dict
    resolved_feature_extractor_file = cached_file(
                                      ^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/transformers/utils/hub.py", line 459, in cached_file
    raise EnvironmentError(
OSError: SmilingWolf/wd-vit-large-tagger-v3 does not appear to have a file named preprocessor_config.json. Checkout 'https://huggingface.co/SmilingWolf/wd-vit-large-tagger-v3/tree/main' for available files.
Failed to verify/download models: SmilingWolf/wd-vit-large-tagger-v3 does not appear to have a file named preprocessor_config.json. Checkout 'https://huggingface.co/SmilingWolf/wd-vit-large-tagger-v3/tree/main' for available files.
Traceback (most recent call last):
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/huggingface_hub/utils/_http.py", line 406, in hf_raise_for_status
    response.raise_for_status()
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/requests/models.py", line 1024, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 404 Client Error: Not Found for url: https://huggingface.co/SmilingWolf/wd-vit-large-tagger-v3/resolve/main/preprocessor_config.json

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/transformers/utils/hub.py", line 403, in cached_file
    resolved_file = hf_hub_download(
                    ^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/huggingface_hub/utils/_validators.py", line 114, in _inner_fn
    return fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/huggingface_hub/file_download.py", line 860, in hf_hub_download
    return _hf_hub_download_to_cache_dir(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/huggingface_hub/file_download.py", line 923, in _hf_hub_download_to_cache_dir
    (url_to_download, etag, commit_hash, expected_size, head_call_error) = _get_metadata_or_catch_error(
                                                                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/huggingface_hub/file_download.py", line 1374, in _get_metadata_or_catch_error
    metadata = get_hf_file_metadata(
               ^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/huggingface_hub/utils/_validators.py", line 114, in _inner_fn
    return fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/huggingface_hub/file_download.py", line 1294, in get_hf_file_metadata
    r = _request_wrapper(
        ^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/huggingface_hub/file_download.py", line 278, in _request_wrapper
    response = _request_wrapper(
               ^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/huggingface_hub/file_download.py", line 302, in _request_wrapper
    hf_raise_for_status(response)
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/huggingface_hub/utils/_http.py", line 417, in hf_raise_for_status
    raise _format(EntryNotFoundError, message, response) from e
huggingface_hub.errors.EntryNotFoundError: 404 Client Error. (Request ID: Root=1-676d82e9-06ea64b479509abc581386aa;9f6d4324-3a3a-462b-8f19-b338e9c2fa8f)

Entry Not Found for url: https://huggingface.co/SmilingWolf/wd-vit-large-tagger-v3/resolve/main/preprocessor_config.json.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/model/model_download_manager.py", line 21, in download_all
    await self._ensure_classification_models()
  File "/Users/rob/repos/kalliste/kalliste/model/model_download_manager.py", line 64, in _ensure_classification_models
    await asyncio.get_event_loop().run_in_executor(
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/transformers/models/auto/feature_extraction_auto.py", line 346, in from_pretrained
    config_dict, _ = FeatureExtractionMixin.get_feature_extractor_dict(pretrained_model_name_or_path, **kwargs)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/transformers/feature_extraction_utils.py", line 509, in get_feature_extractor_dict
    resolved_feature_extractor_file = cached_file(
                                      ^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/transformers/utils/hub.py", line 459, in cached_file
    raise EnvironmentError(
OSError: SmilingWolf/wd-vit-large-tagger-v3 does not appear to have a file named preprocessor_config.json. Checkout 'https://huggingface.co/SmilingWolf/wd-vit-large-tagger-v3/tree/main' for available files.
Failed to initialize models: Model verification failed: SmilingWolf/wd-vit-large-tagger-v3 does not appear to have a file named preprocessor_config.json. Checkout 'https://huggingface.co/SmilingWolf/wd-vit-large-tagger-v3/tree/main' for available files.
Traceback (most recent call last):
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/huggingface_hub/utils/_http.py", line 406, in hf_raise_for_status
    response.raise_for_status()
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/requests/models.py", line 1024, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 404 Client Error: Not Found for url: https://huggingface.co/SmilingWolf/wd-vit-large-tagger-v3/resolve/main/preprocessor_config.json

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/transformers/utils/hub.py", line 403, in cached_file
    resolved_file = hf_hub_download(
                    ^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/huggingface_hub/utils/_validators.py", line 114, in _inner_fn
    return fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/huggingface_hub/file_download.py", line 860, in hf_hub_download
    return _hf_hub_download_to_cache_dir(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/huggingface_hub/file_download.py", line 923, in _hf_hub_download_to_cache_dir
    (url_to_download, etag, commit_hash, expected_size, head_call_error) = _get_metadata_or_catch_error(
                                                                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/huggingface_hub/file_download.py", line 1374, in _get_metadata_or_catch_error
    metadata = get_hf_file_metadata(
               ^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/huggingface_hub/utils/_validators.py", line 114, in _inner_fn
    return fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/huggingface_hub/file_download.py", line 1294, in get_hf_file_metadata
    r = _request_wrapper(
        ^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/huggingface_hub/file_download.py", line 278, in _request_wrapper
    response = _request_wrapper(
               ^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/huggingface_hub/file_download.py", line 302, in _request_wrapper
    hf_raise_for_status(response)
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/huggingface_hub/utils/_http.py", line 417, in hf_raise_for_status
    raise _format(EntryNotFoundError, message, response) from e
huggingface_hub.errors.EntryNotFoundError: 404 Client Error. (Request ID: Root=1-676d82e9-06ea64b479509abc581386aa;9f6d4324-3a3a-462b-8f19-b338e9c2fa8f)

Entry Not Found for url: https://huggingface.co/SmilingWolf/wd-vit-large-tagger-v3/resolve/main/preprocessor_config.json.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/model/model_download_manager.py", line 21, in download_all
    await self._ensure_classification_models()
  File "/Users/rob/repos/kalliste/kalliste/model/model_download_manager.py", line 64, in _ensure_classification_models
    await asyncio.get_event_loop().run_in_executor(
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/transformers/models/auto/feature_extraction_auto.py", line 346, in from_pretrained
    config_dict, _ = FeatureExtractionMixin.get_feature_extractor_dict(pretrained_model_name_or_path, **kwargs)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/transformers/feature_extraction_utils.py", line 509, in get_feature_extractor_dict
    resolved_feature_extractor_file = cached_file(
                                      ^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/transformers/utils/hub.py", line 459, in cached_file
    raise EnvironmentError(
OSError: SmilingWolf/wd-vit-large-tagger-v3 does not appear to have a file named preprocessor_config.json. Checkout 'https://huggingface.co/SmilingWolf/wd-vit-large-tagger-v3/tree/main' for available files.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/model/model_registry.py", line 27, in initialize
    await downloader.download_all()
  File "/Users/rob/repos/kalliste/kalliste/model/model_download_manager.py", line 25, in download_all
    raise RuntimeError(f"Model verification failed: {str(e)}") from e
RuntimeError: Model verification failed: SmilingWolf/wd-vit-large-tagger-v3 does not appear to have a file named preprocessor_config.json. Checkout 'https://huggingface.co/SmilingWolf/wd-vit-large-tagger-v3/tree/main' for available files.
Starting model registry cleanup
[yellow]Pipeline test interrupted by user[/]
[blue]Starting pipeline test[/]
Input directory: [cyan]/Users/rob/repos/kalliste/test_images_input[/]
Output directory: [cyan]/Users/rob/repos/kalliste/test_images_output[/]
[green]Initializing BatchProcessor[/]
Initializing BatchProcessor with input_root=/Users/rob/repos/kalliste/test_images_input, output_root=/Users/rob/repos/kalliste/test_images_output
Scanning for batches in /Users/rob/repos/kalliste/test_images_input
Initializing Batch with input_path=/Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2, max_concurrent=3
Scanning for images in /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2
Found 1 images to process in batch 20180312_Photoshoot2
Found 1 batches to process
BatchProcessor created
Initializing models
Initializing BatchProcessor and model registry
Starting model registry initialization
Checking and downloading models if needed
Verifying detection models
YOLO model already cached: yolov8n.pt
YOLO model already cached: yolov8n-face.pt
Verifying classification models
Verifying blip2 model: Salesforce/blip2-opt-2.7b
[yellow]Pipeline test interrupted by user[/]
[blue]Starting pipeline test[/]
Input directory: [cyan]/Users/rob/repos/kalliste/test_images_input[/]
Output directory: [cyan]/Users/rob/repos/kalliste/test_images_output[/]
[green]Initializing BatchProcessor[/]
Initializing BatchProcessor with input_root=/Users/rob/repos/kalliste/test_images_input, output_root=/Users/rob/repos/kalliste/test_images_output
Scanning for batches in /Users/rob/repos/kalliste/test_images_input
Initializing Batch with input_path=/Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2, max_concurrent=3
Scanning for images in /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2
Found 1 images to process in batch 20180312_Photoshoot2
Found 1 batches to process
BatchProcessor created
Initializing models
Initializing BatchProcessor and model registry
Starting model registry initialization
Checking and downloading models if needed
Verifying detection models
YOLO model already cached: yolov8n.pt
YOLO model already cached: yolov8n-face.pt
Verifying classification models
Verifying blip2 model: Salesforce/blip2-opt-2.7b
[yellow]Pipeline test interrupted by user[/]
[blue]Starting pipeline test[/]
Input directory: [cyan]/Users/rob/repos/kalliste/test_images_input[/]
Output directory: [cyan]/Users/rob/repos/kalliste/test_images_output[/]
[green]Initializing BatchProcessor[/]
Initializing BatchProcessor with input_root=/Users/rob/repos/kalliste/test_images_input, output_root=/Users/rob/repos/kalliste/test_images_output
Scanning for batches in /Users/rob/repos/kalliste/test_images_input
Initializing Batch with input_path=/Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2, max_concurrent=3
Scanning for images in /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2
Found 1 images to process in batch 20180312_Photoshoot2
Found 1 batches to process
BatchProcessor created
Initializing models
Initializing BatchProcessor and model registry
Starting model registry initialization
Checking and downloading models if needed
Verifying detection models
YOLO model already cached: yolov8n.pt
YOLO model already cached: yolov8n-face.pt
Verifying classification models
Verifying blip2 model: Salesforce/blip2-opt-2.7b
Successfully verified blip2 model
Verifying orientation model: LucyintheSky/pose-estimation-front-side-back
Successfully verified orientation model
Verifying wd14 model: SmilingWolf/wd-vit-large-tagger-v3
Failed to verify/download wd14 model: SmilingWolf/wd-vit-large-tagger-v3 does not appear to have a file named preprocessor_config.json. Checkout 'https://huggingface.co/SmilingWolf/wd-vit-large-tagger-v3/tree/main' for available files.
Traceback (most recent call last):
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/huggingface_hub/utils/_http.py", line 406, in hf_raise_for_status
    response.raise_for_status()
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/requests/models.py", line 1024, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 404 Client Error: Not Found for url: https://huggingface.co/SmilingWolf/wd-vit-large-tagger-v3/resolve/main/preprocessor_config.json

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/transformers/utils/hub.py", line 403, in cached_file
    resolved_file = hf_hub_download(
                    ^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/huggingface_hub/utils/_validators.py", line 114, in _inner_fn
    return fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/huggingface_hub/file_download.py", line 860, in hf_hub_download
    return _hf_hub_download_to_cache_dir(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/huggingface_hub/file_download.py", line 923, in _hf_hub_download_to_cache_dir
    (url_to_download, etag, commit_hash, expected_size, head_call_error) = _get_metadata_or_catch_error(
                                                                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/huggingface_hub/file_download.py", line 1374, in _get_metadata_or_catch_error
    metadata = get_hf_file_metadata(
               ^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/huggingface_hub/utils/_validators.py", line 114, in _inner_fn
    return fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/huggingface_hub/file_download.py", line 1294, in get_hf_file_metadata
    r = _request_wrapper(
        ^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/huggingface_hub/file_download.py", line 278, in _request_wrapper
    response = _request_wrapper(
               ^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/huggingface_hub/file_download.py", line 302, in _request_wrapper
    hf_raise_for_status(response)
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/huggingface_hub/utils/_http.py", line 417, in hf_raise_for_status
    raise _format(EntryNotFoundError, message, response) from e
huggingface_hub.errors.EntryNotFoundError: 404 Client Error. (Request ID: Root=1-676d8390-740cd4767578bc957f6d7300;bba38b48-82df-4146-8afa-8e17b2d0f4ee)

Entry Not Found for url: https://huggingface.co/SmilingWolf/wd-vit-large-tagger-v3/resolve/main/preprocessor_config.json.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/model/model_download_manager.py", line 64, in _ensure_classification_models
    await asyncio.get_event_loop().run_in_executor(
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/transformers/models/auto/feature_extraction_auto.py", line 346, in from_pretrained
    config_dict, _ = FeatureExtractionMixin.get_feature_extractor_dict(pretrained_model_name_or_path, **kwargs)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/transformers/feature_extraction_utils.py", line 509, in get_feature_extractor_dict
    resolved_feature_extractor_file = cached_file(
                                      ^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/transformers/utils/hub.py", line 459, in cached_file
    raise EnvironmentError(
OSError: SmilingWolf/wd-vit-large-tagger-v3 does not appear to have a file named preprocessor_config.json. Checkout 'https://huggingface.co/SmilingWolf/wd-vit-large-tagger-v3/tree/main' for available files.
Failed to verify/download models: SmilingWolf/wd-vit-large-tagger-v3 does not appear to have a file named preprocessor_config.json. Checkout 'https://huggingface.co/SmilingWolf/wd-vit-large-tagger-v3/tree/main' for available files.
Traceback (most recent call last):
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/huggingface_hub/utils/_http.py", line 406, in hf_raise_for_status
    response.raise_for_status()
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/requests/models.py", line 1024, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 404 Client Error: Not Found for url: https://huggingface.co/SmilingWolf/wd-vit-large-tagger-v3/resolve/main/preprocessor_config.json

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/transformers/utils/hub.py", line 403, in cached_file
    resolved_file = hf_hub_download(
                    ^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/huggingface_hub/utils/_validators.py", line 114, in _inner_fn
    return fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/huggingface_hub/file_download.py", line 860, in hf_hub_download
    return _hf_hub_download_to_cache_dir(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/huggingface_hub/file_download.py", line 923, in _hf_hub_download_to_cache_dir
    (url_to_download, etag, commit_hash, expected_size, head_call_error) = _get_metadata_or_catch_error(
                                                                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/huggingface_hub/file_download.py", line 1374, in _get_metadata_or_catch_error
    metadata = get_hf_file_metadata(
               ^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/huggingface_hub/utils/_validators.py", line 114, in _inner_fn
    return fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/huggingface_hub/file_download.py", line 1294, in get_hf_file_metadata
    r = _request_wrapper(
        ^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/huggingface_hub/file_download.py", line 278, in _request_wrapper
    response = _request_wrapper(
               ^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/huggingface_hub/file_download.py", line 302, in _request_wrapper
    hf_raise_for_status(response)
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/huggingface_hub/utils/_http.py", line 417, in hf_raise_for_status
    raise _format(EntryNotFoundError, message, response) from e
huggingface_hub.errors.EntryNotFoundError: 404 Client Error. (Request ID: Root=1-676d8390-740cd4767578bc957f6d7300;bba38b48-82df-4146-8afa-8e17b2d0f4ee)

Entry Not Found for url: https://huggingface.co/SmilingWolf/wd-vit-large-tagger-v3/resolve/main/preprocessor_config.json.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/model/model_download_manager.py", line 21, in download_all
    await self._ensure_classification_models()
  File "/Users/rob/repos/kalliste/kalliste/model/model_download_manager.py", line 64, in _ensure_classification_models
    await asyncio.get_event_loop().run_in_executor(
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/transformers/models/auto/feature_extraction_auto.py", line 346, in from_pretrained
    config_dict, _ = FeatureExtractionMixin.get_feature_extractor_dict(pretrained_model_name_or_path, **kwargs)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/transformers/feature_extraction_utils.py", line 509, in get_feature_extractor_dict
    resolved_feature_extractor_file = cached_file(
                                      ^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/transformers/utils/hub.py", line 459, in cached_file
    raise EnvironmentError(
OSError: SmilingWolf/wd-vit-large-tagger-v3 does not appear to have a file named preprocessor_config.json. Checkout 'https://huggingface.co/SmilingWolf/wd-vit-large-tagger-v3/tree/main' for available files.
Failed to initialize models: Model verification failed: SmilingWolf/wd-vit-large-tagger-v3 does not appear to have a file named preprocessor_config.json. Checkout 'https://huggingface.co/SmilingWolf/wd-vit-large-tagger-v3/tree/main' for available files.
Traceback (most recent call last):
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/huggingface_hub/utils/_http.py", line 406, in hf_raise_for_status
    response.raise_for_status()
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/requests/models.py", line 1024, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 404 Client Error: Not Found for url: https://huggingface.co/SmilingWolf/wd-vit-large-tagger-v3/resolve/main/preprocessor_config.json

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/transformers/utils/hub.py", line 403, in cached_file
    resolved_file = hf_hub_download(
                    ^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/huggingface_hub/utils/_validators.py", line 114, in _inner_fn
    return fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/huggingface_hub/file_download.py", line 860, in hf_hub_download
    return _hf_hub_download_to_cache_dir(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/huggingface_hub/file_download.py", line 923, in _hf_hub_download_to_cache_dir
    (url_to_download, etag, commit_hash, expected_size, head_call_error) = _get_metadata_or_catch_error(
                                                                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/huggingface_hub/file_download.py", line 1374, in _get_metadata_or_catch_error
    metadata = get_hf_file_metadata(
               ^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/huggingface_hub/utils/_validators.py", line 114, in _inner_fn
    return fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/huggingface_hub/file_download.py", line 1294, in get_hf_file_metadata
    r = _request_wrapper(
        ^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/huggingface_hub/file_download.py", line 278, in _request_wrapper
    response = _request_wrapper(
               ^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/huggingface_hub/file_download.py", line 302, in _request_wrapper
    hf_raise_for_status(response)
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/huggingface_hub/utils/_http.py", line 417, in hf_raise_for_status
    raise _format(EntryNotFoundError, message, response) from e
huggingface_hub.errors.EntryNotFoundError: 404 Client Error. (Request ID: Root=1-676d8390-740cd4767578bc957f6d7300;bba38b48-82df-4146-8afa-8e17b2d0f4ee)

Entry Not Found for url: https://huggingface.co/SmilingWolf/wd-vit-large-tagger-v3/resolve/main/preprocessor_config.json.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/model/model_download_manager.py", line 21, in download_all
    await self._ensure_classification_models()
  File "/Users/rob/repos/kalliste/kalliste/model/model_download_manager.py", line 64, in _ensure_classification_models
    await asyncio.get_event_loop().run_in_executor(
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/transformers/models/auto/feature_extraction_auto.py", line 346, in from_pretrained
    config_dict, _ = FeatureExtractionMixin.get_feature_extractor_dict(pretrained_model_name_or_path, **kwargs)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/transformers/feature_extraction_utils.py", line 509, in get_feature_extractor_dict
    resolved_feature_extractor_file = cached_file(
                                      ^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/transformers/utils/hub.py", line 459, in cached_file
    raise EnvironmentError(
OSError: SmilingWolf/wd-vit-large-tagger-v3 does not appear to have a file named preprocessor_config.json. Checkout 'https://huggingface.co/SmilingWolf/wd-vit-large-tagger-v3/tree/main' for available files.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/model/model_registry.py", line 27, in initialize
    await downloader.download_all()
  File "/Users/rob/repos/kalliste/kalliste/model/model_download_manager.py", line 25, in download_all
    raise RuntimeError(f"Model verification failed: {str(e)}") from e
RuntimeError: Model verification failed: SmilingWolf/wd-vit-large-tagger-v3 does not appear to have a file named preprocessor_config.json. Checkout 'https://huggingface.co/SmilingWolf/wd-vit-large-tagger-v3/tree/main' for available files.
Starting model registry cleanup
[yellow]Pipeline test interrupted by user[/]
[blue]Starting pipeline test[/]
Input directory: [cyan]/Users/rob/repos/kalliste/test_images_input[/]
Output directory: [cyan]/Users/rob/repos/kalliste/test_images_output[/]
[green]Initializing BatchProcessor[/]
Initializing BatchProcessor with input_root=/Users/rob/repos/kalliste/test_images_input, output_root=/Users/rob/repos/kalliste/test_images_output
Scanning for batches in /Users/rob/repos/kalliste/test_images_input
Initializing Batch with input_path=/Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2, max_concurrent=3
Scanning for images in /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2
Found 1 images to process in batch 20180312_Photoshoot2
Found 1 batches to process
BatchProcessor created
Initializing models
Initializing BatchProcessor and model registry
Starting model registry initialization
Checking and downloading models if needed
Verifying detection models
YOLO model already cached: yolov8n.pt
YOLO model already cached: yolov8n-face.pt
Verifying classification models
Verifying blip2 model: Salesforce/blip2-opt-2.7b
Successfully verified blip2 model
Verifying orientation model: LucyintheSky/pose-estimation-front-side-back
Successfully verified orientation model
Verifying wd14 model: SmilingWolf/wd-vit-large-tagger-v3
Failed to verify/download wd14 model: SmilingWolf/wd-vit-large-tagger-v3 does not appear to have a file named preprocessor_config.json. Checkout 'https://huggingface.co/SmilingWolf/wd-vit-large-tagger-v3/tree/main' for available files.
Traceback (most recent call last):
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/huggingface_hub/utils/_http.py", line 406, in hf_raise_for_status
    response.raise_for_status()
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/requests/models.py", line 1024, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 404 Client Error: Not Found for url: https://huggingface.co/SmilingWolf/wd-vit-large-tagger-v3/resolve/main/preprocessor_config.json

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/transformers/utils/hub.py", line 403, in cached_file
    resolved_file = hf_hub_download(
                    ^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/huggingface_hub/utils/_validators.py", line 114, in _inner_fn
    return fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/huggingface_hub/file_download.py", line 860, in hf_hub_download
    return _hf_hub_download_to_cache_dir(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/huggingface_hub/file_download.py", line 923, in _hf_hub_download_to_cache_dir
    (url_to_download, etag, commit_hash, expected_size, head_call_error) = _get_metadata_or_catch_error(
                                                                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/huggingface_hub/file_download.py", line 1374, in _get_metadata_or_catch_error
    metadata = get_hf_file_metadata(
               ^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/huggingface_hub/utils/_validators.py", line 114, in _inner_fn
    return fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/huggingface_hub/file_download.py", line 1294, in get_hf_file_metadata
    r = _request_wrapper(
        ^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/huggingface_hub/file_download.py", line 278, in _request_wrapper
    response = _request_wrapper(
               ^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/huggingface_hub/file_download.py", line 302, in _request_wrapper
    hf_raise_for_status(response)
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/huggingface_hub/utils/_http.py", line 417, in hf_raise_for_status
    raise _format(EntryNotFoundError, message, response) from e
huggingface_hub.errors.EntryNotFoundError: 404 Client Error. (Request ID: Root=1-676d83cd-1e83781f5eb26c4f46edd0ec;2dd3a6e8-1c76-45bd-a5b4-c084dd23fb24)

Entry Not Found for url: https://huggingface.co/SmilingWolf/wd-vit-large-tagger-v3/resolve/main/preprocessor_config.json.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/model/model_download_manager.py", line 64, in _ensure_classification_models
    await asyncio.get_event_loop().run_in_executor(
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/transformers/models/auto/feature_extraction_auto.py", line 346, in from_pretrained
    config_dict, _ = FeatureExtractionMixin.get_feature_extractor_dict(pretrained_model_name_or_path, **kwargs)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/transformers/feature_extraction_utils.py", line 509, in get_feature_extractor_dict
    resolved_feature_extractor_file = cached_file(
                                      ^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/transformers/utils/hub.py", line 459, in cached_file
    raise EnvironmentError(
OSError: SmilingWolf/wd-vit-large-tagger-v3 does not appear to have a file named preprocessor_config.json. Checkout 'https://huggingface.co/SmilingWolf/wd-vit-large-tagger-v3/tree/main' for available files.
Failed to verify/download models: SmilingWolf/wd-vit-large-tagger-v3 does not appear to have a file named preprocessor_config.json. Checkout 'https://huggingface.co/SmilingWolf/wd-vit-large-tagger-v3/tree/main' for available files.
Traceback (most recent call last):
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/huggingface_hub/utils/_http.py", line 406, in hf_raise_for_status
    response.raise_for_status()
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/requests/models.py", line 1024, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 404 Client Error: Not Found for url: https://huggingface.co/SmilingWolf/wd-vit-large-tagger-v3/resolve/main/preprocessor_config.json

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/transformers/utils/hub.py", line 403, in cached_file
    resolved_file = hf_hub_download(
                    ^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/huggingface_hub/utils/_validators.py", line 114, in _inner_fn
    return fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/huggingface_hub/file_download.py", line 860, in hf_hub_download
    return _hf_hub_download_to_cache_dir(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/huggingface_hub/file_download.py", line 923, in _hf_hub_download_to_cache_dir
    (url_to_download, etag, commit_hash, expected_size, head_call_error) = _get_metadata_or_catch_error(
                                                                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/huggingface_hub/file_download.py", line 1374, in _get_metadata_or_catch_error
    metadata = get_hf_file_metadata(
               ^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/huggingface_hub/utils/_validators.py", line 114, in _inner_fn
    return fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/huggingface_hub/file_download.py", line 1294, in get_hf_file_metadata
    r = _request_wrapper(
        ^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/huggingface_hub/file_download.py", line 278, in _request_wrapper
    response = _request_wrapper(
               ^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/huggingface_hub/file_download.py", line 302, in _request_wrapper
    hf_raise_for_status(response)
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/huggingface_hub/utils/_http.py", line 417, in hf_raise_for_status
    raise _format(EntryNotFoundError, message, response) from e
huggingface_hub.errors.EntryNotFoundError: 404 Client Error. (Request ID: Root=1-676d83cd-1e83781f5eb26c4f46edd0ec;2dd3a6e8-1c76-45bd-a5b4-c084dd23fb24)

Entry Not Found for url: https://huggingface.co/SmilingWolf/wd-vit-large-tagger-v3/resolve/main/preprocessor_config.json.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/model/model_download_manager.py", line 21, in download_all
    await self._ensure_classification_models()
  File "/Users/rob/repos/kalliste/kalliste/model/model_download_manager.py", line 64, in _ensure_classification_models
    await asyncio.get_event_loop().run_in_executor(
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/transformers/models/auto/feature_extraction_auto.py", line 346, in from_pretrained
    config_dict, _ = FeatureExtractionMixin.get_feature_extractor_dict(pretrained_model_name_or_path, **kwargs)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/transformers/feature_extraction_utils.py", line 509, in get_feature_extractor_dict
    resolved_feature_extractor_file = cached_file(
                                      ^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/transformers/utils/hub.py", line 459, in cached_file
    raise EnvironmentError(
OSError: SmilingWolf/wd-vit-large-tagger-v3 does not appear to have a file named preprocessor_config.json. Checkout 'https://huggingface.co/SmilingWolf/wd-vit-large-tagger-v3/tree/main' for available files.
Failed to initialize models: Model verification failed: SmilingWolf/wd-vit-large-tagger-v3 does not appear to have a file named preprocessor_config.json. Checkout 'https://huggingface.co/SmilingWolf/wd-vit-large-tagger-v3/tree/main' for available files.
Traceback (most recent call last):
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/huggingface_hub/utils/_http.py", line 406, in hf_raise_for_status
    response.raise_for_status()
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/requests/models.py", line 1024, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 404 Client Error: Not Found for url: https://huggingface.co/SmilingWolf/wd-vit-large-tagger-v3/resolve/main/preprocessor_config.json

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/transformers/utils/hub.py", line 403, in cached_file
    resolved_file = hf_hub_download(
                    ^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/huggingface_hub/utils/_validators.py", line 114, in _inner_fn
    return fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/huggingface_hub/file_download.py", line 860, in hf_hub_download
    return _hf_hub_download_to_cache_dir(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/huggingface_hub/file_download.py", line 923, in _hf_hub_download_to_cache_dir
    (url_to_download, etag, commit_hash, expected_size, head_call_error) = _get_metadata_or_catch_error(
                                                                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/huggingface_hub/file_download.py", line 1374, in _get_metadata_or_catch_error
    metadata = get_hf_file_metadata(
               ^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/huggingface_hub/utils/_validators.py", line 114, in _inner_fn
    return fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/huggingface_hub/file_download.py", line 1294, in get_hf_file_metadata
    r = _request_wrapper(
        ^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/huggingface_hub/file_download.py", line 278, in _request_wrapper
    response = _request_wrapper(
               ^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/huggingface_hub/file_download.py", line 302, in _request_wrapper
    hf_raise_for_status(response)
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/huggingface_hub/utils/_http.py", line 417, in hf_raise_for_status
    raise _format(EntryNotFoundError, message, response) from e
huggingface_hub.errors.EntryNotFoundError: 404 Client Error. (Request ID: Root=1-676d83cd-1e83781f5eb26c4f46edd0ec;2dd3a6e8-1c76-45bd-a5b4-c084dd23fb24)

Entry Not Found for url: https://huggingface.co/SmilingWolf/wd-vit-large-tagger-v3/resolve/main/preprocessor_config.json.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/model/model_download_manager.py", line 21, in download_all
    await self._ensure_classification_models()
  File "/Users/rob/repos/kalliste/kalliste/model/model_download_manager.py", line 64, in _ensure_classification_models
    await asyncio.get_event_loop().run_in_executor(
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/transformers/models/auto/feature_extraction_auto.py", line 346, in from_pretrained
    config_dict, _ = FeatureExtractionMixin.get_feature_extractor_dict(pretrained_model_name_or_path, **kwargs)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/transformers/feature_extraction_utils.py", line 509, in get_feature_extractor_dict
    resolved_feature_extractor_file = cached_file(
                                      ^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/transformers/utils/hub.py", line 459, in cached_file
    raise EnvironmentError(
OSError: SmilingWolf/wd-vit-large-tagger-v3 does not appear to have a file named preprocessor_config.json. Checkout 'https://huggingface.co/SmilingWolf/wd-vit-large-tagger-v3/tree/main' for available files.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/model/model_registry.py", line 28, in initialize
    await downloader.download_all()
  File "/Users/rob/repos/kalliste/kalliste/model/model_download_manager.py", line 25, in download_all
    raise RuntimeError(f"Model verification failed: {str(e)}") from e
RuntimeError: Model verification failed: SmilingWolf/wd-vit-large-tagger-v3 does not appear to have a file named preprocessor_config.json. Checkout 'https://huggingface.co/SmilingWolf/wd-vit-large-tagger-v3/tree/main' for available files.
Starting model registry cleanup
[blue]Starting pipeline test[/]
Input directory: [cyan]/Users/rob/repos/kalliste/test_images_input[/]
Output directory: [cyan]/Users/rob/repos/kalliste/test_images_output[/]
[green]Initializing BatchProcessor[/]
Initializing BatchProcessor with input_root=/Users/rob/repos/kalliste/test_images_input, output_root=/Users/rob/repos/kalliste/test_images_output
Scanning for batches in /Users/rob/repos/kalliste/test_images_input
Initializing Batch with input_path=/Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2, max_concurrent=3
Scanning for images in /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2
Found 1 images to process in batch 20180312_Photoshoot2
Found 1 batches to process
BatchProcessor created
Initializing models
Initializing BatchProcessor and model registry
Starting model registry initialization
Checking and downloading models if needed
Verifying detection models
YOLO model already cached: yolov8n.pt
YOLO model already cached: yolov8n-face.pt
Verifying classification models
Verifying blip2 model: Salesforce/blip2-opt-2.7b
Successfully verified blip2 model
Verifying orientation model: LucyintheSky/pose-estimation-front-side-back
Successfully verified orientation model
Verifying wd14 model: SmilingWolf/wd-vit-large-tagger-v3
Failed to verify/download wd14 model: SmilingWolf/wd-vit-large-tagger-v3 does not appear to have a file named preprocessor_config.json. Checkout 'https://huggingface.co/SmilingWolf/wd-vit-large-tagger-v3/tree/main' for available files.
Traceback (most recent call last):
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/huggingface_hub/utils/_http.py", line 406, in hf_raise_for_status
    response.raise_for_status()
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/requests/models.py", line 1024, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 404 Client Error: Not Found for url: https://huggingface.co/SmilingWolf/wd-vit-large-tagger-v3/resolve/main/preprocessor_config.json

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/transformers/utils/hub.py", line 403, in cached_file
    resolved_file = hf_hub_download(
                    ^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/huggingface_hub/utils/_validators.py", line 114, in _inner_fn
    return fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/huggingface_hub/file_download.py", line 860, in hf_hub_download
    return _hf_hub_download_to_cache_dir(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/huggingface_hub/file_download.py", line 923, in _hf_hub_download_to_cache_dir
    (url_to_download, etag, commit_hash, expected_size, head_call_error) = _get_metadata_or_catch_error(
                                                                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/huggingface_hub/file_download.py", line 1374, in _get_metadata_or_catch_error
    metadata = get_hf_file_metadata(
               ^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/huggingface_hub/utils/_validators.py", line 114, in _inner_fn
    return fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/huggingface_hub/file_download.py", line 1294, in get_hf_file_metadata
    r = _request_wrapper(
        ^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/huggingface_hub/file_download.py", line 278, in _request_wrapper
    response = _request_wrapper(
               ^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/huggingface_hub/file_download.py", line 302, in _request_wrapper
    hf_raise_for_status(response)
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/huggingface_hub/utils/_http.py", line 417, in hf_raise_for_status
    raise _format(EntryNotFoundError, message, response) from e
huggingface_hub.errors.EntryNotFoundError: 404 Client Error. (Request ID: Root=1-676d8f87-68e8af270104dbbe556e16cf;ec65848c-e642-4e47-a3aa-a3cf673e9b0e)

Entry Not Found for url: https://huggingface.co/SmilingWolf/wd-vit-large-tagger-v3/resolve/main/preprocessor_config.json.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/model/model_download_manager.py", line 64, in _ensure_classification_models
    await asyncio.get_event_loop().run_in_executor(
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/transformers/models/auto/feature_extraction_auto.py", line 346, in from_pretrained
    config_dict, _ = FeatureExtractionMixin.get_feature_extractor_dict(pretrained_model_name_or_path, **kwargs)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/transformers/feature_extraction_utils.py", line 509, in get_feature_extractor_dict
    resolved_feature_extractor_file = cached_file(
                                      ^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/transformers/utils/hub.py", line 459, in cached_file
    raise EnvironmentError(
OSError: SmilingWolf/wd-vit-large-tagger-v3 does not appear to have a file named preprocessor_config.json. Checkout 'https://huggingface.co/SmilingWolf/wd-vit-large-tagger-v3/tree/main' for available files.
Failed to verify/download models: SmilingWolf/wd-vit-large-tagger-v3 does not appear to have a file named preprocessor_config.json. Checkout 'https://huggingface.co/SmilingWolf/wd-vit-large-tagger-v3/tree/main' for available files.
Traceback (most recent call last):
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/huggingface_hub/utils/_http.py", line 406, in hf_raise_for_status
    response.raise_for_status()
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/requests/models.py", line 1024, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 404 Client Error: Not Found for url: https://huggingface.co/SmilingWolf/wd-vit-large-tagger-v3/resolve/main/preprocessor_config.json

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/transformers/utils/hub.py", line 403, in cached_file
    resolved_file = hf_hub_download(
                    ^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/huggingface_hub/utils/_validators.py", line 114, in _inner_fn
    return fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/huggingface_hub/file_download.py", line 860, in hf_hub_download
    return _hf_hub_download_to_cache_dir(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/huggingface_hub/file_download.py", line 923, in _hf_hub_download_to_cache_dir
    (url_to_download, etag, commit_hash, expected_size, head_call_error) = _get_metadata_or_catch_error(
                                                                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/huggingface_hub/file_download.py", line 1374, in _get_metadata_or_catch_error
    metadata = get_hf_file_metadata(
               ^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/huggingface_hub/utils/_validators.py", line 114, in _inner_fn
    return fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/huggingface_hub/file_download.py", line 1294, in get_hf_file_metadata
    r = _request_wrapper(
        ^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/huggingface_hub/file_download.py", line 278, in _request_wrapper
    response = _request_wrapper(
               ^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/huggingface_hub/file_download.py", line 302, in _request_wrapper
    hf_raise_for_status(response)
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/huggingface_hub/utils/_http.py", line 417, in hf_raise_for_status
    raise _format(EntryNotFoundError, message, response) from e
huggingface_hub.errors.EntryNotFoundError: 404 Client Error. (Request ID: Root=1-676d8f87-68e8af270104dbbe556e16cf;ec65848c-e642-4e47-a3aa-a3cf673e9b0e)

Entry Not Found for url: https://huggingface.co/SmilingWolf/wd-vit-large-tagger-v3/resolve/main/preprocessor_config.json.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/model/model_download_manager.py", line 21, in download_all
    await self._ensure_classification_models()
  File "/Users/rob/repos/kalliste/kalliste/model/model_download_manager.py", line 64, in _ensure_classification_models
    await asyncio.get_event_loop().run_in_executor(
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/transformers/models/auto/feature_extraction_auto.py", line 346, in from_pretrained
    config_dict, _ = FeatureExtractionMixin.get_feature_extractor_dict(pretrained_model_name_or_path, **kwargs)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/transformers/feature_extraction_utils.py", line 509, in get_feature_extractor_dict
    resolved_feature_extractor_file = cached_file(
                                      ^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/transformers/utils/hub.py", line 459, in cached_file
    raise EnvironmentError(
OSError: SmilingWolf/wd-vit-large-tagger-v3 does not appear to have a file named preprocessor_config.json. Checkout 'https://huggingface.co/SmilingWolf/wd-vit-large-tagger-v3/tree/main' for available files.
Failed to initialize models: Model verification failed: SmilingWolf/wd-vit-large-tagger-v3 does not appear to have a file named preprocessor_config.json. Checkout 'https://huggingface.co/SmilingWolf/wd-vit-large-tagger-v3/tree/main' for available files.
Traceback (most recent call last):
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/huggingface_hub/utils/_http.py", line 406, in hf_raise_for_status
    response.raise_for_status()
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/requests/models.py", line 1024, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 404 Client Error: Not Found for url: https://huggingface.co/SmilingWolf/wd-vit-large-tagger-v3/resolve/main/preprocessor_config.json

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/transformers/utils/hub.py", line 403, in cached_file
    resolved_file = hf_hub_download(
                    ^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/huggingface_hub/utils/_validators.py", line 114, in _inner_fn
    return fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/huggingface_hub/file_download.py", line 860, in hf_hub_download
    return _hf_hub_download_to_cache_dir(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/huggingface_hub/file_download.py", line 923, in _hf_hub_download_to_cache_dir
    (url_to_download, etag, commit_hash, expected_size, head_call_error) = _get_metadata_or_catch_error(
                                                                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/huggingface_hub/file_download.py", line 1374, in _get_metadata_or_catch_error
    metadata = get_hf_file_metadata(
               ^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/huggingface_hub/utils/_validators.py", line 114, in _inner_fn
    return fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/huggingface_hub/file_download.py", line 1294, in get_hf_file_metadata
    r = _request_wrapper(
        ^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/huggingface_hub/file_download.py", line 278, in _request_wrapper
    response = _request_wrapper(
               ^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/huggingface_hub/file_download.py", line 302, in _request_wrapper
    hf_raise_for_status(response)
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/huggingface_hub/utils/_http.py", line 417, in hf_raise_for_status
    raise _format(EntryNotFoundError, message, response) from e
huggingface_hub.errors.EntryNotFoundError: 404 Client Error. (Request ID: Root=1-676d8f87-68e8af270104dbbe556e16cf;ec65848c-e642-4e47-a3aa-a3cf673e9b0e)

Entry Not Found for url: https://huggingface.co/SmilingWolf/wd-vit-large-tagger-v3/resolve/main/preprocessor_config.json.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/model/model_download_manager.py", line 21, in download_all
    await self._ensure_classification_models()
  File "/Users/rob/repos/kalliste/kalliste/model/model_download_manager.py", line 64, in _ensure_classification_models
    await asyncio.get_event_loop().run_in_executor(
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/transformers/models/auto/feature_extraction_auto.py", line 346, in from_pretrained
    config_dict, _ = FeatureExtractionMixin.get_feature_extractor_dict(pretrained_model_name_or_path, **kwargs)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/transformers/feature_extraction_utils.py", line 509, in get_feature_extractor_dict
    resolved_feature_extractor_file = cached_file(
                                      ^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/transformers/utils/hub.py", line 459, in cached_file
    raise EnvironmentError(
OSError: SmilingWolf/wd-vit-large-tagger-v3 does not appear to have a file named preprocessor_config.json. Checkout 'https://huggingface.co/SmilingWolf/wd-vit-large-tagger-v3/tree/main' for available files.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/model/model_registry.py", line 28, in initialize
    await downloader.download_all()
  File "/Users/rob/repos/kalliste/kalliste/model/model_download_manager.py", line 25, in download_all
    raise RuntimeError(f"Model verification failed: {str(e)}") from e
RuntimeError: Model verification failed: SmilingWolf/wd-vit-large-tagger-v3 does not appear to have a file named preprocessor_config.json. Checkout 'https://huggingface.co/SmilingWolf/wd-vit-large-tagger-v3/tree/main' for available files.
Starting model registry cleanup
[yellow]Pipeline test interrupted by user[/]
[blue]Starting pipeline test[/]
Input directory: [cyan]/Users/rob/repos/kalliste/test_images_input[/]
Output directory: [cyan]/Users/rob/repos/kalliste/test_images_output[/]
[green]Initializing BatchProcessor[/]
Initializing BatchProcessor with input_root=/Users/rob/repos/kalliste/test_images_input, output_root=/Users/rob/repos/kalliste/test_images_output
Scanning for batches in /Users/rob/repos/kalliste/test_images_input
Initializing Batch with input_path=/Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2, max_concurrent=3
Scanning for images in /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2
Found 1 images to process in batch 20180312_Photoshoot2
Found 1 batches to process
BatchProcessor created
Initializing models
Initializing BatchProcessor and model registry
Starting model registry initialization
Checking and downloading models if needed
Verifying detection models
YOLO model already cached: yolov8n.pt
YOLO model already cached: yolov8n-face.pt
Verifying classification models
Verifying blip2 model: Salesforce/blip2-opt-2.7b
Successfully verified blip2 model
Verifying orientation model: LucyintheSky/pose-estimation-front-side-back
Successfully verified orientation model
Verifying wd14 model: SmilingWolf/wd-vit-large-tagger-v3
Failed to verify/download wd14 model: Unrecognized processing class in SmilingWolf/wd-vit-large-tagger-v3. Can't instantiate a processor, a tokenizer, an image processor or a feature extractor for this model. Make sure the repository contains the files of at least one of those processing classes.
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/model/model_download_manager.py", line 52, in _ensure_classification_models
    await asyncio.get_event_loop().run_in_executor(
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/transformers/models/auto/processing_auto.py", line 356, in from_pretrained
    raise ValueError(
ValueError: Unrecognized processing class in SmilingWolf/wd-vit-large-tagger-v3. Can't instantiate a processor, a tokenizer, an image processor or a feature extractor for this model. Make sure the repository contains the files of at least one of those processing classes.
Failed to verify/download models: Unrecognized processing class in SmilingWolf/wd-vit-large-tagger-v3. Can't instantiate a processor, a tokenizer, an image processor or a feature extractor for this model. Make sure the repository contains the files of at least one of those processing classes.
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/model/model_download_manager.py", line 21, in download_all
    await self._ensure_classification_models()
  File "/Users/rob/repos/kalliste/kalliste/model/model_download_manager.py", line 52, in _ensure_classification_models
    await asyncio.get_event_loop().run_in_executor(
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/transformers/models/auto/processing_auto.py", line 356, in from_pretrained
    raise ValueError(
ValueError: Unrecognized processing class in SmilingWolf/wd-vit-large-tagger-v3. Can't instantiate a processor, a tokenizer, an image processor or a feature extractor for this model. Make sure the repository contains the files of at least one of those processing classes.
Failed to initialize models: Model verification failed: Unrecognized processing class in SmilingWolf/wd-vit-large-tagger-v3. Can't instantiate a processor, a tokenizer, an image processor or a feature extractor for this model. Make sure the repository contains the files of at least one of those processing classes.
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/model/model_download_manager.py", line 21, in download_all
    await self._ensure_classification_models()
  File "/Users/rob/repos/kalliste/kalliste/model/model_download_manager.py", line 52, in _ensure_classification_models
    await asyncio.get_event_loop().run_in_executor(
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/transformers/models/auto/processing_auto.py", line 356, in from_pretrained
    raise ValueError(
ValueError: Unrecognized processing class in SmilingWolf/wd-vit-large-tagger-v3. Can't instantiate a processor, a tokenizer, an image processor or a feature extractor for this model. Make sure the repository contains the files of at least one of those processing classes.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/model/model_registry.py", line 28, in initialize
    await downloader.download_all()
  File "/Users/rob/repos/kalliste/kalliste/model/model_download_manager.py", line 25, in download_all
    raise RuntimeError(f"Model verification failed: {str(e)}") from e
RuntimeError: Model verification failed: Unrecognized processing class in SmilingWolf/wd-vit-large-tagger-v3. Can't instantiate a processor, a tokenizer, an image processor or a feature extractor for this model. Make sure the repository contains the files of at least one of those processing classes.
Starting model registry cleanup
[yellow]Pipeline test interrupted by user[/]
[blue]Starting pipeline test[/]
Input directory: [cyan]/Users/rob/repos/kalliste/test_images_input[/]
Output directory: [cyan]/Users/rob/repos/kalliste/test_images_output[/]
[green]Initializing BatchProcessor[/]
Initializing BatchProcessor with input_root=/Users/rob/repos/kalliste/test_images_input, output_root=/Users/rob/repos/kalliste/test_images_output
Scanning for batches in /Users/rob/repos/kalliste/test_images_input
Initializing Batch with input_path=/Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2, max_concurrent=3
Scanning for images in /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2
Found 1 images to process in batch 20180312_Photoshoot2
Found 1 batches to process
BatchProcessor created
Initializing models
Initializing BatchProcessor and model registry
Starting model registry initialization
Checking and downloading models if needed
Verifying detection models
YOLO model already cached: yolov8n.pt
YOLO model already cached: yolov8n-face.pt
Verifying classification models
Verifying blip2 model: Salesforce/blip2-opt-2.7b
Successfully verified blip2 model
Verifying orientation model: LucyintheSky/pose-estimation-front-side-back
Successfully verified orientation model
Verifying wd14 model: SmilingWolf/wd-vit-large-tagger-v3
Failed to verify/download wd14 model: SmilingWolf/wd-vit-large-tagger-v3 does not appear to have a file named preprocessor_config.json. Checkout 'https://huggingface.co/SmilingWolf/wd-vit-large-tagger-v3/tree/main' for available files.
Traceback (most recent call last):
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/huggingface_hub/utils/_http.py", line 406, in hf_raise_for_status
    response.raise_for_status()
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/requests/models.py", line 1024, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 404 Client Error: Not Found for url: https://huggingface.co/SmilingWolf/wd-vit-large-tagger-v3/resolve/main/preprocessor_config.json

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/transformers/utils/hub.py", line 403, in cached_file
    resolved_file = hf_hub_download(
                    ^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/huggingface_hub/utils/_validators.py", line 114, in _inner_fn
    return fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/huggingface_hub/file_download.py", line 860, in hf_hub_download
    return _hf_hub_download_to_cache_dir(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/huggingface_hub/file_download.py", line 923, in _hf_hub_download_to_cache_dir
    (url_to_download, etag, commit_hash, expected_size, head_call_error) = _get_metadata_or_catch_error(
                                                                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/huggingface_hub/file_download.py", line 1374, in _get_metadata_or_catch_error
    metadata = get_hf_file_metadata(
               ^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/huggingface_hub/utils/_validators.py", line 114, in _inner_fn
    return fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/huggingface_hub/file_download.py", line 1294, in get_hf_file_metadata
    r = _request_wrapper(
        ^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/huggingface_hub/file_download.py", line 278, in _request_wrapper
    response = _request_wrapper(
               ^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/huggingface_hub/file_download.py", line 302, in _request_wrapper
    hf_raise_for_status(response)
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/huggingface_hub/utils/_http.py", line 417, in hf_raise_for_status
    raise _format(EntryNotFoundError, message, response) from e
huggingface_hub.errors.EntryNotFoundError: 404 Client Error. (Request ID: Root=1-676d92ba-55c4b5c1036a818c51195be8;6d5f409e-23c7-44bd-a95b-7fbfd65cf174)

Entry Not Found for url: https://huggingface.co/SmilingWolf/wd-vit-large-tagger-v3/resolve/main/preprocessor_config.json.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/model/model_download_manager.py", line 58, in _ensure_classification_models
    await asyncio.get_event_loop().run_in_executor(
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/transformers/models/auto/feature_extraction_auto.py", line 346, in from_pretrained
    config_dict, _ = FeatureExtractionMixin.get_feature_extractor_dict(pretrained_model_name_or_path, **kwargs)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/transformers/feature_extraction_utils.py", line 509, in get_feature_extractor_dict
    resolved_feature_extractor_file = cached_file(
                                      ^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/transformers/utils/hub.py", line 459, in cached_file
    raise EnvironmentError(
OSError: SmilingWolf/wd-vit-large-tagger-v3 does not appear to have a file named preprocessor_config.json. Checkout 'https://huggingface.co/SmilingWolf/wd-vit-large-tagger-v3/tree/main' for available files.
Failed to verify/download models: SmilingWolf/wd-vit-large-tagger-v3 does not appear to have a file named preprocessor_config.json. Checkout 'https://huggingface.co/SmilingWolf/wd-vit-large-tagger-v3/tree/main' for available files.
Traceback (most recent call last):
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/huggingface_hub/utils/_http.py", line 406, in hf_raise_for_status
    response.raise_for_status()
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/requests/models.py", line 1024, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 404 Client Error: Not Found for url: https://huggingface.co/SmilingWolf/wd-vit-large-tagger-v3/resolve/main/preprocessor_config.json

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/transformers/utils/hub.py", line 403, in cached_file
    resolved_file = hf_hub_download(
                    ^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/huggingface_hub/utils/_validators.py", line 114, in _inner_fn
    return fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/huggingface_hub/file_download.py", line 860, in hf_hub_download
    return _hf_hub_download_to_cache_dir(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/huggingface_hub/file_download.py", line 923, in _hf_hub_download_to_cache_dir
    (url_to_download, etag, commit_hash, expected_size, head_call_error) = _get_metadata_or_catch_error(
                                                                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/huggingface_hub/file_download.py", line 1374, in _get_metadata_or_catch_error
    metadata = get_hf_file_metadata(
               ^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/huggingface_hub/utils/_validators.py", line 114, in _inner_fn
    return fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/huggingface_hub/file_download.py", line 1294, in get_hf_file_metadata
    r = _request_wrapper(
        ^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/huggingface_hub/file_download.py", line 278, in _request_wrapper
    response = _request_wrapper(
               ^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/huggingface_hub/file_download.py", line 302, in _request_wrapper
    hf_raise_for_status(response)
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/huggingface_hub/utils/_http.py", line 417, in hf_raise_for_status
    raise _format(EntryNotFoundError, message, response) from e
huggingface_hub.errors.EntryNotFoundError: 404 Client Error. (Request ID: Root=1-676d92ba-55c4b5c1036a818c51195be8;6d5f409e-23c7-44bd-a95b-7fbfd65cf174)

Entry Not Found for url: https://huggingface.co/SmilingWolf/wd-vit-large-tagger-v3/resolve/main/preprocessor_config.json.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/model/model_download_manager.py", line 21, in download_all
    await self._ensure_classification_models()
  File "/Users/rob/repos/kalliste/kalliste/model/model_download_manager.py", line 58, in _ensure_classification_models
    await asyncio.get_event_loop().run_in_executor(
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/transformers/models/auto/feature_extraction_auto.py", line 346, in from_pretrained
    config_dict, _ = FeatureExtractionMixin.get_feature_extractor_dict(pretrained_model_name_or_path, **kwargs)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/transformers/feature_extraction_utils.py", line 509, in get_feature_extractor_dict
    resolved_feature_extractor_file = cached_file(
                                      ^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/transformers/utils/hub.py", line 459, in cached_file
    raise EnvironmentError(
OSError: SmilingWolf/wd-vit-large-tagger-v3 does not appear to have a file named preprocessor_config.json. Checkout 'https://huggingface.co/SmilingWolf/wd-vit-large-tagger-v3/tree/main' for available files.
Failed to initialize models: Model verification failed: SmilingWolf/wd-vit-large-tagger-v3 does not appear to have a file named preprocessor_config.json. Checkout 'https://huggingface.co/SmilingWolf/wd-vit-large-tagger-v3/tree/main' for available files.
Traceback (most recent call last):
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/huggingface_hub/utils/_http.py", line 406, in hf_raise_for_status
    response.raise_for_status()
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/requests/models.py", line 1024, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 404 Client Error: Not Found for url: https://huggingface.co/SmilingWolf/wd-vit-large-tagger-v3/resolve/main/preprocessor_config.json

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/transformers/utils/hub.py", line 403, in cached_file
    resolved_file = hf_hub_download(
                    ^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/huggingface_hub/utils/_validators.py", line 114, in _inner_fn
    return fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/huggingface_hub/file_download.py", line 860, in hf_hub_download
    return _hf_hub_download_to_cache_dir(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/huggingface_hub/file_download.py", line 923, in _hf_hub_download_to_cache_dir
    (url_to_download, etag, commit_hash, expected_size, head_call_error) = _get_metadata_or_catch_error(
                                                                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/huggingface_hub/file_download.py", line 1374, in _get_metadata_or_catch_error
    metadata = get_hf_file_metadata(
               ^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/huggingface_hub/utils/_validators.py", line 114, in _inner_fn
    return fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/huggingface_hub/file_download.py", line 1294, in get_hf_file_metadata
    r = _request_wrapper(
        ^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/huggingface_hub/file_download.py", line 278, in _request_wrapper
    response = _request_wrapper(
               ^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/huggingface_hub/file_download.py", line 302, in _request_wrapper
    hf_raise_for_status(response)
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/huggingface_hub/utils/_http.py", line 417, in hf_raise_for_status
    raise _format(EntryNotFoundError, message, response) from e
huggingface_hub.errors.EntryNotFoundError: 404 Client Error. (Request ID: Root=1-676d92ba-55c4b5c1036a818c51195be8;6d5f409e-23c7-44bd-a95b-7fbfd65cf174)

Entry Not Found for url: https://huggingface.co/SmilingWolf/wd-vit-large-tagger-v3/resolve/main/preprocessor_config.json.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/model/model_download_manager.py", line 21, in download_all
    await self._ensure_classification_models()
  File "/Users/rob/repos/kalliste/kalliste/model/model_download_manager.py", line 58, in _ensure_classification_models
    await asyncio.get_event_loop().run_in_executor(
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/transformers/models/auto/feature_extraction_auto.py", line 346, in from_pretrained
    config_dict, _ = FeatureExtractionMixin.get_feature_extractor_dict(pretrained_model_name_or_path, **kwargs)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/transformers/feature_extraction_utils.py", line 509, in get_feature_extractor_dict
    resolved_feature_extractor_file = cached_file(
                                      ^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/transformers/utils/hub.py", line 459, in cached_file
    raise EnvironmentError(
OSError: SmilingWolf/wd-vit-large-tagger-v3 does not appear to have a file named preprocessor_config.json. Checkout 'https://huggingface.co/SmilingWolf/wd-vit-large-tagger-v3/tree/main' for available files.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/model/model_registry.py", line 28, in initialize
    await downloader.download_all()
  File "/Users/rob/repos/kalliste/kalliste/model/model_download_manager.py", line 25, in download_all
    raise RuntimeError(f"Model verification failed: {str(e)}") from e
RuntimeError: Model verification failed: SmilingWolf/wd-vit-large-tagger-v3 does not appear to have a file named preprocessor_config.json. Checkout 'https://huggingface.co/SmilingWolf/wd-vit-large-tagger-v3/tree/main' for available files.
Starting model registry cleanup
[yellow]Pipeline test interrupted by user[/]
[blue]Starting pipeline test[/]
Input directory: [cyan]/Users/rob/repos/kalliste/test_images_input[/]
Output directory: [cyan]/Users/rob/repos/kalliste/test_images_output[/]
[green]Initializing BatchProcessor[/]
Initializing BatchProcessor with input_root=/Users/rob/repos/kalliste/test_images_input, output_root=/Users/rob/repos/kalliste/test_images_output
Scanning for batches in /Users/rob/repos/kalliste/test_images_input
Initializing Batch with input_path=/Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2, max_concurrent=3
Scanning for images in /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2
Found 1 images to process in batch 20180312_Photoshoot2
Found 1 batches to process
BatchProcessor created
Initializing models
Initializing BatchProcessor and model registry
Starting model registry initialization
Checking and downloading models if needed
Verifying detection models
YOLO model already cached: yolov8n.pt
YOLO model already cached: yolov8n-face.pt
Verifying classification models
Verifying blip2 model: Salesforce/blip2-opt-2.7b
Successfully verified blip2 model
Verifying orientation model: LucyintheSky/pose-estimation-front-side-back
Successfully verified orientation model
Verifying wd14 model: SmilingWolf/wd-vit-large-tagger-v3
Failed to verify/download wd14 model: name 'timm' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/model/model_download_manager.py", line 60, in _ensure_classification_models
    timm.create_model,
    ^^^^
NameError: name 'timm' is not defined
Failed to verify/download models: name 'timm' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/model/model_download_manager.py", line 21, in download_all
    await self._ensure_classification_models()
  File "/Users/rob/repos/kalliste/kalliste/model/model_download_manager.py", line 60, in _ensure_classification_models
    timm.create_model,
    ^^^^
NameError: name 'timm' is not defined
Failed to initialize models: Model verification failed: name 'timm' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/model/model_download_manager.py", line 21, in download_all
    await self._ensure_classification_models()
  File "/Users/rob/repos/kalliste/kalliste/model/model_download_manager.py", line 60, in _ensure_classification_models
    timm.create_model,
    ^^^^
NameError: name 'timm' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/model/model_registry.py", line 28, in initialize
    await downloader.download_all()
  File "/Users/rob/repos/kalliste/kalliste/model/model_download_manager.py", line 25, in download_all
    raise RuntimeError(f"Model verification failed: {str(e)}") from e
RuntimeError: Model verification failed: name 'timm' is not defined
Starting model registry cleanup
[yellow]Pipeline test interrupted by user[/]
[blue]Starting pipeline test[/]
Input directory: [cyan]/Users/rob/repos/kalliste/test_images_input[/]
Output directory: [cyan]/Users/rob/repos/kalliste/test_images_output[/]
[green]Initializing BatchProcessor[/]
Initializing BatchProcessor with input_root=/Users/rob/repos/kalliste/test_images_input, output_root=/Users/rob/repos/kalliste/test_images_output
Scanning for batches in /Users/rob/repos/kalliste/test_images_input
Initializing Batch with input_path=/Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2, max_concurrent=3
Scanning for images in /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2
Found 1 images to process in batch 20180312_Photoshoot2
Found 1 batches to process
BatchProcessor created
Initializing models
Initializing BatchProcessor and model registry
Starting model registry initialization
Checking and downloading models if needed
Verifying detection models
YOLO model already cached: yolov8n.pt
YOLO model already cached: yolov8n-face.pt
Verifying classification models
Verifying blip2 model: Salesforce/blip2-opt-2.7b
Successfully verified blip2 model
Verifying orientation model: LucyintheSky/pose-estimation-front-side-back
Successfully verified orientation model
Verifying wd14 model: SmilingWolf/wd-vit-large-tagger-v3
Failed to verify/download wd14 model: BaseEventLoop.run_in_executor() got an unexpected keyword argument 'pretrained'
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/model/model_download_manager.py", line 59, in _ensure_classification_models
    await asyncio.get_event_loop().run_in_executor(
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: BaseEventLoop.run_in_executor() got an unexpected keyword argument 'pretrained'
Failed to verify/download models: BaseEventLoop.run_in_executor() got an unexpected keyword argument 'pretrained'
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/model/model_download_manager.py", line 22, in download_all
    await self._ensure_classification_models()
  File "/Users/rob/repos/kalliste/kalliste/model/model_download_manager.py", line 59, in _ensure_classification_models
    await asyncio.get_event_loop().run_in_executor(
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: BaseEventLoop.run_in_executor() got an unexpected keyword argument 'pretrained'
Failed to initialize models: Model verification failed: BaseEventLoop.run_in_executor() got an unexpected keyword argument 'pretrained'
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/model/model_download_manager.py", line 22, in download_all
    await self._ensure_classification_models()
  File "/Users/rob/repos/kalliste/kalliste/model/model_download_manager.py", line 59, in _ensure_classification_models
    await asyncio.get_event_loop().run_in_executor(
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: BaseEventLoop.run_in_executor() got an unexpected keyword argument 'pretrained'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/model/model_registry.py", line 28, in initialize
    await downloader.download_all()
  File "/Users/rob/repos/kalliste/kalliste/model/model_download_manager.py", line 26, in download_all
    raise RuntimeError(f"Model verification failed: {str(e)}") from e
RuntimeError: Model verification failed: BaseEventLoop.run_in_executor() got an unexpected keyword argument 'pretrained'
Starting model registry cleanup
[yellow]Pipeline test interrupted by user[/]
[blue]Starting pipeline test[/]
Input directory: [cyan]/Users/rob/repos/kalliste/test_images_input[/]
Output directory: [cyan]/Users/rob/repos/kalliste/test_images_output[/]
[green]Initializing BatchProcessor[/]
Initializing BatchProcessor with input_root=/Users/rob/repos/kalliste/test_images_input, output_root=/Users/rob/repos/kalliste/test_images_output
Scanning for batches in /Users/rob/repos/kalliste/test_images_input
Initializing Batch with input_path=/Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2, max_concurrent=3
Scanning for images in /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2
Found 1 images to process in batch 20180312_Photoshoot2
Found 1 batches to process
BatchProcessor created
Initializing models
Initializing BatchProcessor and model registry
Starting model registry initialization
Checking and downloading models if needed
Verifying detection models
YOLO model already cached: yolov8n.pt
YOLO model already cached: yolov8n-face.pt
Verifying classification models
Verifying blip2 model: Salesforce/blip2-opt-2.7b
Successfully verified blip2 model
Verifying orientation model: LucyintheSky/pose-estimation-front-side-back
Successfully verified orientation model
Verifying wd14 model: SmilingWolf/wd-vit-large-tagger-v3
Failed to verify/download wd14 model: BaseEventLoop.run_in_executor() got an unexpected keyword argument 'pretrained'
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/model/model_download_manager.py", line 59, in _ensure_classification_models
    await asyncio.get_event_loop().run_in_executor(
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: BaseEventLoop.run_in_executor() got an unexpected keyword argument 'pretrained'
Failed to verify/download models: BaseEventLoop.run_in_executor() got an unexpected keyword argument 'pretrained'
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/model/model_download_manager.py", line 22, in download_all
    await self._ensure_classification_models()
  File "/Users/rob/repos/kalliste/kalliste/model/model_download_manager.py", line 59, in _ensure_classification_models
    await asyncio.get_event_loop().run_in_executor(
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: BaseEventLoop.run_in_executor() got an unexpected keyword argument 'pretrained'
Failed to initialize models: Model verification failed: BaseEventLoop.run_in_executor() got an unexpected keyword argument 'pretrained'
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/model/model_download_manager.py", line 22, in download_all
    await self._ensure_classification_models()
  File "/Users/rob/repos/kalliste/kalliste/model/model_download_manager.py", line 59, in _ensure_classification_models
    await asyncio.get_event_loop().run_in_executor(
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: BaseEventLoop.run_in_executor() got an unexpected keyword argument 'pretrained'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/model/model_registry.py", line 28, in initialize
    await downloader.download_all()
  File "/Users/rob/repos/kalliste/kalliste/model/model_download_manager.py", line 26, in download_all
    raise RuntimeError(f"Model verification failed: {str(e)}") from e
RuntimeError: Model verification failed: BaseEventLoop.run_in_executor() got an unexpected keyword argument 'pretrained'
Starting model registry cleanup
[yellow]Pipeline test interrupted by user[/]
[blue]Starting pipeline test[/]
Input directory: [cyan]/Users/rob/repos/kalliste/test_images_input[/]
Output directory: [cyan]/Users/rob/repos/kalliste/test_images_output[/]
[green]Initializing BatchProcessor[/]
Initializing BatchProcessor with input_root=/Users/rob/repos/kalliste/test_images_input, output_root=/Users/rob/repos/kalliste/test_images_output
Scanning for batches in /Users/rob/repos/kalliste/test_images_input
Initializing Batch with input_path=/Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2, max_concurrent=3
Scanning for images in /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2
Found 1 images to process in batch 20180312_Photoshoot2
Found 1 batches to process
BatchProcessor created
Initializing models
Initializing BatchProcessor and model registry
Starting model registry initialization
Checking and downloading models if needed
Verifying detection models
YOLO model already cached: yolov8n.pt
YOLO model already cached: yolov8n-face.pt
Verifying classification models
Verifying blip2 model: Salesforce/blip2-opt-2.7b
Successfully verified blip2 model
Verifying orientation model: LucyintheSky/pose-estimation-front-side-back
Successfully verified orientation model
Verifying wd14 model: SmilingWolf/wd-vit-large-tagger-v3
Loading pretrained weights from Hugging Face hub (SmilingWolf/wd-vit-large-tagger-v3)
[SmilingWolf/wd-vit-large-tagger-v3] Safe alternative available for 'pytorch_model.bin' (as 'model.safetensors'). Loading weights using safetensors.
Successfully verified wd14 model
All models verified/downloaded
Initializing tagger pipeline...
[blue]Starting pipeline test[/]
Input directory: [cyan]/Users/rob/repos/kalliste/test_images_input[/]
Output directory: [cyan]/Users/rob/repos/kalliste/test_images_output[/]
[green]Initializing BatchProcessor[/]
Initializing BatchProcessor with input_root=/Users/rob/repos/kalliste/test_images_input, output_root=/Users/rob/repos/kalliste/test_images_output
Scanning for batches in /Users/rob/repos/kalliste/test_images_input
Initializing Batch with input_path=/Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2, max_concurrent=3
Scanning for images in /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2
Found 1 images to process in batch 20180312_Photoshoot2
Found 1 batches to process
BatchProcessor created
Initializing models
Initializing BatchProcessor and model registry
Starting model registry initialization
Checking and downloading models if needed
Verifying detection models
YOLO model already cached: yolov8n.pt
YOLO model already cached: yolov8n-face.pt
Verifying classification models
Verifying blip2 model: Salesforce/blip2-opt-2.7b
Successfully verified blip2 model
Verifying orientation model: LucyintheSky/pose-estimation-front-side-back
Successfully verified orientation model
Verifying wd14 model: SmilingWolf/wd-vit-large-tagger-v3
Loading pretrained weights from Hugging Face hub (SmilingWolf/wd-vit-large-tagger-v3)
[SmilingWolf/wd-vit-large-tagger-v3] Safe alternative available for 'pytorch_model.bin' (as 'model.safetensors'). Loading weights using safetensors.
Successfully verified wd14 model
All models verified/downloaded
Initializing tagger pipeline...
[blue]Starting pipeline test[/]
Input directory: [cyan]/Users/rob/repos/kalliste/test_images_input[/]
Output directory: [cyan]/Users/rob/repos/kalliste/test_images_output[/]
[green]Initializing BatchProcessor[/]
Initializing BatchProcessor with input_root=/Users/rob/repos/kalliste/test_images_input, output_root=/Users/rob/repos/kalliste/test_images_output
Scanning for batches in /Users/rob/repos/kalliste/test_images_input
Initializing Batch with input_path=/Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2, max_concurrent=3
Scanning for images in /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2
Found 1 images to process in batch 20180312_Photoshoot2
Found 1 batches to process
BatchProcessor created
Initializing models
Initializing BatchProcessor and model registry
Starting model registry initialization
Checking and downloading models if needed
Verifying detection models
YOLO model already cached: yolov8n.pt
YOLO model already cached: yolov8n-face.pt
Verifying classification models
Verifying blip2 model: Salesforce/blip2-opt-2.7b
Successfully verified blip2 model
Verifying orientation model: LucyintheSky/pose-estimation-front-side-back
Successfully verified orientation model
Verifying wd14 model: SmilingWolf/wd-vit-large-tagger-v3
[yellow]Pipeline test interrupted by user[/]
[blue]Starting pipeline test[/]
Input directory: [cyan]/Users/rob/repos/kalliste/test_images_input[/]
Output directory: [cyan]/Users/rob/repos/kalliste/test_images_output[/]
[green]Initializing BatchProcessor[/]
Initializing BatchProcessor with input_root=/Users/rob/repos/kalliste/test_images_input, output_root=/Users/rob/repos/kalliste/test_images_output
Scanning for batches in /Users/rob/repos/kalliste/test_images_input
Initializing Batch with input_path=/Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2, max_concurrent=3
Scanning for images in /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2
Found 1 images to process in batch 20180312_Photoshoot2
Found 1 batches to process
BatchProcessor created
Initializing models
Initializing BatchProcessor and model registry
Starting model registry initialization
Checking and downloading models if needed
Verifying detection models
YOLO model already cached: yolov8n.pt
YOLO model already cached: yolov8n-face.pt
Verifying classification models
Verifying blip2 model: Salesforce/blip2-opt-2.7b
Successfully verified blip2 model
Verifying orientation model: LucyintheSky/pose-estimation-front-side-back
Successfully verified orientation model
Verifying wd14 model: SmilingWolf/wd-vit-large-tagger-v3
[yellow]Pipeline test interrupted by user[/]
[blue]Starting pipeline test[/]
Input directory: [cyan]/Users/rob/repos/kalliste/test_images_input[/]
Output directory: [cyan]/Users/rob/repos/kalliste/test_images_output[/]
[green]Initializing BatchProcessor[/]
Initializing BatchProcessor with input_root=/Users/rob/repos/kalliste/test_images_input, output_root=/Users/rob/repos/kalliste/test_images_output
Scanning for batches in /Users/rob/repos/kalliste/test_images_input
Initializing Batch with input_path=/Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2, max_concurrent=3
Scanning for images in /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2
Found 1 images to process in batch 20180312_Photoshoot2
Found 1 batches to process
BatchProcessor created
Initializing models
Initializing BatchProcessor and model registry
Starting model registry initialization
Checking and downloading models if needed
Verifying detection models
YOLO model already cached: ultralytics/yolov8n
Downloading YOLO model: ultralytics/yolov8n-face
Failed to verify/download face model: 'ultralytics/yolov8n-face' does not exist
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/model/model_download_manager.py", line 38, in _ensure_detection_models
    YOLO(model_path)
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/models/yolo/model.py", line 23, in __init__
    super().__init__(model=model, task=task, verbose=verbose)
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/engine/model.py", line 152, in __init__
    self._load(model, task=task)
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/engine/model.py", line 246, in _load
    weights = checks.check_file(weights)  # runs in all cases, not redundant with above call
              ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/utils/checks.py", line 509, in check_file
    raise FileNotFoundError(f"'{file}' does not exist")
FileNotFoundError: 'ultralytics/yolov8n-face' does not exist
Failed to verify/download models: 'ultralytics/yolov8n-face' does not exist
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/model/model_download_manager.py", line 21, in download_all
    await self._ensure_detection_models()
  File "/Users/rob/repos/kalliste/kalliste/model/model_download_manager.py", line 38, in _ensure_detection_models
    YOLO(model_path)
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/models/yolo/model.py", line 23, in __init__
    super().__init__(model=model, task=task, verbose=verbose)
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/engine/model.py", line 152, in __init__
    self._load(model, task=task)
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/engine/model.py", line 246, in _load
    weights = checks.check_file(weights)  # runs in all cases, not redundant with above call
              ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/utils/checks.py", line 509, in check_file
    raise FileNotFoundError(f"'{file}' does not exist")
FileNotFoundError: 'ultralytics/yolov8n-face' does not exist
Failed to initialize models: Model verification failed: 'ultralytics/yolov8n-face' does not exist
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/model/model_download_manager.py", line 21, in download_all
    await self._ensure_detection_models()
  File "/Users/rob/repos/kalliste/kalliste/model/model_download_manager.py", line 38, in _ensure_detection_models
    YOLO(model_path)
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/models/yolo/model.py", line 23, in __init__
    super().__init__(model=model, task=task, verbose=verbose)
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/engine/model.py", line 152, in __init__
    self._load(model, task=task)
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/engine/model.py", line 246, in _load
    weights = checks.check_file(weights)  # runs in all cases, not redundant with above call
              ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/utils/checks.py", line 509, in check_file
    raise FileNotFoundError(f"'{file}' does not exist")
FileNotFoundError: 'ultralytics/yolov8n-face' does not exist

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/model/model_registry.py", line 28, in initialize
    await downloader.download_all()
  File "/Users/rob/repos/kalliste/kalliste/model/model_download_manager.py", line 26, in download_all
    raise RuntimeError(f"Model verification failed: {str(e)}") from e
RuntimeError: Model verification failed: 'ultralytics/yolov8n-face' does not exist
Starting model registry cleanup
[yellow]Pipeline test interrupted by user[/]
[blue]Starting pipeline test[/]
Input directory: [cyan]/Users/rob/repos/kalliste/test_images_input[/]
Output directory: [cyan]/Users/rob/repos/kalliste/test_images_output[/]
[green]Initializing BatchProcessor[/]
Initializing BatchProcessor with input_root=/Users/rob/repos/kalliste/test_images_input, output_root=/Users/rob/repos/kalliste/test_images_output
Scanning for batches in /Users/rob/repos/kalliste/test_images_input
Initializing Batch with input_path=/Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2, max_concurrent=3
Scanning for images in /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2
Found 1 images to process in batch 20180312_Photoshoot2
Found 1 batches to process
BatchProcessor created
Initializing models
Initializing BatchProcessor and model registry
Starting model registry initialization
Checking and downloading models if needed
Verifying detection models
YOLO model already cached: ultralytics/yolov8n
Failed to verify/download face model: name 'hf_hub_download' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/model/model_download_manager.py", line 44, in _ensure_detection_models
    hf_hub_download,
    ^^^^^^^^^^^^^^^
NameError: name 'hf_hub_download' is not defined
Failed to verify/download models: name 'hf_hub_download' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/model/model_download_manager.py", line 22, in download_all
    await self._ensure_detection_models()
  File "/Users/rob/repos/kalliste/kalliste/model/model_download_manager.py", line 44, in _ensure_detection_models
    hf_hub_download,
    ^^^^^^^^^^^^^^^
NameError: name 'hf_hub_download' is not defined
Failed to initialize models: Model verification failed: name 'hf_hub_download' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/model/model_download_manager.py", line 22, in download_all
    await self._ensure_detection_models()
  File "/Users/rob/repos/kalliste/kalliste/model/model_download_manager.py", line 44, in _ensure_detection_models
    hf_hub_download,
    ^^^^^^^^^^^^^^^
NameError: name 'hf_hub_download' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/model/model_registry.py", line 28, in initialize
    await downloader.download_all()
  File "/Users/rob/repos/kalliste/kalliste/model/model_download_manager.py", line 27, in download_all
    raise RuntimeError(f"Model verification failed: {str(e)}") from e
RuntimeError: Model verification failed: name 'hf_hub_download' is not defined
Starting model registry cleanup
[yellow]Pipeline test interrupted by user[/]
[blue]Starting pipeline test[/]
Input directory: [cyan]/Users/rob/repos/kalliste/test_images_input[/]
Output directory: [cyan]/Users/rob/repos/kalliste/test_images_output[/]
[green]Initializing BatchProcessor[/]
Initializing BatchProcessor with input_root=/Users/rob/repos/kalliste/test_images_input, output_root=/Users/rob/repos/kalliste/test_images_output
Scanning for batches in /Users/rob/repos/kalliste/test_images_input
Initializing Batch with input_path=/Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2, max_concurrent=3
Scanning for images in /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2
Found 1 images to process in batch 20180312_Photoshoot2
Found 1 batches to process
BatchProcessor created
Initializing models
Initializing BatchProcessor and model registry
Starting model registry initialization
Checking and downloading models if needed
Verifying detection models
YOLO model already cached: ultralytics/yolov8n
Failed to verify/download face model: name 'hf_hub_download' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/model/model_download_manager.py", line 44, in _ensure_detection_models
    hf_hub_download,
    ^^^^^^^^^^^^^^^
NameError: name 'hf_hub_download' is not defined
Failed to verify/download models: name 'hf_hub_download' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/model/model_download_manager.py", line 22, in download_all
    await self._ensure_detection_models()
  File "/Users/rob/repos/kalliste/kalliste/model/model_download_manager.py", line 44, in _ensure_detection_models
    hf_hub_download,
    ^^^^^^^^^^^^^^^
NameError: name 'hf_hub_download' is not defined
Failed to initialize models: Model verification failed: name 'hf_hub_download' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/model/model_download_manager.py", line 22, in download_all
    await self._ensure_detection_models()
  File "/Users/rob/repos/kalliste/kalliste/model/model_download_manager.py", line 44, in _ensure_detection_models
    hf_hub_download,
    ^^^^^^^^^^^^^^^
NameError: name 'hf_hub_download' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/model/model_registry.py", line 28, in initialize
    await downloader.download_all()
  File "/Users/rob/repos/kalliste/kalliste/model/model_download_manager.py", line 27, in download_all
    raise RuntimeError(f"Model verification failed: {str(e)}") from e
RuntimeError: Model verification failed: name 'hf_hub_download' is not defined
Starting model registry cleanup
[yellow]Pipeline test interrupted by user[/]
[blue]Starting pipeline test[/]
Input directory: [cyan]/Users/rob/repos/kalliste/test_images_input[/]
Output directory: [cyan]/Users/rob/repos/kalliste/test_images_output[/]
[green]Initializing BatchProcessor[/]
Initializing BatchProcessor with input_root=/Users/rob/repos/kalliste/test_images_input, output_root=/Users/rob/repos/kalliste/test_images_output
Scanning for batches in /Users/rob/repos/kalliste/test_images_input
Initializing Batch with input_path=/Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2, max_concurrent=3
Scanning for images in /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2
Found 1 images to process in batch 20180312_Photoshoot2
Found 1 batches to process
BatchProcessor created
Initializing models
Initializing BatchProcessor and model registry
Starting model registry initialization
Checking and downloading models if needed
Verifying detection models
YOLO model already cached: ultralytics/yolov8n
Downloading face detection model
Failed to verify/download face model: BaseEventLoop.run_in_executor() got an unexpected keyword argument 'repo_type'
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/model/model_download_manager.py", line 44, in _ensure_detection_models
    YOLO(str(face_model_path))
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/models/yolo/model.py", line 23, in __init__
    super().__init__(model=model, task=task, verbose=verbose)
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/engine/model.py", line 152, in __init__
    self._load(model, task=task)
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/engine/model.py", line 241, in _load
    self.model, self.ckpt = attempt_load_one_weight(weights)
                            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/nn/tasks.py", line 806, in attempt_load_one_weight
    ckpt, weight = torch_safe_load(weight)  # load ckpt
                   ^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/nn/tasks.py", line 732, in torch_safe_load
    ckpt = torch.load(file, map_location="cpu")
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/torch/serialization.py", line 1319, in load
    with _open_file_like(f, "rb") as opened_file:
         ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/torch/serialization.py", line 659, in _open_file_like
    return _open_file(name_or_buffer, mode)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/torch/serialization.py", line 640, in __init__
    super().__init__(open(name, mode))
                     ^^^^^^^^^^^^^^^^
FileNotFoundError: [Errno 2] No such file or directory: '/Users/rob/.cache/ultralytics/yolov8n-face.pt'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/model/model_download_manager.py", line 49, in _ensure_detection_models
    temp_path = await asyncio.get_event_loop().run_in_executor(
                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: BaseEventLoop.run_in_executor() got an unexpected keyword argument 'repo_type'
Failed to verify/download models: BaseEventLoop.run_in_executor() got an unexpected keyword argument 'repo_type'
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/model/model_download_manager.py", line 44, in _ensure_detection_models
    YOLO(str(face_model_path))
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/models/yolo/model.py", line 23, in __init__
    super().__init__(model=model, task=task, verbose=verbose)
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/engine/model.py", line 152, in __init__
    self._load(model, task=task)
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/engine/model.py", line 241, in _load
    self.model, self.ckpt = attempt_load_one_weight(weights)
                            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/nn/tasks.py", line 806, in attempt_load_one_weight
    ckpt, weight = torch_safe_load(weight)  # load ckpt
                   ^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/nn/tasks.py", line 732, in torch_safe_load
    ckpt = torch.load(file, map_location="cpu")
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/torch/serialization.py", line 1319, in load
    with _open_file_like(f, "rb") as opened_file:
         ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/torch/serialization.py", line 659, in _open_file_like
    return _open_file(name_or_buffer, mode)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/torch/serialization.py", line 640, in __init__
    super().__init__(open(name, mode))
                     ^^^^^^^^^^^^^^^^
FileNotFoundError: [Errno 2] No such file or directory: '/Users/rob/.cache/ultralytics/yolov8n-face.pt'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/model/model_download_manager.py", line 23, in download_all
    await self._ensure_detection_models()
  File "/Users/rob/repos/kalliste/kalliste/model/model_download_manager.py", line 49, in _ensure_detection_models
    temp_path = await asyncio.get_event_loop().run_in_executor(
                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: BaseEventLoop.run_in_executor() got an unexpected keyword argument 'repo_type'
Failed to initialize models: Model verification failed: BaseEventLoop.run_in_executor() got an unexpected keyword argument 'repo_type'
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/model/model_download_manager.py", line 44, in _ensure_detection_models
    YOLO(str(face_model_path))
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/models/yolo/model.py", line 23, in __init__
    super().__init__(model=model, task=task, verbose=verbose)
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/engine/model.py", line 152, in __init__
    self._load(model, task=task)
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/engine/model.py", line 241, in _load
    self.model, self.ckpt = attempt_load_one_weight(weights)
                            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/nn/tasks.py", line 806, in attempt_load_one_weight
    ckpt, weight = torch_safe_load(weight)  # load ckpt
                   ^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/nn/tasks.py", line 732, in torch_safe_load
    ckpt = torch.load(file, map_location="cpu")
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/torch/serialization.py", line 1319, in load
    with _open_file_like(f, "rb") as opened_file:
         ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/torch/serialization.py", line 659, in _open_file_like
    return _open_file(name_or_buffer, mode)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/torch/serialization.py", line 640, in __init__
    super().__init__(open(name, mode))
                     ^^^^^^^^^^^^^^^^
FileNotFoundError: [Errno 2] No such file or directory: '/Users/rob/.cache/ultralytics/yolov8n-face.pt'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/model/model_download_manager.py", line 23, in download_all
    await self._ensure_detection_models()
  File "/Users/rob/repos/kalliste/kalliste/model/model_download_manager.py", line 49, in _ensure_detection_models
    temp_path = await asyncio.get_event_loop().run_in_executor(
                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: BaseEventLoop.run_in_executor() got an unexpected keyword argument 'repo_type'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/model/model_registry.py", line 28, in initialize
    await downloader.download_all()
  File "/Users/rob/repos/kalliste/kalliste/model/model_download_manager.py", line 28, in download_all
    raise RuntimeError(f"Model verification failed: {str(e)}") from e
RuntimeError: Model verification failed: BaseEventLoop.run_in_executor() got an unexpected keyword argument 'repo_type'
Starting model registry cleanup
[yellow]Pipeline test interrupted by user[/]
[blue]Starting pipeline test[/]
Input directory: [cyan]/Users/rob/repos/kalliste/test_images_input[/]
Output directory: [cyan]/Users/rob/repos/kalliste/test_images_output[/]
[green]Initializing BatchProcessor[/]
Initializing BatchProcessor with input_root=/Users/rob/repos/kalliste/test_images_input, output_root=/Users/rob/repos/kalliste/test_images_output
Scanning for batches in /Users/rob/repos/kalliste/test_images_input
Initializing Batch with input_path=/Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2, max_concurrent=3
Scanning for images in /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2
Found 1 images to process in batch 20180312_Photoshoot2
Found 1 batches to process
BatchProcessor created
Initializing models
Initializing BatchProcessor and model registry
Starting model registry initialization
Checking and downloading models if needed
Verifying detection models
YOLO model already cached: ultralytics/yolov8n
Downloading face detection model
Failed to verify/download face model: BaseEventLoop.run_in_executor() got an unexpected keyword argument 'repo_type'
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/model/model_download_manager.py", line 44, in _ensure_detection_models
    YOLO(str(face_model_path))
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/models/yolo/model.py", line 23, in __init__
    super().__init__(model=model, task=task, verbose=verbose)
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/engine/model.py", line 152, in __init__
    self._load(model, task=task)
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/engine/model.py", line 241, in _load
    self.model, self.ckpt = attempt_load_one_weight(weights)
                            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/nn/tasks.py", line 806, in attempt_load_one_weight
    ckpt, weight = torch_safe_load(weight)  # load ckpt
                   ^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/nn/tasks.py", line 732, in torch_safe_load
    ckpt = torch.load(file, map_location="cpu")
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/torch/serialization.py", line 1319, in load
    with _open_file_like(f, "rb") as opened_file:
         ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/torch/serialization.py", line 659, in _open_file_like
    return _open_file(name_or_buffer, mode)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/torch/serialization.py", line 640, in __init__
    super().__init__(open(name, mode))
                     ^^^^^^^^^^^^^^^^
FileNotFoundError: [Errno 2] No such file or directory: '/Users/rob/.cache/ultralytics/yolov8n-face.pt'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/model/model_download_manager.py", line 49, in _ensure_detection_models
    temp_path = await asyncio.get_event_loop().run_in_executor(
                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: BaseEventLoop.run_in_executor() got an unexpected keyword argument 'repo_type'
Failed to verify/download models: BaseEventLoop.run_in_executor() got an unexpected keyword argument 'repo_type'
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/model/model_download_manager.py", line 44, in _ensure_detection_models
    YOLO(str(face_model_path))
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/models/yolo/model.py", line 23, in __init__
    super().__init__(model=model, task=task, verbose=verbose)
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/engine/model.py", line 152, in __init__
    self._load(model, task=task)
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/engine/model.py", line 241, in _load
    self.model, self.ckpt = attempt_load_one_weight(weights)
                            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/nn/tasks.py", line 806, in attempt_load_one_weight
    ckpt, weight = torch_safe_load(weight)  # load ckpt
                   ^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/nn/tasks.py", line 732, in torch_safe_load
    ckpt = torch.load(file, map_location="cpu")
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/torch/serialization.py", line 1319, in load
    with _open_file_like(f, "rb") as opened_file:
         ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/torch/serialization.py", line 659, in _open_file_like
    return _open_file(name_or_buffer, mode)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/torch/serialization.py", line 640, in __init__
    super().__init__(open(name, mode))
                     ^^^^^^^^^^^^^^^^
FileNotFoundError: [Errno 2] No such file or directory: '/Users/rob/.cache/ultralytics/yolov8n-face.pt'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/model/model_download_manager.py", line 23, in download_all
    await self._ensure_detection_models()
  File "/Users/rob/repos/kalliste/kalliste/model/model_download_manager.py", line 49, in _ensure_detection_models
    temp_path = await asyncio.get_event_loop().run_in_executor(
                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: BaseEventLoop.run_in_executor() got an unexpected keyword argument 'repo_type'
Failed to initialize models: Model verification failed: BaseEventLoop.run_in_executor() got an unexpected keyword argument 'repo_type'
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/model/model_download_manager.py", line 44, in _ensure_detection_models
    YOLO(str(face_model_path))
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/models/yolo/model.py", line 23, in __init__
    super().__init__(model=model, task=task, verbose=verbose)
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/engine/model.py", line 152, in __init__
    self._load(model, task=task)
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/engine/model.py", line 241, in _load
    self.model, self.ckpt = attempt_load_one_weight(weights)
                            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/nn/tasks.py", line 806, in attempt_load_one_weight
    ckpt, weight = torch_safe_load(weight)  # load ckpt
                   ^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/nn/tasks.py", line 732, in torch_safe_load
    ckpt = torch.load(file, map_location="cpu")
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/torch/serialization.py", line 1319, in load
    with _open_file_like(f, "rb") as opened_file:
         ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/torch/serialization.py", line 659, in _open_file_like
    return _open_file(name_or_buffer, mode)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/torch/serialization.py", line 640, in __init__
    super().__init__(open(name, mode))
                     ^^^^^^^^^^^^^^^^
FileNotFoundError: [Errno 2] No such file or directory: '/Users/rob/.cache/ultralytics/yolov8n-face.pt'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/model/model_download_manager.py", line 23, in download_all
    await self._ensure_detection_models()
  File "/Users/rob/repos/kalliste/kalliste/model/model_download_manager.py", line 49, in _ensure_detection_models
    temp_path = await asyncio.get_event_loop().run_in_executor(
                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: BaseEventLoop.run_in_executor() got an unexpected keyword argument 'repo_type'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/model/model_registry.py", line 28, in initialize
    await downloader.download_all()
  File "/Users/rob/repos/kalliste/kalliste/model/model_download_manager.py", line 28, in download_all
    raise RuntimeError(f"Model verification failed: {str(e)}") from e
RuntimeError: Model verification failed: BaseEventLoop.run_in_executor() got an unexpected keyword argument 'repo_type'
Starting model registry cleanup
[yellow]Pipeline test interrupted by user[/]
[blue]Starting pipeline test[/]
Input directory: [cyan]/Users/rob/repos/kalliste/test_images_input[/]
Output directory: [cyan]/Users/rob/repos/kalliste/test_images_output[/]
[green]Initializing BatchProcessor[/]
Initializing BatchProcessor with input_root=/Users/rob/repos/kalliste/test_images_input, output_root=/Users/rob/repos/kalliste/test_images_output
Scanning for batches in /Users/rob/repos/kalliste/test_images_input
Initializing Batch with input_path=/Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2, max_concurrent=3
Scanning for images in /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2
Found 1 images to process in batch 20180312_Photoshoot2
Found 1 batches to process
BatchProcessor created
Initializing models
Initializing BatchProcessor and model registry
Starting model registry initialization
Checking and downloading models if needed
Verifying detection models
YOLO model already cached: ultralytics/yolov8n
Downloading face detection model
Failed to verify/download face model: 404 Client Error. (Request ID: Root=1-676da107-0748486746a78d9a47fceeb6;5abaf416-e30d-48b6-944b-9654a582e286)

Repository Not Found for url: https://huggingface.co/Bingsu/yolov8n-face/resolve/main/yolov8n-face.pt.
Please make sure you specified the correct `repo_id` and `repo_type`.
If you are trying to access a private or gated repo, make sure you are authenticated.
Traceback (most recent call last):
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/huggingface_hub/utils/_http.py", line 406, in hf_raise_for_status
    response.raise_for_status()
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/requests/models.py", line 1024, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 404 Client Error: Not Found for url: https://huggingface.co/Bingsu/yolov8n-face/resolve/main/yolov8n-face.pt

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/model/model_download_manager.py", line 49, in _ensure_detection_models
    temp_path = await asyncio.get_event_loop().run_in_executor(
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/model/model_download_manager.py", line 51, in <lambda>
    lambda: hf_hub_download(
            ^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/huggingface_hub/utils/_validators.py", line 114, in _inner_fn
    return fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/huggingface_hub/file_download.py", line 860, in hf_hub_download
    return _hf_hub_download_to_cache_dir(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/huggingface_hub/file_download.py", line 967, in _hf_hub_download_to_cache_dir
    _raise_on_head_call_error(head_call_error, force_download, local_files_only)
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/huggingface_hub/file_download.py", line 1482, in _raise_on_head_call_error
    raise head_call_error
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/huggingface_hub/file_download.py", line 1374, in _get_metadata_or_catch_error
    metadata = get_hf_file_metadata(
               ^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/huggingface_hub/utils/_validators.py", line 114, in _inner_fn
    return fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/huggingface_hub/file_download.py", line 1294, in get_hf_file_metadata
    r = _request_wrapper(
        ^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/huggingface_hub/file_download.py", line 278, in _request_wrapper
    response = _request_wrapper(
               ^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/huggingface_hub/file_download.py", line 302, in _request_wrapper
    hf_raise_for_status(response)
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/huggingface_hub/utils/_http.py", line 454, in hf_raise_for_status
    raise _format(RepositoryNotFoundError, message, response) from e
huggingface_hub.errors.RepositoryNotFoundError: 404 Client Error. (Request ID: Root=1-676da107-0748486746a78d9a47fceeb6;5abaf416-e30d-48b6-944b-9654a582e286)

Repository Not Found for url: https://huggingface.co/Bingsu/yolov8n-face/resolve/main/yolov8n-face.pt.
Please make sure you specified the correct `repo_id` and `repo_type`.
If you are trying to access a private or gated repo, make sure you are authenticated.
Failed to verify/download models: 404 Client Error. (Request ID: Root=1-676da107-0748486746a78d9a47fceeb6;5abaf416-e30d-48b6-944b-9654a582e286)

Repository Not Found for url: https://huggingface.co/Bingsu/yolov8n-face/resolve/main/yolov8n-face.pt.
Please make sure you specified the correct `repo_id` and `repo_type`.
If you are trying to access a private or gated repo, make sure you are authenticated.
Traceback (most recent call last):
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/huggingface_hub/utils/_http.py", line 406, in hf_raise_for_status
    response.raise_for_status()
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/requests/models.py", line 1024, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 404 Client Error: Not Found for url: https://huggingface.co/Bingsu/yolov8n-face/resolve/main/yolov8n-face.pt

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/model/model_download_manager.py", line 23, in download_all
    await self._ensure_detection_models()
  File "/Users/rob/repos/kalliste/kalliste/model/model_download_manager.py", line 49, in _ensure_detection_models
    temp_path = await asyncio.get_event_loop().run_in_executor(
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/model/model_download_manager.py", line 51, in <lambda>
    lambda: hf_hub_download(
            ^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/huggingface_hub/utils/_validators.py", line 114, in _inner_fn
    return fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/huggingface_hub/file_download.py", line 860, in hf_hub_download
    return _hf_hub_download_to_cache_dir(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/huggingface_hub/file_download.py", line 967, in _hf_hub_download_to_cache_dir
    _raise_on_head_call_error(head_call_error, force_download, local_files_only)
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/huggingface_hub/file_download.py", line 1482, in _raise_on_head_call_error
    raise head_call_error
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/huggingface_hub/file_download.py", line 1374, in _get_metadata_or_catch_error
    metadata = get_hf_file_metadata(
               ^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/huggingface_hub/utils/_validators.py", line 114, in _inner_fn
    return fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/huggingface_hub/file_download.py", line 1294, in get_hf_file_metadata
    r = _request_wrapper(
        ^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/huggingface_hub/file_download.py", line 278, in _request_wrapper
    response = _request_wrapper(
               ^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/huggingface_hub/file_download.py", line 302, in _request_wrapper
    hf_raise_for_status(response)
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/huggingface_hub/utils/_http.py", line 454, in hf_raise_for_status
    raise _format(RepositoryNotFoundError, message, response) from e
huggingface_hub.errors.RepositoryNotFoundError: 404 Client Error. (Request ID: Root=1-676da107-0748486746a78d9a47fceeb6;5abaf416-e30d-48b6-944b-9654a582e286)

Repository Not Found for url: https://huggingface.co/Bingsu/yolov8n-face/resolve/main/yolov8n-face.pt.
Please make sure you specified the correct `repo_id` and `repo_type`.
If you are trying to access a private or gated repo, make sure you are authenticated.
Failed to initialize models: Model verification failed: 404 Client Error. (Request ID: Root=1-676da107-0748486746a78d9a47fceeb6;5abaf416-e30d-48b6-944b-9654a582e286)

Repository Not Found for url: https://huggingface.co/Bingsu/yolov8n-face/resolve/main/yolov8n-face.pt.
Please make sure you specified the correct `repo_id` and `repo_type`.
If you are trying to access a private or gated repo, make sure you are authenticated.
Traceback (most recent call last):
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/huggingface_hub/utils/_http.py", line 406, in hf_raise_for_status
    response.raise_for_status()
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/requests/models.py", line 1024, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 404 Client Error: Not Found for url: https://huggingface.co/Bingsu/yolov8n-face/resolve/main/yolov8n-face.pt

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/model/model_download_manager.py", line 23, in download_all
    await self._ensure_detection_models()
  File "/Users/rob/repos/kalliste/kalliste/model/model_download_manager.py", line 49, in _ensure_detection_models
    temp_path = await asyncio.get_event_loop().run_in_executor(
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/model/model_download_manager.py", line 51, in <lambda>
    lambda: hf_hub_download(
            ^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/huggingface_hub/utils/_validators.py", line 114, in _inner_fn
    return fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/huggingface_hub/file_download.py", line 860, in hf_hub_download
    return _hf_hub_download_to_cache_dir(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/huggingface_hub/file_download.py", line 967, in _hf_hub_download_to_cache_dir
    _raise_on_head_call_error(head_call_error, force_download, local_files_only)
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/huggingface_hub/file_download.py", line 1482, in _raise_on_head_call_error
    raise head_call_error
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/huggingface_hub/file_download.py", line 1374, in _get_metadata_or_catch_error
    metadata = get_hf_file_metadata(
               ^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/huggingface_hub/utils/_validators.py", line 114, in _inner_fn
    return fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/huggingface_hub/file_download.py", line 1294, in get_hf_file_metadata
    r = _request_wrapper(
        ^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/huggingface_hub/file_download.py", line 278, in _request_wrapper
    response = _request_wrapper(
               ^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/huggingface_hub/file_download.py", line 302, in _request_wrapper
    hf_raise_for_status(response)
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/huggingface_hub/utils/_http.py", line 454, in hf_raise_for_status
    raise _format(RepositoryNotFoundError, message, response) from e
huggingface_hub.errors.RepositoryNotFoundError: 404 Client Error. (Request ID: Root=1-676da107-0748486746a78d9a47fceeb6;5abaf416-e30d-48b6-944b-9654a582e286)

Repository Not Found for url: https://huggingface.co/Bingsu/yolov8n-face/resolve/main/yolov8n-face.pt.
Please make sure you specified the correct `repo_id` and `repo_type`.
If you are trying to access a private or gated repo, make sure you are authenticated.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/model/model_registry.py", line 28, in initialize
    await downloader.download_all()
  File "/Users/rob/repos/kalliste/kalliste/model/model_download_manager.py", line 28, in download_all
    raise RuntimeError(f"Model verification failed: {str(e)}") from e
RuntimeError: Model verification failed: 404 Client Error. (Request ID: Root=1-676da107-0748486746a78d9a47fceeb6;5abaf416-e30d-48b6-944b-9654a582e286)

Repository Not Found for url: https://huggingface.co/Bingsu/yolov8n-face/resolve/main/yolov8n-face.pt.
Please make sure you specified the correct `repo_id` and `repo_type`.
If you are trying to access a private or gated repo, make sure you are authenticated.
Starting model registry cleanup
[yellow]Pipeline test interrupted by user[/]
[blue]Starting pipeline test[/]
Input directory: [cyan]/Users/rob/repos/kalliste/test_images_input[/]
Output directory: [cyan]/Users/rob/repos/kalliste/test_images_output[/]
[green]Initializing BatchProcessor[/]
Initializing BatchProcessor with input_root=/Users/rob/repos/kalliste/test_images_input, output_root=/Users/rob/repos/kalliste/test_images_output
Scanning for batches in /Users/rob/repos/kalliste/test_images_input
Initializing Batch with input_path=/Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2, max_concurrent=3
Scanning for images in /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2
Found 1 images to process in batch 20180312_Photoshoot2
Found 1 batches to process
BatchProcessor created
Initializing models
Initializing BatchProcessor and model registry
Starting model registry initialization
Checking and downloading models if needed
Verifying detection model
Failed to verify/download YOLO model: [Errno 2] No such file or directory: 'yolo11x.pt'
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/model/model_download_manager.py", line 35, in _ensure_detection_models
    await asyncio.get_event_loop().run_in_executor(
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/models/yolo/model.py", line 23, in __init__
    super().__init__(model=model, task=task, verbose=verbose)
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/engine/model.py", line 152, in __init__
    self._load(model, task=task)
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/engine/model.py", line 241, in _load
    self.model, self.ckpt = attempt_load_one_weight(weights)
                            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/nn/tasks.py", line 806, in attempt_load_one_weight
    ckpt, weight = torch_safe_load(weight)  # load ckpt
                   ^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/nn/tasks.py", line 732, in torch_safe_load
    ckpt = torch.load(file, map_location="cpu")
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/torch/serialization.py", line 1319, in load
    with _open_file_like(f, "rb") as opened_file:
         ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/torch/serialization.py", line 659, in _open_file_like
    return _open_file(name_or_buffer, mode)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/torch/serialization.py", line 640, in __init__
    super().__init__(open(name, mode))
                     ^^^^^^^^^^^^^^^^
FileNotFoundError: [Errno 2] No such file or directory: 'yolo11x.pt'
Failed to verify/download models: [Errno 2] No such file or directory: 'yolo11x.pt'
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/model/model_download_manager.py", line 23, in download_all
    await self._ensure_detection_models()
  File "/Users/rob/repos/kalliste/kalliste/model/model_download_manager.py", line 35, in _ensure_detection_models
    await asyncio.get_event_loop().run_in_executor(
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/models/yolo/model.py", line 23, in __init__
    super().__init__(model=model, task=task, verbose=verbose)
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/engine/model.py", line 152, in __init__
    self._load(model, task=task)
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/engine/model.py", line 241, in _load
    self.model, self.ckpt = attempt_load_one_weight(weights)
                            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/nn/tasks.py", line 806, in attempt_load_one_weight
    ckpt, weight = torch_safe_load(weight)  # load ckpt
                   ^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/nn/tasks.py", line 732, in torch_safe_load
    ckpt = torch.load(file, map_location="cpu")
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/torch/serialization.py", line 1319, in load
    with _open_file_like(f, "rb") as opened_file:
         ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/torch/serialization.py", line 659, in _open_file_like
    return _open_file(name_or_buffer, mode)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/torch/serialization.py", line 640, in __init__
    super().__init__(open(name, mode))
                     ^^^^^^^^^^^^^^^^
FileNotFoundError: [Errno 2] No such file or directory: 'yolo11x.pt'
Failed to initialize models: Model verification failed: [Errno 2] No such file or directory: 'yolo11x.pt'
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/model/model_download_manager.py", line 23, in download_all
    await self._ensure_detection_models()
  File "/Users/rob/repos/kalliste/kalliste/model/model_download_manager.py", line 35, in _ensure_detection_models
    await asyncio.get_event_loop().run_in_executor(
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/models/yolo/model.py", line 23, in __init__
    super().__init__(model=model, task=task, verbose=verbose)
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/engine/model.py", line 152, in __init__
    self._load(model, task=task)
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/engine/model.py", line 241, in _load
    self.model, self.ckpt = attempt_load_one_weight(weights)
                            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/nn/tasks.py", line 806, in attempt_load_one_weight
    ckpt, weight = torch_safe_load(weight)  # load ckpt
                   ^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/nn/tasks.py", line 732, in torch_safe_load
    ckpt = torch.load(file, map_location="cpu")
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/torch/serialization.py", line 1319, in load
    with _open_file_like(f, "rb") as opened_file:
         ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/torch/serialization.py", line 659, in _open_file_like
    return _open_file(name_or_buffer, mode)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/torch/serialization.py", line 640, in __init__
    super().__init__(open(name, mode))
                     ^^^^^^^^^^^^^^^^
FileNotFoundError: [Errno 2] No such file or directory: 'yolo11x.pt'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/model/model_registry.py", line 28, in initialize
    await downloader.download_all()
  File "/Users/rob/repos/kalliste/kalliste/model/model_download_manager.py", line 28, in download_all
    raise RuntimeError(f"Model verification failed: {str(e)}") from e
RuntimeError: Model verification failed: [Errno 2] No such file or directory: 'yolo11x.pt'
Starting model registry cleanup
[yellow]Pipeline test interrupted by user[/]
[blue]Starting pipeline test[/]
Input directory: [cyan]/Users/rob/repos/kalliste/test_images_input[/]
Output directory: [cyan]/Users/rob/repos/kalliste/test_images_output[/]
[green]Initializing BatchProcessor[/]
Initializing BatchProcessor with input_root=/Users/rob/repos/kalliste/test_images_input, output_root=/Users/rob/repos/kalliste/test_images_output
Scanning for batches in /Users/rob/repos/kalliste/test_images_input
Initializing Batch with input_path=/Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2, max_concurrent=3
Scanning for images in /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2
Found 1 images to process in batch 20180312_Photoshoot2
Found 1 batches to process
BatchProcessor created
Initializing models
Initializing BatchProcessor and model registry
Starting model registry initialization
Checking and downloading models if needed
Verifying detection model
Failed to verify/download YOLO model: [Errno 2] No such file or directory: 'yolo11x.pt'
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/model/model_download_manager.py", line 35, in _ensure_detection_models
    await asyncio.get_event_loop().run_in_executor(
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/models/yolo/model.py", line 23, in __init__
    super().__init__(model=model, task=task, verbose=verbose)
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/engine/model.py", line 152, in __init__
    self._load(model, task=task)
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/engine/model.py", line 241, in _load
    self.model, self.ckpt = attempt_load_one_weight(weights)
                            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/nn/tasks.py", line 806, in attempt_load_one_weight
    ckpt, weight = torch_safe_load(weight)  # load ckpt
                   ^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/nn/tasks.py", line 732, in torch_safe_load
    ckpt = torch.load(file, map_location="cpu")
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/torch/serialization.py", line 1319, in load
    with _open_file_like(f, "rb") as opened_file:
         ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/torch/serialization.py", line 659, in _open_file_like
    return _open_file(name_or_buffer, mode)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/torch/serialization.py", line 640, in __init__
    super().__init__(open(name, mode))
                     ^^^^^^^^^^^^^^^^
FileNotFoundError: [Errno 2] No such file or directory: 'yolo11x.pt'
Failed to verify/download models: [Errno 2] No such file or directory: 'yolo11x.pt'
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/model/model_download_manager.py", line 23, in download_all
    await self._ensure_detection_models()
  File "/Users/rob/repos/kalliste/kalliste/model/model_download_manager.py", line 35, in _ensure_detection_models
    await asyncio.get_event_loop().run_in_executor(
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/models/yolo/model.py", line 23, in __init__
    super().__init__(model=model, task=task, verbose=verbose)
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/engine/model.py", line 152, in __init__
    self._load(model, task=task)
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/engine/model.py", line 241, in _load
    self.model, self.ckpt = attempt_load_one_weight(weights)
                            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/nn/tasks.py", line 806, in attempt_load_one_weight
    ckpt, weight = torch_safe_load(weight)  # load ckpt
                   ^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/nn/tasks.py", line 732, in torch_safe_load
    ckpt = torch.load(file, map_location="cpu")
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/torch/serialization.py", line 1319, in load
    with _open_file_like(f, "rb") as opened_file:
         ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/torch/serialization.py", line 659, in _open_file_like
    return _open_file(name_or_buffer, mode)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/torch/serialization.py", line 640, in __init__
    super().__init__(open(name, mode))
                     ^^^^^^^^^^^^^^^^
FileNotFoundError: [Errno 2] No such file or directory: 'yolo11x.pt'
Failed to initialize models: Model verification failed: [Errno 2] No such file or directory: 'yolo11x.pt'
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/model/model_download_manager.py", line 23, in download_all
    await self._ensure_detection_models()
  File "/Users/rob/repos/kalliste/kalliste/model/model_download_manager.py", line 35, in _ensure_detection_models
    await asyncio.get_event_loop().run_in_executor(
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/models/yolo/model.py", line 23, in __init__
    super().__init__(model=model, task=task, verbose=verbose)
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/engine/model.py", line 152, in __init__
    self._load(model, task=task)
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/engine/model.py", line 241, in _load
    self.model, self.ckpt = attempt_load_one_weight(weights)
                            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/nn/tasks.py", line 806, in attempt_load_one_weight
    ckpt, weight = torch_safe_load(weight)  # load ckpt
                   ^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/nn/tasks.py", line 732, in torch_safe_load
    ckpt = torch.load(file, map_location="cpu")
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/torch/serialization.py", line 1319, in load
    with _open_file_like(f, "rb") as opened_file:
         ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/torch/serialization.py", line 659, in _open_file_like
    return _open_file(name_or_buffer, mode)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/torch/serialization.py", line 640, in __init__
    super().__init__(open(name, mode))
                     ^^^^^^^^^^^^^^^^
FileNotFoundError: [Errno 2] No such file or directory: 'yolo11x.pt'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/model/model_registry.py", line 28, in initialize
    await downloader.download_all()
  File "/Users/rob/repos/kalliste/kalliste/model/model_download_manager.py", line 28, in download_all
    raise RuntimeError(f"Model verification failed: {str(e)}") from e
RuntimeError: Model verification failed: [Errno 2] No such file or directory: 'yolo11x.pt'
Starting model registry cleanup
[yellow]Pipeline test interrupted by user[/]
[blue]Starting pipeline test[/]
Input directory: [cyan]/Users/rob/repos/kalliste/test_images_input[/]
Output directory: [cyan]/Users/rob/repos/kalliste/test_images_output[/]
[green]Initializing BatchProcessor[/]
Initializing BatchProcessor with input_root=/Users/rob/repos/kalliste/test_images_input, output_root=/Users/rob/repos/kalliste/test_images_output
Scanning for batches in /Users/rob/repos/kalliste/test_images_input
Initializing Batch with input_path=/Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2, max_concurrent=3
Scanning for images in /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2
Found 1 images to process in batch 20180312_Photoshoot2
Found 1 batches to process
BatchProcessor created
Initializing models
Initializing BatchProcessor and model registry
Starting model registry initialization
Checking and downloading models if needed
Verifying detection model
Failed to verify/download YOLO model: [Errno 2] No such file or directory: 'yolo11x.pt'
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/model/model_download_manager.py", line 35, in _ensure_detection_models
    await asyncio.get_event_loop().run_in_executor(
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/models/yolo/model.py", line 23, in __init__
    super().__init__(model=model, task=task, verbose=verbose)
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/engine/model.py", line 152, in __init__
    self._load(model, task=task)
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/engine/model.py", line 241, in _load
    self.model, self.ckpt = attempt_load_one_weight(weights)
                            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/nn/tasks.py", line 806, in attempt_load_one_weight
    ckpt, weight = torch_safe_load(weight)  # load ckpt
                   ^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/nn/tasks.py", line 732, in torch_safe_load
    ckpt = torch.load(file, map_location="cpu")
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/torch/serialization.py", line 1319, in load
    with _open_file_like(f, "rb") as opened_file:
         ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/torch/serialization.py", line 659, in _open_file_like
    return _open_file(name_or_buffer, mode)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/torch/serialization.py", line 640, in __init__
    super().__init__(open(name, mode))
                     ^^^^^^^^^^^^^^^^
FileNotFoundError: [Errno 2] No such file or directory: 'yolo11x.pt'
Failed to verify/download models: [Errno 2] No such file or directory: 'yolo11x.pt'
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/model/model_download_manager.py", line 23, in download_all
    await self._ensure_detection_models()
  File "/Users/rob/repos/kalliste/kalliste/model/model_download_manager.py", line 35, in _ensure_detection_models
    await asyncio.get_event_loop().run_in_executor(
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/models/yolo/model.py", line 23, in __init__
    super().__init__(model=model, task=task, verbose=verbose)
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/engine/model.py", line 152, in __init__
    self._load(model, task=task)
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/engine/model.py", line 241, in _load
    self.model, self.ckpt = attempt_load_one_weight(weights)
                            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/nn/tasks.py", line 806, in attempt_load_one_weight
    ckpt, weight = torch_safe_load(weight)  # load ckpt
                   ^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/nn/tasks.py", line 732, in torch_safe_load
    ckpt = torch.load(file, map_location="cpu")
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/torch/serialization.py", line 1319, in load
    with _open_file_like(f, "rb") as opened_file:
         ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/torch/serialization.py", line 659, in _open_file_like
    return _open_file(name_or_buffer, mode)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/torch/serialization.py", line 640, in __init__
    super().__init__(open(name, mode))
                     ^^^^^^^^^^^^^^^^
FileNotFoundError: [Errno 2] No such file or directory: 'yolo11x.pt'
Failed to initialize models: Model verification failed: [Errno 2] No such file or directory: 'yolo11x.pt'
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/model/model_download_manager.py", line 23, in download_all
    await self._ensure_detection_models()
  File "/Users/rob/repos/kalliste/kalliste/model/model_download_manager.py", line 35, in _ensure_detection_models
    await asyncio.get_event_loop().run_in_executor(
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/models/yolo/model.py", line 23, in __init__
    super().__init__(model=model, task=task, verbose=verbose)
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/engine/model.py", line 152, in __init__
    self._load(model, task=task)
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/engine/model.py", line 241, in _load
    self.model, self.ckpt = attempt_load_one_weight(weights)
                            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/nn/tasks.py", line 806, in attempt_load_one_weight
    ckpt, weight = torch_safe_load(weight)  # load ckpt
                   ^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/nn/tasks.py", line 732, in torch_safe_load
    ckpt = torch.load(file, map_location="cpu")
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/torch/serialization.py", line 1319, in load
    with _open_file_like(f, "rb") as opened_file:
         ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/torch/serialization.py", line 659, in _open_file_like
    return _open_file(name_or_buffer, mode)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/torch/serialization.py", line 640, in __init__
    super().__init__(open(name, mode))
                     ^^^^^^^^^^^^^^^^
FileNotFoundError: [Errno 2] No such file or directory: 'yolo11x.pt'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/model/model_registry.py", line 28, in initialize
    await downloader.download_all()
  File "/Users/rob/repos/kalliste/kalliste/model/model_download_manager.py", line 28, in download_all
    raise RuntimeError(f"Model verification failed: {str(e)}") from e
RuntimeError: Model verification failed: [Errno 2] No such file or directory: 'yolo11x.pt'
Starting model registry cleanup
[yellow]Pipeline test interrupted by user[/]
[blue]Starting pipeline test[/]
Input directory: [cyan]/Users/rob/repos/kalliste/test_images_input[/]
Output directory: [cyan]/Users/rob/repos/kalliste/test_images_output[/]
[green]Initializing BatchProcessor[/]
Initializing BatchProcessor with input_root=/Users/rob/repos/kalliste/test_images_input, output_root=/Users/rob/repos/kalliste/test_images_output
Scanning for batches in /Users/rob/repos/kalliste/test_images_input
Initializing Batch with input_path=/Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2, max_concurrent=3
Scanning for images in /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2
Found 1 images to process in batch 20180312_Photoshoot2
Found 1 batches to process
BatchProcessor created
Initializing models
Initializing BatchProcessor and model registry
Starting model registry initialization
Checking and downloading models if needed
Verifying detection model
Failed to verify/download YOLO model: Can't get attribute 'C3k2' on <module 'ultralytics.nn.modules.block' from '/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/nn/modules/block.py'>
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/model/model_download_manager.py", line 36, in _ensure_detection_models
    await asyncio.get_event_loop().run_in_executor(
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/models/yolo/model.py", line 23, in __init__
    super().__init__(model=model, task=task, verbose=verbose)
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/engine/model.py", line 152, in __init__
    self._load(model, task=task)
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/engine/model.py", line 241, in _load
    self.model, self.ckpt = attempt_load_one_weight(weights)
                            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/nn/tasks.py", line 806, in attempt_load_one_weight
    ckpt, weight = torch_safe_load(weight)  # load ckpt
                   ^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/nn/tasks.py", line 732, in torch_safe_load
    ckpt = torch.load(file, map_location="cpu")
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/torch/serialization.py", line 1360, in load
    return _load(
           ^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/torch/serialization.py", line 1848, in _load
    result = unpickler.load()
             ^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/torch/serialization.py", line 1837, in find_class
    return super().find_class(mod_name, name)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: Can't get attribute 'C3k2' on <module 'ultralytics.nn.modules.block' from '/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/nn/modules/block.py'>
Failed to verify/download models: Can't get attribute 'C3k2' on <module 'ultralytics.nn.modules.block' from '/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/nn/modules/block.py'>
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/model/model_download_manager.py", line 23, in download_all
    await self._ensure_detection_models()
  File "/Users/rob/repos/kalliste/kalliste/model/model_download_manager.py", line 36, in _ensure_detection_models
    await asyncio.get_event_loop().run_in_executor(
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/models/yolo/model.py", line 23, in __init__
    super().__init__(model=model, task=task, verbose=verbose)
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/engine/model.py", line 152, in __init__
    self._load(model, task=task)
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/engine/model.py", line 241, in _load
    self.model, self.ckpt = attempt_load_one_weight(weights)
                            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/nn/tasks.py", line 806, in attempt_load_one_weight
    ckpt, weight = torch_safe_load(weight)  # load ckpt
                   ^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/nn/tasks.py", line 732, in torch_safe_load
    ckpt = torch.load(file, map_location="cpu")
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/torch/serialization.py", line 1360, in load
    return _load(
           ^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/torch/serialization.py", line 1848, in _load
    result = unpickler.load()
             ^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/torch/serialization.py", line 1837, in find_class
    return super().find_class(mod_name, name)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: Can't get attribute 'C3k2' on <module 'ultralytics.nn.modules.block' from '/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/nn/modules/block.py'>
Failed to initialize models: Model verification failed: Can't get attribute 'C3k2' on <module 'ultralytics.nn.modules.block' from '/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/nn/modules/block.py'>
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/model/model_download_manager.py", line 23, in download_all
    await self._ensure_detection_models()
  File "/Users/rob/repos/kalliste/kalliste/model/model_download_manager.py", line 36, in _ensure_detection_models
    await asyncio.get_event_loop().run_in_executor(
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/models/yolo/model.py", line 23, in __init__
    super().__init__(model=model, task=task, verbose=verbose)
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/engine/model.py", line 152, in __init__
    self._load(model, task=task)
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/engine/model.py", line 241, in _load
    self.model, self.ckpt = attempt_load_one_weight(weights)
                            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/nn/tasks.py", line 806, in attempt_load_one_weight
    ckpt, weight = torch_safe_load(weight)  # load ckpt
                   ^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/nn/tasks.py", line 732, in torch_safe_load
    ckpt = torch.load(file, map_location="cpu")
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/torch/serialization.py", line 1360, in load
    return _load(
           ^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/torch/serialization.py", line 1848, in _load
    result = unpickler.load()
             ^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/torch/serialization.py", line 1837, in find_class
    return super().find_class(mod_name, name)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: Can't get attribute 'C3k2' on <module 'ultralytics.nn.modules.block' from '/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/nn/modules/block.py'>

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/model/model_registry.py", line 28, in initialize
    await downloader.download_all()
  File "/Users/rob/repos/kalliste/kalliste/model/model_download_manager.py", line 28, in download_all
    raise RuntimeError(f"Model verification failed: {str(e)}") from e
RuntimeError: Model verification failed: Can't get attribute 'C3k2' on <module 'ultralytics.nn.modules.block' from '/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/nn/modules/block.py'>
Starting model registry cleanup
[yellow]Pipeline test interrupted by user[/]
[blue]Starting pipeline test[/]
Input directory: [cyan]/Users/rob/repos/kalliste/test_images_input[/]
Output directory: [cyan]/Users/rob/repos/kalliste/test_images_output[/]
[green]Initializing BatchProcessor[/]
Initializing BatchProcessor with input_root=/Users/rob/repos/kalliste/test_images_input, output_root=/Users/rob/repos/kalliste/test_images_output
Scanning for batches in /Users/rob/repos/kalliste/test_images_input
Initializing Batch with input_path=/Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2, max_concurrent=3
Scanning for images in /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2
Found 1 images to process in batch 20180312_Photoshoot2
Found 1 batches to process
BatchProcessor created
Initializing models
Initializing BatchProcessor and model registry
Starting model registry initialization
Checking and downloading models if needed
Verifying detection model
Failed to verify/download YOLO model: 'ultralytics/yolo11x' does not exist
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/model/model_download_manager.py", line 36, in _ensure_detection_models
    await asyncio.get_event_loop().run_in_executor(
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/models/yolo/model.py", line 23, in __init__
    super().__init__(model=model, task=task, verbose=verbose)
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/engine/model.py", line 152, in __init__
    self._load(model, task=task)
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/engine/model.py", line 246, in _load
    weights = checks.check_file(weights)  # runs in all cases, not redundant with above call
              ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/utils/checks.py", line 509, in check_file
    raise FileNotFoundError(f"'{file}' does not exist")
FileNotFoundError: 'ultralytics/yolo11x' does not exist
Failed to verify/download models: 'ultralytics/yolo11x' does not exist
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/model/model_download_manager.py", line 23, in download_all
    await self._ensure_detection_models()
  File "/Users/rob/repos/kalliste/kalliste/model/model_download_manager.py", line 36, in _ensure_detection_models
    await asyncio.get_event_loop().run_in_executor(
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/models/yolo/model.py", line 23, in __init__
    super().__init__(model=model, task=task, verbose=verbose)
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/engine/model.py", line 152, in __init__
    self._load(model, task=task)
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/engine/model.py", line 246, in _load
    weights = checks.check_file(weights)  # runs in all cases, not redundant with above call
              ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/utils/checks.py", line 509, in check_file
    raise FileNotFoundError(f"'{file}' does not exist")
FileNotFoundError: 'ultralytics/yolo11x' does not exist
Failed to initialize models: Model verification failed: 'ultralytics/yolo11x' does not exist
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/model/model_download_manager.py", line 23, in download_all
    await self._ensure_detection_models()
  File "/Users/rob/repos/kalliste/kalliste/model/model_download_manager.py", line 36, in _ensure_detection_models
    await asyncio.get_event_loop().run_in_executor(
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/models/yolo/model.py", line 23, in __init__
    super().__init__(model=model, task=task, verbose=verbose)
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/engine/model.py", line 152, in __init__
    self._load(model, task=task)
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/engine/model.py", line 246, in _load
    weights = checks.check_file(weights)  # runs in all cases, not redundant with above call
              ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/utils/checks.py", line 509, in check_file
    raise FileNotFoundError(f"'{file}' does not exist")
FileNotFoundError: 'ultralytics/yolo11x' does not exist

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/model/model_registry.py", line 28, in initialize
    await downloader.download_all()
  File "/Users/rob/repos/kalliste/kalliste/model/model_download_manager.py", line 28, in download_all
    raise RuntimeError(f"Model verification failed: {str(e)}") from e
RuntimeError: Model verification failed: 'ultralytics/yolo11x' does not exist
Starting model registry cleanup
[yellow]Pipeline test interrupted by user[/]
[blue]Starting pipeline test[/]
Input directory: [cyan]/Users/rob/repos/kalliste/test_images_input[/]
Output directory: [cyan]/Users/rob/repos/kalliste/test_images_output[/]
[green]Initializing BatchProcessor[/]
Initializing BatchProcessor with input_root=/Users/rob/repos/kalliste/test_images_input, output_root=/Users/rob/repos/kalliste/test_images_output
Scanning for batches in /Users/rob/repos/kalliste/test_images_input
Initializing Batch with input_path=/Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2, max_concurrent=3
Scanning for images in /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2
Found 1 images to process in batch 20180312_Photoshoot2
Found 1 batches to process
BatchProcessor created
Initializing models
Initializing BatchProcessor and model registry
Starting model registry initialization
Checking and downloading models if needed
Verifying detection model
Failed to verify/download YOLO model: 'ultralytics/yolo11x' does not exist
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/model/model_download_manager.py", line 36, in _ensure_detection_models
    await asyncio.get_event_loop().run_in_executor(
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/models/yolo/model.py", line 23, in __init__
    super().__init__(model=model, task=task, verbose=verbose)
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/engine/model.py", line 152, in __init__
    self._load(model, task=task)
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/engine/model.py", line 246, in _load
    weights = checks.check_file(weights)  # runs in all cases, not redundant with above call
              ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/utils/checks.py", line 509, in check_file
    raise FileNotFoundError(f"'{file}' does not exist")
FileNotFoundError: 'ultralytics/yolo11x' does not exist
Failed to verify/download models: 'ultralytics/yolo11x' does not exist
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/model/model_download_manager.py", line 23, in download_all
    await self._ensure_detection_models()
  File "/Users/rob/repos/kalliste/kalliste/model/model_download_manager.py", line 36, in _ensure_detection_models
    await asyncio.get_event_loop().run_in_executor(
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/models/yolo/model.py", line 23, in __init__
    super().__init__(model=model, task=task, verbose=verbose)
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/engine/model.py", line 152, in __init__
    self._load(model, task=task)
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/engine/model.py", line 246, in _load
    weights = checks.check_file(weights)  # runs in all cases, not redundant with above call
              ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/utils/checks.py", line 509, in check_file
    raise FileNotFoundError(f"'{file}' does not exist")
FileNotFoundError: 'ultralytics/yolo11x' does not exist
Failed to initialize models: Model verification failed: 'ultralytics/yolo11x' does not exist
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/model/model_download_manager.py", line 23, in download_all
    await self._ensure_detection_models()
  File "/Users/rob/repos/kalliste/kalliste/model/model_download_manager.py", line 36, in _ensure_detection_models
    await asyncio.get_event_loop().run_in_executor(
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/models/yolo/model.py", line 23, in __init__
    super().__init__(model=model, task=task, verbose=verbose)
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/engine/model.py", line 152, in __init__
    self._load(model, task=task)
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/engine/model.py", line 246, in _load
    weights = checks.check_file(weights)  # runs in all cases, not redundant with above call
              ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/utils/checks.py", line 509, in check_file
    raise FileNotFoundError(f"'{file}' does not exist")
FileNotFoundError: 'ultralytics/yolo11x' does not exist

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/model/model_registry.py", line 28, in initialize
    await downloader.download_all()
  File "/Users/rob/repos/kalliste/kalliste/model/model_download_manager.py", line 28, in download_all
    raise RuntimeError(f"Model verification failed: {str(e)}") from e
RuntimeError: Model verification failed: 'ultralytics/yolo11x' does not exist
Starting model registry cleanup
[yellow]Pipeline test interrupted by user[/]
[blue]Starting pipeline test[/]
Input directory: [cyan]/Users/rob/repos/kalliste/test_images_input[/]
Output directory: [cyan]/Users/rob/repos/kalliste/test_images_output[/]
[green]Initializing BatchProcessor[/]
Initializing BatchProcessor with input_root=/Users/rob/repos/kalliste/test_images_input, output_root=/Users/rob/repos/kalliste/test_images_output
Scanning for batches in /Users/rob/repos/kalliste/test_images_input
Initializing Batch with input_path=/Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2, max_concurrent=3
Scanning for images in /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2
Found 1 images to process in batch 20180312_Photoshoot2
Found 1 batches to process
BatchProcessor created
Initializing models
Initializing BatchProcessor and model registry
Starting model registry initialization
Checking and downloading models if needed
Verifying detection model
Failed to verify/download YOLO model: 'ultralytics/yolo11x' does not exist
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/model/model_download_manager.py", line 38, in _ensure_detection_models
    await asyncio.get_event_loop().run_in_executor(
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/models/yolo/model.py", line 23, in __init__
    super().__init__(model=model, task=task, verbose=verbose)
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/engine/model.py", line 152, in __init__
    self._load(model, task=task)
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/engine/model.py", line 246, in _load
    weights = checks.check_file(weights)  # runs in all cases, not redundant with above call
              ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/utils/checks.py", line 509, in check_file
    raise FileNotFoundError(f"'{file}' does not exist")
FileNotFoundError: 'ultralytics/yolo11x' does not exist
Failed to verify/download models: 'ultralytics/yolo11x' does not exist
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/model/model_download_manager.py", line 23, in download_all
    await self._ensure_detection_models()
  File "/Users/rob/repos/kalliste/kalliste/model/model_download_manager.py", line 38, in _ensure_detection_models
    await asyncio.get_event_loop().run_in_executor(
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/models/yolo/model.py", line 23, in __init__
    super().__init__(model=model, task=task, verbose=verbose)
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/engine/model.py", line 152, in __init__
    self._load(model, task=task)
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/engine/model.py", line 246, in _load
    weights = checks.check_file(weights)  # runs in all cases, not redundant with above call
              ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/utils/checks.py", line 509, in check_file
    raise FileNotFoundError(f"'{file}' does not exist")
FileNotFoundError: 'ultralytics/yolo11x' does not exist
Failed to initialize models: Model verification failed: 'ultralytics/yolo11x' does not exist
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/model/model_download_manager.py", line 23, in download_all
    await self._ensure_detection_models()
  File "/Users/rob/repos/kalliste/kalliste/model/model_download_manager.py", line 38, in _ensure_detection_models
    await asyncio.get_event_loop().run_in_executor(
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/models/yolo/model.py", line 23, in __init__
    super().__init__(model=model, task=task, verbose=verbose)
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/engine/model.py", line 152, in __init__
    self._load(model, task=task)
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/engine/model.py", line 246, in _load
    weights = checks.check_file(weights)  # runs in all cases, not redundant with above call
              ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/utils/checks.py", line 509, in check_file
    raise FileNotFoundError(f"'{file}' does not exist")
FileNotFoundError: 'ultralytics/yolo11x' does not exist

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/model/model_registry.py", line 28, in initialize
    await downloader.download_all()
  File "/Users/rob/repos/kalliste/kalliste/model/model_download_manager.py", line 28, in download_all
    raise RuntimeError(f"Model verification failed: {str(e)}") from e
RuntimeError: Model verification failed: 'ultralytics/yolo11x' does not exist
Starting model registry cleanup
[yellow]Pipeline test interrupted by user[/]
[blue]Starting pipeline test[/]
Input directory: [cyan]/Users/rob/repos/kalliste/test_images_input[/]
Output directory: [cyan]/Users/rob/repos/kalliste/test_images_output[/]
[green]Initializing BatchProcessor[/]
Initializing BatchProcessor with input_root=/Users/rob/repos/kalliste/test_images_input, output_root=/Users/rob/repos/kalliste/test_images_output
Scanning for batches in /Users/rob/repos/kalliste/test_images_input
Initializing Batch with input_path=/Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2, max_concurrent=3
Scanning for images in /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2
Found 1 images to process in batch 20180312_Photoshoot2
Found 1 batches to process
BatchProcessor created
Initializing models
Initializing BatchProcessor and model registry
Starting model registry initialization
Checking and downloading models if needed
Verifying detection model
Failed to verify/download YOLO model: 'ultralytics/yolo11x' does not exist
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/model/model_download_manager.py", line 38, in _ensure_detection_models
    await asyncio.get_event_loop().run_in_executor(
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/models/yolo/model.py", line 23, in __init__
    super().__init__(model=model, task=task, verbose=verbose)
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/engine/model.py", line 152, in __init__
    self._load(model, task=task)
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/engine/model.py", line 246, in _load
    weights = checks.check_file(weights)  # runs in all cases, not redundant with above call
              ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/utils/checks.py", line 509, in check_file
    raise FileNotFoundError(f"'{file}' does not exist")
FileNotFoundError: 'ultralytics/yolo11x' does not exist
Failed to verify/download models: 'ultralytics/yolo11x' does not exist
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/model/model_download_manager.py", line 23, in download_all
    await self._ensure_detection_models()
  File "/Users/rob/repos/kalliste/kalliste/model/model_download_manager.py", line 38, in _ensure_detection_models
    await asyncio.get_event_loop().run_in_executor(
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/models/yolo/model.py", line 23, in __init__
    super().__init__(model=model, task=task, verbose=verbose)
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/engine/model.py", line 152, in __init__
    self._load(model, task=task)
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/engine/model.py", line 246, in _load
    weights = checks.check_file(weights)  # runs in all cases, not redundant with above call
              ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/utils/checks.py", line 509, in check_file
    raise FileNotFoundError(f"'{file}' does not exist")
FileNotFoundError: 'ultralytics/yolo11x' does not exist
Failed to initialize models: Model verification failed: 'ultralytics/yolo11x' does not exist
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/model/model_download_manager.py", line 23, in download_all
    await self._ensure_detection_models()
  File "/Users/rob/repos/kalliste/kalliste/model/model_download_manager.py", line 38, in _ensure_detection_models
    await asyncio.get_event_loop().run_in_executor(
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/models/yolo/model.py", line 23, in __init__
    super().__init__(model=model, task=task, verbose=verbose)
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/engine/model.py", line 152, in __init__
    self._load(model, task=task)
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/engine/model.py", line 246, in _load
    weights = checks.check_file(weights)  # runs in all cases, not redundant with above call
              ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/utils/checks.py", line 509, in check_file
    raise FileNotFoundError(f"'{file}' does not exist")
FileNotFoundError: 'ultralytics/yolo11x' does not exist

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/model/model_registry.py", line 28, in initialize
    await downloader.download_all()
  File "/Users/rob/repos/kalliste/kalliste/model/model_download_manager.py", line 28, in download_all
    raise RuntimeError(f"Model verification failed: {str(e)}") from e
RuntimeError: Model verification failed: 'ultralytics/yolo11x' does not exist
Starting model registry cleanup
[yellow]Pipeline test interrupted by user[/]
[blue]Starting pipeline test[/]
Input directory: [cyan]/Users/rob/repos/kalliste/test_images_input[/]
Output directory: [cyan]/Users/rob/repos/kalliste/test_images_output[/]
[green]Initializing BatchProcessor[/]
Initializing BatchProcessor with input_root=/Users/rob/repos/kalliste/test_images_input, output_root=/Users/rob/repos/kalliste/test_images_output
Scanning for batches in /Users/rob/repos/kalliste/test_images_input
Initializing Batch with input_path=/Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2, max_concurrent=3
Scanning for images in /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2
Found 1 images to process in batch 20180312_Photoshoot2
Found 1 batches to process
BatchProcessor created
Initializing models
Initializing BatchProcessor and model registry
Starting model registry initialization
Checking and downloading models if needed
Verifying detection model
Failed to verify/download YOLO model: 'ultralytics/yolo11x' does not exist
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/model/model_download_manager.py", line 38, in _ensure_detection_models
    await asyncio.get_event_loop().run_in_executor(
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/models/yolo/model.py", line 23, in __init__
    super().__init__(model=model, task=task, verbose=verbose)
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/engine/model.py", line 152, in __init__
    self._load(model, task=task)
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/engine/model.py", line 246, in _load
    weights = checks.check_file(weights)  # runs in all cases, not redundant with above call
              ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/utils/checks.py", line 509, in check_file
    raise FileNotFoundError(f"'{file}' does not exist")
FileNotFoundError: 'ultralytics/yolo11x' does not exist
Failed to verify/download models: 'ultralytics/yolo11x' does not exist
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/model/model_download_manager.py", line 23, in download_all
    await self._ensure_detection_models()
  File "/Users/rob/repos/kalliste/kalliste/model/model_download_manager.py", line 38, in _ensure_detection_models
    await asyncio.get_event_loop().run_in_executor(
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/models/yolo/model.py", line 23, in __init__
    super().__init__(model=model, task=task, verbose=verbose)
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/engine/model.py", line 152, in __init__
    self._load(model, task=task)
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/engine/model.py", line 246, in _load
    weights = checks.check_file(weights)  # runs in all cases, not redundant with above call
              ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/utils/checks.py", line 509, in check_file
    raise FileNotFoundError(f"'{file}' does not exist")
FileNotFoundError: 'ultralytics/yolo11x' does not exist
Failed to initialize models: Model verification failed: 'ultralytics/yolo11x' does not exist
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/model/model_download_manager.py", line 23, in download_all
    await self._ensure_detection_models()
  File "/Users/rob/repos/kalliste/kalliste/model/model_download_manager.py", line 38, in _ensure_detection_models
    await asyncio.get_event_loop().run_in_executor(
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/models/yolo/model.py", line 23, in __init__
    super().__init__(model=model, task=task, verbose=verbose)
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/engine/model.py", line 152, in __init__
    self._load(model, task=task)
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/engine/model.py", line 246, in _load
    weights = checks.check_file(weights)  # runs in all cases, not redundant with above call
              ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/utils/checks.py", line 509, in check_file
    raise FileNotFoundError(f"'{file}' does not exist")
FileNotFoundError: 'ultralytics/yolo11x' does not exist

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/model/model_registry.py", line 28, in initialize
    await downloader.download_all()
  File "/Users/rob/repos/kalliste/kalliste/model/model_download_manager.py", line 28, in download_all
    raise RuntimeError(f"Model verification failed: {str(e)}") from e
RuntimeError: Model verification failed: 'ultralytics/yolo11x' does not exist
Starting model registry cleanup
[yellow]Pipeline test interrupted by user[/]
[blue]Starting pipeline test[/]
Input directory: [cyan]/Users/rob/repos/kalliste/test_images_input[/]
Output directory: [cyan]/Users/rob/repos/kalliste/test_images_output[/]
[green]Initializing BatchProcessor[/]
Initializing BatchProcessor with input_root=/Users/rob/repos/kalliste/test_images_input, output_root=/Users/rob/repos/kalliste/test_images_output
Scanning for batches in /Users/rob/repos/kalliste/test_images_input
Initializing Batch with input_path=/Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2, max_concurrent=3
Scanning for images in /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2
Found 1 images to process in batch 20180312_Photoshoot2
Found 1 batches to process
BatchProcessor created
Initializing models
Initializing BatchProcessor and model registry
Starting model registry initialization
Checking and downloading models if needed
Verifying detection model
Failed to verify/download YOLO model: 'ultralytics/yolo11x' does not exist
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/model/model_download_manager.py", line 38, in _ensure_detection_models
    await asyncio.get_event_loop().run_in_executor(
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/models/yolo/model.py", line 23, in __init__
    super().__init__(model=model, task=task, verbose=verbose)
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/engine/model.py", line 152, in __init__
    self._load(model, task=task)
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/engine/model.py", line 246, in _load
    weights = checks.check_file(weights)  # runs in all cases, not redundant with above call
              ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/utils/checks.py", line 509, in check_file
    raise FileNotFoundError(f"'{file}' does not exist")
FileNotFoundError: 'ultralytics/yolo11x' does not exist
Failed to verify/download models: 'ultralytics/yolo11x' does not exist
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/model/model_download_manager.py", line 23, in download_all
    await self._ensure_detection_models()
  File "/Users/rob/repos/kalliste/kalliste/model/model_download_manager.py", line 38, in _ensure_detection_models
    await asyncio.get_event_loop().run_in_executor(
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/models/yolo/model.py", line 23, in __init__
    super().__init__(model=model, task=task, verbose=verbose)
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/engine/model.py", line 152, in __init__
    self._load(model, task=task)
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/engine/model.py", line 246, in _load
    weights = checks.check_file(weights)  # runs in all cases, not redundant with above call
              ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/utils/checks.py", line 509, in check_file
    raise FileNotFoundError(f"'{file}' does not exist")
FileNotFoundError: 'ultralytics/yolo11x' does not exist
Failed to initialize models: Model verification failed: 'ultralytics/yolo11x' does not exist
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/model/model_download_manager.py", line 23, in download_all
    await self._ensure_detection_models()
  File "/Users/rob/repos/kalliste/kalliste/model/model_download_manager.py", line 38, in _ensure_detection_models
    await asyncio.get_event_loop().run_in_executor(
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/models/yolo/model.py", line 23, in __init__
    super().__init__(model=model, task=task, verbose=verbose)
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/engine/model.py", line 152, in __init__
    self._load(model, task=task)
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/engine/model.py", line 246, in _load
    weights = checks.check_file(weights)  # runs in all cases, not redundant with above call
              ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/utils/checks.py", line 509, in check_file
    raise FileNotFoundError(f"'{file}' does not exist")
FileNotFoundError: 'ultralytics/yolo11x' does not exist

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/model/model_registry.py", line 28, in initialize
    await downloader.download_all()
  File "/Users/rob/repos/kalliste/kalliste/model/model_download_manager.py", line 28, in download_all
    raise RuntimeError(f"Model verification failed: {str(e)}") from e
RuntimeError: Model verification failed: 'ultralytics/yolo11x' does not exist
Starting model registry cleanup
[yellow]Pipeline test interrupted by user[/]
[blue]Starting pipeline test[/]
Input directory: [cyan]/Users/rob/repos/kalliste/test_images_input[/]
Output directory: [cyan]/Users/rob/repos/kalliste/test_images_output[/]
[green]Initializing BatchProcessor[/]
Initializing BatchProcessor with input_root=/Users/rob/repos/kalliste/test_images_input, output_root=/Users/rob/repos/kalliste/test_images_output
Scanning for batches in /Users/rob/repos/kalliste/test_images_input
Initializing Batch with input_path=/Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2, max_concurrent=3
Scanning for images in /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2
Found 1 images to process in batch 20180312_Photoshoot2
Found 1 batches to process
BatchProcessor created
Initializing models
Initializing BatchProcessor and model registry
Starting model registry initialization
Checking and downloading models if needed
Failed to verify/download models: 'ModelDownloadManager' object has no attribute '_ensure_detection_models'
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/model/model_download_manager.py", line 23, in download_all
    await self._ensure_detection_models()
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'ModelDownloadManager' object has no attribute '_ensure_detection_models'
Failed to initialize models: Model verification failed: 'ModelDownloadManager' object has no attribute '_ensure_detection_models'
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/model/model_download_manager.py", line 23, in download_all
    await self._ensure_detection_models()
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'ModelDownloadManager' object has no attribute '_ensure_detection_models'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/model/model_registry.py", line 28, in initialize
    await downloader.download_all()
  File "/Users/rob/repos/kalliste/kalliste/model/model_download_manager.py", line 28, in download_all
    raise RuntimeError(f"Model verification failed: {str(e)}") from e
RuntimeError: Model verification failed: 'ModelDownloadManager' object has no attribute '_ensure_detection_models'
Starting model registry cleanup
[yellow]Pipeline test interrupted by user[/]
[blue]Starting pipeline test[/]
Input directory: [cyan]/Users/rob/repos/kalliste/test_images_input[/]
Output directory: [cyan]/Users/rob/repos/kalliste/test_images_output[/]
[green]Initializing BatchProcessor[/]
Initializing BatchProcessor with input_root=/Users/rob/repos/kalliste/test_images_input, output_root=/Users/rob/repos/kalliste/test_images_output
Scanning for batches in /Users/rob/repos/kalliste/test_images_input
Initializing Batch with input_path=/Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2, max_concurrent=3
Scanning for images in /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2
Found 1 images to process in batch 20180312_Photoshoot2
Found 1 batches to process
BatchProcessor created
Initializing models
Initializing BatchProcessor and model registry
Starting model registry initialization
Checking and downloading models if needed
Verifying detection model
Downloading YOLO model to cache directory
Failed to verify/download YOLO model: name 'requests' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/model/model_download_manager.py", line 42, in _ensure_detection_models
    response = requests.get(url, stream=True)
               ^^^^^^^^
NameError: name 'requests' is not defined
Failed to verify/download models: name 'requests' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/model/model_download_manager.py", line 23, in download_all
    await self._ensure_detection_models()
  File "/Users/rob/repos/kalliste/kalliste/model/model_download_manager.py", line 42, in _ensure_detection_models
    response = requests.get(url, stream=True)
               ^^^^^^^^
NameError: name 'requests' is not defined
Failed to initialize models: Model verification failed: name 'requests' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/model/model_download_manager.py", line 23, in download_all
    await self._ensure_detection_models()
  File "/Users/rob/repos/kalliste/kalliste/model/model_download_manager.py", line 42, in _ensure_detection_models
    response = requests.get(url, stream=True)
               ^^^^^^^^
NameError: name 'requests' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/model/model_registry.py", line 28, in initialize
    await downloader.download_all()
  File "/Users/rob/repos/kalliste/kalliste/model/model_download_manager.py", line 28, in download_all
    raise RuntimeError(f"Model verification failed: {str(e)}") from e
RuntimeError: Model verification failed: name 'requests' is not defined
Starting model registry cleanup
[yellow]Pipeline test interrupted by user[/]
[blue]Starting pipeline test[/]
Input directory: [cyan]/Users/rob/repos/kalliste/test_images_input[/]
Output directory: [cyan]/Users/rob/repos/kalliste/test_images_output[/]
[green]Initializing BatchProcessor[/]
Initializing BatchProcessor with input_root=/Users/rob/repos/kalliste/test_images_input, output_root=/Users/rob/repos/kalliste/test_images_output
Scanning for batches in /Users/rob/repos/kalliste/test_images_input
Initializing Batch with input_path=/Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2, max_concurrent=3
Scanning for images in /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2
Found 1 images to process in batch 20180312_Photoshoot2
Found 1 batches to process
BatchProcessor created
Initializing models
Initializing BatchProcessor and model registry
Starting model registry initialization
Checking and downloading models if needed
Verifying detection model
Downloading YOLO model to cache directory
Failed to verify/download YOLO model: Can't get attribute 'C3k2' on <module 'ultralytics.nn.modules.block' from '/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/nn/modules/block.py'>
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/model/model_download_manager.py", line 45, in _ensure_detection_models
    await asyncio.get_event_loop().run_in_executor(
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/models/yolo/model.py", line 23, in __init__
    super().__init__(model=model, task=task, verbose=verbose)
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/engine/model.py", line 152, in __init__
    self._load(model, task=task)
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/engine/model.py", line 241, in _load
    self.model, self.ckpt = attempt_load_one_weight(weights)
                            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/nn/tasks.py", line 806, in attempt_load_one_weight
    ckpt, weight = torch_safe_load(weight)  # load ckpt
                   ^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/nn/tasks.py", line 732, in torch_safe_load
    ckpt = torch.load(file, map_location="cpu")
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/torch/serialization.py", line 1360, in load
    return _load(
           ^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/torch/serialization.py", line 1848, in _load
    result = unpickler.load()
             ^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/torch/serialization.py", line 1837, in find_class
    return super().find_class(mod_name, name)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: Can't get attribute 'C3k2' on <module 'ultralytics.nn.modules.block' from '/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/nn/modules/block.py'>
Failed to verify/download models: Can't get attribute 'C3k2' on <module 'ultralytics.nn.modules.block' from '/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/nn/modules/block.py'>
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/model/model_download_manager.py", line 18, in download_all
    await self._ensure_detection_models()
  File "/Users/rob/repos/kalliste/kalliste/model/model_download_manager.py", line 45, in _ensure_detection_models
    await asyncio.get_event_loop().run_in_executor(
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/models/yolo/model.py", line 23, in __init__
    super().__init__(model=model, task=task, verbose=verbose)
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/engine/model.py", line 152, in __init__
    self._load(model, task=task)
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/engine/model.py", line 241, in _load
    self.model, self.ckpt = attempt_load_one_weight(weights)
                            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/nn/tasks.py", line 806, in attempt_load_one_weight
    ckpt, weight = torch_safe_load(weight)  # load ckpt
                   ^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/nn/tasks.py", line 732, in torch_safe_load
    ckpt = torch.load(file, map_location="cpu")
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/torch/serialization.py", line 1360, in load
    return _load(
           ^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/torch/serialization.py", line 1848, in _load
    result = unpickler.load()
             ^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/torch/serialization.py", line 1837, in find_class
    return super().find_class(mod_name, name)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: Can't get attribute 'C3k2' on <module 'ultralytics.nn.modules.block' from '/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/nn/modules/block.py'>
Failed to initialize models: Model verification failed: Can't get attribute 'C3k2' on <module 'ultralytics.nn.modules.block' from '/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/nn/modules/block.py'>
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/model/model_download_manager.py", line 18, in download_all
    await self._ensure_detection_models()
  File "/Users/rob/repos/kalliste/kalliste/model/model_download_manager.py", line 45, in _ensure_detection_models
    await asyncio.get_event_loop().run_in_executor(
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/models/yolo/model.py", line 23, in __init__
    super().__init__(model=model, task=task, verbose=verbose)
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/engine/model.py", line 152, in __init__
    self._load(model, task=task)
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/engine/model.py", line 241, in _load
    self.model, self.ckpt = attempt_load_one_weight(weights)
                            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/nn/tasks.py", line 806, in attempt_load_one_weight
    ckpt, weight = torch_safe_load(weight)  # load ckpt
                   ^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/nn/tasks.py", line 732, in torch_safe_load
    ckpt = torch.load(file, map_location="cpu")
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/torch/serialization.py", line 1360, in load
    return _load(
           ^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/torch/serialization.py", line 1848, in _load
    result = unpickler.load()
             ^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/torch/serialization.py", line 1837, in find_class
    return super().find_class(mod_name, name)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: Can't get attribute 'C3k2' on <module 'ultralytics.nn.modules.block' from '/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/nn/modules/block.py'>

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/model/model_registry.py", line 28, in initialize
    await downloader.download_all()
  File "/Users/rob/repos/kalliste/kalliste/model/model_download_manager.py", line 23, in download_all
    raise RuntimeError(f"Model verification failed: {str(e)}") from e
RuntimeError: Model verification failed: Can't get attribute 'C3k2' on <module 'ultralytics.nn.modules.block' from '/opt/miniconda3/envs/kalliste/lib/python3.11/site-packages/ultralytics/nn/modules/block.py'>
Starting model registry cleanup
[yellow]Pipeline test interrupted by user[/]
[blue]Starting pipeline test[/]
Input directory: [cyan]/Users/rob/repos/kalliste/test_images_input[/]
Output directory: [cyan]/Users/rob/repos/kalliste/test_images_output[/]
[green]Initializing BatchProcessor[/]
Initializing BatchProcessor with input_root=/Users/rob/repos/kalliste/test_images_input, output_root=/Users/rob/repos/kalliste/test_images_output
Scanning for batches in /Users/rob/repos/kalliste/test_images_input
Initializing Batch with input_path=/Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2, max_concurrent=3
Scanning for images in /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2
Found 1 images to process in batch 20180312_Photoshoot2
Found 1 batches to process
BatchProcessor created
Initializing models
Initializing BatchProcessor and model registry
Starting model registry initialization
Checking and downloading models if needed
Verifying detection model
YOLO model verified in cache
Verifying classification models
Verifying blip2 model: Salesforce/blip2-opt-2.7b
Failed to verify/download blip2 model: name 'AutoProcessor' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/model/model_download_manager.py", line 57, in _ensure_classification_models
    AutoProcessor.from_pretrained,
    ^^^^^^^^^^^^^
NameError: name 'AutoProcessor' is not defined
Failed to verify/download models: name 'AutoProcessor' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/model/model_download_manager.py", line 19, in download_all
    await self._ensure_classification_models()
  File "/Users/rob/repos/kalliste/kalliste/model/model_download_manager.py", line 57, in _ensure_classification_models
    AutoProcessor.from_pretrained,
    ^^^^^^^^^^^^^
NameError: name 'AutoProcessor' is not defined
Failed to initialize models: Model verification failed: name 'AutoProcessor' is not defined
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/model/model_download_manager.py", line 19, in download_all
    await self._ensure_classification_models()
  File "/Users/rob/repos/kalliste/kalliste/model/model_download_manager.py", line 57, in _ensure_classification_models
    AutoProcessor.from_pretrained,
    ^^^^^^^^^^^^^
NameError: name 'AutoProcessor' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/model/model_registry.py", line 28, in initialize
    await downloader.download_all()
  File "/Users/rob/repos/kalliste/kalliste/model/model_download_manager.py", line 23, in download_all
    raise RuntimeError(f"Model verification failed: {str(e)}") from e
RuntimeError: Model verification failed: name 'AutoProcessor' is not defined
Starting model registry cleanup
[yellow]Pipeline test interrupted by user[/]
[blue]Starting pipeline test[/]
Input directory: [cyan]/Users/rob/repos/kalliste/test_images_input[/]
Output directory: [cyan]/Users/rob/repos/kalliste/test_images_output[/]
[green]Initializing BatchProcessor[/]
Initializing BatchProcessor with input_root=/Users/rob/repos/kalliste/test_images_input, output_root=/Users/rob/repos/kalliste/test_images_output
Scanning for batches in /Users/rob/repos/kalliste/test_images_input
Initializing Batch with input_path=/Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2, max_concurrent=3
Scanning for images in /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2
Found 1 images to process in batch 20180312_Photoshoot2
Found 1 batches to process
BatchProcessor created
Initializing models
Initializing BatchProcessor and model registry
Starting model registry initialization
Checking and downloading models if needed
Verifying detection model
YOLO model verified in cache
Verifying classification models
Verifying blip2 model: Salesforce/blip2-opt-2.7b
Successfully verified blip2 model
Verifying orientation model: LucyintheSky/pose-estimation-front-side-back
Successfully verified orientation model
Verifying wd14 model: SmilingWolf/wd-vit-large-tagger-v3
Loading pretrained weights from Hugging Face hub (SmilingWolf/wd-vit-large-tagger-v3)
[SmilingWolf/wd-vit-large-tagger-v3] Safe alternative available for 'pytorch_model.bin' (as 'model.safetensors'). Loading weights using safetensors.
Successfully verified wd14 model
All models verified/downloaded
Initializing tagger pipeline...
[blue]Starting pipeline test[/]
Input directory: [cyan]/Users/rob/repos/kalliste/test_images_input[/]
Output directory: [cyan]/Users/rob/repos/kalliste/test_images_output[/]
[green]Initializing BatchProcessor[/]
Initializing BatchProcessor with input_root=/Users/rob/repos/kalliste/test_images_input, output_root=/Users/rob/repos/kalliste/test_images_output
Scanning for batches in /Users/rob/repos/kalliste/test_images_input
Initializing Batch with input_path=/Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2, max_concurrent=3
Scanning for images in /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2
Found 1 images to process in batch 20180312_Photoshoot2
Found 1 batches to process
BatchProcessor created
Initializing models
Initializing BatchProcessor and model registry
Starting model registry initialization
Checking and downloading models if needed
Verifying detection model
YOLO model verified in cache
Verifying classification models
Verifying blip2 model: Salesforce/blip2-opt-2.7b
Successfully verified blip2 model
Verifying orientation model: LucyintheSky/pose-estimation-front-side-back
Successfully verified orientation model
Verifying wd14 model: SmilingWolf/wd-vit-large-tagger-v3
Loading pretrained weights from Hugging Face hub (SmilingWolf/wd-vit-large-tagger-v3)
[SmilingWolf/wd-vit-large-tagger-v3] Safe alternative available for 'pytorch_model.bin' (as 'model.safetensors'). Loading weights using safetensors.
Successfully verified wd14 model
All models verified/downloaded
Initializing tagger pipeline...
[blue]Starting pipeline test[/]
Input directory: [cyan]/Users/rob/repos/kalliste/test_images_input[/]
Output directory: [cyan]/Users/rob/repos/kalliste/test_images_output[/]
[green]Initializing BatchProcessor[/]
Initializing BatchProcessor with input_root=/Users/rob/repos/kalliste/test_images_input, output_root=/Users/rob/repos/kalliste/test_images_output
Scanning for batches in /Users/rob/repos/kalliste/test_images_input
Initializing Batch with input_path=/Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2, max_concurrent=3
Scanning for images in /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2
Found 1 images to process in batch 20180312_Photoshoot2
Found 1 batches to process
BatchProcessor created
Initializing models
Initializing BatchProcessor and model registry
Starting model registry initialization
Checking and downloading models if needed
Verifying detection model
YOLO model verified in cache
Verifying classification models
Verifying blip2 model: Salesforce/blip2-opt-2.7b
Successfully verified blip2 model
Verifying orientation model: LucyintheSky/pose-estimation-front-side-back
Successfully verified orientation model
Verifying wd14 model: SmilingWolf/wd-vit-large-tagger-v3
Loading pretrained weights from Hugging Face hub (SmilingWolf/wd-vit-large-tagger-v3)
[SmilingWolf/wd-vit-large-tagger-v3] Safe alternative available for 'pytorch_model.bin' (as 'model.safetensors'). Loading weights using safetensors.
Successfully verified wd14 model
All models verified/downloaded
Initializing tagger pipeline...
[blue]Starting pipeline test[/]
Input directory: [cyan]/Users/rob/repos/kalliste/test_images_input[/]
Output directory: [cyan]/Users/rob/repos/kalliste/test_images_output[/]
[green]Initializing BatchProcessor[/]
Initializing BatchProcessor with input_root=/Users/rob/repos/kalliste/test_images_input, output_root=/Users/rob/repos/kalliste/test_images_output
Scanning for batches in /Users/rob/repos/kalliste/test_images_input
Initializing Batch with input_path=/Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2, max_concurrent=3
Scanning for images in /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2
Found 1 images to process in batch 20180312_Photoshoot2
Found 1 batches to process
BatchProcessor created
Initializing models
Initializing BatchProcessor and model registry
Starting model registry initialization
Checking and downloading models if needed
Verifying detection model
Downloading YOLO model to cache directory
Download complete
YOLO model verified in cache
Verifying classification models
Verifying blip2 model: Salesforce/blip2-opt-2.7b
Successfully verified blip2 model
Verifying orientation model: LucyintheSky/pose-estimation-front-side-back
Successfully verified orientation model
Verifying wd14 model: SmilingWolf/wd-vit-large-tagger-v3
Loading pretrained weights from Hugging Face hub (SmilingWolf/wd-vit-large-tagger-v3)
[SmilingWolf/wd-vit-large-tagger-v3] Safe alternative available for 'pytorch_model.bin' (as 'model.safetensors'). Loading weights using safetensors.
Successfully verified wd14 model
All models verified/downloaded
Initializing tagger pipeline...
[blue]Starting pipeline test[/]
Input directory: [cyan]/Users/rob/repos/kalliste/test_images_input[/]
Output directory: [cyan]/Users/rob/repos/kalliste/test_images_output[/]
[green]Initializing BatchProcessor[/]
Initializing BatchProcessor with input_root=/Users/rob/repos/kalliste/test_images_input, output_root=/Users/rob/repos/kalliste/test_images_output
Scanning for batches in /Users/rob/repos/kalliste/test_images_input
Initializing Batch with input_path=/Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2, max_concurrent=3
Scanning for images in /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2
Found 1 images to process in batch 20180312_Photoshoot2
Found 1 batches to process
BatchProcessor created
Initializing models
Initializing BatchProcessor and model registry
Starting model registry initialization
Checking and downloading models if needed
Verifying detection model
YOLO model verified in cache
Verifying classification models
Verifying blip2 model: Salesforce/blip2-opt-2.7b
Successfully verified blip2 model
Verifying orientation model: LucyintheSky/pose-estimation-front-side-back
Successfully verified orientation model
Verifying wd14 model: SmilingWolf/wd-vit-large-tagger-v3
Loading pretrained weights from Hugging Face hub (SmilingWolf/wd-vit-large-tagger-v3)
[SmilingWolf/wd-vit-large-tagger-v3] Safe alternative available for 'pytorch_model.bin' (as 'model.safetensors'). Loading weights using safetensors.
Successfully verified wd14 model
All models verified/downloaded
Initializing tagger pipeline...
[blue]Starting pipeline test[/]
Input directory: [cyan]/Users/rob/repos/kalliste/test_images_input[/]
Output directory: [cyan]/Users/rob/repos/kalliste/test_images_output[/]
[green]Initializing BatchProcessor[/]
Initializing BatchProcessor with input_root=/Users/rob/repos/kalliste/test_images_input, output_root=/Users/rob/repos/kalliste/test_images_output
Scanning for batches in /Users/rob/repos/kalliste/test_images_input
Initializing Batch with input_path=/Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2, max_concurrent=3
Scanning for images in /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2
Found 1 images to process in batch 20180312_Photoshoot2
Found 1 batches to process
BatchProcessor created
Initializing models
Initializing BatchProcessor and model registry
Starting model registry initialization
Checking and downloading models if needed
Verifying detection model
YOLO model verified in cache
Verifying classification models
Verifying blip2 model: Salesforce/blip2-opt-2.7b
Successfully verified blip2 model
Verifying orientation model: LucyintheSky/pose-estimation-front-side-back
Successfully verified orientation model
Verifying wd14 model: SmilingWolf/wd-vit-large-tagger-v3
Loading pretrained weights from Hugging Face hub (SmilingWolf/wd-vit-large-tagger-v3)
[SmilingWolf/wd-vit-large-tagger-v3] Safe alternative available for 'pytorch_model.bin' (as 'model.safetensors'). Loading weights using safetensors.
Successfully verified wd14 model
All models verified/downloaded
Initializing tagger pipeline...
Creating TaggerPipeline instance
MPS device validated
TaggerPipeline created with device: mps
Starting tagger pipeline initialization
Initializing orientation tagger...
Creating OrientationTagger instance for device: mps
Orientation tagger created successfully
Initializing caption tagger...
Creating CaptionTagger instance for device: mps
Caption tagger created successfully
Initializing WD14 tagger...
Loading pretrained weights from Hugging Face hub (SmilingWolf/wd-vit-large-tagger-v3)
[SmilingWolf/wd-vit-large-tagger-v3] Safe alternative available for 'pytorch_model.bin' (as 'model.safetensors'). Loading weights using safetensors.
Failed to initialize WD14 tagger: Tags file not found: /Users/rob/repos/kalliste/weights/wd14/selected_tags.csv
Failed to initialize models: Tags file not found: /Users/rob/repos/kalliste/weights/wd14/selected_tags.csv
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/model/model_registry.py", line 34, in initialize
    await tagger.initialize()
  File "/Users/rob/repos/kalliste/kalliste/taggers/tagger_pipeline.py", line 143, in initialize
    raise FileNotFoundError(f"Tags file not found: {tags_file}")
FileNotFoundError: Tags file not found: /Users/rob/repos/kalliste/weights/wd14/selected_tags.csv
Starting model registry cleanup
[blue]Starting pipeline test[/]
Input directory: [cyan]/Users/rob/repos/kalliste/test_images_input[/]
Output directory: [cyan]/Users/rob/repos/kalliste/test_images_output[/]
[green]Initializing BatchProcessor[/]
Initializing BatchProcessor with input_root=/Users/rob/repos/kalliste/test_images_input, output_root=/Users/rob/repos/kalliste/test_images_output
Scanning for batches in /Users/rob/repos/kalliste/test_images_input
Initializing Batch with input_path=/Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2, max_concurrent=3
Using default detection config: /Users/rob/repos/kalliste/kalliste/default_detection_config.yaml
Scanning for images in /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2
Failed to create OriginalImage for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 60, in scan_for_images
    original_image = OriginalImage(
                     ^^^^^^^^^^^^^^
TypeError: OriginalImage.__init__() got an unexpected keyword argument 'input_path'
Error scanning for images in /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 60, in scan_for_images
    original_image = OriginalImage(
                     ^^^^^^^^^^^^^^
TypeError: OriginalImage.__init__() got an unexpected keyword argument 'input_path'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 68, in scan_for_images
    raise RuntimeError(f"Failed to initialize image {file}: {str(e)}") from e
RuntimeError: Failed to initialize image /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png: OriginalImage.__init__() got an unexpected keyword argument 'input_path'
Failed to scan for images in /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 60, in scan_for_images
    original_image = OriginalImage(
                     ^^^^^^^^^^^^^^
TypeError: OriginalImage.__init__() got an unexpected keyword argument 'input_path'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 68, in scan_for_images
    raise RuntimeError(f"Failed to initialize image {file}: {str(e)}") from e
RuntimeError: Failed to initialize image /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png: OriginalImage.__init__() got an unexpected keyword argument 'input_path'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 35, in __init__
    self.scan_for_images()
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 77, in scan_for_images
    raise RuntimeError(f"Failed to scan for images: {str(e)}") from e
RuntimeError: Failed to scan for images: Failed to initialize image /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png: OriginalImage.__init__() got an unexpected keyword argument 'input_path'
Failed to scan for batches
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 60, in scan_for_images
    original_image = OriginalImage(
                     ^^^^^^^^^^^^^^
TypeError: OriginalImage.__init__() got an unexpected keyword argument 'input_path'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 68, in scan_for_images
    raise RuntimeError(f"Failed to initialize image {file}: {str(e)}") from e
RuntimeError: Failed to initialize image /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png: OriginalImage.__init__() got an unexpected keyword argument 'input_path'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 35, in __init__
    self.scan_for_images()
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 77, in scan_for_images
    raise RuntimeError(f"Failed to scan for images: {str(e)}") from e
RuntimeError: Failed to scan for images: Failed to initialize image /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png: OriginalImage.__init__() got an unexpected keyword argument 'input_path'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/batch_processor.py", line 62, in scan_for_batches
    self.batches.append(Batch(input_path=item, output_path=output_dir))
                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 38, in __init__
    raise RuntimeError(f"Failed to initialize batch: {str(e)}") from e
RuntimeError: Failed to initialize batch: Failed to scan for images: Failed to initialize image /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png: OriginalImage.__init__() got an unexpected keyword argument 'input_path'
[red bold]Failed to initialize BatchProcessor[/]
[red bold]Pipeline test failed[/]
[blue]Starting pipeline test[/]
Input directory: [cyan]/Users/rob/repos/kalliste/test_images_input[/]
Output directory: [cyan]/Users/rob/repos/kalliste/test_images_output[/]
[green]Initializing BatchProcessor[/]
Initializing BatchProcessor with input_root=/Users/rob/repos/kalliste/test_images_input, output_root=/Users/rob/repos/kalliste/test_images_output
Scanning for batches in /Users/rob/repos/kalliste/test_images_input
Initializing Batch with input_path=/Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2, max_concurrent=3
Using default detection config: /Users/rob/repos/kalliste/kalliste/default_detection_config.yaml
Scanning for images in /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2
Failed to create OriginalImage for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 60, in scan_for_images
    original_image = OriginalImage(
                     ^^^^^^^^^^^^^^
TypeError: OriginalImage.__init__() got an unexpected keyword argument 'input_path'
Error scanning for images in /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 60, in scan_for_images
    original_image = OriginalImage(
                     ^^^^^^^^^^^^^^
TypeError: OriginalImage.__init__() got an unexpected keyword argument 'input_path'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 68, in scan_for_images
    raise RuntimeError(f"Failed to initialize image {file}: {str(e)}") from e
RuntimeError: Failed to initialize image /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png: OriginalImage.__init__() got an unexpected keyword argument 'input_path'
Failed to scan for images in /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 60, in scan_for_images
    original_image = OriginalImage(
                     ^^^^^^^^^^^^^^
TypeError: OriginalImage.__init__() got an unexpected keyword argument 'input_path'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 68, in scan_for_images
    raise RuntimeError(f"Failed to initialize image {file}: {str(e)}") from e
RuntimeError: Failed to initialize image /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png: OriginalImage.__init__() got an unexpected keyword argument 'input_path'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 35, in __init__
    self.scan_for_images()
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 77, in scan_for_images
    raise RuntimeError(f"Failed to scan for images: {str(e)}") from e
RuntimeError: Failed to scan for images: Failed to initialize image /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png: OriginalImage.__init__() got an unexpected keyword argument 'input_path'
Failed to scan for batches
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 60, in scan_for_images
    original_image = OriginalImage(
                     ^^^^^^^^^^^^^^
TypeError: OriginalImage.__init__() got an unexpected keyword argument 'input_path'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 68, in scan_for_images
    raise RuntimeError(f"Failed to initialize image {file}: {str(e)}") from e
RuntimeError: Failed to initialize image /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png: OriginalImage.__init__() got an unexpected keyword argument 'input_path'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 35, in __init__
    self.scan_for_images()
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 77, in scan_for_images
    raise RuntimeError(f"Failed to scan for images: {str(e)}") from e
RuntimeError: Failed to scan for images: Failed to initialize image /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png: OriginalImage.__init__() got an unexpected keyword argument 'input_path'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/batch_processor.py", line 62, in scan_for_batches
    self.batches.append(Batch(input_path=item, output_path=output_dir))
                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 38, in __init__
    raise RuntimeError(f"Failed to initialize batch: {str(e)}") from e
RuntimeError: Failed to initialize batch: Failed to scan for images: Failed to initialize image /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png: OriginalImage.__init__() got an unexpected keyword argument 'input_path'
[red bold]Failed to initialize BatchProcessor[/]
[red bold]Pipeline test failed[/]
[blue]Starting pipeline test[/]
Initializing BatchProcessor with input_root=/Users/rob/repos/kalliste/test_images_input, output_root=/Users/rob/repos/kalliste/test_images_output
Scanning for batches in /Users/rob/repos/kalliste/test_images_input
Initializing Batch with input_path=/Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2, max_concurrent=3
Using default detection config: /Users/rob/repos/kalliste/kalliste/default_detection_config.yaml
Scanning for images in /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2
Failed to create OriginalImage for /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 60, in scan_for_images
    original_image = OriginalImage(
                     ^^^^^^^^^^^^^^
TypeError: OriginalImage.__init__() got an unexpected keyword argument 'input_path'
Error scanning for images in /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 60, in scan_for_images
    original_image = OriginalImage(
                     ^^^^^^^^^^^^^^
TypeError: OriginalImage.__init__() got an unexpected keyword argument 'input_path'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 68, in scan_for_images
    raise RuntimeError(f"Failed to initialize image {file}: {str(e)}") from e
RuntimeError: Failed to initialize image /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png: OriginalImage.__init__() got an unexpected keyword argument 'input_path'
Failed to scan for images in /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 60, in scan_for_images
    original_image = OriginalImage(
                     ^^^^^^^^^^^^^^
TypeError: OriginalImage.__init__() got an unexpected keyword argument 'input_path'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 68, in scan_for_images
    raise RuntimeError(f"Failed to initialize image {file}: {str(e)}") from e
RuntimeError: Failed to initialize image /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png: OriginalImage.__init__() got an unexpected keyword argument 'input_path'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 35, in __init__
    self.scan_for_images()
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 77, in scan_for_images
    raise RuntimeError(f"Failed to scan for images: {str(e)}") from e
RuntimeError: Failed to scan for images: Failed to initialize image /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png: OriginalImage.__init__() got an unexpected keyword argument 'input_path'
Failed to scan for batches
Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 60, in scan_for_images
    original_image = OriginalImage(
                     ^^^^^^^^^^^^^^
TypeError: OriginalImage.__init__() got an unexpected keyword argument 'input_path'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 68, in scan_for_images
    raise RuntimeError(f"Failed to initialize image {file}: {str(e)}") from e
RuntimeError: Failed to initialize image /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png: OriginalImage.__init__() got an unexpected keyword argument 'input_path'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 35, in __init__
    self.scan_for_images()
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 77, in scan_for_images
    raise RuntimeError(f"Failed to scan for images: {str(e)}") from e
RuntimeError: Failed to scan for images: Failed to initialize image /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png: OriginalImage.__init__() got an unexpected keyword argument 'input_path'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rob/repos/kalliste/kalliste/image/batch_processor.py", line 60, in scan_for_batches
    self.batches.append(Batch(input_path=item, output_path=output_dir))
                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rob/repos/kalliste/kalliste/image/batch.py", line 38, in __init__
    raise RuntimeError(f"Failed to initialize batch: {str(e)}") from e
RuntimeError: Failed to initialize batch: Failed to scan for images: Failed to initialize image /Users/rob/repos/kalliste/test_images_input/20180312_Photoshoot2/3M2A2876.png: OriginalImage.__init__() got an unexpected keyword argument 'input_path'
[red bold]Pipeline test failed[/]
